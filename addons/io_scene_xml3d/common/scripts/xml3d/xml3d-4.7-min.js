var XML3D=XML3D||{};XML3D.version=4.7;XML3D.xml3dNS="http://www.xml3d.org/2009/xml3d";XML3D.xhtmlNS="http://www.w3.org/1999/xhtml";XML3D.webglNS="http://www.xml3d.org/2009/xml3d/webgl";XML3D._xml3d=document.createElementNS(XML3D.xml3dNS,"xml3d");XML3D._native=!!XML3D._xml3d.style;XML3D._parallel=void 0!=XML3D._parallel?XML3D._parallel:!1;XML3D.createElement=function(e){return document.createElementNS(XML3D.xml3dNS,e)};
XML3D.extend=function(e,c){for(var b in c){var a=c.__lookupGetter__(b),d=c.__lookupSetter__(b);if(a||d)a&&e.__defineGetter__(b,a),d&&e.__defineSetter__(b,d);else if(void 0===c[b])delete e[b];else if("constructor"!==b||e!==window)e[b]=c[b]}return e};XML3D.isSuperclassOf=function(e,c){for(;c&&c.superclass;){if(c.superclass===e.prototype)return!0;c=c.superclass.constructor}return!1};
XML3D.createClass=function(e,c,b){b=b||{};if(c){var a=function(){};a.prototype=c.prototype;e.prototype=new a;e.prototype.constructor=e;e.superclass=c.prototype}e.isSuperclassOf=XML3D.isSuperclassOf.bind(e,e);for(var d in b)e.prototype[d]=b[d];return e};
(function(){function e(a){if(!(XML3D._native||-1<b.indexOf(a))){b.push(a);var c=XML3D.debug.setup();if(!XML3D.webgl||!XML3D.webgl.supported()){c&&XML3D.debug.logWarning("Could not initialise WebGL, sorry :-(");c=document.createElementNS(XML3D.xhtmlNS,"div");a.parentNode.insertBefore(c,a);c.appendChild(a);c.style.display="none";var g=document.createElementNS(XML3D.xhtmlNS,"div");g.setAttribute("class",a.getAttribute("class"));g.setAttribute("style",a.getAttribute("style"));g.style.border="2px solid red";
g.style.color="red";g.style.padding="10px";g.style.backgroundColor="rgba(255, 0, 0, 0.3)";var f=a.getAttribute("width");null!==f&&(g.style.width=f);f=a.getAttribute("height");null!==f&&(g.style.height=f);var f=document.createElement("h3"),h=document.createTextNode("Your browser doesn't appear to support XML3D.");f.appendChild(h);h=document.createElement("p");h.appendChild(document.createTextNode("Please visit "));var e=document.createElement("a");e.setAttribute("href","http://www.xml3d.org");e.appendChild(document.createTextNode("http://www.xml3d.org"));
h.appendChild(e);h.appendChild(document.createTextNode(" to get information about browsers supporting XML3D."));g.appendChild(f);g.appendChild(h);c.parentNode.insertBefore(g,c)}else{XML3D.debug.logInfo("Configuring",a.querySelectorAll("*").length,"elements");try{XML3D.config.configure(a)}catch(j){c&&XML3D.debug.logException(j);b.splice(b.indexOf(a),1);return}try{XML3D.webgl.configure(a)}catch(k){c&&XML3D.debug.logException(k);b.splice(b.indexOf(a),1);return}XML3D.base.sendAdapterEvent(a,{onConfigured:[]})}b.splice(b.indexOf(a),
1)}}function c(){if(XML3D.document)XML3D.document.onunload()}var b=[];document.addEventListener("DOMContentLoaded",function(){XML3D.options.setOptionsFromQuery();XML3D.css.init();var a=XML3D.debug.setup();a&&XML3D.debug.logInfo("xml3d.js version: "+XML3D.version);var b=document.querySelectorAll("xml3d");a&&XML3D.debug.logInfo("Found "+b.length+" xml3d node(s)");if(b.length&&XML3D._native)a&&XML3D.debug.logInfo("Using native implementation.");else{XML3D.xhtml=null!=document.xmlEncoding;for(a=0;a<b.length;a++)e(b[a])}},
!1);window.addEventListener("unload",c,!1);window.addEventListener("reload",c,!1);document.addEventListener("DOMNodeInserted",function(a){"xml3d"===a.target.tagName&&e(a.target)},!1);document.addEventListener("DOMNodeRemoved",function(a){if("xml3d"===a.target.tagName&&(a=a.target,!(-1<b.indexOf(a))&&(a._configured=void 0,a.parentNode))){var c=a.parentNode.previousElementSibling,g=a.parentNode.parentNode;g&&c&&"canvas"===c.tagName&&(g.removeChild(a.parentNode),g.removeChild(c))}},!1)})();(function(e){function c(a){var b;if(!isNaN(parseFloat(a))&&isFinite(a)){for(b in t)if(t[b]===a)return b;XML3D.debug.logDebug("Got unknown OpenCL Error Code:",a)}return"UNKNOWN_ERROR"}function b(a){var b=null;return a.name&&"string"===typeof a.name&&t[a.name]?t[a.name]:a.message&&"string"===typeof a.message&&(b=a.message.match(/-?\d+/g),b instanceof Array)?parseInt(b[b.length-1],10):!1}function a(a,b){a&&"string"!==typeof a&&(XML3D.debug.logDebug("WebCL API: WebCLError: Error name not type of String"),
a="");b&&"string"!==typeof b&&(XML3D.debug.logDebug("WebCL API: WebCLError: Error message not type of String"),b="");this.name=a||"WebCLError";this.message=b||"Generic WebCL error.";this.stack=Error().stack}function d(){return q=window.WebCL&&WebCL.getPlatforms}function g(){var a;r=!0;try{a=WebCL.getPlatforms()}catch(b){r=!1}if(!a||0===a.length)r=!1;return r}function f(){0===o.length&&(o=WebCL.getPlatforms());return o}function h(d,g){var f=[];if(!g)return XML3D.debug.logError("WebCL API: getPlatformDevicesByType(): platform was not defined."),
!1;d=d||v;try{"CPU"===d?f=g.getDevices(WebCL.DEVICE_TYPE_CPU):"GPU"===d?f=g.getDevices(WebCL.DEVICE_TYPE_GPU):"ALL"===d&&(f=g.getDevices(WebCL.DEVICE_TYPE_ALL))}catch(m){if(f=b(m)){if(f!==t.DEVICE_NOT_FOUND)throw new a(c(f),"Could not get devices.");}else throw m;return!1}return f}function i(a){var b=[],c,d;f();for(d=o.length;d--;)(c=h(a,o[d]))&&c.forEach(function(a){b.push(a)});return 0===b.length?!1:b}function j(d){var g={devices:i(v)},f;XML3D.extend(g,d);try{f=WebCL.createContext(g)}catch(m){d=
b(m);if(!d)throw m;throw new a(c(d),"Failed to create a WebCL context.");}return f}function k(d,g){var f,g=g||p;if(!d)return XML3D.debug.logError("WebCL API: createProgram(): codeStr was not defined."),!1;if(!g)return XML3D.debug.logError("WebCL API: createProgram(): clCtx was not defined."),!1;try{f=g.createProgram(d)}catch(m){f=b(m);if(!f)throw m;throw new a(c(f),"Failed to create a WebCL program.");}return f}function l(d,g){g=g||n;if(!d)return XML3D.debug.logError("WebCL API: buildProgram(): program was not defined."),
!1;try{d.build(g,"")}catch(f){var m=b(f);if(!m)throw f;throw new a(c(m),d.getBuildInfo(g[0],WebCL.CL_PROGRAM_BUILD_LOG));}return d}function m(d,g){var f;if(!d)return XML3D.debug.logError("WebCL API: createKernel(): program was not defined."),!1;if(!g)return XML3D.debug.logError("WebCL API: createKernel(): name was not defined."),!1;try{f=d.createKernel(g)}catch(m){f=b(m);if(!f)throw m;throw new a(c(f),"Failed to create a WebCL kernel.");}return f}var o=[],n=[],p=null,q=!1,r=!1,v="CPU",t={SUCCESS:0,
DEVICE_NOT_FOUND:-1,DEVICE_NOT_AVAILABLE:-2,COMPILER_NOT_AVAILABLE:-3,MEM_OBJECT_ALLOCATION_FAILURE:-4,OUT_OF_RESOURCES:-5,OUT_OF_HOST_MEMORY:-6,PROFILING_INFO_NOT_AVAILABLE:-7,MEM_COPY_OVERLAP:-8,IMAGE_FORMAT_MISMATCH:-9,IMAGE_FORMAT_NOT_SUPPORTED:-10,BUILD_PROGRAM_FAILURE:-11,MAP_FAILURE:-12,INVALID_VALUE:-30,INVALID_DEVICE_TYPE:-31,INVALID_PLATFORM:-32,INVALID_DEVICE:-33,INVALID_CONTEXT:-34,INVALID_QUEUE_PROPERTIES:-35,INVALID_COMMAND_QUEUE:-36,INVALID_HOST_PTR:-37,INVALID_MEM_OBJECT:-38,INVALID_IMAGE_FORMAT_DESCRIPTOR:-39,
INVALID_IMAGE_SIZE:-40,INVALID_SAMPLER:-41,INVALID_BINARY:-42,INVALID_BUILD_OPTIONS:-43,INVALID_PROGRAM:-44,INVALID_PROGRAM_EXECUTABLE:-45,INVALID_KERNEL_NAME:-46,INVALID_KERNEL_DEFINITION:-47,INVALID_KERNEL:-48,INVALID_ARG_INDEX:-49,INVALID_ARG_VALUE:-50,INVALID_ARG_SIZE:-51,INVALID_KERNEL_ARGS:-52,INVALID_WORK_DIMENSION:-53,INVALID_WORK_GROUP_SIZE:-54,INVALID_WORK_ITEM_SIZE:-55,INVALID_GLOBAL_OFFSET:-56,INVALID_EVENT_WAIT_LIST:-57,INVALID_EVENT:-58,INVALID_OPERATION:-59,INVALID_GL_OBJECT:-60,INVALID_BUFFER_SIZE:-61,
INVALID_MIP_LEVEL:-62,INVALID_GLOBAL_WORK_SIZE:-63};Object.freeze(t);a.prototype=Object.create(Error.prototype);a.prototype.constructor=a;var y=function(d,g){var f={};return{register:function(a,b){if(f.hasOwnProperty(a))return XML3D.debug.logWarning("WebCL API: kernels.register(): Kernel with a same name is already defined."),!1;if("string"!==typeof a)return XML3D.debug.logError("WebCL API: kernels.register(): Kernel name was not defined or was not type of String."),!1;if("string"!==typeof b)return XML3D.debug.logError("WebCL API: kernels.register(): Kernel code was not defined or was not type of String."),
!1;var c,h;c=k(b,d);l(c,g);c&&(h=m(c,a));return h?(f[a]=h,!0):!1},unRegister:function(d){if(f.hasOwnProperty(d)){try{f[d].release()}catch(g){d=b(g);if(!d)throw g;throw new a(c(d),"Could not release kernel resources.");}delete f[d];return!0}return!1},getKernel:function(a){return"string"!==typeof a?!1:f.hasOwnProperty(a)?f[a]:!1},setArgs:function(){var d=Array.prototype.slice.call(arguments),g,f;if(2>d.length)return XML3D.debug.logWarning("WebCL API: setArgs(): No kernel arguments were defined."),!1;
g=d[0];d=d.slice(1);if(!g)return XML3D.debug.logWarning("WebCL API: setArgs(): WebCL kernel was not defined."),!1;f=g.getInfo(WebCL.CL_KERNEL_NUM_ARGS);if(d.length>f)XML3D.debug.logWarning("WebCL: setArgs: Input args amount > kernel program args amount! Ignoring extra arguments.");else if(d.length<f)return XML3D.debug.logError("WebCL: setArgs: Not enough arguments were given to WebCL kernel."),!1;XML3D.debug.logDebug("Args for kernel:",g.getInfo(WebCL.KERNEL_FUNCTION_NAME));try{for(;f--;)XML3D.debug.logDebug("Arg:",
f,d[f]),g.setArg(f,d[f])}catch(m){g=b(m);if(!g)throw m;throw new a(c(g),"Could not set kernel arguments.");}return!0}}};e.webcl={init:function(a){if(!d())return XML3D.debug.logWarning("WebCL API: Unfortunately your system does not support WebCL. WebCL namespace is not available."),!1;if(!g())return XML3D.debug.logWarning("WebCL API: Unfortunately your system does not support WebCL. OpenCL drivers are not working properly."),!1;f();n=i(a||v);p=j({devices:n});return!0},createContext:j,createProgram:k,
buildProgram:l,createKernel:m,createCommandQueue:function(d,g){var f,g=g||p;if(!g)return XML3D.debug.logError("WebCL API: createCommandQueue: clCtx was not defined"),!1;try{f=g.createCommandQueue(d||n[0],0)}catch(m){if(!b(m))throw m;throw new a(c(b(m)),"Could not create CommandQueue.");}return f},createBuffer:function(d,g,f){f=f||p;if(d){if(isNaN(parseFloat(d))||!isFinite(d)||0>d)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer size must be a positive number."),!1}else return XML3D.debug.logError("WebCL API: createBuffer(): Buffer size was not defined."),
!1;if(!g)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer type was not defined."),!1;if(!f)return XML3D.debug.logError("WebCL API: createBuffer(): clCtx was not defined."),!1;try{if("r"===g)return f.createBuffer(WebCL.CL_MEM_READ_ONLY,d);if("w"===g)return f.createBuffer(WebCL.CL_MEM_WRITE_ONLY,d);if("rw"===g)return f.createBuffer(WebCL.CL_MEM_READ_WRITE,d);XML3D.debug.logError("WebCL API: createBuffer(): Unknown buffer type:",g);return!1}catch(m){d=b(m);if(!d)throw m;throw new a(c(d),
"Could not create a WebCL buffer.");}},getDefaultContext:function(){return p},getPlatforms:f,getDevicesByType:i,getContextDevices:function(d){var g=[];if(!d)return XML3D.debug.logError("WebCL API: getContextDevices(): clCtx was not defined."),!1;try{g=d.getInfo(WebCL.CONTEXT_DEVICES)}catch(f){if(d=b(f))throw new a(c(d),"Could not get devices.");throw f;}return 0===g.length?!1:g},getDevicePlatform:function(d){var g;if(!d)return XML3D.debug.logError("WebCL API: getDevicePlatform(): device was not defined."),
!1;try{g=d.getInfo(WebCL.DEVICE_PLATFORM)}catch(f){d=b(f);if(!d)throw f;throw new a(c(d),"Could not get the platform of the device.");}return g},kernels:new y,KernelManager:y,hasWebCLNamespace:d,hasOpenCLDrivers:g,isAvailable:function(){return d()&&g()},WebCLError:a,getCLErrorName:c}})(XML3D=XML3D||{});
XML3D.setParameter=function(e,c,b){if(e=document.getElementById(e))for(var e=e.childNodes,a=0;a<e.length;a++){var d=e[a];if(d.nodeType===Node.ELEMENT_NODE&&d.name==c&&"string"===typeof b){for(;d.hasChildNodes();)d.removeChild(d.lastChild);d.appendChild(document.createTextNode(b));return!0}}return!1};
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,c){window.setTimeout(e,1E3/c)}}();
(function(){XML3D.util||(XML3D.util={});var e=XML3D.util;e.dispatchEvent=function(b,a){var d=null;if(document.createEvent){d=document.createEvent("Events");d.initEvent(a,true,true);b.dispatchEvent(d)}else if(document.createEventObject){d=document.createEventObject();b.fireEvent("on"+a,d)}};e.dispatchCustomEvent=function(b,a,d,c,f){var h=document.createEvent("CustomEvent");h.initCustomEvent(a,d,c,f);b.dispatchEvent(h)};e.getStyle=function(b,a){var d="";if(document.defaultView&&document.defaultView.getComputedStyle)d=
document.defaultView.getComputedStyle(b,"").getPropertyValue(a);else if(b.currentStyle){a=a.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()});d=b.currentStyle[a]}return d};e.evaluateXPathExpr=function(b,a){return document.evaluate(a,b,function(){return XML3D.xml3dNS},XPathResult.FIRST_ORDERED_NODE_TYPE,null)};var c=0;e.getOrCreateActiveView=function(b){var a=b.activeView;if(a){var d=XML3D.URIResolver.resolveLocal(a);if(!d)throw"XML3D Error: xml3d references view that is not defined: '"+a+"'.";
return d}if(d=XML3D.xhtml?XML3D.util.evaluateXPathExpr(b,".//xml3d:view[1]").singleNodeValue:b.getElementsByTagName("view")[0]){if(d.id&&d.id.length>0)b.activeView="#"+d.id;return d}XML3D.debug.logWarning("xml3d element has no view defined: creating one.");a="xml3d.autocreatedview_"+c++;d=XML3D.createElement("view");d.setAttribute("id",a);b.appendChild(d);b.setAttribute("activeView","#"+a);return d}})();
Array.forEach||(Array.forEach=function(e,c,b){for(var a=e.length,d=0;d<a;d++)d in e&&c.call(b,e[d],d,e)});Array.map||(Array.map=function(e,c,b){for(var a=e.length,d=[],g=0;g<a;g++)g in e&&(d[g]=c.call(b,e[g],g,e));return d});Array.filter||(Array.filter=function(e,c,b){for(var a=e.length,d=[],g=0;g<a;g++)if(g in e){var f=e[g];c.call(b,f,g,e)&&d.push(f)}return d});Array.erase||(Array.erase=function(e,c){for(var b=false,a=-1;(a=e.indexOf(c))!=-1;){e.splice(a,1);b=true}return b});
Array.set||(Array.set=function(e,c,b){for(var a=0;a<b.length;a++)e[c+a]=b[a]});Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)=="[object Array]"});
(function(e){var c=function(){this._options={};this._listeners={"*":[]}};c.prototype={register:function(b,a){if(this._options.hasOwnProperty(b))throw Error("Option already registered '"+b+"'");this._options[b]={currentValue:a,defaultValue:a}},resetValue:function(b){if(!this._options.hasOwnProperty(b))throw Error("Invalid configuration key '"+b+"'");this._options[b].currentValue=this._options[b].defaultValue;this.notifyObservers(b,this._options[b].currentValue)},setValue:function(b,a){if(!this._options.hasOwnProperty(b))throw Error("Invalid configuration key '"+
b+"'");this._options[b].currentValue=a;this.notifyObservers(b,a)},getValue:function(b){if(!this._options.hasOwnProperty(b))throw Error("Invalid configuration key '"+b+"'");return this._options[b].currentValue},getKeys:function(){return Object.keys(this._options)},notifyObservers:function(b,a){this._listeners.hasOwnProperty(b)&&this._listeners[b].forEach(function(d){d(b,a)});this._listeners["*"].forEach(function(d){d(b,a)})},addObserver:function(b,a){if(typeof b=="function"){a=b;b="*"}if(!this._options.hasOwnProperty(b)&&
b!=="*")throw Error("Can't register to unknown option '"+b+"'");this._listeners.hasOwnProperty(b)||(this._listeners[b]=[]);this._listeners[b].push(a)},removeObserver:function(b){for(var a in this._listeners){var d=this._listeners[a],c=d.indexOf(b);c!=-1&&d.splice(c,1)}}};c=new c;c.setOptionsFromQuery=function(){window.location.search.substr(1).split("&").forEach(function(b){b=b.split("=");try{var a=b[0].toLowerCase();if(a.indexOf("xml3d-")===0){var d=decodeURIComponent(b[1]);try{d=JSON.parse(d)}catch(c){}XML3D.options.setValue(a.substr(6),
d)}}catch(f){XML3D.debug&&XML3D.debug.logError(f)}})};e.options=c})(XML3D);
(function(e){XML3D.options.register("loglevel","warning");e.debug={ALL:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4,EXCEPTION:5,params:{},isSetup:false,loglevel:4,loglevels:{all:0,debug:1,info:2,warning:3,error:4,exception:5},setup:function(){var c=XML3D.debug;if(!c.isSetup){c.isSetup=true;c.loglevel=c.loglevels[XML3D.options.getValue("loglevel")]||3;XML3D.options.addObserver(function(b,a){if(b=="loglevel")c.loglevel=c.loglevels[a]||3})}return true},_setLogLevel:function(){},doLog:function(c,b){if(!(XML3D.debug.params.xml3d_nolog||
c<XML3D.debug.loglevel)){b=Array.prototype.slice.call(b);if(window.console)switch(c){case XML3D.debug.INFO:window.console.info.apply(window.console,b);break;case XML3D.debug.WARNING:window.console.warn.apply(window.console,b);break;case XML3D.debug.ERROR:window.console.error.apply(window.console,b);break;case XML3D.debug.EXCEPTION:window.console.error(XML3D.debug.printStackTrace({e:b[0],guess:true}).join("\n"));break;case XML3D.debug.DEBUG:window.console.debug.apply(window.console,b)}}},logDebug:function(){XML3D.debug.doLog(XML3D.debug.DEBUG,
arguments)},logInfo:function(){XML3D.debug.doLog(XML3D.debug.INFO,arguments)},logWarning:function(){XML3D.debug.doLog(XML3D.debug.WARNING,arguments)},logError:function(){XML3D.debug.doLog(XML3D.debug.ERROR,arguments)},logException:function(){XML3D.debug.doLog(XML3D.debug.EXCEPTION,arguments)},assert:function(c,b){if(!c){var a=XML3D.debug.assert.caller?XML3D.debug.assert.caller.name:null;a?XML3D.debug.doLog(XML3D.debug.WARNING,["Assertion failed in "+a,b]):XML3D.debug.doLog(XML3D.debug.WARNING,["Assertion failed",
b])}},trace:function(c,b){b=b!==void 0?b:XML3D.debug.ERROR;if(window.console.trace){c&&XML3D.debug.doLog(b,[c]);window.console.trace()}else{var a=XML3D.debug.printStackTrace();c&&a.splice(0,0,c);XML3D.debug.doLog(b,a)}},getNumberWithPadding:function(c,b){for(var a=""+c;a.length<b;)a=" "+a;return a},formatSourceCode:function(c){for(var b="",c=c.split("\n"),a=0;a<c.length;++a)b=b+(this.getNumberWithPadding(a+1,3)+"  "+c[a]+"\n");return b}}})(XML3D);
XML3D.URI=function(e){e=e||"";if(e.indexOf("blob:")==0){var c=/^(?:([^:\/?\#]+):)?([^\#]*)(?:\#(.*))?/,e=e.match(c);this.valid=e!=null;this.scheme=e[1]||null;this.query=this.path=this.authority=null;this.opaqueString=e[2]||null;this.fragment=e[3]||null}else{c=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/;e=e.match(c);this.valid=e!=null;this.scheme=e[1]||null;this.authority=e[2]||null;this.path=e[3]||null;this.query=e[4]||null;this.opaqueString=null;this.fragment=e[5]||
null}};XML3D.URI.prototype.isLocal=function(){return this.scheme!="blob"&&!this.authority&&!this.path};XML3D.URI.prototype.isAbsolute=function(){return this.scheme!=null};XML3D.URI.prototype.getAbsoluteURI=function(e){if(!this.valid||this.isAbsolute())return this;e=new XML3D.URI(e);if(this.path){e.path=this.path.indexOf("/")==0?this.path:e.path.substr(0,e.path.lastIndexOf("/")+1)+this.path;e.query=this.query}else if(this.query)e.query=this.query;e.fragment=this.fragment;return e};
XML3D.URI.prototype.hasSameOrigin=function(e){typeof e=="string"&&(e=new XML3D.URI(e));return this.scheme=="blob"?true:this.scheme==e.scheme&&this.authority==e.authority};
XML3D.URI.prototype.toString=function(){var e="";if(this.scheme=="blob"){e="blob:"+this.opaqueString;this.fragment&&(e=e+("#"+this.fragment));return e}this.scheme&&(e=e+(this.scheme+":"));this.authority&&(e=e+("//"+this.authority));this.path&&(e=e+this.path);this.query&&(e=e+("?"+this.query));this.fragment&&(e=e+("#"+this.fragment));return e};
XML3D.URI.prototype.toStringWithoutFragment=function(){var e="";if(this.scheme=="blob")return e="blob:"+this.opaqueString;this.scheme&&(e=e+(this.scheme+":"));this.authority&&(e=e+("//"+this.authority));this.path&&(e=e+this.path);this.query&&(e=e+("?"+this.query));return e};XML3D.URIResolver=function(){};
XML3D.URIResolver.resolveLocal=function(e,c){typeof e=="string"&&(e=new XML3D.URI(e));c=c||window.document;return e.scheme=="urn"||e.scheme=="blob"?null:!e.path&&e.fragment?c.getElementById(e.fragment):null};XML3D.URIResolver.resolve=function(e,c){XML3D.debug.logWarning("You are using deprecated XML3D.URIResolver.resolve. Use XML3D.URIResolver.resolveLocal instead.");return XML3D.URIResolver.resolveLocal(e,c)};
(function(){XML3D.css={};XML3D.css.TRANSFORM_PROPERTY=null;XML3D.css.init=function(){"transform"in document.body.style?XML3D.css.TRANSFORM_PROPERTY="transform":"WebkitTransform"in document.body.style?XML3D.css.TRANSFORM_PROPERTY="-webkit-transform":"MozTransform"in document.body.style?XML3D.css.TRANSFORM_PROPERTY="-moz-transform":XML3D.debug.logWarning("No supported transform css property found")};XML3D.css.getInlinePropertyValue=function(e,c){var b=e.getAttribute("style");if(b)if(b=RegExp(c+"s*:([^;]+)",
"i").exec(b))return b[1].trim();return null};XML3D.css.getPropertyValue=function(e,c){var b=this.getInlinePropertyValue(e,c);return b?b:window.getComputedStyle(e).getPropertyValue(c)};XML3D.css.getCSSMatrix=function(e){if(!XML3D.css.TRANSFORM_PROPERTY||!XML3D.css.CSSMatrix)return null;var c=null;XML3D.css.TRANSFORM_PROPERTY!="transform"&&(c=XML3D.css.getInlinePropertyValue(e,"transform"));c||(c=XML3D.css.getPropertyValue(e,XML3D.css.TRANSFORM_PROPERTY));if(!c||c=="none")return null;e=null;try{e=new XML3D.css.CSSMatrix(c)}catch(b){XML3D.debug.logError("Error parsing transform property: "+
c)}return e}})();var FirminCSSMatrix=function(e){this.m11=this.m22=this.m33=this.m44=1;this.m12=this.m13=this.m14=this.m21=this.m23=this.m24=this.m31=this.m32=this.m34=this.m41=this.m42=this.m43=0;typeof e=="string"&&this.setMatrixValue(e)};FirminCSSMatrix.displayName="FirminCSSMatrix";FirminCSSMatrix.degreesToRadians=function(e){return e*Math.PI/180};FirminCSSMatrix.determinant2x2=function(e,c,b,a){return e*a-c*b};
FirminCSSMatrix.determinant3x3=function(e,c,b,a,d,g,f,h,i){var j=FirminCSSMatrix.determinant2x2;return e*j(d,g,h,i)-a*j(c,b,h,i)+f*j(c,b,d,g)};FirminCSSMatrix.determinant4x4=function(e){var c=FirminCSSMatrix.determinant3x3,b=e.m21,a=e.m31,d=e.m41,g=e.m12,f=e.m22,h=e.m32,i=e.m42,j=e.m13,k=e.m23,l=e.m33,m=e.m43,o=e.m14,n=e.m24,p=e.m34,q=e.m44;return e.m11*c(f,k,n,h,l,p,i,m,q)-b*c(g,j,o,h,l,p,i,m,q)+a*c(g,j,o,f,k,n,i,m,q)-d*c(g,j,o,f,k,n,h,l,p)};
FirminCSSMatrix.toMatrixString=function(e){var c=/(\w+)\(([^\)]+)\)/i,b=e.match(/(\w+)\([^\)]+\)/ig),a=b&&b.every(function(a){return/^matrix/.test(a)});if(!b||a)return e;var d=function(a){return a.value},g={matrix:function(a,b){var d=new FirminCSSMatrix(b.unparsed);return a.multiply(d)},matrix3d:function(a,b){var d=new FirminCSSMatrix(b.unparsed);return a.multiply(d)},perspective:function(a,b){var d=new FirminCSSMatrix;d.m34=d.m34-1/b.value[0].value;return a.multiply(d)},rotate:function(a,b){return a.rotate.apply(a,
b.value.map(d))},rotate3d:function(a,b){return a.rotateAxisAngle.apply(a,b.value.map(d))},rotateX:function(a,b){return a.rotate.apply(a,[b.value[0].value,0,0])},rotateY:function(a,b){return a.rotate.apply(a,[0,b.value[0].value,0])},rotateZ:function(a,b){return a.rotate.apply(a,[0,0,b.value[0].value])},scale:function(a,b){return a.scale.apply(a,b.value.map(d))},scale3d:function(a,b){return a.scale.apply(a,b.value.map(d))},scaleX:function(a,b){return a.scale.apply(a,b.value.map(d))},scaleY:function(a,
b){return a.scale.apply(a,[0,b.value[0].value,0])},scaleZ:function(a,b){return a.scale.apply(a,[0,0,b.value[0].value])},skew:function(a,b){var d=new FirminCSSMatrix("skewX("+b.value[0].unparsed+")"),d="matrix(1.00000, "+(new FirminCSSMatrix("skewY("+b.value[1].unparsed+")")).b+", "+d.c+", 1.000000, 0.000000, 0.000000)",d=new FirminCSSMatrix(d);return a.multiply(d)},skewX:function(a,b){return a.skewX.apply(a,[b.value[0].value])},skewY:function(a,b){return a.skewY.apply(a,[b.value[0].value])},translate:function(a,
b){return a.translate.apply(a,b.value.map(d))},translate3d:function(a,b){return a.translate.apply(a,b.value.map(d))},translateX:function(a,b){return a.translate.apply(a,[b.value[0].value,0,0])},translateY:function(a,b){return a.translate.apply(a,[0,b.value[0].value,0])},translateZ:function(a,b){return a.translate.apply(a,[0,0,b.value[0].value])}},e=b.map(function(a){var b=a.match(c).slice(1);return{key:b[0],value:b[1].split(/, ?/).map(function(a){var b=a.match(/([-\+]?[0-9]+[\.0-9]*)(deg|rad|grad|px|%)*/)||
[];return{value:parseFloat(b[1]),units:b[2],unparsed:a}}),unparsed:a}}),b=new FirminCSSMatrix;return e.reduce(function(a,b){b.value=b.value.map(function(a){if(a.units=="rad"){a.value=a.value*(180/Math.PI);a.units="deg"}else if(a.units=="grad"){a.value=a.value/(400/360);a.units="deg"}return a});return(0,g[b.key])(a,b)||a},b).toString()};
[["m11","a"],["m12","b"],["m21","c"],["m22","d"],["m41","e"],["m42","f"]].forEach(function(e){var c=e[0];Object.defineProperty(FirminCSSMatrix.prototype,e[1],{set:function(b){this[c]=b},get:function(){return this[c]},enumerable:true,configurable:true})});FirminCSSMatrix.prototype.isAffine=function(){return this.m13===0&&this.m14===0&&this.m23===0&&this.m24===0&&this.m31===0&&this.m32===0&&this.m33===1&&this.m34===0&&this.m43===0&&this.m44===1};
FirminCSSMatrix.prototype.multiply=function(e){if(!e)return null;var c=new FirminCSSMatrix;c.m11=e.m11*this.m11+e.m12*this.m21+e.m13*this.m31+e.m14*this.m41;c.m12=e.m11*this.m12+e.m12*this.m22+e.m13*this.m32+e.m14*this.m42;c.m13=e.m11*this.m13+e.m12*this.m23+e.m13*this.m33+e.m14*this.m43;c.m14=e.m11*this.m14+e.m12*this.m24+e.m13*this.m34+e.m14*this.m44;c.m21=e.m21*this.m11+e.m22*this.m21+e.m23*this.m31+e.m24*this.m41;c.m22=e.m21*this.m12+e.m22*this.m22+e.m23*this.m32+e.m24*this.m42;c.m23=e.m21*this.m13+
e.m22*this.m23+e.m23*this.m33+e.m24*this.m43;c.m24=e.m21*this.m14+e.m22*this.m24+e.m23*this.m34+e.m24*this.m44;c.m31=e.m31*this.m11+e.m32*this.m21+e.m33*this.m31+e.m34*this.m41;c.m32=e.m31*this.m12+e.m32*this.m22+e.m33*this.m32+e.m34*this.m42;c.m33=e.m31*this.m13+e.m32*this.m23+e.m33*this.m33+e.m34*this.m43;c.m34=e.m31*this.m14+e.m32*this.m24+e.m33*this.m34+e.m34*this.m44;c.m41=e.m41*this.m11+e.m42*this.m21+e.m43*this.m31+e.m44*this.m41;c.m42=e.m41*this.m12+e.m42*this.m22+e.m43*this.m32+e.m44*this.m42;
c.m43=e.m41*this.m13+e.m42*this.m23+e.m43*this.m33+e.m44*this.m43;c.m44=e.m41*this.m14+e.m42*this.m24+e.m43*this.m34+e.m44*this.m44;return c};FirminCSSMatrix.prototype.isIdentityOrTranslation=function(){return this.m11===1&&this.m12===0&&this.m13===0&&this.m14===0&&this.m21===0&&this.m22===1&&this.m23===0&&this.m24===0&&this.m31===0&&this.m31===0&&this.m33===1&&this.m34===0&&this.m44===1};
FirminCSSMatrix.prototype.adjoint=function(){var e=new FirminCSSMatrix,c=FirminCSSMatrix.determinant3x3,b=this.m11,a=this.m12,d=this.m13,g=this.m14,f=this.m21,h=this.m22,i=this.m23,j=this.m24,k=this.m31,l=this.m32,m=this.m33,o=this.m34,n=this.m41,p=this.m42,q=this.m43,r=this.m44;e.m11=c(h,l,p,i,m,q,j,o,r);e.m21=-c(f,k,n,i,m,q,j,o,r);e.m31=c(f,k,n,h,l,p,j,o,r);e.m41=-c(f,k,n,h,l,p,i,m,q);e.m12=-c(a,l,p,d,m,q,g,o,r);e.m22=c(b,k,n,d,m,q,g,o,r);e.m32=-c(b,k,n,a,l,p,g,o,r);e.m42=c(b,k,n,a,l,p,d,m,q);e.m13=
c(a,h,p,d,i,q,g,j,r);e.m23=-c(b,f,n,d,i,q,g,j,r);e.m33=c(b,f,n,a,h,p,g,j,r);e.m43=-c(b,f,n,a,h,p,d,i,q);e.m14=-c(a,h,l,d,i,m,g,j,o);e.m24=c(b,f,k,d,i,m,g,j,o);e.m34=-c(b,f,k,a,h,l,g,j,o);e.m44=c(b,f,k,a,h,l,d,i,m);return e};
FirminCSSMatrix.prototype.inverse=function(){var e,c,b,a;if(this.isIdentityOrTranslation()){e=new FirminCSSMatrix;if(!(this.m41===0&&this.m42===0&&this.m43===0)){e.m41=-this.m41;e.m42=-this.m42;e.m43=-this.m43}return e}c=this.adjoint();e=FirminCSSMatrix.determinant4x4(this);if(Math.abs(e)<1.0E-8)return null;for(b=1;b<5;b++)for(a=1;a<5;a++)c["m"+b+a]=c["m"+b+a]/e;return c};
FirminCSSMatrix.prototype.rotate=function(e,c,b){var a=FirminCSSMatrix.degreesToRadians;if(typeof e!="number"||isNaN(e))e=0;if((typeof c!="number"||isNaN(c))&&(typeof b!="number"||isNaN(b))){b=e;c=e=0}if(typeof c!="number"||isNaN(c))c=0;if(typeof b!="number"||isNaN(b))b=0;var e=a(e),c=a(c),b=a(b),a=new FirminCSSMatrix,d=new FirminCSSMatrix,g=new FirminCSSMatrix,f,b=b/2;f=Math.sin(b);b=Math.cos(b);g.m11=g.m22=1-2*f*f;g.m12=g.m21=2*f*b;g.m21=g.m21*-1;c=c/2;f=Math.sin(c);b=Math.cos(c);d.m11=d.m33=1-
2*f*f;d.m13=d.m31=2*f*b;d.m13=d.m13*-1;e=e/2;f=Math.sin(e);b=Math.cos(e);a.m22=a.m33=1-2*f*f;a.m23=a.m32=2*f*b;a.m32=a.m32*-1;return this.toString()===(new FirminCSSMatrix).toString()?g.multiply(d).multiply(a):this.multiply(a).multiply(d).multiply(g)};
FirminCSSMatrix.prototype.rotateAxisAngle=function(e,c,b,a){if(typeof e!="number"||isNaN(e))e=0;if(typeof c!="number"||isNaN(c))c=0;if(typeof b!="number"||isNaN(b))b=0;if(typeof a!="number"||isNaN(a))a=0;e===0&&c===0&&b===0&&(b=1);var d=new FirminCSSMatrix,g=Math.sqrt(e*e+c*c+b*b),f,h,i,a=(FirminCSSMatrix.degreesToRadians(a)||0)/2;f=Math.cos(a);h=Math.sin(a);a=h*h;if(g===0){c=e=0;b=1}else if(g!==1){e=e/g;c=c/g;b=b/g}if(e===1&&c===0&&b===0){d.m22=d.m33=1-2*a;d.m23=d.m32=2*f*h;d.m32=d.m32*-1}else if(e===
0&&c===1&&b===0){d.m11=d.m33=1-2*a;d.m13=d.m31=2*f*h;d.m13=d.m13*-1}else if(e===0&&c===0&&b===1){d.m11=d.m22=1-2*a;d.m12=d.m21=2*f*h;d.m21=d.m21*-1}else{g=h*f;f=e*e;h=c*c;i=b*b;d.m11=1-2*(h+i)*a;d.m12=2*(e*c*a+b*g);d.m13=2*(e*b*a-c*g);d.m21=2*(c*e*a-b*g);d.m22=1-2*(i+f)*a;d.m23=2*(c*b*a+e*g);d.m31=2*(b*e*a+c*g);d.m32=2*(b*c*a-e*g);d.m33=1-2*(f+h)*a}return this.multiply(d)};
FirminCSSMatrix.prototype.scale=function(e,c,b){var a=new FirminCSSMatrix;if(typeof e!="number"||isNaN(e))e=1;if(typeof c!="number"||isNaN(c))c=e;if(typeof b!="number"||isNaN(b))b=1;a.m11=e;a.m22=c;a.m33=b;return this.multiply(a)};FirminCSSMatrix.prototype.skewX=function(e){var e=FirminCSSMatrix.degreesToRadians(e),c=new FirminCSSMatrix;c.c=Math.tan(e);return this.multiply(c)};
FirminCSSMatrix.prototype.skewY=function(e){var e=FirminCSSMatrix.degreesToRadians(e),c=new FirminCSSMatrix;c.b=Math.tan(e);return this.multiply(c)};FirminCSSMatrix.prototype.translate=function(e,c,b){var a=new FirminCSSMatrix;if(typeof e!="number"||isNaN(e))e=0;if(typeof c!="number"||isNaN(c))c=0;if(typeof b!="number"||isNaN(b))b=0;a.m41=e;a.m42=c;a.m43=b;return this.multiply(a)};
FirminCSSMatrix.prototype.setMatrixValue=function(e){var e=FirminCSSMatrix.toMatrixString(e.trim()),c=e.match(/^matrix(3d)?\(\s*(.+)\s*\)$/),b,a,d,g,f;if(c){b=!!c[1];c=c[2].split(/\s*,\s*/);a=c.length;d=Array(a);if(b&&a!==16||!(b||a===6))XML3D.debug.logError("Invalid CSS Matrix: ",e);else{for(g=0;g<a;g++){f=c[g];if(f.match(/^-?\d+(\.\d+)?$/))d[g]=parseFloat(f);else{XML3D.debug.logError("Invalid CSS Matrix: ",e);return}}for(g=0;g<a;g++)this[b?"m"+(Math.floor(g/4)+1)+(g%4+1):String.fromCharCode(g+97)]=
d[g]}}};FirminCSSMatrix.prototype.toString=function(){var e=this,c,b;if(this.isAffine()){b="matrix(";c=["a","b","c","d","e","f"]}else{b="matrix3d(";c=["m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44"]}return b+c.map(function(a){return e[a].toFixed(6)}).join(", ")+")"};XML3D.css.CSSMatrix=FirminCSSMatrix;
XML3D.css.convertCssToMat4=function(e,c){var b=c||XML3D.math.mat4.create();b[0]=e.m11;b[1]=e.m12;b[2]=e.m13;b[3]=e.m14;b[4]=e.m21;b[5]=e.m22;b[6]=e.m23;b[7]=e.m24;b[8]=e.m31;b[9]=e.m32;b[10]=e.m33;b[11]=e.m34;b[12]=e.m41;b[13]=e.m42;b[14]=e.m43;b[15]=e.m44;return b};XML3D.math={};var GLU={};
(function(e){e.unProject=function(c,b,a,d,g,f,h){c=[c,b,a,1];b=[];e.multMatrices(d,g,b);if(!e.invertMatrix(b,b))return!1;c[0]=(c[0]-f[0])/f[2];c[1]=(c[1]-f[1])/f[3];c[0]=2*c[0]-1;c[1]=2*c[1]-1;c[2]=2*c[2]-1;d=[];e.multMatrixVec(b,c,d);if(0===d[3])return!1;d[0]/=d[3];d[1]/=d[3];d[2]/=d[3];h[0]=d[0];h[1]=d[1];h[2]=d[2];return!0};e.multMatrixVec=function(c,b,a){for(var d=0;4>d;d+=1)a[d]=b[0]*c[0+d]+b[1]*c[4+d]+b[2]*c[8+d]+b[3]*c[12+d]};e.multMatrices=function(c,b,a){for(var d=0;4>d;d+=1)for(var g=0;4>
g;g+=1)a[4*d+g]=c[4*d+0]*b[0+g]+c[4*d+1]*b[4+g]+c[4*d+2]*b[8+g]+c[4*d+3]*b[12+g]};e.invertMatrix=function(c,b){var a=[];a[0]=c[5]*c[10]*c[15]-c[5]*c[11]*c[14]-c[9]*c[6]*c[15]+c[9]*c[7]*c[14]+c[13]*c[6]*c[11]-c[13]*c[7]*c[10];a[4]=-c[4]*c[10]*c[15]+c[4]*c[11]*c[14]+c[8]*c[6]*c[15]-c[8]*c[7]*c[14]-c[12]*c[6]*c[11]+c[12]*c[7]*c[10];a[8]=c[4]*c[9]*c[15]-c[4]*c[11]*c[13]-c[8]*c[5]*c[15]+c[8]*c[7]*c[13]+c[12]*c[5]*c[11]-c[12]*c[7]*c[9];a[12]=-c[4]*c[9]*c[14]+c[4]*c[10]*c[13]+c[8]*c[5]*c[14]-c[8]*c[6]*c[13]-
c[12]*c[5]*c[10]+c[12]*c[6]*c[9];a[1]=-c[1]*c[10]*c[15]+c[1]*c[11]*c[14]+c[9]*c[2]*c[15]-c[9]*c[3]*c[14]-c[13]*c[2]*c[11]+c[13]*c[3]*c[10];a[5]=c[0]*c[10]*c[15]-c[0]*c[11]*c[14]-c[8]*c[2]*c[15]+c[8]*c[3]*c[14]+c[12]*c[2]*c[11]-c[12]*c[3]*c[10];a[9]=-c[0]*c[9]*c[15]+c[0]*c[11]*c[13]+c[8]*c[1]*c[15]-c[8]*c[3]*c[13]-c[12]*c[1]*c[11]+c[12]*c[3]*c[9];a[13]=c[0]*c[9]*c[14]-c[0]*c[10]*c[13]-c[8]*c[1]*c[14]+c[8]*c[2]*c[13]+c[12]*c[1]*c[10]-c[12]*c[2]*c[9];a[2]=c[1]*c[6]*c[15]-c[1]*c[7]*c[14]-c[5]*c[2]*c[15]+
c[5]*c[3]*c[14]+c[13]*c[2]*c[7]-c[13]*c[3]*c[6];a[6]=-c[0]*c[6]*c[15]+c[0]*c[7]*c[14]+c[4]*c[2]*c[15]-c[4]*c[3]*c[14]-c[12]*c[2]*c[7]+c[12]*c[3]*c[6];a[10]=c[0]*c[5]*c[15]-c[0]*c[7]*c[13]-c[4]*c[1]*c[15]+c[4]*c[3]*c[13]+c[12]*c[1]*c[7]-c[12]*c[3]*c[5];a[14]=-c[0]*c[5]*c[14]+c[0]*c[6]*c[13]+c[4]*c[1]*c[14]-c[4]*c[2]*c[13]-c[12]*c[1]*c[6]+c[12]*c[2]*c[5];a[3]=-c[1]*c[6]*c[11]+c[1]*c[7]*c[10]+c[5]*c[2]*c[11]-c[5]*c[3]*c[10]-c[9]*c[2]*c[7]+c[9]*c[3]*c[6];a[7]=c[0]*c[6]*c[11]-c[0]*c[7]*c[10]-c[4]*c[2]*
c[11]+c[4]*c[3]*c[10]+c[8]*c[2]*c[7]-c[8]*c[3]*c[6];a[11]=-c[0]*c[5]*c[11]+c[0]*c[7]*c[9]+c[4]*c[1]*c[11]-c[4]*c[3]*c[9]-c[8]*c[1]*c[7]+c[8]*c[3]*c[5];a[15]=c[0]*c[5]*c[10]-c[0]*c[6]*c[9]-c[4]*c[1]*c[10]+c[4]*c[2]*c[9]+c[8]*c[1]*c[6]-c[8]*c[2]*c[5];var d=c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12];if(0===d)return!1;for(var d=1/d,g=0;16>g;g+=1)b[g]=a[g]*d;return!0}})(GLU);
(function(e){(function(c){if(!b)var b=1.0E-6;if(!a)var a="undefined"!==typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var g={setMatrixArrayType:function(b){a=b}};"undefined"!==typeof c&&(c.glMatrix=g);var f={create:function(){var b=new a(2);b[0]=0;b[1]=0;return b},clone:function(b){var d=new a(2);d[0]=b[0];d[1]=b[1];return d},fromValues:function(b,d){var c=new a(2);c[0]=b;c[1]=d;return c},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},set:function(a,b,d){a[0]=b;a[1]=d;return a},
add:function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];return a}};f.sub=f.subtract;f.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=b[1]*d[1];return a};f.mul=f.multiply;f.divide=function(a,b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];return a};f.div=f.divide;f.min=function(a,b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);return a};f.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=Math.max(b[1],d[1]);return a};f.scale=function(a,b,d){a[0]=b[0]*
d;a[1]=b[1]*d;return a};f.scaleAndAdd=function(a,b,d,c){a[0]=b[0]+d[0]*c;a[1]=b[1]+d[1]*c;return a};f.distance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1];return Math.sqrt(d*d+c*c)};f.dist=f.distance;f.squaredDistance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1];return d*d+c*c};f.sqrDist=f.squaredDistance;f.length=function(a){var b=a[0],a=a[1];return Math.sqrt(b*b+a*a)};f.len=f.length;f.squaredLength=function(a){var b=a[0],a=a[1];return b*b+a*a};f.sqrLen=f.squaredLength;f.negate=function(a,b){a[0]=-b[0];
a[1]=-b[1];return a};f.normalize=function(a,b){var d=b[0],c=b[1],d=d*d+c*c;if(d>0){d=1/Math.sqrt(d);a[0]=b[0]*d;a[1]=b[1]*d}return a};f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};f.cross=function(a,b,d){b=b[0]*d[1]-b[1]*d[0];a[0]=a[1]=0;a[2]=b;return a};f.lerp=function(a,b,d,c){var g=b[0],b=b[1];a[0]=g+c*(d[0]-g);a[1]=b+c*(d[1]-b);return a};f.random=function(a,b){var b=b||1,c=d()*2*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};f.transformMat2=function(a,b,d){var c=b[0],b=b[1];a[0]=d[0]*
c+d[2]*b;a[1]=d[1]*c+d[3]*b;return a};f.transformMat2d=function(a,b,d){var c=b[0],b=b[1];a[0]=d[0]*c+d[2]*b+d[4];a[1]=d[1]*c+d[3]*b+d[5];return a};f.transformMat3=function(a,b,d){var c=b[0],b=b[1];a[0]=d[0]*c+d[3]*b+d[6];a[1]=d[1]*c+d[4]*b+d[7];return a};f.transformMat4=function(a,b,d){var c=b[0],b=b[1];a[0]=d[0]*c+d[4]*b+d[12];a[1]=d[1]*c+d[5]*b+d[13];return a};f.forEach=function(){var a=f.create();return function(b,d,c,g,f,h){d||(d=2);c||(c=0);for(g=g?Math.min(g*d+c,b.length):b.length;c<g;c=c+d){a[0]=
b[c];a[1]=b[c+1];f(a,a,h);b[c]=a[0];b[c+1]=a[1]}return b}}();f.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};"undefined"!==typeof c&&(c.vec2=f);var h={create:function(){var b=new a(3);b[0]=0;b[1]=0;b[2]=0;return b},clone:function(b){var d=new a(3);d[0]=b[0];d[1]=b[1];d[2]=b[2];return d},fromValues:function(b,d,c){var g=new a(3);g[0]=b;g[1]=d;g[2]=c;return g},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,d,c){a[0]=b;a[1]=d;a[2]=c;return a},add:function(a,b,d){a[0]=
b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];return a}};h.sub=h.subtract;h.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=b[1]*d[1];a[2]=b[2]*d[2];return a};h.mul=h.multiply;h.divide=function(a,b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];a[2]=b[2]/d[2];return a};h.div=h.divide;h.min=function(a,b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);a[2]=Math.min(b[2],d[2]);return a};h.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=
Math.max(b[1],d[1]);a[2]=Math.max(b[2],d[2]);return a};h.scale=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;return a};h.scaleAndAdd=function(a,b,d,c){a[0]=b[0]+d[0]*c;a[1]=b[1]+d[1]*c;a[2]=b[2]+d[2]*c;return a};h.distance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],g=b[2]-a[2];return Math.sqrt(d*d+c*c+g*g)};h.dist=h.distance;h.squaredDistance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],g=b[2]-a[2];return d*d+c*c+g*g};h.sqrDist=h.squaredDistance;h.length=function(a){var b=a[0],d=a[1],a=a[2];return Math.sqrt(b*
b+d*d+a*a)};h.len=h.length;h.squaredLength=function(a){var b=a[0],d=a[1],a=a[2];return b*b+d*d+a*a};h.sqrLen=h.squaredLength;h.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};h.normalize=function(a,b){var d=b[0],c=b[1],g=b[2],d=d*d+c*c+g*g;if(d>0){d=1/Math.sqrt(d);a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d}return a};h.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};h.cross=function(a,b,d){var c=b[0],g=b[1],b=b[2],f=d[0],h=d[1],d=d[2];a[0]=g*d-b*h;a[1]=b*f-c*d;a[2]=c*h-g*f;return a};
h.lerp=function(a,b,d,c){var g=b[0],f=b[1],b=b[2];a[0]=g+c*(d[0]-g);a[1]=f+c*(d[1]-f);a[2]=b+c*(d[2]-b);return a};h.random=function(a,b){var b=b||1,c=d()*2*Math.PI,g=d()*2-1,f=Math.sqrt(1-g*g)*b;a[0]=Math.cos(c)*f;a[1]=Math.sin(c)*f;a[2]=g*b;return a};h.transformMat4=function(a,b,d){var c=b[0],g=b[1],b=b[2];a[0]=d[0]*c+d[4]*g+d[8]*b+d[12];a[1]=d[1]*c+d[5]*g+d[9]*b+d[13];a[2]=d[2]*c+d[6]*g+d[10]*b+d[14];return a};h.transformMat3=function(a,b,d){var c=b[0],g=b[1],b=b[2];a[0]=c*d[0]+g*d[3]+b*d[6];a[1]=
c*d[1]+g*d[4]+b*d[7];a[2]=c*d[2]+g*d[5]+b*d[8];return a};h.transformQuat=function(a,b,d){var c=b[0],g=b[1],f=b[2],b=d[0],h=d[1],e=d[2],d=d[3],i=d*c+h*f-e*g,j=d*g+e*c-b*f,l=d*f+b*g-h*c,c=-b*c-h*g-e*f;a[0]=i*d+c*-b+j*-e-l*-h;a[1]=j*d+c*-h+l*-b-i*-e;a[2]=l*d+c*-e+i*-h-j*-b;return a};h.forEach=function(){var a=h.create();return function(b,d,c,g,f,h){d||(d=3);c||(c=0);for(g=g?Math.min(g*d+c,b.length):b.length;c<g;c=c+d){a[0]=b[c];a[1]=b[c+1];a[2]=b[c+2];f(a,a,h);b[c]=a[0];b[c+1]=a[1];b[c+2]=a[2]}return b}}();
h.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof c&&(c.vec3=h);var e={create:function(){var b=new a(4);b[0]=0;b[1]=0;b[2]=0;b[3]=0;return b},clone:function(b){var d=new a(4);d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];return d},fromValues:function(b,d,c,g){var f=new a(4);f[0]=b;f[1]=d;f[2]=c;f[3]=g;return f},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,d,c,g){a[0]=b;a[1]=d;a[2]=c;a[3]=g;return a},add:function(a,b,d){a[0]=b[0]+
d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];a[3]=b[3]+d[3];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];a[3]=b[3]-d[3];return a}};e.sub=e.subtract;e.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=b[1]*d[1];a[2]=b[2]*d[2];a[3]=b[3]*d[3];return a};e.mul=e.multiply;e.divide=function(a,b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];a[2]=b[2]/d[2];a[3]=b[3]/d[3];return a};e.div=e.divide;e.min=function(a,b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);a[2]=Math.min(b[2],d[2]);a[3]=Math.min(b[3],
d[3]);return a};e.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=Math.max(b[1],d[1]);a[2]=Math.max(b[2],d[2]);a[3]=Math.max(b[3],d[3]);return a};e.scale=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;return a};e.scaleAndAdd=function(a,b,d,c){a[0]=b[0]+d[0]*c;a[1]=b[1]+d[1]*c;a[2]=b[2]+d[2]*c;a[3]=b[3]+d[3]*c;return a};e.distance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],g=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(d*d+c*c+g*g+f*f)};e.dist=e.distance;e.squaredDistance=function(a,b){var d=
b[0]-a[0],c=b[1]-a[1],g=b[2]-a[2],f=b[3]-a[3];return d*d+c*c+g*g+f*f};e.sqrDist=e.squaredDistance;e.length=function(a){var b=a[0],d=a[1],c=a[2],a=a[3];return Math.sqrt(b*b+d*d+c*c+a*a)};e.len=e.length;e.squaredLength=function(a){var b=a[0],d=a[1],c=a[2],a=a[3];return b*b+d*d+c*c+a*a};e.sqrLen=e.squaredLength;e.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};e.normalize=function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],d=d*d+c*c+g*g+f*f;if(d>0){d=1/Math.sqrt(d);a[0]=b[0]*d;a[1]=
b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d}return a};e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};e.lerp=function(a,b,d,c){var g=b[0],f=b[1],h=b[2],b=b[3];a[0]=g+c*(d[0]-g);a[1]=f+c*(d[1]-f);a[2]=h+c*(d[2]-h);a[3]=b+c*(d[3]-b);return a};e.random=function(a,b){b=b||1;a[0]=d();a[1]=d();a[2]=d();a[3]=d();e.normalize(a,a);e.scale(a,a,b);return a};e.transformMat4=function(a,b,d){var c=b[0],g=b[1],f=b[2],b=b[3];a[0]=d[0]*c+d[4]*g+d[8]*f+d[12]*b;a[1]=d[1]*c+d[5]*g+d[9]*f+d[13]*b;a[2]=d[2]*c+d[6]*
g+d[10]*f+d[14]*b;a[3]=d[3]*c+d[7]*g+d[11]*f+d[15]*b;return a};e.transformQuat=function(a,b,d){var c=b[0],g=b[1],f=b[2],b=d[0],h=d[1],e=d[2],d=d[3],i=d*c+h*f-e*g,j=d*g+e*c-b*f,l=d*f+b*g-h*c,c=-b*c-h*g-e*f;a[0]=i*d+c*-b+j*-e-l*-h;a[1]=j*d+c*-h+l*-b-i*-e;a[2]=l*d+c*-e+i*-h-j*-b;return a};e.forEach=function(){var a=e.create();return function(b,d,c,g,f,h){d||(d=4);c||(c=0);for(g=g?Math.min(g*d+c,b.length):b.length;c<g;c=c+d){a[0]=b[c];a[1]=b[c+1];a[2]=b[c+2];a[3]=b[c+3];f(a,a,h);b[c]=a[0];b[c+1]=a[1];
b[c+2]=a[2];b[c+3]=a[3]}return b}}();e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof c&&(c.vec4=e);g={create:function(){var b=new a(4);b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},clone:function(b){var d=new a(4);d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(a===b){var d=b[1];a[1]=b[2];a[2]=d}else{a[0]=
b[0];a[1]=b[2];a[2]=b[1];a[3]=b[3]}return a},invert:function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=d*f-g*c;if(!h)return null;h=1/h;a[0]=f*h;a[1]=-c*h;a[2]=-g*h;a[3]=d*h;return a},adjoint:function(a,b){var d=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=d;return a},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:function(a,b,d){var c=b[0],g=b[1],f=b[2],b=b[3],h=d[0],e=d[1],i=d[2],d=d[3];a[0]=c*h+g*i;a[1]=c*e+g*d;a[2]=f*h+b*i;a[3]=f*e+b*d;return a}};g.mul=g.multiply;g.rotate=function(a,b,
d){var c=b[0],g=b[1],f=b[2],b=b[3],h=Math.sin(d),d=Math.cos(d);a[0]=c*d+g*h;a[1]=c*-h+g*d;a[2]=f*d+b*h;a[3]=f*-h+b*d;return a};g.scale=function(a,b,d){var c=b[1],g=b[2],f=b[3],h=d[0],d=d[1];a[0]=b[0]*h;a[1]=c*d;a[2]=g*h;a[3]=f*d;return a};g.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof c&&(c.mat2=g);g={create:function(){var b=new a(6);b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},clone:function(b){var d=new a(6);d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=
b[3];d[4]=b[4];d[5]=b[5];return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},invert:function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=b[4],e=b[5],i=d*f-c*g;if(!i)return null;i=1/i;a[0]=f*i;a[1]=-c*i;a[2]=-g*i;a[3]=d*i;a[4]=(g*e-f*h)*i;a[5]=(c*h-d*e)*i;return a},determinant:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:function(a,b,d){var c=b[0],g=b[1],f=b[2],h=b[3],e=b[4],b=b[5],
i=d[0],j=d[1],l=d[2],k=d[3],u=d[4],d=d[5];a[0]=c*i+g*l;a[1]=c*j+g*k;a[2]=f*i+h*l;a[3]=f*j+h*k;a[4]=i*e+l*b+u;a[5]=j*e+k*b+d;return a}};g.mul=g.multiply;g.rotate=function(a,b,d){var c=b[0],g=b[1],f=b[2],h=b[3],e=b[4],b=b[5],i=Math.sin(d),d=Math.cos(d);a[0]=c*d+g*i;a[1]=-c*i+g*d;a[2]=f*d+h*i;a[3]=-f*i+d*h;a[4]=d*e+i*b;a[5]=d*b-i*e;return a};g.scale=function(a,b,d){var c=d[0],d=d[1];a[0]=b[0]*c;a[1]=b[1]*d;a[2]=b[2]*c;a[3]=b[3]*d;a[4]=b[4]*c;a[5]=b[5]*d;return a};g.translate=function(a,b,d){a[0]=b[0];
a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4]+d[0];a[5]=b[5]+d[1];return a};g.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};"undefined"!==typeof c&&(c.mat2d=g);var j={create:function(){var b=new a(9);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},fromMat4:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(b){var d=new a(9);d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=
b[3];d[4]=b[4];d[5]=b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(a===b){var d=b[1],c=b[2],g=b[5];a[1]=b[3];a[2]=b[6];a[3]=d;a[5]=b[7];a[6]=c;a[7]=g}else{a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8]}return a},invert:function(a,
b){var d=b[0],c=b[1],g=b[2],f=b[3],h=b[4],e=b[5],i=b[6],j=b[7],l=b[8],k=l*h-e*j,u=-l*f+e*i,x=j*f-h*i,z=d*k+c*u+g*x;if(!z)return null;z=1/z;a[0]=k*z;a[1]=(-l*c+g*j)*z;a[2]=(e*c-g*h)*z;a[3]=u*z;a[4]=(l*d-g*i)*z;a[5]=(-e*d+g*f)*z;a[6]=x*z;a[7]=(-j*d+c*i)*z;a[8]=(h*d-c*f)*z;return a},adjoint:function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=b[4],e=b[5],i=b[6],j=b[7],l=b[8];a[0]=h*l-e*j;a[1]=g*j-c*l;a[2]=c*e-g*h;a[3]=e*i-f*l;a[4]=d*l-g*i;a[5]=g*f-d*e;a[6]=f*j-h*i;a[7]=c*i-d*j;a[8]=d*h-c*f;return a},determinant:function(a){var b=
a[3],d=a[4],c=a[5],g=a[6],f=a[7],h=a[8];return a[0]*(h*d-c*f)+a[1]*(-h*b+c*g)+a[2]*(f*b-d*g)},multiply:function(a,b,d){var c=b[0],g=b[1],f=b[2],h=b[3],e=b[4],i=b[5],j=b[6],l=b[7],b=b[8],k=d[0],u=d[1],x=d[2],z=d[3],A=d[4],B=d[5],C=d[6],E=d[7],d=d[8];a[0]=k*c+u*h+x*j;a[1]=k*g+u*e+x*l;a[2]=k*f+u*i+x*b;a[3]=z*c+A*h+B*j;a[4]=z*g+A*e+B*l;a[5]=z*f+A*i+B*b;a[6]=C*c+E*h+d*j;a[7]=C*g+E*e+d*l;a[8]=C*f+E*i+d*b;return a}};j.mul=j.multiply;j.translate=function(a,b,d){var c=b[0],g=b[1],f=b[2],h=b[3],e=b[4],i=b[5],
j=b[6],l=b[7],b=b[8],k=d[0],d=d[1];a[0]=c;a[1]=g;a[2]=f;a[3]=h;a[4]=e;a[5]=i;a[6]=k*c+d*h+j;a[7]=k*g+d*e+l;a[8]=k*f+d*i+b;return a};j.rotate=function(a,b,d){var c=b[0],g=b[1],f=b[2],h=b[3],e=b[4],i=b[5],j=b[6],l=b[7],b=b[8],k=Math.sin(d),d=Math.cos(d);a[0]=d*c+k*h;a[1]=d*g+k*e;a[2]=d*f+k*i;a[3]=d*h-k*c;a[4]=d*e-k*g;a[5]=d*i-k*f;a[6]=j;a[7]=l;a[8]=b;return a};j.scale=function(a,b,d){var c=d[0],d=d[1];a[0]=c*b[0];a[1]=c*b[1];a[2]=c*b[2];a[3]=d*b[3];a[4]=d*b[4];a[5]=d*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];
return a};j.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};j.fromQuat=function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=d+d,e=c+c,i=g+g,j=d*h,l=d*e,d=d*i,k=c*e,c=c*i,g=g*i,h=f*h,e=f*e,f=f*i;a[0]=1-(k+g);a[3]=l+f;a[6]=d-e;a[1]=l-f;a[4]=1-(j+g);a[7]=c+h;a[2]=d+e;a[5]=c-h;a[8]=1-(j+k);return a};j.normalFromMat4=function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=b[4],e=b[5],i=b[6],j=b[7],l=b[8],k=b[9],u=b[10],x=b[11],z=b[12],A=b[13],B=b[14],
C=b[15],E=d*e-c*h,H=d*i-g*h,F=d*j-f*h,G=c*i-g*e,I=c*j-f*e,K=g*j-f*i,L=l*A-k*z,M=l*B-u*z,l=l*C-x*z,N=k*B-u*A,k=k*C-x*A,u=u*C-x*B,x=E*u-H*k+F*N+G*l-I*M+K*L;if(!x)return null;x=1/x;a[0]=(e*u-i*k+j*N)*x;a[1]=(i*l-h*u-j*M)*x;a[2]=(h*k-e*l+j*L)*x;a[3]=(g*k-c*u-f*N)*x;a[4]=(d*u-g*l+f*M)*x;a[5]=(c*l-d*k-f*L)*x;a[6]=(A*K-B*I+C*G)*x;a[7]=(B*F-z*K-C*H)*x;a[8]=(z*I-A*F+C*E)*x;return a};j.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};"undefined"!==
typeof c&&(c.mat3=j);var k={create:function(){var b=new a(16);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},clone:function(b){var d=new a(16);d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4];d[5]=b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];d[9]=b[9];d[10]=b[10];d[11]=b[11];d[12]=b[12];d[13]=b[13];d[14]=b[14];d[15]=b[15];return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];
a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(a===b){var d=b[1],c=b[2],g=b[3],f=b[6],h=b[7],e=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=d;a[6]=b[9];a[7]=b[13];a[8]=c;a[9]=f;a[11]=b[14];a[12]=g;a[13]=h;a[14]=e}else{a[0]=b[0];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=b[1];a[5]=
b[5];a[6]=b[9];a[7]=b[13];a[8]=b[2];a[9]=b[6];a[10]=b[10];a[11]=b[14];a[12]=b[3];a[13]=b[7];a[14]=b[11];a[15]=b[15]}return a},invert:function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=b[4],e=b[5],i=b[6],j=b[7],l=b[8],k=b[9],u=b[10],x=b[11],z=b[12],A=b[13],B=b[14],C=b[15],E=d*e-c*h,H=d*i-g*h,F=d*j-f*h,G=c*i-g*e,I=c*j-f*e,K=g*j-f*i,L=l*A-k*z,M=l*B-u*z,N=l*C-x*z,O=k*B-u*A,P=k*C-x*A,Q=u*C-x*B,J=E*Q-H*P+F*O+G*N-I*M+K*L;if(!J)return null;J=1/J;a[0]=(e*Q-i*P+j*O)*J;a[1]=(g*P-c*Q-f*O)*J;a[2]=(A*K-B*I+C*G)*J;
a[3]=(u*I-k*K-x*G)*J;a[4]=(i*N-h*Q-j*M)*J;a[5]=(d*Q-g*N+f*M)*J;a[6]=(B*F-z*K-C*H)*J;a[7]=(l*K-u*F+x*H)*J;a[8]=(h*P-e*N+j*L)*J;a[9]=(c*N-d*P-f*L)*J;a[10]=(z*I-A*F+C*E)*J;a[11]=(k*F-l*I-x*E)*J;a[12]=(e*M-h*O-i*L)*J;a[13]=(d*O-c*M+g*L)*J;a[14]=(A*H-z*G-B*E)*J;a[15]=(l*G-k*H+u*E)*J;return a},adjoint:function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=b[4],e=b[5],i=b[6],j=b[7],l=b[8],k=b[9],u=b[10],x=b[11],z=b[12],A=b[13],B=b[14],C=b[15];a[0]=e*(u*C-x*B)-k*(i*C-j*B)+A*(i*x-j*u);a[1]=-(c*(u*C-x*B)-k*(g*C-f*
B)+A*(g*x-f*u));a[2]=c*(i*C-j*B)-e*(g*C-f*B)+A*(g*j-f*i);a[3]=-(c*(i*x-j*u)-e*(g*x-f*u)+k*(g*j-f*i));a[4]=-(h*(u*C-x*B)-l*(i*C-j*B)+z*(i*x-j*u));a[5]=d*(u*C-x*B)-l*(g*C-f*B)+z*(g*x-f*u);a[6]=-(d*(i*C-j*B)-h*(g*C-f*B)+z*(g*j-f*i));a[7]=d*(i*x-j*u)-h*(g*x-f*u)+l*(g*j-f*i);a[8]=h*(k*C-x*A)-l*(e*C-j*A)+z*(e*x-j*k);a[9]=-(d*(k*C-x*A)-l*(c*C-f*A)+z*(c*x-f*k));a[10]=d*(e*C-j*A)-h*(c*C-f*A)+z*(c*j-f*e);a[11]=-(d*(e*x-j*k)-h*(c*x-f*k)+l*(c*j-f*e));a[12]=-(h*(k*B-u*A)-l*(e*B-i*A)+z*(e*u-i*k));a[13]=d*(k*B-
u*A)-l*(c*B-g*A)+z*(c*u-g*k);a[14]=-(d*(e*B-i*A)-h*(c*B-g*A)+z*(c*i-g*e));a[15]=d*(e*u-i*k)-h*(c*u-g*k)+l*(c*i-g*e);return a},determinant:function(a){var b=a[0],d=a[1],c=a[2],g=a[3],f=a[4],h=a[5],e=a[6],i=a[7],j=a[8],l=a[9],k=a[10],u=a[11],x=a[12],z=a[13],A=a[14],a=a[15];return(b*h-d*f)*(k*a-u*A)-(b*e-c*f)*(l*a-u*z)+(b*i-g*f)*(l*A-k*z)+(d*e-c*h)*(j*a-u*x)-(d*i-g*h)*(j*A-k*x)+(c*i-g*e)*(j*z-l*x)},multiply:function(a,b,d){var c=b[0],g=b[1],f=b[2],h=b[3],e=b[4],i=b[5],j=b[6],l=b[7],k=b[8],u=b[9],x=b[10],
z=b[11],A=b[12],B=b[13],C=b[14],b=b[15],E=d[0],H=d[1],F=d[2],G=d[3];a[0]=E*c+H*e+F*k+G*A;a[1]=E*g+H*i+F*u+G*B;a[2]=E*f+H*j+F*x+G*C;a[3]=E*h+H*l+F*z+G*b;E=d[4];H=d[5];F=d[6];G=d[7];a[4]=E*c+H*e+F*k+G*A;a[5]=E*g+H*i+F*u+G*B;a[6]=E*f+H*j+F*x+G*C;a[7]=E*h+H*l+F*z+G*b;E=d[8];H=d[9];F=d[10];G=d[11];a[8]=E*c+H*e+F*k+G*A;a[9]=E*g+H*i+F*u+G*B;a[10]=E*f+H*j+F*x+G*C;a[11]=E*h+H*l+F*z+G*b;E=d[12];H=d[13];F=d[14];G=d[15];a[12]=E*c+H*e+F*k+G*A;a[13]=E*g+H*i+F*u+G*B;a[14]=E*f+H*j+F*x+G*C;a[15]=E*h+H*l+F*z+G*b;return a}};
k.mul=k.multiply;k.translate=function(a,b,d){var c=d[0],g=d[1],d=d[2],f,h,e,i,j,l,k,u,x,z,A,B;if(b===a){a[12]=b[0]*c+b[4]*g+b[8]*d+b[12];a[13]=b[1]*c+b[5]*g+b[9]*d+b[13];a[14]=b[2]*c+b[6]*g+b[10]*d+b[14];a[15]=b[3]*c+b[7]*g+b[11]*d+b[15]}else{f=b[0];h=b[1];e=b[2];i=b[3];j=b[4];l=b[5];k=b[6];u=b[7];x=b[8];z=b[9];A=b[10];B=b[11];a[0]=f;a[1]=h;a[2]=e;a[3]=i;a[4]=j;a[5]=l;a[6]=k;a[7]=u;a[8]=x;a[9]=z;a[10]=A;a[11]=B;a[12]=f*c+j*g+x*d+b[12];a[13]=h*c+l*g+z*d+b[13];a[14]=e*c+k*g+A*d+b[14];a[15]=i*c+u*g+
B*d+b[15]}return a};k.scale=function(a,b,d){var c=d[0],g=d[1],d=d[2];a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*g;a[5]=b[5]*g;a[6]=b[6]*g;a[7]=b[7]*g;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};k.rotate=function(a,d,c,g){var f=g[0],h=g[1],g=g[2],e=Math.sqrt(f*f+h*h+g*g),i,j,l,k,D,u,x,z,A,B,C,E,H,F,G,I,K,L,M,N;if(Math.abs(e)<b)return null;e=1/e;f=f*e;h=h*e;g=g*e;i=Math.sin(c);j=Math.cos(c);l=1-j;c=d[0];e=d[1];k=d[2];D=
d[3];u=d[4];x=d[5];z=d[6];A=d[7];B=d[8];C=d[9];E=d[10];H=d[11];F=f*f*l+j;G=h*f*l+g*i;I=g*f*l-h*i;K=f*h*l-g*i;L=h*h*l+j;M=g*h*l+f*i;N=f*g*l+h*i;f=h*g*l-f*i;h=g*g*l+j;a[0]=c*F+u*G+B*I;a[1]=e*F+x*G+C*I;a[2]=k*F+z*G+E*I;a[3]=D*F+A*G+H*I;a[4]=c*K+u*L+B*M;a[5]=e*K+x*L+C*M;a[6]=k*K+z*L+E*M;a[7]=D*K+A*L+H*M;a[8]=c*N+u*f+B*h;a[9]=e*N+x*f+C*h;a[10]=k*N+z*f+E*h;a[11]=D*N+A*f+H*h;if(d!==a){a[12]=d[12];a[13]=d[13];a[14]=d[14];a[15]=d[15]}return a};k.rotateX=function(a,b,d){var c=Math.sin(d),d=Math.cos(d),g=b[4],
f=b[5],h=b[6],e=b[7],i=b[8],j=b[9],l=b[10],k=b[11];if(b!==a){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[4]=g*d+i*c;a[5]=f*d+j*c;a[6]=h*d+l*c;a[7]=e*d+k*c;a[8]=i*d-g*c;a[9]=j*d-f*c;a[10]=l*d-h*c;a[11]=k*d-e*c;return a};k.rotateY=function(a,b,d){var c=Math.sin(d),d=Math.cos(d),g=b[0],f=b[1],h=b[2],e=b[3],i=b[8],j=b[9],l=b[10],k=b[11];if(b!==a){a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=g*d-i*c;a[1]=f*d-
j*c;a[2]=h*d-l*c;a[3]=e*d-k*c;a[8]=g*c+i*d;a[9]=f*c+j*d;a[10]=h*c+l*d;a[11]=e*c+k*d;return a};k.rotateZ=function(a,b,d){var c=Math.sin(d),d=Math.cos(d),g=b[0],f=b[1],h=b[2],e=b[3],i=b[4],j=b[5],l=b[6],k=b[7];if(b!==a){a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=g*d+i*c;a[1]=f*d+j*c;a[2]=h*d+l*c;a[3]=e*d+k*c;a[4]=i*d-g*c;a[5]=j*d-f*c;a[6]=l*d-h*c;a[7]=k*d-e*c;return a};k.fromRotationTranslation=function(a,b,d){var c=b[0],g=b[1],f=b[2],h=b[3],e=c+
c,i=g+g,j=f+f,b=c*e,l=c*i,c=c*j,k=g*i,g=g*j,f=f*j,e=h*e,i=h*i,h=h*j;a[0]=1-(k+f);a[1]=l+h;a[2]=c-i;a[3]=0;a[4]=l-h;a[5]=1-(b+f);a[6]=g+e;a[7]=0;a[8]=c+i;a[9]=g-e;a[10]=1-(b+k);a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a};k.fromQuat=function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=d+d,e=c+c,i=g+g,j=d*h,l=d*e,d=d*i,k=c*e,c=c*i,g=g*i,h=f*h,e=f*e,f=f*i;a[0]=1-(k+g);a[1]=l+f;a[2]=d-e;a[3]=0;a[4]=l-f;a[5]=1-(j+g);a[6]=c+h;a[7]=0;a[8]=d+e;a[9]=c-h;a[10]=1-(j+k);a[11]=0;a[12]=0;a[13]=0;a[14]=
0;a[15]=1;return a};k.frustum=function(a,b,d,c,g,f,h){var e=1/(d-b),i=1/(g-c),j=1/(f-h);a[0]=f*2*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=f*2*i;a[6]=0;a[7]=0;a[8]=(d+b)*e;a[9]=(g+c)*i;a[10]=(h+f)*j;a[11]=-1;a[12]=0;a[13]=0;a[14]=h*f*2*j;a[15]=0;return a};k.perspective=function(a,b,d,c,g){var b=1/Math.tan(b/2),f=1/(c-g);a[0]=b/d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(g+c)*f;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*g*c*f;a[15]=0;return a};k.ortho=function(a,b,d,c,g,f,h){var e=1/(b-
d),i=1/(c-g),j=1/(f-h);a[0]=-2*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*i;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*j;a[11]=0;a[12]=(b+d)*e;a[13]=(g+c)*i;a[14]=(h+f)*j;a[15]=1;return a};k.lookAt=function(a,d,c,g){var f,h,e,i,j,l,s,D,u=d[0],x=d[1],d=d[2];e=g[0];i=g[1];h=g[2];s=c[0];g=c[1];f=c[2];if(Math.abs(u-s)<b&&Math.abs(x-g)<b&&Math.abs(d-f)<b)return k.identity(a);c=u-s;g=x-g;s=d-f;D=1/Math.sqrt(c*c+g*g+s*s);c=c*D;g=g*D;s=s*D;f=i*s-h*g;h=h*c-e*s;e=e*g-i*c;if(D=Math.sqrt(f*f+h*h+e*e)){D=1/D;f=f*D;h=h*D;
e=e*D}else e=h=f=0;i=g*e-s*h;j=s*f-c*e;l=c*h-g*f;if(D=Math.sqrt(i*i+j*j+l*l)){D=1/D;i=i*D;j=j*D;l=l*D}else l=j=i=0;a[0]=f;a[1]=i;a[2]=c;a[3]=0;a[4]=h;a[5]=j;a[6]=g;a[7]=0;a[8]=e;a[9]=l;a[10]=s;a[11]=0;a[12]=-(f*u+h*x+e*d);a[13]=-(i*u+j*x+l*d);a[14]=-(c*u+g*x+s*d);a[15]=1;return a};k.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};"undefined"!==typeof c&&
(c.mat4=k);var l={create:function(){var b=new a(4);b[0]=0;b[1]=0;b[2]=0;b[3]=1;return b}};l.rotationTo=function(){var a=h.create(),b=h.fromValues(1,0,0),d=h.fromValues(0,1,0);return function(c,g,f){var e=h.dot(g,f);if(e<-0.999999){h.cross(a,b,g);h.length(a)<1.0E-6&&h.cross(a,d,g);h.normalize(a,a);l.setAxisAngle(c,a,Math.PI);return c}if(e>0.999999){c[0]=0;c[1]=0;c[2]=0;c[3]=1;return c}h.cross(a,g,f);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=1+e;return l.normalize(c,c)}}();l.setAxes=function(){var a=j.create();
return function(b,d,c,g){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=g[0];a[4]=g[1];a[7]=g[2];a[2]=d[0];a[5]=d[1];a[8]=d[2];return l.normalize(b,l.fromMat3(b,a))}}();l.clone=e.clone;l.fromValues=e.fromValues;l.copy=e.copy;l.set=e.set;l.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};l.setAxisAngle=function(a,b,d){var d=d*0.5,c=Math.sin(d);a[0]=c*b[0];a[1]=c*b[1];a[2]=c*b[2];a[3]=Math.cos(d);return a};l.add=e.add;l.multiply=function(a,b,d){var c=b[0],g=b[1],f=b[2],b=b[3],h=d[0],e=d[1],i=d[2],d=d[3];
a[0]=c*d+b*h+g*i-f*e;a[1]=g*d+b*e+f*h-c*i;a[2]=f*d+b*i+c*e-g*h;a[3]=b*d-c*h-g*e-f*i;return a};l.mul=l.multiply;l.scale=e.scale;l.rotateX=function(a,b,d){var d=d*0.5,c=b[0],g=b[1],f=b[2],b=b[3],h=Math.sin(d),d=Math.cos(d);a[0]=c*d+b*h;a[1]=g*d+f*h;a[2]=f*d-g*h;a[3]=b*d-c*h;return a};l.rotateY=function(a,b,d){var d=d*0.5,c=b[0],g=b[1],f=b[2],b=b[3],h=Math.sin(d),d=Math.cos(d);a[0]=c*d-f*h;a[1]=g*d+b*h;a[2]=f*d+c*h;a[3]=b*d-g*h;return a};l.rotateZ=function(a,b,d){var d=d*0.5,c=b[0],g=b[1],f=b[2],b=b[3],
h=Math.sin(d),d=Math.cos(d);a[0]=c*d+g*h;a[1]=g*d-c*h;a[2]=f*d+b*h;a[3]=b*d-f*h;return a};l.calculateW=function(a,b){var d=b[0],c=b[1],g=b[2];a[0]=d;a[1]=c;a[2]=g;a[3]=-Math.sqrt(Math.abs(1-d*d-c*c-g*g));return a};l.dot=e.dot;l.lerp=e.lerp;l.slerp=function(a,b,d,c){var g=b[0],f=b[1],h=b[2],b=b[3],e=d[0],i=d[1],j=d[2],d=d[3],l,k,u;k=g*e+f*i+h*j+b*d;if(k<0){k=-k;e=-e;i=-i;j=-j;d=-d}if(1-k>1.0E-6){l=Math.acos(k);u=Math.sin(l);k=Math.sin((1-c)*l)/u;c=Math.sin(c*l)/u}else k=1-c;a[0]=k*g+c*e;a[1]=k*f+c*
i;a[2]=k*h+c*j;a[3]=k*b+c*d;return a};l.invert=function(a,b){var d=b[0],c=b[1],g=b[2],f=b[3],h=d*d+c*c+g*g+f*f,h=h?1/h:0;a[0]=-d*h;a[1]=-c*h;a[2]=-g*h;a[3]=f*h;return a};l.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};l.length=e.length;l.len=l.length;l.squaredLength=e.squaredLength;l.sqrLen=l.squaredLength;l.normalize=e.normalize;l.fromMat3=function(){var a=typeof Int8Array!=="undefined"?new Int8Array([1,2,0]):[1,2,0];return function(b,d){var c=d[0]+d[4]+d[8];if(c>0){c=
Math.sqrt(c+1);b[3]=0.5*c;c=0.5/c;b[0]=(d[7]-d[5])*c;b[1]=(d[2]-d[6])*c;b[2]=(d[3]-d[1])*c}else{var g=0;d[4]>d[0]&&(g=1);d[8]>d[g*3+g]&&(g=2);var f=a[g],h=a[f],c=Math.sqrt(d[g*3+g]-d[f*3+f]-d[h*3+h]+1);b[g]=0.5*c;c=0.5/c;b[3]=(d[h*3+f]-d[f*3+h])*c;b[f]=(d[f*3+g]+d[g*3+f])*c;b[h]=(d[h*3+g]+d[g*3+h])*c}return b}}();l.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof c&&(c.quat=l)})(e)})(XML3D.math);
(function(){function e(c){var c=c||{guess:!0},b=c.e||null,c=!!c.guess,a=new e.implementation,b=a.run(b);return c?a.guessAnonymousFunctions(b):b}e.implementation=function(){};e.implementation.prototype={run:function(c,b){c=c||this.createException();b=b||this.mode(c);return"other"===b?this.other(arguments.callee):this[b](c)},createException:function(){try{this.undef()}catch(c){return c}},mode:function(c){return c.arguments&&c.stack?"chrome":c.stack&&c.sourceURL?"safari":"string"===typeof c.message&&
"undefined"!==typeof window&&window.opera?!c.stacktrace||-1<c.message.indexOf("\n")&&c.message.split("\n").length>c.stacktrace.split("\n").length?"opera9":!c.stack?"opera10a":0>c.stacktrace.indexOf("called from line")?"opera10b":"opera11":c.stack?"firefox":"other"},instrumentFunction:function(c,b,a){var c=c||window,d=c[b];c[b]=function(){a.call(this,e().slice(4));return c[b]._instrumented.apply(this,arguments)};c[b]._instrumented=d},deinstrumentFunction:function(c,b){c[b].constructor===Function&&
c[b]._instrumented&&c[b]._instrumented.constructor===Function&&(c[b]=c[b]._instrumented)},chrome:function(c){c=(c.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");c.pop();return c},safari:function(c){return c.stack.replace(/\[native code\]\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},firefox:function(c){return c.stack.replace(/(?:\n@:0)?\s+$/m,
"").replace(/^[\(@]/gm,"{anonymous}()@").split("\n")},opera11:function(c){for(var b=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,c=c.stacktrace.split("\n"),a=[],d=0,g=c.length;d<g;d+=2){var f=b.exec(c[d]);if(f){var h=f[4]+":"+f[1]+":"+f[2],f=f[3]||"global code",f=f.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");a.push(f+"@"+h+" -- "+c[d+1].replace(/^\s+/,""))}}return a},opera10b:function(c){for(var b=/^(.*)@(.+):(\d+)$/,c=c.stacktrace.split("\n"),
a=[],d=0,g=c.length;d<g;d++){var f=b.exec(c[d]);f&&a.push((f[1]?f[1]+"()":"global code")+"@"+f[2]+":"+f[3])}return a},opera10a:function(c){for(var b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,c=c.stacktrace.split("\n"),a=[],d=0,g=c.length;d<g;d+=2){var f=b.exec(c[d]);f&&a.push((f[3]||"{anonymous}")+"()@"+f[2]+":"+f[1]+" -- "+c[d+1].replace(/^\s+/,""))}return a},opera9:function(c){for(var b=/Line (\d+).*script (?:in )?(\S+)/i,c=c.message.split("\n"),a=[],d=2,g=c.length;d<g;d+=2){var f=
b.exec(c[d]);f&&a.push("{anonymous}()@"+f[2]+":"+f[1]+" -- "+c[d+1].replace(/^\s+/,""))}return a},other:function(c){for(var b=/function\s*([\w\-$]+)?\s*\(/i,a=[],d,g;c&&c.arguments&&10>a.length;)d=b.test(c.toString())?RegExp.$1||"{anonymous}":"{anonymous}",g=Array.prototype.slice.call(c.arguments||[]),a[a.length]=d+"("+this.stringifyArguments(g)+")",c=c.caller;return a},stringifyArguments:function(c){for(var b=[],a=Array.prototype.slice,d=0;d<c.length;++d){var g=c[d];void 0===g?b[d]="undefined":null===
g?b[d]="null":g.constructor&&(g.constructor===Array?b[d]=3>g.length?"["+this.stringifyArguments(g)+"]":"["+this.stringifyArguments(a.call(g,0,1))+"..."+this.stringifyArguments(a.call(g,-1))+"]":g.constructor===Object?b[d]="#object":g.constructor===Function?b[d]="#function":g.constructor===String?b[d]='"'+g+'"':g.constructor===Number&&(b[d]=g))}return b.join(",")},sourceCache:{},ajax:function(c){var b=this.createXMLHTTPObject();if(b)try{return b.open("GET",c,!1),b.send(null),b.responseText}catch(a){}return""},
createXMLHTTPObject:function(){for(var c,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],a=0;a<b.length;a++)try{return c=b[a](),this.createXMLHTTPObject=b[a],c}catch(d){}},isSameDomain:function(c){return"undefined"!==typeof location&&-1!==c.indexOf(location.hostname)},getSource:function(c){c in this.sourceCache||(this.sourceCache[c]=this.ajax(c).split("\n"));
return this.sourceCache[c]},guessAnonymousFunctions:function(c){for(var b=0;b<c.length;++b){var a=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,d=c[b],g=/\{anonymous\}\(.*\)@(.*)/.exec(d);if(g){var f=a.exec(g[1]);f&&(a=f[1],g=f[2],f=f[3]||0,a&&this.isSameDomain(a)&&g&&(a=this.guessAnonymousFunction(a,g,f),c[b]=d.replace("{anonymous}",a)))}}return c},guessAnonymousFunction:function(c,b){var a;try{a=this.findFunctionName(this.getSource(c),b)}catch(d){a="getSource failed with url: "+c+", exception: "+d.toString()}return a},
findFunctionName:function(c,b){for(var a=/function\s+([^(]*?)\s*\(([^)]*)\)/,d=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,g=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,f="",h,e=Math.min(b,20),j,k=0;k<e;++k)if(h=c[b-k-1],j=h.indexOf("//"),0<=j&&(h=h.substr(0,j)),h)if(f=h+f,(h=d.exec(f))&&h[1]||(h=a.exec(f))&&h[1]||(h=g.exec(f))&&h[1])return h[1];return"(?)"}};XML3D.debug.printStackTrace=e})();
(function(e){var c=function(){};c.prototype={constructor:c,addEventListener:function(b,a){void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===d[b]&&(d[b]=[]);-1===d[b].indexOf(a)&&d[b].push(a)},hasEventListener:function(b,a){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[b]&&-1!==d[b].indexOf(a)?!0:!1},removeEventListener:function(b,a){if(void 0!==this._listeners){var d=this._listeners,c=d[b].indexOf(a);-1!==c&&d[b].splice(c,1)}},dispatchEvent:function(b){if(void 0!==
this._listeners){var a=this._listeners[b.type];if(void 0!==a){b.target=this;for(var d=0,c=a.length;d<c;d++)a[d].call(this,b)}}}};e.EventDispatcher=c})(XML3D.util);
(function(e){var c={VERSION:"2.2.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(b,a){var d="string"==typeof b.initial?{state:b.initial}:b.initial,g=a||b.target||{},f=b.events||[],h=b.callbacks||{},e={},j=function(a){var b=a.from instanceof Array?a.from:a.from?[a.from]:[c.WILDCARD];e[a.name]=e[a.name]||{};for(var d=0;d<b.length;d++)e[a.name][b[d]]=a.to||b[d]};d&&(d.event=
d.event||"startup",j({name:d.event,from:"none",to:d.state}));for(var k=0;k<f.length;k++)j(f[k]);for(var l in e)e.hasOwnProperty(l)&&(g[l]=c.buildEvent(l,e[l]));for(l in h)h.hasOwnProperty(l)&&(g[l]=h[l]);g.current="none";g.is=function(a){return this.current==a};g.can=function(a){return!this.transition&&(e[a].hasOwnProperty(this.current)||e[a].hasOwnProperty(c.WILDCARD))};g.cannot=function(a){return!this.can(a)};g.error=b.error||function(a,b,d,c,g,f,h){throw h||f;};if(d&&!d.defer)g[d.event]();return g},
doCallback:function(b,a,d,g,f,h){if(a)try{return a.apply(b,[d,g,f].concat(h))}catch(e){return b.error(d,g,f,h,c.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeEvent:function(b,a,d,g,f){return c.doCallback(b,b["onbefore"+a],a,d,g,f)},afterEvent:function(b,a,d,g,f){return c.doCallback(b,b["onafter"+a]||b["on"+a],a,d,g,f)},leaveState:function(b,a,d,g,f){return c.doCallback(b,b["onleave"+d],a,d,g,f)},enterState:function(b,a,d,g,f){return c.doCallback(b,
b["onenter"+g]||b["on"+g],a,d,g,f)},changeState:function(b,a,d,g,f){return c.doCallback(b,b.onchangestate,a,d,g,f)},buildEvent:function(b,a){return function(){var d=this.current,g=a[d]||a[c.WILDCARD]||d,f=Array.prototype.slice.call(arguments);if(this.transition)return this.error(b,d,g,f,c.Error.PENDING_TRANSITION,"event "+b+" inappropriate because previous transition did not complete");if(this.cannot(b))return this.error(b,d,g,f,c.Error.INVALID_TRANSITION,"event "+b+" inappropriate in current state "+
this.current);if(!1===c.beforeEvent(this,b,d,g,f))return c.Result.CANCELLED;if(d===g)return c.afterEvent(this,b,d,g,f),c.Result.NOTRANSITION;var h=this;this.transition=function(){h.transition=null;h.current=g;c.enterState(h,b,d,g,f);c.changeState(h,b,d,g,f);c.afterEvent(h,b,d,g,f)};this.transition.cancel=function(){h.transition=null;c.afterEvent(h,b,d,g,f)};var e=c.leaveState(this,b,d,g,f);if(!1===e)return this.transition=null,c.Result.CANCELLED;if("async"===e)return c.Result.ASYNC;this.transition&&
this.transition();return c.Result.SUCCEEDED}}};e.StateMachine=c})(this);
var SimplexNoise=function(e){void 0==e&&(e=Math);this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];this.p=[];for(var c=0;256>c;c++)this.p[c]=Math.floor(256*e.random());this.perm=[];for(c=0;512>c;c++)this.perm[c]=this.p[c&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],
[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};
SimplexNoise.prototype.dot=function(e,c,b){return e[0]*c+e[1]*b};
SimplexNoise.prototype.noise=function(e,c){var b,a,d;d=0.5*(Math.sqrt(3)-1);d*=e+c;var g=Math.floor(e+d),f=Math.floor(c+d),h=(3-Math.sqrt(3))/6;d=(g+f)*h;b=e-(g-d);var i=c-(f-d),j,k;b>i?(j=1,k=0):(j=0,k=1);a=b-j+h;var l=i-k+h;d=b-1+2*h;var h=i-1+2*h,m=g&255,f=f&255,g=this.perm[m+this.perm[f]]%12;j=this.perm[m+j+this.perm[f+k]]%12;k=this.perm[m+1+this.perm[f+1]]%12;f=0.5-b*b-i*i;0>f?b=0:(f*=f,b=f*f*this.dot(this.grad3[g],b,i));i=0.5-a*a-l*l;0>i?a=0:(i*=i,a=i*i*this.dot(this.grad3[j],a,l));l=0.5-d*
d-h*h;0>l?d=0:(l*=l,d=l*l*this.dot(this.grad3[k],d,h));return 70*(b+a+d)};
SimplexNoise.prototype.noise3d=function(e,c,b){var a,d,g,f=(e+c+b)*(1/3),h=Math.floor(e+f),i=Math.floor(c+f),j=Math.floor(b+f),f=1/6;g=(h+i+j)*f;a=e-(h-g);d=c-(i-g);var k=b-(j-g),l,m,o,n,p,q;a>=d?d>=k?(l=1,o=m=0,p=n=1,q=0):(a>=k?(l=1,o=m=0):(m=l=0,o=1),n=1,p=0,q=1):d<k?(m=l=0,o=1,n=0,q=p=1):a<k?(l=0,m=1,n=o=0,q=p=1):(l=0,m=1,o=0,p=n=1,q=0);var r=a-l+f,v=d-m+f,t=k-o+f;g=a-n+2*f;var e=d-p+2*f,y=k-q+2*f,b=a-1+3*f,c=d-1+3*f,f=k-1+3*f,h=h&255,w=i&255,s=j&255,i=this.perm[h+this.perm[w+this.perm[s]]]%12,
j=this.perm[h+l+this.perm[w+m+this.perm[s+o]]]%12;n=this.perm[h+n+this.perm[w+p+this.perm[s+q]]]%12;h=this.perm[h+1+this.perm[w+1+this.perm[s+1]]]%12;p=0.6-a*a-d*d-k*k;0>p?a=0:(p*=p,a=p*p*this.dot(this.grad3[i],a,d,k));d=0.6-r*r-v*v-t*t;0>d?d=0:(d*=d,d=d*d*this.dot(this.grad3[j],r,v,t));r=0.6-g*g-e*e-y*y;0>r?g=0:(r*=r,g=r*r*this.dot(this.grad3[n],g,e,y));e=0.6-b*b-c*c-f*f;0>e?b=0:(e*=e,b=e*e*this.dot(this.grad3[h],b,c,f));return 32*(a+d+g+b)};(function(e){var c={create:function(){var b=new Float32Array(6);b[0]=Number.MAX_VALUE;b[1]=Number.MAX_VALUE;b[2]=Number.MAX_VALUE;b[3]=-Number.MAX_VALUE;b[4]=-Number.MAX_VALUE;b[5]=-Number.MAX_VALUE;return b},clone:function(b){var a=new Float32Array(6);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},copyMin:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},copyMax:function(b,a){b[0]=
a[3];b[1]=a[4];b[2]=a[5];return b},extendWithBox:function(b,a){for(var d=0;3>d;d++)b[d]=Math.min(a[d],b[d]),b[d+3]=Math.max(a[d+3],b[d+3]);return b},empty:function(b){b[0]=Number.MAX_VALUE;b[1]=Number.MAX_VALUE;b[2]=Number.MAX_VALUE;b[3]=-Number.MAX_VALUE;b[4]=-Number.MAX_VALUE;b[5]=-Number.MAX_VALUE;return b},isEmpty:function(b){return b[0]>b[3]||b[1]>b[4]||b[2]>b[5]},center:function(b,a){b[0]=0.5*(a[0]+a[3]);b[1]=0.5*(a[1]+a[4]);b[2]=0.5*(a[2]+a[5]);return b},size:function(b,a){b[0]=a[3]-a[0];b[1]=
a[4]-a[1];b[2]=a[5]-a[2];return b},halfSize:function(b,a){b[0]=0.5*(a[3]-a[0]);b[1]=0.5*(a[4]-a[1]);b[2]=0.5*(a[5]-a[2]);return b},transform:function(b,a,d){if(d[0]>d[3]||d[1]>d[4]||d[2]>d[5])c.copy(b,d);else{d=c.clone(d);if(0==a[3]&&0==a[7]&&0==a[11]&&1==a[15]){for(var g=0;3>g;g++){b[g]=b[g+3]=a[12+g];for(var f=0;3>f;f++){var h,e;h=a[4*f+g]*d[f];e=a[4*f+g]*d[f+3];h<e?(b[g]+=h,b[g+3]+=e):(b[g]+=e,b[g+3]+=h)}}return b}throw Error("Matrix is not affine");}}};c.transform2=function(){var b=XML3D.math.mat4.create(),
a=XML3D.math.vec3.create(),d=XML3D.math.vec3.create();return function(g,f,h){c.center(a,h);c.halfSize(d,h);XML3D.math.mat4.copy(b,f);b.set([0,0,0,1],12);for(h=0;16>h;h++)b[h]=Math.abs(b[h]);XML3D.math.vec3.transformMat4(d,d,b);XML3D.math.vec3.transformMat4(a,a,f);g[0]=a[0]-d[0];g[1]=a[1]-d[1];g[2]=a[2]-d[2];g[3]=a[0]+d[0];g[4]=a[1]+d[1];g[5]=a[2]+d[2];return g}}();c.longestSide=function(b){var a=Math.abs(b[3]-b[0]),d=Math.abs(b[4]-b[1]),b=Math.abs(b[5]-b[2]);return Math.max(a,Math.max(d,b))};c.intersects=
function(b,a,d){var c=1/a._direction.x,f=1/a._direction.y,h=1/a._direction.z,e=(b[0]-a._origin.x)*c,c=(b[3]-a._origin.x)*c,j=(b[1]-a._origin.y)*f,f=(b[4]-a._origin.y)*f,k=(b[2]-a._origin.z)*h,a=(b[5]-a._origin.z)*h,b=Math.max(Math.max(Math.min(e,c),Math.min(j,f)),Math.min(k,a)),e=Math.min(Math.min(Math.max(e,c),Math.max(j,f)),Math.max(k,a));if(void 0===d||void 0===d.dist)return 0<e&&b<=e;if(0>e||b>e)return d.dist=Number.MAX_VALUE,!1;d.dist=b;return!0};c.asXML3DBox=function(b){var a=new window.XML3DBox;
a.min._data[0]=b[0];a.min._data[1]=b[1];a.min._data[2]=b[2];a.max._data[0]=b[3];a.max._data[1]=b[4];a.max._data[2]=b[5];return a};c.fromXML3DBox=function(b){var a=new Float32Array(6);a[0]=b.min._data[0];a[1]=b.min._data[1];a[2]=b.min._data[2];a[3]=b.max._data[0];a[4]=b.max._data[1];a[5]=b.max._data[2];return a};c.str=function(b){return"bbox("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};e.bbox=c;e.EMPTY_BOX=c.create()})(XML3D.math);(function(e){function c(a){return{get:function(){return this._data[a]},set:function(b){this._data[a]=b;this._callback&&this._callback(this)},configurable:!1,enumerable:!1}}if(!e){var b=function(a,b,c,f){this._data=new Float32Array(3);void 0!==a&&null!==a&&this.set(a,b,c);this._callback="function"==typeof f?f:0},e=b.prototype;e.set=function(a,b,c){a.length&&3<=a.length?(this._data[0]=a[0],this._data[1]=a[1],this._data[2]=a[2]):a._data&&a._data.length&&3===a._data.length?(this._data[0]=a._data[0],this._data[1]=
a._data[1],this._data[2]=a._data[2]):3==arguments.length&&(this._data[0]=a,this._data[1]=b,this._data[2]=c);this._callback&&this._callback(this)};Object.defineProperty(e,"x",c(0));Object.defineProperty(e,"y",c(1));Object.defineProperty(e,"z",c(2));e.toString=function(){return"[object XML3DVec3]"};e.add=function(a){return a._data?new b(this._data[0]+a._data[0],this._data[1]+a._data[1],this._data[2]+a._data[2]):new b(this._data[0]+a.x,this._data[1]+a.y,this._data[2]+a.z)};e.subtract=function(a){return a._data?
new b(this._data[0]-a._data[0],this._data[1]-a._data[1],this._data[2]-a._data[2]):new b(this._data[0]-a.x,this._data[1]-a.y,this._data[2]-a.z)};e.length=function(){return Math.sqrt(this._data[0]*this._data[0]+this._data[1]*this._data[1]+this._data[2]*this._data[2])};e.setVec3Value=function(a){a=/^\s*(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(a);if(!a)throw Error("Wrong format for XML3DVec3::setVec3Value");this._data[0]=+a[1];this._data[1]=+a[2];this._data[2]=+a[3];this._callback&&this._callback(this)};e.multiply=
function(a){return a._data?new b(this._data[0]*a._data[0],this._data[1]*a._data[1],this._data[2]*a._data[2]):new b(this._data[0]*a.x,this._data[1]*a.y,this._data[2]*a.z)};e.scale=function(a){return new b(this._data[0]*a,this._data[1]*a,this._data[2]*a)};e.cross=function(a){return a._data?new b(this._data[1]*a._data[2]-this._data[2]*a._data[1],this._data[2]*a._data[0]-this._data[0]*a._data[2],this._data[0]*a._data[1]-this._data[1]*a._data[0]):new b(this._data[1]*a.z-this._data[2]*a.y,this._data[2]*
a.x-this._data[0]*a.z,this._data[0]*a.y-this._data[1]*a.x)};e.negate=function(){return new b(-this._data[0],-this._data[1],-this._data[2])};e.dot=function(a){return this._data[0]*a.x+this._data[1]*a.y+this._data[2]*a.z};e.normalize=function(){var a=this.length();if(a)a=1/a;else throw Error();return new b(this._data[0]*a,this._data[1]*a,this._data[2]*a)};XML3D.XML3DVec3=b;window.XML3DVec3=b}})(XML3D._native);
(function(e){if(!e){var c=function(b,a,d){var c=this;this._data=new Float32Array(4);this._axis=new window.XML3DVec3(0,0,1,function(){c._updateQuaternion();c._callback&&c._callback(c)});this._angle=0;this._updateQuaternion();void 0!==b&&null!==b&&this.set(b,a);this._callback="function"==typeof d?d:0},e=c.prototype;e.set=function(b,a){b.axis&&void 0!==b.angle?this.setAxisAngle(b.axis,b.angle):b.length&&4<=b.length?this._setQuaternion(b):b._data&&b._data.length&&3===b._data.length?this.setAxisAngle(b,
a):XML3D.debug.logError("XML3DRotation.set(): invalid argument given. Expect XML3DRotation or Float32Array.")};Object.defineProperty(e,"axis",{get:function(){return this._axis},set:function(){throw Error("Can't set axis. XML3DRotation::axis is readonly.");},configurable:!1,enumerable:!1});Object.defineProperty(e,"angle",{get:function(){return this._angle},set:function(b){this._angle=b;this._updateQuaternion();this._callback&&this._callback(this)},configurable:!1,enumerable:!1});e.toString=function(){return"[object XML3DRotation]"};
e.setAxisAngle=function(b,a){if("object"!=typeof b||isNaN(a))throw Error("Illegal axis and/or angle values: ( axis="+b+" angle="+a+" )");this._axis._data[0]=b._data[0];this._axis._data[1]=b._data[1];this._axis._data[2]=b._data[2];this._angle=a;this._updateQuaternion();this._callback&&this._callback(this)};e.setRotation=function(b,a){var d=b.normalize(),c=a.normalize(),f=d.cross(c);f.length()||(f=Math.abs(d._data[1])>=0.9*Math.abs(d._data[0])&&Math.abs(d._data[2])>=0.9*Math.abs(d._data[0])?new window.XML3DVec3(0,
-d._data[2],d._data[1]):Math.abs(d._data[0])>=0.9*Math.abs(d._data[1])&&Math.abs(d._data[2])>=0.9*Math.abs(d._data[1])?new window.XML3DVec3(-d._data[2],0,d._data[0]):new window.XML3DVec3(-d._data[1],d._data[0],0));this.setAxisAngle(f,Math.acos(d.dot(c)))};e._updateQuaternion=function(){var b=this._axis.length();1.0E-5<b?(b=Math.sin(this._angle/2)/b,this._data[0]=this._axis.x*b,this._data[1]=this._axis.y*b,this._data[2]=this._axis.z*b,this._data[3]=Math.cos(this._angle/2)):XML3D.math.quat.set(this._data,
0,0,0,1)};e.setAxisAngleValue=function(b){var a=/^\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(b);if(!a)throw Error("Could not parse AxisAngle string: "+b);this.setAxisAngle(new window.XML3DVec3(+a[1],+a[2],+a[3]),+a[4])};e.interpolate=function(b,a){var d=XML3D.math.quat.create(),g=new c;XML3D.math.quat.slerp(d,this._data,b._data,a);g._setQuaternion(d);return g};e.setQuaternion=function(b,a){this._setQuaternion([b.x,b.y,b.z,a])};e.toMatrix=function(){var b=XML3D.math.quat.copy(XML3D.math.quat.create(),
this._data),a=new window.XML3DMatrix;XML3D.math.mat4.fromRotationTranslation(a._data,b,[0,0,0]);return a};e.rotateVec3=function(b){var a=new window.XML3DVec3;XML3D.math.vec3.transformQuat(a._data,b._data,this._data);return a};e._setQuaternion=function(b){var a=Math.sqrt(1-b[3]*b[3]);0.001>a||isNaN(a)?(this._axis._data[0]=0,this._axis._data[1]=0,this._axis._data[2]=1,this._angle=0):(a=1/a,this._axis._data[0]=b[0]*a,this._axis._data[1]=b[1]*a,this._axis._data[2]=b[2]*a,this._angle=2*Math.acos(b[3]));
this._data=XML3D.math.quat.copy(XML3D.math.quat.create(),b);this._callback&&this._callback(this)};e.multiply=function(b){var a=new c,d=XML3D.math.quat.create();XML3D.math.quat.multiply(d,this._data,b._data);a._setQuaternion(d);return a};e.normalize=function(){var b=this._axis.normalize();return new c(b,this._angle)};e.getQuaternion=function(){return XML3D.math.quat.copy(XML3D.math.quat.create(),this._data)};e.setFromBasis=function(b,a,d){var c=XML3D.math.quat.create();XML3D.math.quat.setFromBasis(b._data,
a._data,d._data,c);this._setQuaternion(c)};XML3D.XML3DRotation=c;window.XML3DRotation=c}})(XML3D._native);
(function(e){e||(e=function(c,b,a){var d=this,g=function(){d._callback&&d._callback(d)};this._min=new window.XML3DVec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,g);this._max=new window.XML3DVec3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,g);c&&c.min?(this._min.set(c.min),this._max.set(c.max)):(c&&this._min.set(c),b&&this._max.set(b));this._callback="function"==typeof a?a:0},Object.defineProperty(e.prototype,"min",{get:function(){return this._min},set:function(){throw Error("XML3DBox::min is readonly.");
},configurable:!1,enumerable:!1}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},set:function(){throw Error("XML3DBox::max is readonly.");},configurable:!1,enumerable:!1}),e.prototype.size=function(){var c=this._max.subtract(this._min);0>c.x&&(c.x=0);0>c.y&&(c.y=0);0>c.z&&(c.z=0);return c},e.prototype.center=function(){return this._min.add(this._max).scale(0.5)},e.prototype.makeEmpty=function(){this._min=new window.XML3DVec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);
this._max=new window.XML3DVec3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this._callback&&this._callback(this)},e.prototype.isEmpty=function(){return this._min.x>this._max.x||this._min.y>this._max.y||this._min.z>this._max.z},e.prototype.toString=function(){return"[object XML3DBox]"},e.prototype.set=function(c){this._min.set(c.min);this._max.set(c.max);this._callback&&this._callback(this)},e.prototype.extend=function(c){if(c){var b;if(c.constructor===window.XML3DBox)b=c.min,c=c.max;else if(c.constructor===
window.XML3DVec3)b=c;else return;b.x<this._min.x&&(this._min.x=b.x);b.y<this._min.y&&(this._min.y=b.y);b.z<this._min.z&&(this._min.z=b.z);c.x>this._max.x&&(this._max.x=c.x);c.y>this._max.y&&(this._max.y=c.y);c.z>this._max.z&&(this._max.z=c.z)}},XML3D.XML3DBox=e,window.XML3DBox=e)})(XML3D._native);
(function(e){function c(a){return{get:function(){return this._data[a]},set:function(b){this._data[a]=b;this._callback&&this._callback(this)},configurable:!1,enumerable:!1}}if(!e){var b=function(a,b,c,f,h,e,j,k,l,m,o,n,p,q,r,v,t){"number"==typeof a&&16<=arguments.length?(this.set(a,b,c,f,h,e,j,k,l,m,o,n,p,q,r,v),this._callback="function"==typeof t?t:0):"object"==typeof a&&1==arguments.length?this.set(a):(this._data=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._callback="function"==typeof a?
a:0)},e=b.prototype;Object.defineProperty(e,"m11",c(0));Object.defineProperty(e,"m12",c(1));Object.defineProperty(e,"m13",c(2));Object.defineProperty(e,"m14",c(3));Object.defineProperty(e,"m21",c(4));Object.defineProperty(e,"m22",c(5));Object.defineProperty(e,"m23",c(6));Object.defineProperty(e,"m24",c(7));Object.defineProperty(e,"m31",c(8));Object.defineProperty(e,"m32",c(9));Object.defineProperty(e,"m33",c(10));Object.defineProperty(e,"m34",c(11));Object.defineProperty(e,"m41",c(12));Object.defineProperty(e,
"m42",c(13));Object.defineProperty(e,"m43",c(14));Object.defineProperty(e,"m44",c(15));e.set=function(a,b,c,f,h,e,j,k,l,m,o,n,p,q,r,v){"number"==typeof a&&16<=arguments.length?this._data=new Float32Array(arguments):a._data&&a._data.length&&16===a._data.length?this._data=new Float32Array(a._data):a.length&&16<=a.length?this._data=new Float32Array(a):XML3D.debug.logError("XML3DMatrix.set(): invalid parameter(s). Expect XML3DMatrix, Float32Array or 16 numbers.")};e.toString=function(){return"[object XML3DMatrix]"};
e.setMatrixValue=function(a){a=/^(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)$/.exec(a);if(!a)throw{code:DOMException.SYNTAX_ERR,message:"SYNTAX_ERR: DOM Exception 12"};if(17!=a.length)throw{code:DOMException.SYNTAX_ERR,message:"Illegal number of elements: "+(a.length-1)+"expected: 16"};this._data=new Float32Array(a.slice(1));this._callback&&this._callback(this)};e.multiply=function(a){var d=new b;XML3D.math.mat4.multiply(d._data,
this._data,a._data);return d};e.inverse=function(){var a=new b;a._data=XML3D.math.mat4.invert(a._data,this._data);if(null==a._data||isNaN(a._data[0]))throw Error("Trying to invert matrix that is not invertable.");return a};e.rotate=function(a,d,c){var f=new b;if(void 0===d&&void 0===c)return XML3D.math.mat4.rotateZ(f._data,this._data,a),f;XML3D.math.mat4.rotateZ(f._data,this._data,c);XML3D.math.mat4.rotateY(f._data,f._data,d);XML3D.math.mat4.rotateX(f._data,f._data,a);return f};e.rotateAxisAngle=
function(a,d,c,f){var h=new b;XML3D.math.mat4.rotate(h._data,this._data,f,[a,d,c]);return h};e.scale=function(a,d,c){var f=new b;c||(c=1);d||(d=a);XML3D.math.mat4.scale(f._data,this._data,[a,d,c]);return f};e.translate=function(a,d,c){var f=new b;XML3D.math.mat4.translate(f._data,this._data,[a,d,c]);return f};XML3D.XML3DMatrix=b;window.XML3DMatrix||(window.XML3DMatrix=b)}})(XML3D._native);
(function(e){if(!e){var e=function(b,a,d){var c=this,f=function(){c._callback&&c._callback(c)};this._origin=new window.XML3DVec3(0,0,0,f);this._direction=new window.XML3DVec3(0,0,-1,f);b&&b.origin?this.set(b,a):(b&&this._origin.set(b),a&&this._direction.set(a));this._callback="function"==typeof d?d:0},c=e.prototype;Object.defineProperty(c,"origin",{get:function(){return this._origin},set:function(){throw Error("Can't set axis. XML3DRay::origin is readonly.");},configurable:!1,enumerable:!1});Object.defineProperty(c,
"direction",{get:function(){return this._direction},set:function(){throw Error("Can't set axis. XML3DRay::origin is readonly.");},configurable:!1,enumerable:!1});c.set=function(b){this._origin.set(b.origin);this._direction.set(b.direction);this._callback&&this._callback(this)};c.toString=function(){return"[object XML3DRay]"};XML3D.XML3DRay=e;window.XML3DRay=e}})(XML3D._native);
(function(e){function c(a){switch(a){case Xflow.DATA_TYPE.FLOAT:return d.FLOAT;case Xflow.DATA_TYPE.FLOAT2:return d.FLOAT2;case Xflow.DATA_TYPE.FLOAT3:return d.FLOAT3;case Xflow.DATA_TYPE.FLOAT4:return d.FLOAT4;case Xflow.DATA_TYPE.FLOAT4X4:return d.FLOAT4X4;case Xflow.DATA_TYPE.INT:return d.INT;case Xflow.DATA_TYPE.INT4:return d.INT4;case Xflow.DATA_TYPE.BOOL:return d.BOOL;case Xflow.DATA_TYPE.TEXTURE:return d.TEXTURE;case Xflow.DATA_TYPE.BYTE:return d.BYTE;case Xflow.DATA_TYPE.UBYTE:return d.UBYTE;
default:throw Error("WHAT IS THIS I DON'T EVEN...");}}if(!e){var b=[],e=function(a){this.callback=a;this.observed=[]};window.XML3DDataObserver=e;e.prototype.observe=function(a,d){if(!a)throw Error("The node to observe is null.");if(!a._configured)throw Error("Note to observe is not   (yet). Make sure to pass an XML3D node and to execute this function after XML3D has been configured e.g. inside a DOMContentLoaded listener.");var c=XML3D.base.resourceManager.getAdapter(a,XML3D.data);if(!c)throw Error("Can't observe node. XML3DataObserver can only observe data containers such as <data>, <mesh> or <shader>");
0==this.observed.length&&b.push(this);var e={node:a,changed:!1,request:null},j=d&&d.names;"String"===Object.prototype.toString.call(j).slice(8,-1)&&(j=[j]);e.request=c.getComputeRequest(j,function(){e.changed=!0});e.request.getResult();this.observed.push(e)};e.prototype.disconnect=function(){for(var a=0;a<this.observed.length;++a)this.observed[a].request.clear();this.observed=[];for(a=b.length;a--;)b[a]==this&&b.splice(a,1)};XML3D.updateXflowObserver=function(){for(var c=0;c<b.length;++c){for(var f=
b[c],h=[],e=0;e<f.observed.length;++e){var j=f.observed[e];if(j.changed){j.changed=!1;var k=j.request.getResult(),k=new d(k);h.push(new a(j.node,k))}}0<h.length&&f.callback&&f.callback(h,f)}};var a=function(a,b){this.target=a;this.result=b};window.XML3DDataRecord=a;var d=function(a){this._entries={};for(var b=0;b<a.outputNames.length;++b){var d=a.outputNames[b],e=a.getOutputData(d),j=e&&e.getValue();null!==j&&(e=c(e.type),this._entries[d]={type:e,value:j})}};window.XML3DDataResult=d;d.prototype.getValue=
function(a){return this._entries[a]?this._entries[a].value:null};d.prototype.getType=function(a){return this._entries[a]?this._entries[a].type:null};d.prototype.getNames=function(){var a=[],b;for(b in this._entries)a.push(b);return a};d.FLOAT=0;d.FLOAT2=1;d.FLOAT3=2;d.FLOAT4=3;d.FLOAT4X4=4;d.INT=10;d.INT4=11;d.BOOL=20;d.TEXTURE=30;d.BYTE=40;d.UBYTE=50;e=function(a,b,d,e,j,k){this.type=c(a);this.origin=b;this.originalName=d;this.seqLength=e;this.seqMinKey=j;this.seqMaxKey=k};window.XML3DDataChannelInfo=
e;e.ORIGIN_CHILD=1;e.ORIGIN_COMPUTE=2;e.ORIGIN_PROTO=3}})(XML3D._native);(function(e){function c(b){for(var a in this.connectedAdapterHandles)this.connectedAdapterHandles[a]==b.adapterHandle&&this.notifyChanged(new e.events.ConnectedAdapterNotification(b,a))}e.base={toString:function(){return"base"}};e.base.Adapter=function(b){this.factory=b};e.base.Adapter.prototype.connectAdapterHandle=function(b,a){this.connectedAdapterHandles||(this.connectedAdapterHandles={},this._bindedAdapterHandleCallback=c.bind(this));this.disconnectAdapterHandle(b);a?(this.connectedAdapterHandles[b]=
a,this.connectedAdapterHandles[b].addListener(this._bindedAdapterHandleCallback)):delete this.connectedAdapterHandles[b]};e.base.Adapter.prototype.disconnectAdapterHandle=function(b){this.connectedAdapterHandles&&this.connectedAdapterHandles[b]&&(this.connectedAdapterHandles[b].removeListener(this._bindedAdapterHandleCallback),delete this.connectedAdapterHandles[b])};e.base.Adapter.prototype.clearAdapterHandles=function(){for(var b in this.connectedAdapterHandles)this.connectedAdapterHandles[b].removeListener(this._bindedAdapterHandleCallback);
this.connectedAdapterHandles={}};e.base.Adapter.prototype.getConnectedAdapterHandle=function(b){return this.connectedAdapterHandles&&this.connectedAdapterHandles[b]};e.base.Adapter.prototype.getConnectedAdapter=function(b){return(b=this.getConnectedAdapterHandle(b))&&b.getAdapter()};e.base.Adapter.prototype.onDispose=function(){};e.base.NodeAdapter=function(b,a){e.base.Adapter.call(this,b);this.node=a};e.createClass(e.base.NodeAdapter,e.base.Adapter);e.base.NodeAdapter.prototype.init=function(){};
e.base.NodeAdapter.prototype.notifyChanged=function(){};e.base.NodeAdapter.prototype.getAdapterHandle=function(b,a,d){d=void 0===d?this.factory.canvasId:d;return e.base.resourceManager.getAdapterHandle(this.node.ownerDocument,b,a||this.factory.aspect,d)};e.base.NodeAdapter.prototype.notifyOppositeAdapters=function(b){b=b||e.events.ADAPTER_HANDLE_CHANGED;return e.base.resourceManager.notifyNodeAdapterChange(this.node,this.factory.aspect,this.factory.canvasId,b)};e.base.NodeAdapter.prototype.traverse=
function(b){b(this);for(var a=this.node.firstElementChild;a;){var d=this.factory.getAdapter(a);d&&d.traverse(b);a=a.nextElementSibling}};e.base.IFactory=function(){};e.base.AdapterFactory=function(b,a,d){this.aspect=b;this.canvasId=d||0;this.mimetypes="string"==typeof a?[a]:a;e.base.registerFactory(this)};e.base.AdapterFactory.prototype.createAdapter=function(){return null};e.base.AdapterFactory.prototype.supportsMimetype=function(b){return-1!=this.mimetypes.indexOf(b)};e.base.NodeAdapterFactory=
function(b,a){e.base.AdapterFactory.call(this,b,["text/xml","application/xml"],a)};e.createClass(e.base.NodeAdapterFactory,e.base.AdapterFactory);e.base.NodeAdapterFactory.prototype.getAdapter=function(b){b&&void 0===b._configured&&e.config.element(b,!0);if(!b||void 0===b._configured)return null;var a=b._configured,d=this.aspect+"_"+this.canvasId,c=a.adapters[d];if(void 0!==c)return c;if(c=this.createAdapter(b))a.adapters[d]=c,c.init();return c};e.base.callAdapterFunc=function(b,a){var d=[];if(!b||
void 0===b._configured)return d;var c=b._configured.adapters,f;for(f in c)for(var h in a){var e=c[f],j=e[h];j&&d.push(j.apply(e,a[h]))}return d};e.base.sendAdapterEvent=function(b,a){if(!b||void 0===b._configured)return!1;var d=b._configured.adapters,c;for(c in d)for(var f in a){var h=d[c][f];h&&h.apply(d[c],a[f])}return!0}})(window.XML3D);
(function(e){var c=function(b){this.url=b;this.adapter=null;this.listeners=[];this.status=0};c.STATUS={LOADING:0,NOT_FOUND:1,READY:2};c.prototype.hasAdapter=function(){return null!=this.adapter};c.prototype.getAdapter=function(){return this.adapter};c.prototype.setAdapter=function(b,a){this.adapter=b;this.status=a;this.notifyListeners(e.events.ADAPTER_HANDLE_CHANGED)};c.prototype.notifyListeners=function(b){for(var b=new e.events.AdapterHandleNotification(this,b),a=this.listeners.length;a--;)this.listeners[a](b)};
c.prototype.addListener=function(b){-1==this.listeners.indexOf(b)&&this.listeners.push(b)};c.prototype.removeListener=function(b){b=this.listeners.indexOf(b);-1!=b&&this.listeners.splice(b,1)};e.base.AdapterHandle=c})(window.XML3D);
(function(){function e(a){var b=p[a];b||(b={counter:0,listeners:[]},p[a]=b);return b}function c(a){var b=a.listeners;a.listeners=[];for(a=b.length;a--;)b[a](this)}function b(a){if(a=p[a])XML3D.debug.assert(0<a.counter,"counter must be > 0"),a.counter--,0==a.counter&&c(a)}function a(a){for(var b in r)if(a==r[b])return!0;return!1}function d(a){for(var b in v)if(-1!==a.indexOf(v[b],a.length-v[b].length))return!0;return!1}function g(b){var c=null;try{c=new XMLHttpRequest}catch(g){c=null}c&&(c._url=b,
c._contentChecked=!1,c.open("GET",b,!0),d(b)&&(c.responseType="arraybuffer"),c.onreadystatechange=function(){if(!c._aborted){if(!c._contentChecked&&(c.readyState==2||c.readyState==3||c.readyState==4)&&c.status==200){c._contentChecked=true;var b=c.getResponseHeader("content-type");if(b){b=a(b);if(b!=(c.responseType=="arraybuffer")){c._aborted=true;var d=c.onreadystatechange;c.onreadystatechange=null;var g=c._url;c.abort();c=new XMLHttpRequest;c._url=g;c._contentChecked=true;c.open("GET",g,true);if(b)c.responseType=
"arraybuffer";c.onreadystatechange=d;c.send(null);return}}}if(c.readyState==4)if(c.status==200){XML3D.debug.logDebug("Loaded: "+c._url);XML3D.xmlHttpCallback&&XML3D.xmlHttpCallback(c);b=c;d=b.getResponseHeader("content-type");f(b,b._url,d)}else{XML3D.debug.logError("Could not load external document '"+c._url+"': "+c.status+" - "+c.statusText);h(c._url)}}},c.send(null))}function f(a,b,d){var c=m[b],g=c.mimetype=d;0<d.indexOf(";")&&(g=d.substr(0,d.indexOf(";")));var f=null;if("arraybuffer"==a.responseType)f=
a.response;else if("application/json"==g)f=JSON.parse(a.responseText);else if("application/xml"==g||"text/xml"==g){if(f=a.responseXML,!f){XML3D.debug.logError("Invalid external XML document '"+a._url+"': XML Syntax error");return}}else"application/octet-stream"==g||"text/plain; charset=x-user-defined"==d?XML3D.debug.logError("Possibly wrong loading of resource "+b+". Mimetype is "+d+" but response is not an ArrayBuffer"):XML3D.debug.logError("Unidentified response type (response = '"+a.response+"', responseType = '"+
a.responseType+"')"),f=a.response;(d=XML3D.base.findFormat(f,a.responseType,g))?(c.format=d,d.getFormatData(f,a.responseType,g,function(a,d){if(a){c.response=d;var g=m[b],f=g.fragments;g.fragments=[];for(g=0;g<f.length;++g)i(b,f[g])}else h(b)})):XML3D.debug.logError("No format handler for resource (response = '"+f+"', responseType = '"+a.responseType+"')")}function h(a){var b=m[a],d=b.fragments;b.fragments=[];for(b=0;b<d.length;++b)k(a+(d[b]?"#"+d[b]:""))}function i(a,b){var d=m[a].response,c=m[a].format,
g=a+(b?"#"+b:"");d?(d=c.getFragmentData(d,b))?j(g,c,d):k(g):k(g)}function j(a,d,c){for(var g in n[a])for(var f in n[a][g]){var h=n[a][g][f];h.hasAdapter()||(l(h,g,f,d,c),b(f,a))}}function k(a){for(var d in n[a])for(var c in n[a][d])n[a][d][c].setAdapter(null,XML3D.base.AdapterHandle.STATUS.NOT_FOUND),b(c,a)}function l(a,b,d,c,g){(d=c.getFactory(b,d))?(b=d.getAdapter?d.getAdapter(g):d.createAdapter(g))&&a.setAdapter(b,XML3D.base.AdapterHandle.STATUS.READY):XML3D.debug.logError("Format does not support adapterType "+
b)}XML3D.options.register("resource-crossorigin-attribute","anonymous");var m={},o={},n={},p={},q=[],r=["application/octet-stream","text/plain; charset=x-user-defined"],v=[".bin",".bson"];XML3D.base.registerFactory=function(a){var b=a.canvasId;o[b]||(o[b]=[]);o[b].push(a)};XML3D.base.registerFormat=function(a){a&&q.push(a)};XML3D.base.findFormat=function(a,b,d){for(var c=0;c<q.length;++c){var g=q[c];if(q[c].isFormatSupported(a,b,d))return g}return null};var t=function(){};t.prototype.addLoadCompleteListener=
function(a,b){var d=p[a];void 0===d||0==d.counter?b(a):-1==d.listeners.indexOf(b)&&d.listeners.push(b)};t.prototype.removeLoadCompleteListener=function(a,b){var d=p[a];if(d){var c=d.listeners.indexOf(b);-1!=c&&d.listeners.splice(c,1)}};t.prototype.addBinaryContentType=function(a){-1==r.indexOf(a)&&r.push(a)};t.prototype.removeBinaryContentType=function(a){a=r.indexOf(a);-1!=a&&r.splice(a,1)};t.prototype.addBinaryExtension=function(a){-1==v.indexOf(a)&&v.push(a)};t.prototype.removeBinaryExtension=
function(a){a=v.indexOf(a);-1!=a&&v.splice(a,1)};t.prototype.getAbsoluteURI=function(a,b){if(!b)return null;"string"==typeof b&&(b=new XML3D.URI(b));if(a!=document||!b.isLocal())b=b.getAbsoluteURI(a.documentURI);return b};t.prototype.getAdapterHandle=function(a,b,d,c){c=c||0;b=this.getAbsoluteURI(a,b);if(!b)return null;n[b]||(n[b]={});n[b][d]||(n[b][d]={});if(a=n[b][d][c])return a;a=new XML3D.base.AdapterHandle(b);n[b][d][c]=a;b.isLocal()?(b=XML3D.URIResolver.resolveLocal(b))?l(a,d,c,XML3D.base.xml3dFormatHandler,
b):a.setAdapter(null,XML3D.base.AdapterHandle.STATUS.NOT_FOUND):(e(c).counter++,d=b.toStringWithoutFragment(),(c=m[d])&&c.response?i(d,b.fragment):(c||(g(d),m[d]=c={fragments:[]}),c.fragments.push(b.fragment)));return a};t.prototype.getAdapter=function(a,b,d){return(b=XML3D.base.xml3dFormatHandler.getFactory(b,d))?b.getAdapter(a):null};t.prototype.notifyNodeIdChange=function(a,b,d){for(var c=a;c.parentNode;)c=c.parentNode;if(c==window.document){if(b){var b="#"+b,g;for(g in n[b])for(var f in n[b][g])c=
n[b][g][f],c.hasAdapter()&&c.setAdapter(null,XML3D.base.AdapterHandle.STATUS.NOT_FOUND)}d&&j("#"+d,XML3D.base.xml3dFormatHandler,a)}};t.prototype.notifyNodeAdapterChange=function(a,b,d,c){d=d||0;a="#"+a.id;n[a]&&n[a][b]&&n[a][b][d]&&n[a][b][d].notifyListeners(c)};t.prototype.loadData=function(b,c,g){var f=null;try{f=new XMLHttpRequest}catch(h){f=null}f&&(f._url=b,f._contentChecked=!1,f.open("GET",b,!0),d(b)&&(f.responseType="arraybuffer"),f.onreadystatechange=function(){if(!f._aborted){if(!f._contentChecked&&
(f.readyState==2||f.readyState==3||f.readyState==4)&&f.status==200){f._contentChecked=true;var b=f.getResponseHeader("content-type");if(b){b=a(b);if(b!=(f.responseType=="arraybuffer")){f._aborted=true;var d=f.onreadystatechange;f.onreadystatechange=null;var h=f._url;f.abort();f=new XMLHttpRequest;f._url=h;f._contentChecked=true;f.open("GET",h,true);if(b)f.responseType="arraybuffer";f.onreadystatechange=d;f.send(null);return}}}if(f.readyState==4)if(f.status==200){XML3D.debug.logDebug("Loaded: "+f._url);
b=f.getResponseHeader("content-type");d=null;if(f.responseType=="arraybuffer")d=f.response;else if(b=="application/json")d=JSON.parse(f.responseText);else if(b=="application/xml"||b=="text/xml")d=f.responseXML;else if(b=="application/octet-stream"||b=="text/plain; charset=x-user-defined"){XML3D.debug.logError("Possibly wrong loading of resource "+h+". Mimetype is "+b+" but response is not an ArrayBuffer");d=f.responseText}c&&c(d)}else{XML3D.debug.logError("Could not load external document '"+f._url+
"': "+f.status+" - "+f.statusText);g&&g(f)}}},f.send(null))};t.prototype.getImage=function(a,d,c){e(0).counter++;var g=new Image;g.onload=function(c){b(0,a);d(c,g)};g.onerror=function(d){b(0,a);c(d,g)};a.hasSameOrigin(document.location.href)||(g.crossOrigin=XML3D.options.getValue("resource-crossorigin-attribute"),XML3D.debug.logWarning("You are using an cross-origin image as texture. This might cause troubles cause the canvas is 'tainted'."));g.src=a.toString();return g};t.prototype.getVideo=function(a,
d,c){function g(){b(0,a)}function f(a){return function(b){a(b,h)}}e(0).counter++;var h=document.createElement("video");h.addEventListener("canplay",g,!0);h.addEventListener("error",g,!0);a.hasSameOrigin(document.location.href)||(h.crossOrigin=XML3D.options.getValue("resource-crossorigin-attribute"),XML3D.debug.logWarning("You are using an cross-origin video as texture. This might cause troubles cause the canvas is 'tainted'.",a));h.autoplay=d;for(var i in c)h.addEventListener(i,f(c[i]),!0);h.src=
a.toString();return h};XML3D.base.resourceManager=new t})();
(function(){var e=function(){this.factoryClasses={};this.factoryCache={}};e.prototype.registerFactoryClass=function(a){if(!a.prototype.aspect||!XML3D.isSuperclassOf(XML3D.base.AdapterFactory,a))throw Error("factoryClass must be a subclass of XML3D.base.AdapterFactory");this.factoryClasses[a.prototype.aspect]=a};e.prototype.getFactoryClassByAspect=function(a){return this.factoryClasses[a]};e.prototype.getFactory=function(a,b){var b=b||0,d=a+"_"+b,c=this.factoryCache[d];if(!c){c=this.getFactoryClassByAspect(a);
if(!c)return null;c=new c(b);this.factoryCache[d]=c}return c};e.prototype.isFormatSupported=function(){return!1};e.prototype.getFormatData=function(a,b,d,c){c(!0,a)};e.prototype.getFragmentData=function(a,b){return!b?a:null};var c=function(){e.call(this)};XML3D.createClass(c,e);c.prototype.isFormatSupported=function(a,b,d){return a&&9===a.nodeType&&("application/xml"===d||"text/xml"===d)};c.prototype.getFormatData=function(a,b,d,c){c(!0,a)};c.prototype.getFragmentData=function(a,b){return a.querySelectorAll("*[id="+
b+"]")[0]};var b=function(){e.call(this)};XML3D.createClass(b,c);b.prototype.isFormatSupported=function(a,b,d){return c.prototype.isFormatSupported.call(this,a,b,d)};b.prototype.getFormatData=function(a,b,d,c){b=a.querySelectorAll("xml3d");for(d=0;d<b.length;++d)XML3D.config.element(b[d]);c(!0,a)};var a=function(){e.call(this)};XML3D.createClass(a,e);a.prototype.isFormatSupported=function(a,b,d){return"application/json"===d};var d=function(){e.call(this)};XML3D.createClass(d,e);XML3D.base.JSONFormatHandler=
a;XML3D.base.BinaryFormatHandler=d;XML3D.base.XMLFormatHandler=c;XML3D.base.XML3DFormatHandler=b;XML3D.base.xml3dFormatHandler=new b;XML3D.base.FormatHandler=e;XML3D.base.registerFormat(XML3D.base.xml3dFormatHandler)})();(function(){var e={NODE_INSERTED:0,VALUE_MODIFIED:1,NODE_REMOVED:2,THIS_REMOVED:3,ADAPTER_HANDLE_CHANGED:4,ADAPTER_VALUE_CHANGED:5,Notification:function(c){this.type=c}};e.Notification.prototype.toString=function(){return"Notification (type:"+this.type+")"};e.NotificationWrapper=function(c,b){this.wrapped=c;this.type=b};XML3D.createClass(e.NotificationWrapper,e.Notification);e.NotificationWrapper.prototype.toString=function(){return"NotificationWrapper (type:"+this.type+", wrapped: "+this.wrapped+
")"};e.AdapterHandleNotification=function(c,b){this.adapterHandle=c;this.type=b};XML3D.createClass(e.AdapterHandleNotification,e.Notification);e.AdapterHandleNotification.prototype.toString=function(){return"AdapterHandleNotification (type:"+this.type+")"};e.ConnectedAdapterNotification=function(c,b){this.adapter=c.adapterHandle.getAdapter();this.key=b;this.url=c.adapterHandle.url;this.type=c.type;this.handleStatus=c.adapterHandle.status};XML3D.createClass(e.ConnectedAdapterNotification,e.Notification);
e.ConnectedAdapterNotification.prototype.toString=function(){return"ConnectedAdapterNotification (type:"+this.type+", key: "+this.key+")"};XML3D.events=XML3D.events||{};XML3D.extend(XML3D.events,e)})();XML3D.config=XML3D.config||{};XML3D.config.isXML3DElement=function(e){return e.nodeType===Node.ELEMENT_NODE&&e.namespaceURI==XML3D.xml3dNS};
XML3D.config.element=function(e,c){if(void 0===e._configured){var b=XML3D.classInfo[e.localName];if(void 0===b)XML3D.debug.logInfo("Unrecognised element "+e.localName);else{e._configured="xml3d"==e.localName?new XML3D.XML3DHandler(e):new XML3D.ElementHandler(e,c);e._configured.registerAttributes(b);void 0==e.style&&(e.style=null);b=e.firstElementChild;for(XML3D.base.resourceManager.notifyNodeIdChange(e,null,e.getAttribute("id"));b;)XML3D.config.element(b,c),b=b.nextElementSibling}}};
XML3D.config.configure=function(e,c){Array.isArray(e)?Array.forEach(e,function(b){XML3D.config.element(b,c)}):XML3D.config.element(e,c)};
(function(e){if(!e){var e={},c=document.getElementById;e.getElementById=function(a){var b=c.call(this,a);if(b)return b;for(var b=this.getElementsByTagName("*"),f=0;f<b.length;f++){var h=b[f];if(h.getAttribute("id")===a)return h}return null};var b=document.createElementNS;e.createElementNS=function(a,c){var f=b.call(this,a,c);(a==XML3D.xml3dNS||XML3D.classInfo[c.toLowerCase()])&&XML3D.config.element(f,!0);return f};var a=document.createElement;e.createElement=function(b){var c=a.call(this,b);XML3D.classInfo[b.toLowerCase()]&&
XML3D.config.element(c,!0);return c};XML3D.extend(window.document,e)}})(XML3D._native);
if(-1!=navigator.userAgent.indexOf("WebKit")){var attrModifiedWorks=!1,listener=function(){attrModifiedWorks=!0};document.documentElement.addEventListener("DOMAttrModified",listener,!1);document.documentElement.setAttribute("___TEST___",!0);document.documentElement.removeAttribute("___TEST___");document.documentElement.removeEventListener("DOMAttrModified",listener,!1);attrModifiedWorks||(Element.prototype.__setAttribute=HTMLElement.prototype.setAttribute,Element.prototype.setAttribute=function(e,
c){var b=this.getAttribute(e);this.__setAttribute(e,c);var c=this.getAttribute(e),a=document.createEvent("MutationEvent");a.initMutationEvent("DOMAttrModified",!0,!1,this,b||"",c||"",e,null==b?MutationEvent.ADDITION:MutationEvent.MODIFICATION);this.dispatchEvent(a)},Element.prototype.__removeAttribute=HTMLElement.prototype.removeAttribute,Element.prototype.removeAttribute=function(e){var c=this.getAttribute(e);this.__removeAttribute(e);var b=document.createEvent("MutationEvent");b.initMutationEvent("DOMAttrModified",
!0,!1,this,c,"",e,MutationEvent.REMOVAL);this.dispatchEvent(b)})}
(function(){function e(a){var b=a.target._configured;if("style"==a.attrName){var d=new k.NotificationWrapper(a);d.type=k.VALUE_MODIFIED;b.notify(d)}if(d=b&&b.handlers[a.attrName]){var c=!1;d.setFromAttribute&&(c=d.setFromAttribute(a.newValue,a.prevValue));c||(d=new k.NotificationWrapper(a),d.type=k.VALUE_MODIFIED,b.notify(d))}}function c(d){var c=d.target,g=d.relatedNode._configured;if(g){var f=new k.NotificationWrapper(d);c.nodeType==Node.TEXT_NODE&&g.handlers.value?(f.type=k.VALUE_MODIFIED,g.handlers.value.resetValue()):
(f.type=k.NODE_REMOVED,g.notify(f),c._configured&&(f.type=k.THIS_REMOVED,b(c,f),a(c)));d.stopPropagation()}}function b(a,d){a._configured&&(a._configured.notify(d),a._configured.remove(d));for(var c=a.firstElementChild;c;)b(c,d),c=c.nextElementSibling}function a(b){XML3D.base.resourceManager.notifyNodeIdChange(b,b.id,null);for(b=b.firstElementChild;b;)a(b),b=b.nextElementSibling}function d(a){var b=a.target,d=a.relatedNode._configured;if(d&&a.currentTarget!==b){var c=new k.NotificationWrapper(a);
b.nodeType==Node.TEXT_NODE&&d.handlers.value?(c.type=k.VALUE_MODIFIED,d.handlers.value.resetValue()):(XML3D.config.element(b),c.type=k.NODE_INSERTED,g(b));d.notify(c);a.stopPropagation()}}function g(a){for(var b=a.firstElementChild;b;)g(b),b=b.nextElementSibling;XML3D.base.resourceManager.notifyNodeIdChange(a,null,a.id)}function f(a){a=a.target;XML3D.base.resourceManager.notifyNodeIdChange(a,null,a.id)}function h(a){a=a.target;XML3D.base.resourceManager.notifyNodeIdChange(a,a.id,null)}function i(a,
b,d){var c={get:function(){return d[a]}};try{Object.defineProperty(b,a,c)}catch(g){XML3D.debug.logWarning("Can't configure "+b.nodeName+"::"+a)}}var j={},k=XML3D.events;j.ElementHandler=function(a,b){a&&(this.element=a,this.handlers={},this.adapters={},b&&(a.addEventListener("DOMNodeRemoved",c,!0),a.addEventListener("DOMNodeInserted",d,!0),a.addEventListener("DOMNodeInsertedIntoDocument",f,!0),a.addEventListener("DOMNodeRemovedFromDocument",h,!0),a.addEventListener("DOMAttrModified",e,!0),this.monitoring=
!0))};j.ElementHandler.prototype.registerAttributes=function(a){var b=this.element,d;for(d in a)if(void 0===a[d])delete b[d];else if(void 0!==a[d].a){var c=a[d].id||d,g=new a[d].a(b,c,a[d].params);this.handlers[c]=g;try{Object.defineProperty(b,d,g.desc)}catch(f){XML3D.debug.logWarning("Can't configure "+b.nodeName+"::"+d)}}else void 0!==a[d].m?b[d]=a[d].m:XML3D.debug.logError("Can't configure "+b.nodeName+"::"+d);return b};j.ElementHandler.prototype.registerMixed=function(){this.element.addEventListener("DOMCharacterDataModified",
this,!1)};j.ElementHandler.prototype.handleEvent=function(a){XML3D.debug.logDebug(a.type+" at "+a.currentTarget.localName+"/"+a.target);var b=new k.NotificationWrapper(a);switch(a.type){case "DOMCharacterDataModified":b.type=k.VALUE_MODIFIED,this.handlers.value.resetValue(),this.notify(b)}};j.ElementHandler.prototype.notify=function(a){var b=this.adapters,d;for(d in b)try{b[d].notifyChanged(a)}catch(c){XML3D.debug.logException(c)}};j.ElementHandler.prototype.remove=function(){for(var a in this.adapters){var b=
this.adapters[a];if(b.onDispose)b.onDispose();b.clearAdapterHandles&&b.clearAdapterHandles()}this.adapters={};for(a in this.handlers)b=this.handlers[a],b.remove&&b.remove()};j.ElementHandler.prototype.toString=function(){return"ElementHandler ("+this.element.nodeName+", id: "+this.element.id+")"};var l="clientHeight,clientLeft,clientTop,clientWidth,offsetHeight,offsetLeft,offsetTop,offsetWidth".split(",");j.XML3DHandler=function(a){j.ElementHandler.call(this,a,!0);var b=document.createElement("canvas");
b.width=800;b.height=600;this.canvas=b;for(var d in l)i(l[d],a,b);a.getBoundingClientRect=function(){return b.getBoundingClientRect()}};XML3D.createClass(j.XML3DHandler,j.ElementHandler);XML3D.extend(XML3D,j)})();
(function(){var e=function(a){switch(a.toLowerCase()){case "true":case "1":return!0;case "false":case "0":return!1;default:return Boolean(a)}},c={},b=function(){this.setter=function(){}};c.IDHandler=function(a,b){this.setFromAttribute=function(b,d){XML3D.base.resourceManager.notifyNodeIdChange(a,d,b)};this.desc={get:function(){return this.getAttribute(b)||""},set:function(a){this.setAttribute(b,a)}}};c.StringAttributeHandler=function(a,b){this.desc={get:function(){return this.getAttribute(b)||""},
set:function(a){this.setAttribute(b,a)}}};c.ReferenceHandler=c.StringAttributeHandler;c.EnumAttributeHandler=function(a,d,c){b.call(this,a);var e=c.d;this.setFromAttribute=function(a){e=(a=a.toLowerCase())&&void 0!==c.e[a]?c.e[a]:c.d;return!1};a.hasAttribute(d)&&this.setFromAttribute(a.getAttribute(d));this.desc={get:function(){return c.e[e]},set:function(a){this.setAttribute(d,a);e=(a="string"==typeof a?a.toLowerCase():void 0)&&void 0!==c.e[a]?c.e[a]:c.d}}};c.EnumAttributeHandler.prototype=new b;
c.EnumAttributeHandler.prototype.constructor=c.EnumAttributeHandler;c.EventAttributeHandler=function(a,d){b.call(this,a);var c=null;this.setFromAttribute=function(){c=null;return!1};this.desc={get:function(){return c?c:!this.hasAttribute(d)||void 0===c?null:eval("crx = function onclick(event){\n  "+this.getAttribute(d)+"\n}")},set:function(b){c="function"==typeof b?b:void 0;this._configured.notify({attrName:d,relatedNode:a})}}};c.EventAttributeHandler.prototype=new b;c.EventAttributeHandler.prototype.constructor=
c.EventAttributeHandler;c.IntAttributeHandler=function(a,b,d){var c=d;this.setFromAttribute=function(e){c=(e=e.match(/^\d+/))?+e[0]:d;a._configured.canvas&&(a._configured.canvas[b]=c);return!1};a.hasAttribute(b)&&this.setFromAttribute(a.getAttribute(b));this.desc={get:function(){return c},set:function(a){a=+a;c=isNaN(a)?d:Math.floor(a);this.setAttribute(b,c+"")}}};c.IntAttributeHandler.prototype=new b;c.IntAttributeHandler.prototype.constructor=c.IntAttributeHandler;c.FloatAttributeHandler=function(a,
b,d){var c=d;this.setFromAttribute=function(a){a=+a;c=isNaN(a)?d:a;return!1};a.hasAttribute(b)&&this.setFromAttribute(a.getAttribute(b));this.desc={get:function(){return c},set:function(a){a=+a;c=isNaN(a)?d:a;this.setAttribute(b,c+"")}}};c.BoolAttributeHandler=function(a,b,d){var c=d;this.setFromAttribute=function(a){c=e(a+"");return!1};a.hasAttribute(b)&&this.setFromAttribute(a.getAttribute(b));this.desc={get:function(){return c},set:function(a){c=Boolean(a);this.setAttribute(b,c+"")}}};c.XML3DVec3AttributeHandler=
function(a,b,d){var c=null,e=this,k=function(d){a.setAttribute(b,d.x+" "+d.y+" "+d.z)};this.setFromAttribute=function(a){c||(c=new window.XML3DVec3(0,0,0,k));(a=/^\s*(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(a))?(c._data[0]=a[1],c._data[1]=a[2],c._data[2]=a[3]):c._data.set(d);return!1};this.desc={get:function(){c||(this.hasAttribute(b)?e.setFromAttribute(this.getAttribute(b)):c=new window.XML3DVec3(d[0],d[1],d[2],k));return c},set:function(){throw Error("Can't set "+a.nodeName+"::"+b+": it's readonly");}}};
c.XML3DRotationAttributeHandler=function(a,b,d){var c=null,e=this,k=function(d){a.setAttribute(b,d.axis.x+" "+d.axis.y+" "+d.axis.z+" "+d.angle)};this.setFromAttribute=function(a){c||(c=new window.XML3DRotation(null,null,k));(a=/^\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(a))?(c._axis._data[0]=+a[1],c._axis._data[1]=+a[2],c._axis._data[2]=+a[3],c._angle=+a[4]):(c._axis._data[0]=d[0],c._axis._data[1]=d[1],c._axis._data[2]=d[2],c._angle=d[3]);c._updateQuaternion();return!1};this.desc={get:function(){c||
(this.hasAttribute(b)?e.setFromAttribute(this.getAttribute(b)):c=new window.XML3DRotation(new window.XML3DVec3(d[0],d[1],d[2]),d[3],k));return c},set:function(){throw Error("Can't set "+a.nodeName+"::"+b+": it's readonly");}}};var a=function(a,b,d){a._configured.registerMixed();return{get:function(){b.value||(b.value=d.parse(a));return b.value},set:function(){throw Error("Can't set "+a.nodeName+"::value: it's readonly");}}},d=function(a){for(var b="",a=a.firstChild;a;)b+=3==a.nodeType?a.textContent:
" ",a=a.nextSibling;return b};c.FloatArrayValueHandler=function(b){var d={};this.desc=a(b,d,this);this.resetValue=function(){d.value=null}};c.FloatArrayValueHandler.prototype.parse=function(a){return(a=d(a).match(/([+\-0-9eE\.]+)/g))?new Float32Array(a):new Float32Array};c.Float2ArrayValueHandler=c.FloatArrayValueHandler;c.Float3ArrayValueHandler=c.FloatArrayValueHandler;c.Float4ArrayValueHandler=c.FloatArrayValueHandler;c.Float4x4ArrayValueHandler=c.FloatArrayValueHandler;c.IntArrayValueHandler=
function(b){var d={};this.desc=a(b,d,this);this.resetValue=function(){d.value=null}};c.IntArrayValueHandler.prototype.parse=function(a){return(a=d(a).match(/([+\-0-9]+)/g))?new Int32Array(a):new Int32Array};c.BoolArrayValueHandler=function(b){var d={};this.desc=a(b,d,this);this.resetValue=function(){d.value=null}};c.BoolArrayValueHandler.prototype.parse=function(a){a=d(a).match(/(true|false|0|1)/ig);return!a?new Uint8Array:(a=Array.map(a,e))?new Uint8Array(a):new Uint8Array};c.StringValueHandler=
function(b){var d={};this.desc=a(b,d,this);this.resetValue=function(){d.value=null}};c.StringValueHandler.prototype.parse=function(a){return a.textContent};c.CanvasStyleHandler=function(a,b){var d=a._configured.canvas;this.desc={};this.desc.get=function(){return d.style};this.desc.set=function(){};this.setFromAttribute=function(a){d.setAttribute(b,a)};a.hasAttribute(b)&&this.setFromAttribute(a.getAttribute(b))};c.CanvasClassHandler=function(a,b){var d=a._configured.canvas;d.className="_xml3d";this.desc=
{};this.desc.get=function(){return d.className};this.desc.set=function(a){d.className=a};this.setFromAttribute=function(a){d.setAttribute(b,a+" _xml3d")};a.hasAttribute(b)&&this.setFromAttribute(a.getAttribute(b))};XML3D.extend(XML3D,c)})();XML3D.methods=XML3D.methods||{};
new function(){function e(a,b){var d={},c;for(c in b){var e=b[c],k=a.getOutputData(e)&&a.getOutputData(e).getValue();k&&(d[e]=k)}return d}var c={xml3dCreateXML3DVec3:function(){return new window.XML3DVec3},xml3dCreateXML3DRay:function(){return new window.XML3DRay},xml3dGetElementByRay:function(a,b,d){var c=this._configured.adapters||{},e;for(e in c)if(c[e].getElementByRay)return c[e].getElementByRay(a,b,d);return null},xml3dCreateXML3DMatrix:function(){return new window.XML3DMatrix},xml3dCreateXML3DRotation:function(){return new window.XML3DRotation},
viewGetDirection:function(){return this.orientation.rotateVec3(new window.XML3DVec3(0,0,-1))},viewSetPosition:function(a){this.position=a}},b=XML3D.math.vec3.create(),a=XML3D.math.vec3.create(),d=XML3D.math.vec3.create();XML3D.math.quat.setFromMat3=function(a,b){var d=a[0]+a[4]+a[8];0<d?(d=2*Math.sqrt(d+1),b[0]=(a[7]-a[5])/d,b[1]=(a[2]-a[6])/d,b[2]=(a[3]-a[1])/d,b[3]=0.25*d):a[0]>a[4]&a[0]>a[8]?(d=2*Math.sqrt(1+a[0]-a[4]-a[8]),b[3]=(a[7]-a[5])/d,b[0]=0.25*d,b[1]=(a[1]+a[3])/d,b[2]=(a[2]+a[6])/d):
a[4]>a[8]?(d=2*Math.sqrt(1+a[4]-a[0]-a[8]),b[3]=(a[2]-a[6])/d,b[0]=(a[1]+a[3])/d,b[1]=0.25*d,b[2]=(a[5]+a[7])/d):(d=2*Math.sqrt(1+a[8]-a[0]-a[4]),b[3]=(a[3]-a[1])/d,b[0]=(a[2]+a[6])/d,b[1]=(a[5]+a[7])/d,b[2]=0.25*d)};XML3D.math.quat.setFromBasis=function(a,b,d,c){var e=1/XML3D.math.vec3.length(a),k=1/XML3D.math.vec3.length(b),l=1/XML3D.math.vec3.length(d),m=XML3D.math.mat3.create();m[0]=a[0]*e;m[1]=b[0]*k;m[2]=d[0]*l;m[3]=a[1]*e;m[4]=b[1]*k;m[5]=d[1]*l;m[6]=a[2]*e;m[7]=b[2]*k;m[8]=d[2]*l;XML3D.math.quat.setFromMat3(m,
c)};c.viewSetDirection=function(c){var c=c||new window.XML3DVec3(0,0,-1),c=c.normalize(),f=this.orientation.rotateVec3(new window.XML3DVec3(0,1,0)),f=f.normalize();XML3D.math.vec3.cross(b,c._data,f._data);XML3D.math.vec3.length(b)||(b=this.orientation.rotateVec3(new window.XML3DVec3(1,0,0))._data);XML3D.math.vec3.cross(a,b,c._data);XML3D.math.vec3.negate(d,c._data);c=XML3D.math.quat.create();XML3D.math.quat.setFromBasis(b,a,d,c);this.orientation._setQuaternion(c)};c.viewSetUpVector=function(a){var a=
a||new window.XML3DVec3(0,1,0),a=a.normalize(),b=new window.XML3DRotation;b.setRotation(new window.XML3DVec3(0,1,0),a);b=this.orientation.multiply(b);b=b.normalize();this.orientation.set(b)};c.viewGetUpVector=function(){return this.orientation.rotateVec3(new window.XML3DVec3(0,1,0))};c.viewLookAt=function(a){this.setDirection(a.subtract(this.position))};c.viewGetViewMatrix=function(){var a=this._configured.adapters||{},b;for(b in a)if(a[b].getViewMatrix)return a[b].getViewMatrix();a=this.position;
b=this.orientation;var d=b.axis;return(new window.XML3DMatrix).translate(a.x,a.y,a.z).rotateAxisAngle(d.x,d.y,d.z,b.angle).inverse()};c.xml3dGetElementByPoint=function(a,b,d,c){var e=this._configured.adapters||{},k;for(k in e)if(e[k].getElementByPoint)return e[k].getElementByPoint(a,b,d,c);return null};c.xml3dGenerateRay=function(a,b){var d=this._configured.adapters||{},c;for(c in d)if(d[c].generateRay)return d[c].generateRay(a,b);return new window.XML3DRay};c.groupGetLocalMatrix=function(){var a=
this._configured.adapters||{},b;for(b in a)if(a[b].getLocalMatrix)return a[b].getLocalMatrix();return new window.XML3DMatrix};c.groupGetBoundingBox=function(){var a=this._configured.adapters||{},b;for(b in a)if(a[b].getBoundingBox)return a[b].getBoundingBox();return new window.XML3DBox};c.xml3dGetBoundingBox=c.groupGetBoundingBox;c.meshGetBoundingBox=function(){var a=this._configured.adapters||{},b;for(b in a)if(a[b].getBoundingBox)return a[b].getBoundingBox();return new window.XML3DBox};c.xml3dGetRenderInterface=
function(){var a=this._configured.adapters||{},b;for(b in a)if(a[b].getRenderInterface)return a[b].getRenderInterface();return{}};c.XML3DGraphTypeGetWorldMatrix=function(){var a=this._configured.adapters||{},b;for(b in a)if(a[b].getWorldMatrix)return a[b].getWorldMatrix();return new window.XML3DMatrix};c.videoPlay=function(){XML3D.base.sendAdapterEvent(this,{play:[]})};c.videoPause=function(){XML3D.base.sendAdapterEvent(this,{pause:[]})};c.XML3DNestedDataContainerTypeGetOutputNames=c.XML3DShaderProviderTypeGetOutputNames=
c.meshGetOutputNames=function(){var a=XML3D.base.resourceManager.getAdapter(this,XML3D.data);return a?a.getOutputNames():null};c.XML3DNestedDataContainerTypeGetResult=c.XML3DShaderProviderTypeGetResult=c.meshGetResult=function(a){var b=XML3D.base.resourceManager.getAdapter(this,XML3D.data);return b?(a=b.getComputeResult(a),!a?null:new window.XML3DDataResult(a)):null};c.XML3DNestedDataContainerTypeGetOutputChannelInfo=c.XML3DShaderProviderTypeGetOutputChannelInfo=c.meshGetOutputChannelInfo=function(a){var b=
XML3D.base.resourceManager.getAdapter(this,XML3D.data);return b?(a=b.getOutputChannelInfo(a),!a?null:new window.XML3DDataChannelInfo(a.type,a.origin,a.originalName,a.seqLength,a.seqMinKey,a.seqMaxKey)):null};c.XML3DNestedDataContainerTypeGetComputeInfo=c.XML3DShaderProviderTypeGetComputeInfo=c.meshGetComputeInfo=function(){XML3D.debug.logError(this.nodeName+"::getComputeInfo is not implemeted yet.");return null};c.XML3DNestedDataContainerTypeGetProtoInfo=c.XML3DShaderProviderTypeGetProtoInfo=c.meshGetProtoInfo=
function(){XML3D.debug.logError(this.nodeName+"::getProtoInfo is not implemeted yet.");return null};c.XML3DNestedDataContainerTypeIsOutputConnected=c.XML3DShaderProviderTypeIsOutputConnected=c.meshIsOutputConnected=function(){XML3D.debug.logError(this.nodeName+"::isOutputConnected is not implemeted yet.");return!1};c.dataAddOutputFieldListener=function(a,b){if(!a)return!1;"String"===Object.prototype.toString.call(a).slice(8,-1)&&(a=[a]);if(0==a.length)return!1;var d=XML3D.base.callAdapterFunc(this,
{getComputeRequest:[a,function(d){b(e(d.getResult(),a))}]});if(0==d.length)return!1;d=d[0].getResult();d=e(d,a);Object.keys(d).length&&b(d);return!0};XML3D.scriptValueLabel="[value set by script]";c.XML3DDataSourceTypeSetScriptValue=function(a){var b=this._configured;b&&(this.textContent!=XML3D.scriptValueLabel&&(this.textContent=XML3D.scriptValueLabel),b.scriptValue=a,(b=XML3D.base.resourceManager.getAdapter(this,XML3D.data))&&b.setScriptValue(a))};XML3D.extend(XML3D.methods,c)};
XML3D.MeshTypes={};XML3D.MeshTypes.triangles=0;XML3D.MeshTypes[0]="triangles";XML3D.MeshTypes.trianglestrips=1;XML3D.MeshTypes[1]="trianglestrips";XML3D.MeshTypes.lines=2;XML3D.MeshTypes[2]="lines";XML3D.MeshTypes.linestrips=3;XML3D.MeshTypes[3]="linestrips";XML3D.MeshTypes.points=4;XML3D.MeshTypes[4]="points";XML3D.TextureTypes={};XML3D.TextureTypes["2d"]=0;XML3D.TextureTypes[0]="2d";XML3D.TextureTypes["1d"]=1;XML3D.TextureTypes[1]="1d";XML3D.TextureTypes["3d"]=2;XML3D.TextureTypes[2]="3d";
XML3D.FilterTypes={};XML3D.FilterTypes.nearest=1;XML3D.FilterTypes[1]="nearest";XML3D.FilterTypes.linear=2;XML3D.FilterTypes[2]="linear";XML3D.FilterTypes["nearest-mipmap-nearest"]=3;XML3D.FilterTypes[3]="nearest-mipmap-nearest";XML3D.FilterTypes["linear-mipmap-nearest"]=4;XML3D.FilterTypes[4]="linear-mipmap-nearest";XML3D.FilterTypes["nearest-mipmap-linear"]=5;XML3D.FilterTypes[5]="nearest-mipmap-linear";XML3D.FilterTypes["linear-mipmap-linear"]=6;XML3D.FilterTypes[6]="linear-mipmap-linear";
XML3D.WrapTypes={};XML3D.WrapTypes.clamp=0;XML3D.WrapTypes[0]="clamp";XML3D.WrapTypes.repeat=1;XML3D.WrapTypes[1]="repeat";XML3D.WrapTypes.border=2;XML3D.WrapTypes[2]="border";XML3D.PlatformTypes={};XML3D.PlatformTypes.auto=1;XML3D.PlatformTypes[1]="auto";XML3D.PlatformTypes.js=2;XML3D.PlatformTypes[2]="js";XML3D.PlatformTypes.gl=3;XML3D.PlatformTypes[3]="gl";XML3D.PlatformTypes.cl=4;XML3D.PlatformTypes[4]="cl";XML3D.DataFieldType={};XML3D.DataFieldType["float "]=0;XML3D.DataFieldType[0]="float ";
XML3D.DataFieldType["float2 "]=1;XML3D.DataFieldType[1]="float2 ";XML3D.DataFieldType.float3=2;XML3D.DataFieldType[2]="float3";XML3D.DataFieldType.float4=3;XML3D.DataFieldType[3]="float4";XML3D.DataFieldType.float4x4=4;XML3D.DataFieldType[4]="float4x4";XML3D.DataFieldType["int"]=10;XML3D.DataFieldType[10]="int";XML3D.DataFieldType.int4=11;XML3D.DataFieldType[11]="int4";XML3D.DataFieldType.bool=20;XML3D.DataFieldType[20]="bool";XML3D.DataFieldType.texture=30;XML3D.DataFieldType[30]="texture";
XML3D.DataChannelOrigin={};XML3D.DataChannelOrigin["origin_value "]=0;XML3D.DataChannelOrigin[0]="origin_value ";XML3D.DataChannelOrigin.origin_child=1;XML3D.DataChannelOrigin[1]="origin_child";XML3D.DataChannelOrigin.origin_source=2;XML3D.DataChannelOrigin[2]="origin_source";XML3D.DataChannelOrigin.origin_compute=3;XML3D.DataChannelOrigin[3]="origin_compute";XML3D.DataChannelOrigin.origin_proto=4;XML3D.DataChannelOrigin[4]="origin_proto";XML3D.classInfo={};
XML3D.classInfo.xml3d={id:{a:XML3D.IDHandler},className:{a:XML3D.CanvasClassHandler,id:"class"},style:{a:XML3D.CanvasStyleHandler},onclick:{a:XML3D.EventAttributeHandler},ondblclick:{a:XML3D.EventAttributeHandler},onmousedown:{a:XML3D.EventAttributeHandler},onmouseup:{a:XML3D.EventAttributeHandler},onmouseover:{a:XML3D.EventAttributeHandler},onmousemove:{a:XML3D.EventAttributeHandler},onmouseout:{a:XML3D.EventAttributeHandler},onkeypress:{a:XML3D.EventAttributeHandler},onkeydown:{a:XML3D.EventAttributeHandler},
onkeyup:{a:XML3D.EventAttributeHandler},height:{a:XML3D.IntAttributeHandler,params:600},width:{a:XML3D.IntAttributeHandler,params:800},createXML3DVec3:{m:XML3D.methods.xml3dCreateXML3DVec3},createXML3DRotation:{m:XML3D.methods.xml3dCreateXML3DRotation},createXML3DMatrix:{m:XML3D.methods.xml3dCreateXML3DMatrix},createXML3DRay:{m:XML3D.methods.xml3dCreateXML3DRay},getElementByPoint:{m:XML3D.methods.xml3dGetElementByPoint},generateRay:{m:XML3D.methods.xml3dGenerateRay},getElementByRay:{m:XML3D.methods.xml3dGetElementByRay},
getBoundingBox:{m:XML3D.methods.xml3dGetBoundingBox},getRenderInterface:{m:XML3D.methods.xml3dGetRenderInterface},activeView:{a:XML3D.ReferenceHandler},_term:void 0};XML3D.classInfo.compute={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},value:{a:XML3D.StringValueHandler},_term:void 0};
XML3D.classInfo.data={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},compute:{a:XML3D.StringAttributeHandler},platform:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.PlatformTypes,d:1}},filter:{a:XML3D.StringAttributeHandler},getOutputNames:{m:XML3D.methods.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetProtoInfo},
isOutputConnected:{m:XML3D.methods.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:XML3D.methods.XML3DNestedDataContainerTypeGetResult},src:{a:XML3D.ReferenceHandler},_term:void 0};
XML3D.classInfo.dataflow={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},platform:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.PlatformTypes,d:1}},out:{a:XML3D.StringAttributeHandler},getOutputNames:{m:XML3D.methods.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetProtoInfo},
isOutputConnected:{m:XML3D.methods.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:XML3D.methods.XML3DNestedDataContainerTypeGetResult},_term:void 0};XML3D.classInfo.asset={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},src:{a:XML3D.ReferenceHandler},pick:{a:XML3D.StringAttributeHandler},_term:void 0};XML3D.classInfo.defs={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},_term:void 0};
XML3D.classInfo.group={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},onclick:{a:XML3D.EventAttributeHandler},ondblclick:{a:XML3D.EventAttributeHandler},onmousedown:{a:XML3D.EventAttributeHandler},onmouseup:{a:XML3D.EventAttributeHandler},onmouseover:{a:XML3D.EventAttributeHandler},onmousemove:{a:XML3D.EventAttributeHandler},onmouseout:{a:XML3D.EventAttributeHandler},onkeypress:{a:XML3D.EventAttributeHandler},onkeydown:{a:XML3D.EventAttributeHandler},onkeyup:{a:XML3D.EventAttributeHandler},
visible:{a:XML3D.BoolAttributeHandler,params:!0},getWorldMatrix:{m:XML3D.methods.XML3DGraphTypeGetWorldMatrix},getLocalMatrix:{m:XML3D.methods.groupGetLocalMatrix},getBoundingBox:{m:XML3D.methods.groupGetBoundingBox},transform:{a:XML3D.ReferenceHandler},shader:{a:XML3D.ReferenceHandler},_term:void 0};
XML3D.classInfo.mesh={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},onclick:{a:XML3D.EventAttributeHandler},ondblclick:{a:XML3D.EventAttributeHandler},onmousedown:{a:XML3D.EventAttributeHandler},onmouseup:{a:XML3D.EventAttributeHandler},onmouseover:{a:XML3D.EventAttributeHandler},onmousemove:{a:XML3D.EventAttributeHandler},onmouseout:{a:XML3D.EventAttributeHandler},onkeypress:{a:XML3D.EventAttributeHandler},onkeydown:{a:XML3D.EventAttributeHandler},onkeyup:{a:XML3D.EventAttributeHandler},
visible:{a:XML3D.BoolAttributeHandler,params:!0},type:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.MeshTypes,d:0}},compute:{a:XML3D.StringAttributeHandler},transform:{a:XML3D.ReferenceHandler},shader:{a:XML3D.ReferenceHandler},getWorldMatrix:{m:XML3D.methods.XML3DGraphTypeGetWorldMatrix},getBoundingBox:{m:XML3D.methods.meshGetBoundingBox},getOutputNames:{m:XML3D.methods.meshGetOutputNames},getOutputChannelInfo:{m:XML3D.methods.meshGetOutputChannelInfo},getComputeInfo:{m:XML3D.methods.meshGetComputeInfo},
getProtoInfo:{m:XML3D.methods.meshGetProtoInfo},isOutputConnected:{m:XML3D.methods.meshIsOutputConnected},getResult:{m:XML3D.methods.meshGetResult},src:{a:XML3D.ReferenceHandler},_term:void 0};
XML3D.classInfo.model={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},onclick:{a:XML3D.EventAttributeHandler},ondblclick:{a:XML3D.EventAttributeHandler},onmousedown:{a:XML3D.EventAttributeHandler},onmouseup:{a:XML3D.EventAttributeHandler},onmouseover:{a:XML3D.EventAttributeHandler},onmousemove:{a:XML3D.EventAttributeHandler},onmouseout:{a:XML3D.EventAttributeHandler},onkeypress:{a:XML3D.EventAttributeHandler},onkeydown:{a:XML3D.EventAttributeHandler},onkeyup:{a:XML3D.EventAttributeHandler},
visible:{a:XML3D.BoolAttributeHandler,params:!0},getWorldMatrix:{m:XML3D.methods.XML3DGraphTypeGetWorldMatrix},getBoundingBox:{m:XML3D.methods.meshGetBoundingBox},src:{a:XML3D.ReferenceHandler},pick:{a:XML3D.StringAttributeHandler},_term:void 0};
XML3D.classInfo.transform={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},translation:{a:XML3D.XML3DVec3AttributeHandler,params:[0,0,0]},scale:{a:XML3D.XML3DVec3AttributeHandler,params:[1,1,1]},rotation:{a:XML3D.XML3DRotationAttributeHandler,params:[0,0,1,0]},center:{a:XML3D.XML3DVec3AttributeHandler,params:[0,0,0]},scaleOrientation:{a:XML3D.XML3DRotationAttributeHandler,params:[0,0,1,0]},_term:void 0};
XML3D.classInfo.shader={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},compute:{a:XML3D.StringAttributeHandler},getOutputNames:{m:XML3D.methods.XML3DShaderProviderTypeGetOutputNames},getOutputChannelInfo:{m:XML3D.methods.XML3DShaderProviderTypeGetOutputChannelInfo},getComputeInfo:{m:XML3D.methods.XML3DShaderProviderTypeGetComputeInfo},getProtoInfo:{m:XML3D.methods.XML3DShaderProviderTypeGetProtoInfo},isOutputConnected:{m:XML3D.methods.XML3DShaderProviderTypeIsOutputConnected},
getResult:{m:XML3D.methods.XML3DShaderProviderTypeGetResult},script:{a:XML3D.ReferenceHandler},src:{a:XML3D.ReferenceHandler},_term:void 0};
XML3D.classInfo.light={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},onclick:{a:XML3D.EventAttributeHandler},ondblclick:{a:XML3D.EventAttributeHandler},onmousedown:{a:XML3D.EventAttributeHandler},onmouseup:{a:XML3D.EventAttributeHandler},onmouseover:{a:XML3D.EventAttributeHandler},onmousemove:{a:XML3D.EventAttributeHandler},onmouseout:{a:XML3D.EventAttributeHandler},onkeypress:{a:XML3D.EventAttributeHandler},onkeydown:{a:XML3D.EventAttributeHandler},onkeyup:{a:XML3D.EventAttributeHandler},
visible:{a:XML3D.BoolAttributeHandler,params:!0},global:{a:XML3D.BoolAttributeHandler,params:!1},intensity:{a:XML3D.FloatAttributeHandler,params:1},getWorldMatrix:{m:XML3D.methods.XML3DGraphTypeGetWorldMatrix},shader:{a:XML3D.ReferenceHandler},_term:void 0};
XML3D.classInfo.lightshader={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},compute:{a:XML3D.StringAttributeHandler},getOutputNames:{m:XML3D.methods.XML3DShaderProviderTypeGetOutputNames},getOutputChannelInfo:{m:XML3D.methods.XML3DShaderProviderTypeGetOutputChannelInfo},getComputeInfo:{m:XML3D.methods.XML3DShaderProviderTypeGetComputeInfo},getProtoInfo:{m:XML3D.methods.XML3DShaderProviderTypeGetProtoInfo},isOutputConnected:{m:XML3D.methods.XML3DShaderProviderTypeIsOutputConnected},
getResult:{m:XML3D.methods.XML3DShaderProviderTypeGetResult},script:{a:XML3D.ReferenceHandler},src:{a:XML3D.ReferenceHandler},_term:void 0};XML3D.classInfo.script={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},value:{a:XML3D.StringValueHandler},src:{a:XML3D.StringAttributeHandler},type:{a:XML3D.StringAttributeHandler},_term:void 0};
XML3D.classInfo.assetmesh={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},type:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.MeshTypes,d:0}},compute:{a:XML3D.StringAttributeHandler},filter:{a:XML3D.StringAttributeHandler},includes:{a:XML3D.StringAttributeHandler},shader:{a:XML3D.ReferenceHandler},transform:{a:XML3D.ReferenceHandler},platform:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.PlatformTypes,d:1}},getOutputNames:{m:XML3D.methods.XML3DNestedDataContainerTypeGetOutputNames},
getOutputChannelInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:XML3D.methods.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:XML3D.methods.XML3DNestedDataContainerTypeGetResult},src:{a:XML3D.ReferenceHandler},_term:void 0};
XML3D.classInfo.assetdata={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},compute:{a:XML3D.StringAttributeHandler},filter:{a:XML3D.StringAttributeHandler},includes:{a:XML3D.StringAttributeHandler},platform:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.PlatformTypes,d:1}},getOutputNames:{m:XML3D.methods.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetOutputChannelInfo},
getComputeInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:XML3D.methods.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:XML3D.methods.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:XML3D.methods.XML3DNestedDataContainerTypeGetResult},src:{a:XML3D.ReferenceHandler},_term:void 0};
XML3D.classInfo["float"]={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},value:{a:XML3D.FloatArrayValueHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};
XML3D.classInfo.float2={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},value:{a:XML3D.Float2ArrayValueHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};
XML3D.classInfo.float3={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},value:{a:XML3D.Float3ArrayValueHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};
XML3D.classInfo.float4={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},value:{a:XML3D.Float4ArrayValueHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};
XML3D.classInfo.float4x4={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},value:{a:XML3D.Float4x4ArrayValueHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};
XML3D.classInfo["int"]={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},value:{a:XML3D.IntArrayValueHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};
XML3D.classInfo.int4={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},value:{a:XML3D.IntArrayValueHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};
XML3D.classInfo.bool={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},value:{a:XML3D.BoolArrayValueHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};
XML3D.classInfo.texture={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},name:{a:XML3D.StringAttributeHandler},param:{a:XML3D.BoolAttributeHandler,params:!1},key:{a:XML3D.FloatAttributeHandler,params:0},type:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.TextureTypes,d:0}},filterMin:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.FilterTypes,d:6}},filterMag:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.FilterTypes,d:2}},filterMip:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.FilterTypes,
d:1}},wrapS:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.WrapTypes,d:0}},wrapT:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.WrapTypes,d:0}},wrapU:{a:XML3D.EnumAttributeHandler,params:{e:XML3D.WrapTypes,d:0}},borderColor:{a:XML3D.StringAttributeHandler},setScriptValue:{m:XML3D.methods.XML3DDataSourceTypeSetScriptValue},_term:void 0};XML3D.classInfo.img={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},src:{a:XML3D.StringAttributeHandler},_term:void 0};
XML3D.classInfo.video={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},src:{a:XML3D.StringAttributeHandler},autoplay:{a:XML3D.BoolAttributeHandler,params:!1},play:{m:XML3D.methods.videoPlay},pause:{m:XML3D.methods.videoPause},_term:void 0};
XML3D.classInfo.view={id:{a:XML3D.IDHandler},className:{a:XML3D.StringAttributeHandler,id:"class"},onclick:{a:XML3D.EventAttributeHandler},ondblclick:{a:XML3D.EventAttributeHandler},onmousedown:{a:XML3D.EventAttributeHandler},onmouseup:{a:XML3D.EventAttributeHandler},onmouseover:{a:XML3D.EventAttributeHandler},onmousemove:{a:XML3D.EventAttributeHandler},onmouseout:{a:XML3D.EventAttributeHandler},onkeypress:{a:XML3D.EventAttributeHandler},onkeydown:{a:XML3D.EventAttributeHandler},onkeyup:{a:XML3D.EventAttributeHandler},
visible:{a:XML3D.BoolAttributeHandler,params:!0},position:{a:XML3D.XML3DVec3AttributeHandler,params:[0,0,0]},orientation:{a:XML3D.XML3DRotationAttributeHandler,params:[0,0,1,0]},fieldOfView:{a:XML3D.FloatAttributeHandler,params:0.785398},getWorldMatrix:{m:XML3D.methods.XML3DGraphTypeGetWorldMatrix},setDirection:{m:XML3D.methods.viewSetDirection},setUpVector:{m:XML3D.methods.viewSetUpVector},lookAt:{m:XML3D.methods.viewLookAt},getDirection:{m:XML3D.methods.viewGetDirection},getUpVector:{m:XML3D.methods.viewGetUpVector},
getViewMatrix:{m:XML3D.methods.viewGetViewMatrix},perspective:{a:XML3D.ReferenceHandler},_term:void 0};window=this;var Xflow={};
(function(){Xflow.EPSILON=1.0E-6;Xflow.DATA_TYPE={UNKNOWN:0,FLOAT:1,FLOAT2:2,FLOAT3:3,FLOAT4:4,FLOAT3X3:5,FLOAT4X4:10,INT:20,INT4:21,BOOL:30,TEXTURE:40,BYTE:50,UBYTE:60};Xflow.DATA_TYPE_MAP={"float":Xflow.DATA_TYPE.FLOAT,float2:Xflow.DATA_TYPE.FLOAT2,float3:Xflow.DATA_TYPE.FLOAT3,float4:Xflow.DATA_TYPE.FLOAT4,float3x3:Xflow.DATA_TYPE.FLOAT3X3,float4x4:Xflow.DATA_TYPE.FLOAT4X4,"int":Xflow.DATA_TYPE.INT,int4:Xflow.DATA_TYPE.INT4,bool:Xflow.DATA_TYPE.BOOL,texture:Xflow.DATA_TYPE.TEXTURE,"byte":Xflow.DATA_TYPE.BYTE,
ubyte:Xflow.DATA_TYPE.UBYTE};Xflow.TEXTURE_TYPE={UNKNOWN:0,FLOAT:1,UBYTE:60,USHORT_5_6_5:70,USHORT_4_4_4_4:71,USHORT_5_5_5_1:72};Xflow.TEXTURE_FORMAT={UNKNOWN:0,ALPHA:100,RGB:101,RGBA:102,LUMINANCE:103,LUMINANCE_ALPHA:104};Xflow.DATA_TYPE_TUPLE_SIZE={};Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.FLOAT]=1;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.FLOAT2]=2;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.FLOAT3]=3;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.FLOAT4]=4;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.FLOAT3X3]=
9;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.FLOAT4X4]=16;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.INT]=1;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.INT4]=4;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.BOOL]=1;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.TEXTURE]=1;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.BYTE]=1;Xflow.DATA_TYPE_TUPLE_SIZE[Xflow.DATA_TYPE.UBYTE]=1;Xflow.TYPED_ARRAY_MAP={};Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.FLOAT]=Float32Array;Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.FLOAT2]=Float32Array;
Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.FLOAT3]=Float32Array;Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.FLOAT4]=Float32Array;Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.FLOAT4X4]=Float32Array;Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.INT]=Int32Array;Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.INT4]=Int32Array;Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.BOOL]=Int8Array;Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.BYTE]=Int8Array;Xflow.TYPED_ARRAY_MAP[Xflow.DATA_TYPE.UBYTE]=Uint8Array;Xflow.TYPED_ARRAY_MAP[Xflow.TEXTURE_TYPE.USHORT_4_4_4_4]=
Uint16Array;Xflow.TYPED_ARRAY_MAP[Xflow.TEXTURE_TYPE.USHORT_5_6_5]=Uint16Array;Xflow.TYPED_ARRAY_MAP[Xflow.TEXTURE_TYPE.USHORT_5_5_5_1]=Uint16Array;Xflow.TEXTURE_FORMAT_TUPLE_SIZE={};Xflow.TEXTURE_FORMAT_TUPLE_SIZE[Xflow.TEXTURE_FORMAT.ALPHA]=1;Xflow.TEXTURE_FORMAT_TUPLE_SIZE[Xflow.TEXTURE_FORMAT.RGB]=3;Xflow.TEXTURE_FORMAT_TUPLE_SIZE[Xflow.TEXTURE_FORMAT.RGBA]=4;Xflow.TEXTURE_FORMAT_TUPLE_SIZE[Xflow.TEXTURE_FORMAT.LUMINANCE]=1;Xflow.TEXTURE_FORMAT_TUPLE_SIZE[Xflow.TEXTURE_FORMAT.LUMINANCE_ALPHA]=
2;Xflow.getTypeName=function(a){for(var b in Xflow.DATA_TYPE_MAP)if(Xflow.DATA_TYPE_MAP[b]===a)return b};Xflow.TEX_FILTER_TYPE={NEAREST:9728,LINEAR:9729,MIPMAP_NEAREST:9984,MIPMAP_LINEAR:9985};Xflow.TEX_WRAP_TYPE={CLAMP:33071,REPEAT:10497};Xflow.TEX_TYPE={TEXTURE_2D:3553};Xflow.SHADER_CONSTANT_KEY={WORLD_TRANSFORM:1,VIEW_TRANSFORM:2,SCREEN_TRANSFORM:3,WORLD_TRANSFORM_NORMAL:4,VIEW_TRANSFORM_NORMAL:5,SCREEN_TRANSFORM_NORMAL:6,OBJECT_ID:7};Xflow.VS_ATTRIB_TRANSFORM={NONE:0,VIEW_POINT:1,WORLD_POINT:2,
VIEW_NORMAL:3,WORLD_NORMAL:4};Xflow.DATA_FILTER_TYPE={RENAME:0,KEEP:1,REMOVE:2};Xflow.DATA_ENTRY_STATE={CHANGED_VALUE:1,CHANGED_NEW:2,LOAD_START:3,LOAD_END:4,CHANGED_SIZE:5,CHANGED_REMOVED:6,CHANGED_SIZE_TYPE:7};Xflow.RESULT_TYPE={COMPUTE:0,VS:1};Xflow.RESULT_STATE={NONE:0,CHANGED_DATA_VALUE:1,CHANGED_DATA_SIZE:2,CHANGED_STRUCTURE:3,LOAD_START:4,LOAD_END:5,IMAGE_LOAD_START:6,IMAGE_LOAD_END:7};Xflow.SEQUENCE={NO_ACCESS:0,PREV_BUFFER:1,NEXT_BUFFER:2,LINEAR_WEIGHT:3};Xflow.ITERATION_TYPE={NULL:0,ONE:1,
MANY:2};Xflow.EXTRACT={NO_EXTRAC:0,TEX_WIDTH:1,TEX_HEIGHT:2};Xflow.ORIGIN={CHILD:1,COMPUTE:2,PROTO:3};Xflow.PLATFORM={JAVASCRIPT:0,GLSL:1,CL:2,ASYNC:3};Xflow.PROCESS_STATE={MODIFIED:0,LOADING:1,NEEDS_VALIDATION:2,INVALID:3,UNPROCESSED:4,PROCESSED:5};var e=[];Xflow.registerErrorCallback=function(a){e.push(a)};Xflow.notifyError=function(a,b){if(0<e.length){var c;for(c=0;c<e.length;++c)e[c](a,b)}};Xflow.createClass=function(a,b,c){c=c||{};if(b){var f=function(){};f.prototype=b.prototype;a.prototype=
new f;a.prototype.constructor=a;a.superclass=b.prototype}for(var e in c)a.prototype[e]=c[e];return a};var c=[],b=[];Xflow._listCallback=function(a,d){var g;if(-1==(g=c.indexOf(a)))g=c.length,c.push(a);var f=b[g];if(!f||f<d)b[g]=d};Xflow._callListedCallback=function(){if(c.length){var a;for(a=0;a<c.length;++a)c[a]._onListedCallback(b[a]);c=[];b=[]}}})();
(function(){function e(a,b,d,c){"object"===typeof a?(a.nodeName&&("video"===a.nodeName.toLowerCase()&&"undefined"===typeof a.complete&&Object.defineProperties(a,{width:{get:function(){return this.videoWidth}},height:{get:function(){return this.videoHeight}},complete:{get:function(){return!(0==this.readyState||0>=this.videoWidth||0>=this.videoHeight)}}}),a.texelFormat=Xflow.TEXTURE_FORMAT.RGBA,a.texelType=Xflow.TEXTURE_TYPE.UBYTE),this._source=a):(d=d||Xflow.TEXTURE_FORMAT.RGBA,c=c||Xflow.TEXTURE_TYPE.UBYTE,
this._source={width:a,height:b,texelFormat:d,texelType:c,data:new Xflow.TYPED_ARRAY_MAP[c](a*b*Xflow.TEXTURE_FORMAT_TUPLE_SIZE[d])})}function c(a,b){for(var d=0;d<f._listeners.length;++d)f._listeners[d](a,b);for(d=0;d<a._listeners.length;++d)a._listeners[d](a,b)}Xflow.SamplerConfig=function(){this.generateMipMap=this.colorB=this.colorG=this.colorR=this.textureType=this.wrapU=this.wrapT=this.wrapS=this.mipFilter=this.magFilter=this.minFilter=0};Xflow.SamplerConfig.prototype.setDefaults=function(){this.magFilter=
this.minFilter=Xflow.TEX_FILTER_TYPE.LINEAR;this.mipFilter=Xflow.TEX_FILTER_TYPE.NEAREST;this.wrapU=this.wrapT=this.wrapS=Xflow.TEX_WRAP_TYPE.CLAMP;this.textureType=Xflow.TEX_TYPE.TEXTURE_2D;this.generateMipMap=this.colorB=this.colorG=this.colorR=0};Xflow.SamplerConfig.prototype.set=function(a){this.minFilter=a.minFilter;this.magFilter=a.magFilter;this.mipFilter=a.mipFilter;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.wrapU=a.wrapU;this.textureType=a.textureType;this.colorR=a.colorR;this.colorG=a.colorG;
this.colorB=a.colorB;this.generateMipMap=a.generateMipMap};var b=Xflow.SamplerConfig;Xflow.DataEntry=function(a){this._type=a;this._listeners=[];this.userData={}};var a=Xflow.DataEntry;Object.defineProperty(a.prototype,"type",{set:function(){throw Error("type is read-only");},get:function(){return this._type}});a.prototype.addListener=function(a){this._listeners.push(a)};a.prototype.removeListener=function(a){Array.erase(this._listeners,a)};a.prototype._notifyChanged=function(){c(this,Xflow.DATA_ENTRY_STATE.CHANGED_VALUE)};
Xflow.BufferEntry=function(a,b){Xflow.DataEntry.call(this,a);this._value=b;c(this,Xflow.DATA_ENTRY_STATE.CHANGED_NEW)};Xflow.createClass(Xflow.BufferEntry,Xflow.DataEntry);a=Xflow.BufferEntry;a.prototype.setValue=function(a){this._setValue(a);Xflow._callListedCallback()};a.prototype._setValue=function(a){var b=this._value?this._value.length:0,d=a?a.length:0,f=this.getTupleSize(),b=(b>=2*f?2:b>=f?1:0)!=(d>=2*f?2:d>=f?1:0)?Xflow.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:b!=d?Xflow.DATA_ENTRY_STATE.CHANGED_SIZE:
Xflow.DATA_ENTRY_STATE.CHANGED_VALUE;this._value=a;c(this,b)};a.prototype.getValue=function(){return this._value};a.prototype.getLength=function(){return this._value?this._value.length:0};a.prototype.getTupleSize=function(){this._tupleSize||(this._tupleSize=Xflow.DATA_TYPE_TUPLE_SIZE[this._type]);return this._tupleSize};a.prototype.getIterateCount=function(){return this.getLength()/this.getTupleSize()};a.prototype.isEmpty=function(){return!this._value||!this.getLength()};var d,g;Xflow.toImageData=
function(a){if(a instanceof ImageData)return a;if(!a.data)throw Error("no data property");if(!a.width)throw Error("no width property");if(!a.height)throw Error("no height property");g||(d=document.createElement("canvas"),g=d.getContext("2d"));for(var b=g.createImageData(a.width,a.height),c=0;c<a.data.length;++c){var f=a.data[c];255<f&&(f=255);0>f&&(f=0);b.data[c]=f}return b};Object.defineProperties(e.prototype,{imageData:{get:function(){if(this._source instanceof HTMLElement){var a=document.createElement("canvas");
a.width=this._source.width;a.height=this._source.height;a=a.getContext("2d");a.drawImage(this._source,0,0);a=a.getImageData(0,0,this._source.width,this._source.height);a.texelFormat=this._source.texelFormat;a.texelType=this._source.texelType;this._source=a}return this._source}},glTextureData:{get:function(){return this._source}},complete:{get:function(){return"undefined"===typeof this._source.complete?!0:this._source.complete}},width:{get:function(){return this._source?this._source.width:-1}},height:{get:function(){return this._source?
this._source.height:-1}},texelFormat:{get:function(){return this._source?this._source.texelFormat:Xflow.TEXTURE_FORMAT.UNKNOWN}},texelType:{get:function(){return this._source?this._source.texelType:Xflow.TEXTURE_TYPE.UNKNOWN}}});Xflow.TextureEntry=function(a){Xflow.DataEntry.call(this,Xflow.DATA_TYPE.TEXTURE);this._samplerConfig=new b;this._loading=!1;this.setImage(a);c(this,Xflow.DATA_ENTRY_STATE.CHANGED_NEW)};Xflow.createClass(Xflow.TextureEntry,Xflow.DataEntry);a=Xflow.TextureEntry;Object.defineProperties(Xflow.TextureEntry.prototype,
{width:{get:function(){return this._source?this._source.width:-1}},height:{get:function(){return this._source?this._source.height:-1}},texelFormat:{get:function(){return this._source?this._source.texelFormat:Xflow.TEXTURE_FORMAT.UNKNOWN}},texelType:{get:function(){return this._source?this._source.texelType:Xflow.TEXTURE_TYPE.UNKNOWN}}});a.prototype.isLoading=function(){return!this._source?!1:!this._source.complete};a.prototype._createImage=function(a,b,d,c,f){!this._source||this.width!=a||this.height!=
b||this.format!=d||this.type!=c?(a=new e(a,b,d,c),f||(f=new Xflow.SamplerConfig,f.setDefaults()),this._samplerConfig.set(f),this._setImage(a)):this._notifyChanged();return this._source};a.prototype.setImage=function(a){this._setImage(a);Xflow._callListedCallback()};a.prototype._setImage=function(a){a?a instanceof e?this._setSource(a):this._setSource(new e(a)):this._setSource(null)};a.prototype._setSource=function(a){this._source=a;this.isLoading()?(this._loading=!0,c(this,Xflow.DATA_ENTRY_STATE.LOAD_START)):
this._loading?(this._loading=!1,c(this,Xflow.DATA_ENTRY_STATE.LOAD_END)):c(this,Xflow.DATA_ENTRY_STATE.CHANGED_VALUE)};a.prototype.asGLTextureValue=function(){return this._source.glTextureData};a.prototype.getValue=function(){return!this._source||this.isLoading()?null:this._source.imageData};a.prototype.getSamplerConfig=function(){return this._samplerConfig};a.prototype.getLength=function(){return 1};a.prototype.isEmpty=function(){return!1};a.prototype.getIterateCount=function(){return 1};Xflow.ImageDataTextureEntry=
function(a){Xflow.DataEntry.call(this,Xflow.DATA_TYPE.TEXTURE);this._samplerConfig=new b;this._imageData=null;this._texelFormat=Xflow.TEXTURE_FORMAT.RGBA;this._texelType=Xflow.TEXTURE_TYPE.UBYTE;this._updateImageData(a);c(this,Xflow.DATA_ENTRY_STATE.CHANGED_NEW)};Xflow.createClass(Xflow.ImageDataTextureEntry,Xflow.DataEntry);a=Xflow.ImageDataTextureEntry;Object.defineProperties(Xflow.ImageDataTextureEntry.prototype,{width:{get:function(){return this._imageData?this._imageData.width:-1}},height:{get:function(){return this._imageData?
this._imageData.height:-1}},texelFormat:{get:function(){return this._texelFormat}},texelType:{get:function(){return this._texelType}}});a.prototype.isLoading=function(){return!this._imageData};a.prototype._updateImageData=function(a){this._texelFormat=Xflow.TEXTURE_FORMAT.RGBA;this._texelType=Xflow.TEXTURE_TYPE.UBYTE;this._imageData=a};a.prototype._createImage=function(a,b,d,c,f){if(!this._image||this.getWidth()!=a||this.getHeight()!=b||this._format!=d||this._type!=c){if(!a||!b)throw Error("Width or height is not specified");
this._texelFormat=d;this._texelType=c;f||(f=new Xflow.SamplerConfig,f.setDefaults());this._samplerConfig.set(f);d={width:a,height:b,data:null};d.data=c==Xflow.TEXTURE_TYPE.FLOAT?new Float32Array(4*a*b):Uint8Array==Uint8ClampedArray?new Int16Array(4*a*b):new Uint8ClampedArray(4*a*b);this._imageData=d}this._notifyChanged()};a.prototype.setImageData=function(a){this._updateImageData(a);c(this,Xflow.DATA_ENTRY_STATE.CHANGED_VALUE);Xflow._callListedCallback()};a.prototype.getWidth=function(){return this._imageData&&
this._imageData.width||0};a.prototype.getHeight=function(){return this._imageData&&this._imageData.height||0};a.prototype.getValue=function(){return this._imageData};a.prototype.getSamplerConfig=function(){return this._samplerConfig};a.prototype.getLength=function(){return 1};a.prototype.isEmpty=function(){return!1};a.prototype.getIterateCount=function(){return 1};Xflow.DataChangeNotifier={_listeners:[]};var f=Xflow.DataChangeNotifier;f.addListener=function(a){this._listeners.push(a)};f.removeListener=
function(a){Array.erase(this._listeners,a)}})();
(function(){function e(a){var b,d,c,f,g=XML3D.webcl;if(g&&g.isAvailable()){b=g.getPlatforms();if(!b||"array"===typeof b&&0===b.length)return!1;try{d=g.getDevicesByType("GPU")||g.getDevicesByType("CPU")}catch(e){return!1}if(!d)return!1;try{c=g.createContext({devices:d})}catch(h){return!1}try{f=g.createCommandQueue(d[0],c)}catch(i){return!1}a.cl={API:g,kernelManager:new g.KernelManager(c,d),platforms:b,devices:d,ctx:c,cmdQueue:f};return!0}return!1}function c(a,b){if(!a._filterMapping||a._filterMapping.isEmpty()){if(!a._computeOperator){if(a._sourceNode&&
0==a._children.length)return c(a._sourceNode);if(1==a._children.length&&a._children[0]instanceof j)return c(a._children[0])}var d=a._channelNode.getChildDataIndex(b);if(-1!=d&&void 0!=d)return a._sourceNode?c(a._sourceNode):c(a._children[d])}return a}function b(b){a(b);return d(b)}function a(a){for(var b=!1,d=0;!b&&d<a._children.length;++d)b=a._children[d],b=b instanceof Xflow.DataNode?b._imageLoading:b._data&&b._data.isLoading&&b._data.isLoading();!b&&a._sourceNode&&(b=a._sourceNode._imageLoading);
!b&&a._dataflowNode&&(b=a._dataflowNode._imageLoading);b=b||!1;if(b!=a._imageLoading){a._imageLoading=b;for(d=0;d<a._parents.length;++d)a._parents[d].notify(b?Xflow.RESULT_STATE.IMAGE_LOAD_START:Xflow.RESULT_STATE.IMAGE_LOAD_END)}}function d(a){for(var b=a._loading,d=0;!b&&d<a._children.length;++d)b=a._children[d],b=b instanceof Xflow.DataNode?b._subTreeLoading:!1;!b&&a._sourceNode&&(b=a._sourceNode._subTreeLoading);!b&&a._dataflowNode&&(b=a._dataflowNode._subTreeLoading);if(b!=a._subTreeLoading){a._subTreeLoading=
b;for(d=0;d<a._parents.length;++d)a._parents[d].notify(b?Xflow.RESULT_STATE.LOAD_START:Xflow.RESULT_STATE.LOAD_END);return!0}return!1}function g(a,b){for(var d=0;d<a._parents.length;++d)a._parents[d].notify(b,a)}function f(a,b,d){a[b]&&a[b]._removeOwner(a);a[b]=d;a[b]&&a[b]._addOwner(a)}Xflow.Graph=function(){this.initPlatform()};var h=Xflow.Graph;h.prototype.initPlatform=function(){this.platform=Xflow.PLATFORM.JAVASCRIPT;e(this)&&(this.platform=Xflow.PLATFORM.CL)};h.prototype.createInputNode=function(){return new Xflow.InputNode(this)};
h.prototype.createDataNode=function(a){return new Xflow.DataNode(this,a)};Xflow.GraphNode=function(a){this._graph=a;this._parents=[]};Xflow.InputNode=function(a){Xflow.GraphNode.call(this,a);this._name="";this._key=0;this._paramName=this._data=null;this._paramGlobal=!1;this._dataListener=this.onDataChange.bind(this)};Xflow.createClass(Xflow.InputNode,Xflow.GraphNode);h=Xflow.InputNode;h.prototype.onDataChange=function(a,b){var d;switch(b){case Xflow.DATA_ENTRY_STATE.CHANGED_VALUE:d=Xflow.RESULT_STATE.CHANGED_DATA_VALUE;
break;case Xflow.DATA_ENTRY_STATE.LOAD_START:d=Xflow.RESULT_STATE.IMAGE_LOAD_START;break;case Xflow.DATA_ENTRY_STATE.LOAD_END:d=Xflow.RESULT_STATE.IMAGE_LOAD_START;break;case Xflow.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:d=Xflow.RESULT_STATE.CHANGED_STRUCTURE;break;case Xflow.DATA_ENTRY_STATE.CHANGED_SIZE:d=Xflow.RESULT_STATE.CHANGED_DATA_SIZE;break;default:d=Xflow.RESULT_STATE.CHANGED_DATA_SIZE}g(this,d)};Object.defineProperty(h.prototype,"name",{set:function(a){this._name=a;g(this,Xflow.RESULT_STATE.CHANGED_STRUCTURE);
Xflow._callListedCallback()},get:function(){return this._name}});Object.defineProperty(h.prototype,"key",{set:function(a){this._key=a;g(this,Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._key}});Object.defineProperty(h.prototype,"paramName",{set:function(a){this._paramName=a;g(this,Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._paramName}});Object.defineProperty(h.prototype,"paramGlobal",{set:function(a){this._paramGlobal=
a;g(this,Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._paramGlobal}});Object.defineProperty(h.prototype,"data",{set:function(a){var b=!1;this._data&&(b=this._data._loading,this._data.removeListener(this._dataListener));(this._data=a)&&this._data.addListener(this._dataListener);b!=this._data._loading&&g(this,this._data._loading?Xflow.RESULT_STATE.IMAGE_LOAD_START:Xflow.RESULT_STATE.IMAGE_LOAD_END);Xflow._callListedCallback()},get:function(){return this._data}});
h.prototype._getParamNames=function(){return this._paramGlobal?null:this._paramName};h.prototype._getGlobalParamNames=function(){return this._paramGlobal?this._paramName:null};Xflow.createBufferInputNode=function(a,b,d){if(0==d)return null;a=Xflow.DATA_TYPE_MAP[a];d=new Xflow.TYPED_ARRAY_MAP[a](d*Xflow.DATA_TYPE_TUPLE_SIZE[a]);d=new Xflow.BufferEntry(a,d);a=XML3D.data.xflowGraph.createInputNode();a.data=d;a.name=b;return a};var i=0;Xflow.DataNode=function(a,b){Xflow.GraphNode.call(this,a);this._imageLoading=
this._subTreeLoading=this._loading=!1;this.id=++i;this._isProtoNode=b;this._children=[];this._userData=this._sourceNode=null;this._filterType=0;this._filterMapping=null;this._computeOperator="";this._computeUsesDataflow=!1;this._dataflowNode=this._computeOutputMapping=this._computeInputMapping=null;this._channelNode=new Xflow.ChannelNode(this);this._substitutionNodes={};this._platform=this._globalParamNames=this._paramNames=null;this._listeners=[]};Xflow.createClass(Xflow.DataNode,Xflow.GraphNode);
var j=Xflow.DataNode;Xflow.Mapping=function(){this._owners=[]};Xflow.OrderMapping=function(){Xflow.Mapping.call(this);this._names=[]};Xflow.createClass(Xflow.OrderMapping,Xflow.Mapping);Xflow.NameMapping=function(){Xflow.Mapping.call(this);this._destNames=[];this._srcNames=[]};Xflow.createClass(Xflow.NameMapping,Xflow.Mapping);Object.defineProperty(j.prototype,"sourceNode",{set:function(a){this._sourceNode&&Array.erase(this._sourceNode._parents,this);(this._sourceNode=a)&&this._sourceNode._parents.push(this);
b(this)||this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._sourceNode}});Object.defineProperty(j.prototype,"protoNode",{set:function(a){this._computeUsesDataflow=!!a;this._computeOutputMapping=this._computeInputMapping=null;this.dataflowNode=a},get:function(){return this._dataflowNode}});Object.defineProperty(j.prototype,"dataflowNode",{set:function(a){if(a&&!this._computeUsesDataflow)throw Error("Cannot set dataflowNode when compute doesn't use dataflow.");
this._dataflowNode&&Array.erase(this._dataflowNode._parents,this);(this._dataflowNode=a)&&this._dataflowNode._parents.push(this);b(this)||this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._dataflowNode}});Object.defineProperty(j.prototype,"userData",{set:function(a){this._userData=a},get:function(){return this._userData}});j.prototype.setLoading=function(a){this._loading!=a&&(this._loading=a,d(this),Xflow._callListedCallback())};j.prototype.isSubtreeLoading=
function(){return this._subTreeLoading};j.prototype.isImageLoading=function(){return this._imageLoading};Object.defineProperty(j.prototype,"filterType",{set:function(a){this._filterType=a;this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._filterType}});Object.defineProperty(j.prototype,"filterMapping",{set:function(a){f(this,"_filterMapping",a);this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._filterMapping}});
Object.defineProperty(j.prototype,"computeOperator",{set:function(a){this._computeOperator=a;this._computeUsesDataflow=!1;this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._computeUsesDataflow?null:this._computeOperator}});Object.defineProperty(j.prototype,"computeDataflowUrl",{set:function(a){this._computeOperator=a;this._computeUsesDataflow=!0;this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._computeUsesDataflow?
this._computeOperator:null}});Object.defineProperty(j.prototype,"computeInputMapping",{set:function(a){f(this,"_computeInputMapping",a);this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._computeInputMapping}});Object.defineProperty(j.prototype,"computeOutputMapping",{set:function(a){f(this,"_computeOutputMapping",a);this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()},get:function(){return this._computeOutputMapping}});
j.prototype.isProtoNode=function(){return this._isProtoNode};j.prototype.appendChild=function(a){this._children.push(a);a._parents.push(this);b(this)||this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()};j.prototype.removeChild=function(a){Array.erase(this._children,a);Array.erase(a._parents,this);b(this)||this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()};j.prototype.insertBefore=function(a,d){var c=this._children.indexOf(d);-1==c?this._children.push(a):
this._children.splice(c,0,a);a._parents.push(this);b(this)||this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()};j.prototype.clearChildren=function(){for(var a=0;a<this._children.length;++a)Array.erase(this._children[a]._parents,this);this._children=[];b(this)||this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()};j.prototype.detachFromParents=function(){for(var a=0;a<this._parents.length;++a){var b=this._parents[a];b._sourceNode==this?b.sourceNode=
null:b._dataflowNode==this?b.dataflowNode=null:b.removeChild(this)}this._children=[]};j.prototype.setPlatform=function(a){"string"===typeof a?"cl"===a?this._platform=Xflow.PLATFORM.CL:"gl"===a?this._platform=Xflow.PLATFORM.GLSL:"js"===a&&(this._platform=Xflow.PLATFORM.JAVASCRIPT):this._platform=!isNaN(parseFloat(a))&&isFinite(a)?a:null;this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()};var k=/^([A-Za-z\s]*)\(([^()]+)\)$/;j.prototype.setFilter=function(a){var a=a||"",b=
Xflow.DATA_FILTER_TYPE.RENAME,d=null;if(a){var c=a.trim().match(k);if(c){a=c[1].trim();switch(a){case "keep":b=Xflow.DATA_FILTER_TYPE.KEEP;break;case "remove":b=Xflow.DATA_FILTER_TYPE.REMOVE;break;case "rename":b=Xflow.DATA_FILTER_TYPE.RENAME;break;default:Xflow.notifyError("Unknown filter type:"+a,this)}d=Xflow.Mapping.parse(c[2],this)}else Xflow.notifyError("Could not parse filter '"+a+"'",this)}d||(d=new Xflow.OrderMapping);f(this,"_filterMapping",d);this._filterType=b;this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);
Xflow._callListedCallback()};var l=/^(([^=]+)\=)?([^'(]+('[^']+')?[^'(]+)(\(([^()]*)?\))?$/,m=/^\(([^()]*)\)$/,o=/^dataflow\['([^']+)'\]$/;Xflow.getComputeDataflowUrl=function(a){var b="";if(a=(a||"").trim().match(l))return b=a[3].trim(),(a=b.match(o))?a[1]:null};j.prototype.setCompute=function(a){var a=a||"",b="",d=null,c=null,g=a.trim().match(l);if(g){var a=g[2]?g[2].trim():"",b=g[3].trim(),e=g[6]?g[6].trim():"";if(g=a.match(m))a=g[1];e&&(d=Xflow.Mapping.parse(e,this));a&&(c=Xflow.Mapping.parse(a,
this));(g=b.match(o))?(this._computeUsesDataflow=!0,b=g[1]):this._computeUsesDataflow=!1;this._dataflowNode=null}else a&&Xflow.notifyError("Error parsing Compute value '"+a+"'",this);f(this,"_computeInputMapping",d);f(this,"_computeOutputMapping",c);this._computeOperator=b;this.notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()};j.prototype.notify=function(b,c){if(b==Xflow.RESULT_STATE.CHANGED_STRUCTURE||b==Xflow.RESULT_STATE.LOAD_START||b==Xflow.RESULT_STATE.LOAD_END){this._globalParamNames=
this._paramNames=null;this._channelNode.setStructureOutOfSync();for(var f in this._substitutionNodes)this._substitutionNodes[f].clear();this._substitutionNodes={};b==Xflow.RESULT_STATE.CHANGED_STRUCTURE?g(this,b):d(this)}else if(b==Xflow.RESULT_STATE.CHANGED_DATA_VALUE||b==Xflow.RESULT_STATE.CHANGED_DATA_SIZE||b==Xflow.RESULT_STATE.IMAGE_LOAD_START||b==Xflow.RESULT_STATE.IMAGE_LOAD_END)(b==Xflow.RESULT_STATE.IMAGE_LOAD_START||b==Xflow.RESULT_STATE.IMAGE_LOAD_END)&&a(this),c&&this._channelNode.notifyDataChange(c,
b);for(f=0;f<this._listeners.length;++f)this._listeners[f](b)};j.prototype.addListener=function(a){this._listeners.push(a)};j.prototype.removeListener=function(a){Array.erase(this._listeners,a)};j.prototype.getOutputNames=function(){return c(this)._channelNode.getOutputNames()};j.prototype.getOutputChannelInfo=function(a){return c(this)._channelNode.getOutputChannelInfo(a)};j.prototype.getParamNames=function(){return this._getParamNames()};j.prototype._getResult=function(a,b){return c(this,b)._channelNode.getResult(a,
b)};j.prototype._getForwardNode=function(a){return c(this,a)};j.prototype._getParamNames=function(){if(!this._paramNames)if(this._paramNames=[],this._sourceNode)Xflow.nameset.add(this._paramNames,this._sourceNode._getParamNames());else for(var a=0;a<this._children.length;++a)Xflow.nameset.add(this._paramNames,this._children[a]._getParamNames());return this._paramNames};j.prototype._getGlobalParamNames=function(){if(!this._globalParamNames)if(this._globalParamNames=[],this._dataflowNode&&Xflow.nameset.add(this._globalParamNames,
this._dataflowNode._getGlobalParamNames()),this._sourceNode)Xflow.nameset.add(this._globalParamNames,this._sourceNode._getGlobalParamNames());else for(var a=0;a<this._children.length;++a)Xflow.nameset.add(this._globalParamNames,this._children[a]._getGlobalParamNames());return this._globalParamNames};j.prototype._getChannelNode=function(a){if(a){var b=a.getKey(this);this._substitutionNodes[b]?this._substitutionNodes[b].increaseRef():this._substitutionNodes[b]=new Xflow.ChannelNode(this,a);return this._substitutionNodes[b]}return this._channelNode};
j.prototype._removeSubstitutionNode=function(a){a=a.substitution.getKey(this);this._substitutionNodes[a]&&this._substitutionNodes[a].decreaseRef()&&delete this._substitutionNodes[a]}})();
(function(){function e(a){for(var b=0;b<a._owners.length;++b)a._owners[b].notify(Xflow.RESULT_STATE.CHANGED_STRUCTURE);Xflow._callListedCallback()}Xflow.Mapping.parse=function(g,f){var g=g.trim(),e=g.trim().match(b);if(e)return c.parse(g,f);if(e=g.trim().match(d))return a.parse(e[1],f);Xflow.notifyError("Cannot parse name mapping '"+g+"'",f);return null};Xflow.Mapping.prototype._addOwner=function(a){-1==this._owners.indexOf(a)&&this._owners.push(a)};Xflow.Mapping.prototype._removeOwner=function(a){a=
this._owners.indexOf(a);-1!=a&&this._owners.splice(a,-1)};var c=Xflow.OrderMapping;c.parse=function(a,b){for(var d=new Xflow.OrderMapping(b),c=a.split(","),e=0;e<c.length;e++)d._names.push(c[e].trim());return d};Object.defineProperty(c.prototype,"length",{set:function(){throw Error("length is read-only");},get:function(){return this._name.length}});c.prototype.getName=function(a){return this._names[a]};c.prototype.clear=function(){this._names=[];e(this)};c.prototype.setName=function(a,b){this._names[a]=
b;e(this)};c.prototype.removeName=function(a){this._names.splice(a);e(this)};c.prototype.isEmpty=function(){return 0==this._names.length};var b=/^([^:,{}]+)(,[^:{},]+)*$/;c.prototype.applyFilterOnChannelMap=function(a,b,d,c){if(d==Xflow.DATA_FILTER_TYPE.KEEP)for(var e=0;e<this._names.length;++e)d=this._names[e],b.map[d]&&c(a,d,b,d);else for(e in b.map){var k=this._names.indexOf(e);(d==Xflow.DATA_FILTER_TYPE.RENAME||d==Xflow.DATA_FILTER_TYPE.REMOVE&&-1==k)&&c(a,e,b,e)}};c.prototype.getScriptInputName=
function(a){return this._names[a]?this._names[a]:null};c.prototype.getScriptOutputName=function(a){return this._names[a]?this._names[a]:null};c.prototype.getScriptOutputNameInv=function(a,b){var d=this._names.indexOf(a);return-1==d?null:b[d].name};c.prototype.applyScriptOutputOnMap=function(a,b){var d=0,c;for(c in b)if(d<this._names.length)a[this._names[d]]=b[c],++d;else break};c.prototype.getRenameSrcName=function(a){return a};c.prototype.filterNameset=function(a,b){if(b==Xflow.DATA_FILTER_TYPE.RENAME)return a.splice();
var d=b==Xflow.DATA_FILTER_TYPE.KEEP,c=[],e;for(e in a){var k=this._names.indexOf(a[e]);(d&&-1!=k||!d&&-1==k)&&c.push(a[e])}return c};var a=Xflow.NameMapping;a.parse=function(a,b){for(var d=new Xflow.NameMapping(b),c=a.split(","),e=0;e<c.length;e++){var k=c[e].split(":"),l=k[0].trim(),k=k[1].trim();d.setNamePair(l,k)}return d};Object.defineProperty(a.prototype,"length",{set:function(){throw Error("length is read-only");},get:function(){return this._srcNames.length}});a.prototype.getDestName=function(a){return this._destNames[a]};
a.prototype.getSrcName=function(a){return this._srcNames[a]};a.prototype.getSrcNameFromDestName=function(a){a=this._destNames.indexOf(a);return-1==a?null:this._srcNames[a]};a.prototype.getDestNameFromSrcName=function(a){a=this._srcNames.indexOf(a);return-1==a?null:this._destNames[a]};a.prototype.clear=function(){this._srcNames=[];this._destNames=[];e(this)};a.prototype.setNamePair=function(a,b){var d=this._destNames.indexOf(a);-1!=d&&(this._destNames.splice(d,1),this._srcNames.splice(d,1));this._destNames.push(a);
this._srcNames.push(b);e(this)};a.prototype.removeNamePair=function(a){a=this._destNames.indexOf(a);-1!=a&&(this._destNames.splice(a,1),this._srcNames.splice(a,1));e(this)};a.prototype.isEmpty=function(){return 0==this._destNames.length};var d=/^\{(([^:,{}]+:[^:{},]+)(,[^:{},]+:[^:},]+)*)\}$/;a.prototype.filterNameset=function(){};a.prototype.applyFilterOnChannelMap=function(a,b,d,c){if(d==Xflow.DATA_FILTER_TYPE.REMOVE)for(var e in b.map)-1==this._srcNames.indexOf(e)&&c(a,e,b,e);else{if(d==Xflow.DATA_FILTER_TYPE.RENAME)for(e in b.map)-1==
this._srcNames.indexOf(e)&&c(a,e,b,e);for(e in this._destNames)c(a,this._destNames[e],b,this._srcNames[e])}};a.prototype.getRenameSrcName=function(a){return this.getSrcNameFromDestName(a)||a};a.prototype.getScriptInputName=function(a,b){return this.getSrcNameFromDestName(b)};a.prototype.getScriptOutputName=function(a,b){return this.getDestNameFromSrcName(b)};a.prototype.getScriptOutputNameInv=function(a){a=this._destNames.indexOf(a);return-1==a?null:this._srcNames[a]};a.prototype.applyScriptOutputOnMap=
function(a,b){for(var d in this._destNames)a[this._destNames[d]]=b[this._srcNames[d]]}})();
(function(){function e(a,b){a._result&&a._result._removeRequest(a);(a._result=b)&&b._addRequest(a);return b}function c(a,b,c){var a=a._getForwardNode(c),c=a.id+"|"+b.getKey(),e;(e=f[c])?d[e.id]++:(e=a._graph.createDataNode(!1),e.appendChild(a),e.computeOperator=b.getOperator(),e.computeInputMapping=null,e.computeOutputMapping=null,f[c]=e,d[e.id]=1,g[e.id]=c);return e}var b=function(a,b,d){this._dataNode=a;this._filter=b?b.slice().sort():null;this._listener=d;this._result=null;this._dataNodeListener=
this._onDataNodeChange.bind(this);this._dataNode.addListener(this._dataNodeListener)};Xflow.Request=b;Object.defineProperty(b.prototype,"dataNode",{set:function(){throw Error("dataNode is readonly");},get:function(){return this._dataNode}});Object.defineProperty(b.prototype,"filter",{set:function(){throw Error("filter is read-only");},get:function(){return this._filter}});b.prototype.clear=function(){this._listener=null;this._result&&this._result._removeRequest(this);this._dataNode.removeListener(this._dataNodeListener)};
b.prototype._onListedCallback=function(a){this._listener&&this._listener(this,a)};b.prototype._onDataNodeChange=function(a){Xflow._listCallback(this,a)};var a=function(a,b,d){Xflow.Request.call(this,a,b,d)};Xflow.createClass(a,Xflow.Request);Xflow.ComputeRequest=a;a.prototype.getResult=function(){return e(this,this._dataNode._getResult(Xflow.RESULT_TYPE.COMPUTE,this._filter))};a.prototype._onResultChanged=function(a){this._onDataNodeChange(a)};var d={},g={},f={},a=function(a,b,d){var f=b.getFilter();
if(0==f.length)throw Error("vsConfig requires at least one attribute entry.");Xflow.Request.call(this,a,f,d);this._vsConfig=b;this._vsConnectNode=c(a,b)};Xflow.createClass(a,Xflow.Request);Xflow.VertexShaderRequest=a;a.prototype.getConfig=function(){return this._vsConfig};a.prototype.getResult=function(){return e(this,this._vsConnectNode._getResult(Xflow.RESULT_TYPE.VS,this._filter))};a.prototype._onDataNodeChange=function(a){if(a==Xflow.RESULT_STATE.CHANGED_STRUCTURE){var e=c(this._dataNode,this._vsConfig,
this._filter);if(e!=this._vsConnectNode){var j=this._vsConnectNode;d[j.id]--;d[j.id]||(f[g[j.id]]=null,j.clearChildren());this._vsConnectNode=e}}b.prototype._onDataNodeChange.call(this,a)};a.prototype.getVertexShader=function(){this.getResult();this._vertexShader||(this._vertexShader=this._result.getVertexShader(this._vsConfig));return this._vertexShader};a.prototype._onResultChanged=function(a,b){this._onDataNodeChange(b)}})();
(function(){Xflow.Result=function(){this.valid=this.loading=!1;this._listeners=[];this._requests=[]};var e=Xflow.Result;e.prototype.addListener=function(c){this._listeners.push(c)};e.prototype.removeListener=function(c){Array.erase(this._listeners,c)};e.prototype._addRequest=function(c){this._requests.push(c)};e.prototype._removeRequest=function(c){Array.erase(this._requests,c)};e.prototype._notifyChanged=function(c){this.valid=!1;for(var b=0;b<this._requests.length;++b)this._requests[b]._onResultChanged(c);
Xflow._listCallback(this,c)};e.prototype._onListedCallback=function(c){for(var b=0;b<this._listeners.length;++b)this._listeners[b](this,c)};Xflow.ComputeResult=function(){Xflow.Result.call(this);this._outputNames=[];this._dataEntries={}};Xflow.createClass(Xflow.ComputeResult,Xflow.Result);e=Xflow.ComputeResult;Object.defineProperty(e.prototype,"outputNames",{set:function(){throw Error("outputNames is readonly");},get:function(){return this._outputNames}});e.prototype.getOutputData=function(c){return this._dataEntries[c]};
e.prototype.getOutputMap=function(){return this._dataEntries};Xflow.VSDataResult=function(){Xflow.Result.call(this);this._programData=this._program=null};Xflow.createClass(Xflow.VSDataResult,Xflow.Result);e=Xflow.VSDataResult;Object.defineProperty(e.prototype,"outputNames",{set:function(){throw Error("shaderOutputNames is readonly");},get:function(){return this._program.getOutputNames()}});e.prototype.isOutputUniform=function(c){return this._program.isOutputUniform(c)};e.prototype.isOutputNull=function(c){return this._program.isOutputNull(c)};
e.prototype.getOutputType=function(c){return this._program.getOutputType(c)};e.prototype.getVertexShader=function(c){return this._program.createVertexShader(this._programData,c)}})();
(function(){Xflow.shaderConstant={};Xflow.shaderConstant[Xflow.SHADER_CONSTANT_KEY.OBJECT_ID]="objectID";Xflow.shaderConstant[Xflow.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM]="screenTransform";Xflow.shaderConstant[Xflow.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM_NORMAL]="screenTransformNormal";Xflow.shaderConstant[Xflow.SHADER_CONSTANT_KEY.VIEW_TRANSFORM]="viewTransform";Xflow.shaderConstant[Xflow.SHADER_CONSTANT_KEY.VIEW_TRANSFORM_NORMAL]="viewTransformNormal";Xflow.shaderConstant[Xflow.SHADER_CONSTANT_KEY.WORLD_TRANSFORM]=
"worldTransform";Xflow.shaderConstant[Xflow.SHADER_CONSTANT_KEY.WORLD_TRANSFORM_NORMAL]="worldTransformNormal";Xflow.setShaderConstant=function(c,b){Xflow.shaderConstant[c]=b};Xflow.VSConfig=function(){this._attributes={};this._blockedNames=[];this._addInput={};this._addOutput={};this._codeFragments=[];this._outputChanneling={}};Xflow.VSConfig.prototype.addAttribute=function(c,b,a){if(this._attributes[b]){if(this._attributes[b].type!=c)throw Error("Tries to add two attributes with different types of name '"+
b+'"');this._attributes[b].optional=this._attributes[b].optional&&a}else this._attributes[b]={type:c,optional:a,channeling:[]}};Xflow.VSConfig.prototype.channelAttribute=function(c,b,a){this._attributes[c].channeling.push({outputName:b,code:a})};Xflow.VSConfig.prototype.addInputParameter=function(c,b,a){this._addInput[b]||(this._addInput[b]={type:c,uniform:a},this._blockedNames.push(b))};Xflow.VSConfig.prototype.addOutputParameter=function(c,b){this._addOutput[b]||(this._addOutput[b]={type:c},this._blockedNames.push(b))};
Xflow.VSConfig.prototype.addCodeFragment=function(c){this._codeFragments.push(c)};Xflow.VSConfig.prototype.addBlockedName=function(c){this._blockedNames.push(c)};Xflow.VSConfig.prototype.getBlockedNames=function(){return this._blockedNames};Xflow.VSConfig.prototype.getFilter=function(){return Object.keys(this._attributes)};Xflow.VSConfig.prototype.getKey=function(){var c="",b;for(b in this._attributes)var a=this._attributes[b],c=c+(";"+a.type+","+b+","+a.optional);return c};var e={};Xflow.VSConfig.prototype.getOperator=
function(){var c=this.getKey();if(e[c])return e[c];var b=[],a=[],d="VSConnect",d;for(d in this._attributes){var g=this._attributes[d],f=Xflow.getTypeName(g.type);b.push({type:f,name:d});a.push({type:f,source:d,optional:g.optional});d+="T"+f+"N"+d+"O"+g.optional+"."}b=Xflow.initAnonymousOperator(d,{outputs:b,params:a,evaluate_glsl:"\t// VS Connector\n"});return e[c]=b};Xflow.VertexShader=function(c){this._programData=c;this._glslCode=null;this._inputNames=[];this._outputNames=[];this._inputInfo={};
this._outputInfo={}};Object.defineProperty(Xflow.VertexShader.prototype,"inputNames",{set:function(){throw Error("inputNames is readonly");},get:function(){return this._inputNames}});Object.defineProperty(Xflow.VertexShader.prototype,"outputNames",{set:function(){throw Error("outputNames is readonly");},get:function(){return this._outputNames}});Xflow.VertexShader.prototype.isInputUniform=function(c){return this._inputInfo[c].uniform};Xflow.VertexShader.prototype.getInputData=function(c){return this._programData.getDataEntry(this._inputInfo[c].index)};
Xflow.VertexShader.prototype.isOutputNull=function(c){return this._outputInfo[c].iteration==Xflow.ITERATION_TYPE.NULL};Xflow.VertexShader.prototype.isOutputFragmentUniform=function(c){return this._outputInfo[c].iteration==Xflow.ITERATION_TYPE.ONE};Xflow.VertexShader.prototype.getUniformOutputData=function(c){return this._programData.getDataEntry(this._outputInfo[c].index)};Xflow.VertexShader.prototype.getOutputType=function(c){return this._outputInfo[c].type};Xflow.VertexShader.prototype.getOutputSourceName=
function(c){return this._outputInfo[c].sourceName};Xflow.VertexShader.prototype.getGLSLCode=function(){return this._glslCode}})();
(function(){function e(a,b){a.map[b]||(a.map[b]={channel:null,childDataIndex:void 0})}function c(a,d,c,i){e(a,d);var j=a.map[d].channel;if(!j||!j.willMergeWithDataSlot(c))return c=new Xflow.Channel(a,c),a.map[d].channel=c,a.map[d].childDataIndex=i,c;j=b(a,j);j.addDataSlot(c);a.map[d].channel=j;a.map[d].childDataIndex=-1;return j}function b(a,b){if(b.map!=a){var d=new Xflow.Channel(a);d.addChannelEntries(b);d.creatorProcessNode=b.creatorProcessNode;return d}return b}Xflow.DataSlot=function(a,b){this.key=
b||0;this.dataEntry=a;this.asyncDataEntry=null;this.parentChannels=[]};Xflow.DataSlot.prototype.addChannel=function(a){this.parentChannels.push(a)};Xflow.DataSlot.prototype.removeChannel=function(a){a=this.parentChannels.indexOf(a);-1!=a&&this.parentChannels.splice(a,1)};Xflow.DataSlot.prototype.swapAsync=function(){var a=this.dataEntry;this.dataEntry=this.asyncDataEntry;this.asyncDataEntry=a};Xflow.DataSlot.prototype.setDataEntry=function(a,b){this.dataEntry=a;this.notifyOnChange(b==Xflow.RESULT_STATE.CHANGED_DATA_VALUE?
Xflow.DATA_ENTRY_STATE.CHANGED_VALUE:Xflow.DATA_ENTRY_STATE.CHANGED_SIZE)};Xflow.DataSlot.prototype.notifyOnChange=function(a){for(var b=0;b<this.parentChannels.length;++b)this.parentChannels[b].notifyOnChange(a)};Xflow.ChannelMap=function(){this.map={}};var a=Xflow.ChannelMap;a.prototype.getNames=function(){var a=[],b;for(b in this.map)a.push(b);return a};a.prototype.getChannel=function(a){return!this.map[a]?null:this.map[a].channel};a.prototype.getChildDataIndex=function(a){return!this.map[a]?void 0:
this.map[a].childDataIndex};a.prototype.getChildDataIndexForFilter=function(a){for(var b,a=a||this.getNames(),d=0;d<a.length;++d){var c=this.getChildDataIndex(a[d]);void 0!=c&&(b=void 0!=b&&b!=c?-1:c)}return b};a.prototype.merge=function(a,b){for(var d in a.map){var c=void 0==b?a.getChildDataIndex(d):b;this.addChannel(d,a.getChannel(d),c)}};a.prototype.addChannel=function(a,d,c){if(d){void 0==c&&(c=-1);e(this,a);var i=this.map[a].channel;!i||!i.willMergeWithChannel(d)?(this.map[a].channel=d,this.map[a].childDataIndex=
c):(i=b(this,i),i.addChannelEntries(d),this.map[a].channel=i,this.map[a].childDataIndex=-1)}};a.prototype.addDataEntry=function(a,b){c(this,a,b,-1)};a.prototype.addOutputDataSlot=function(a,b,d){c(this,a,b,-1).creatorProcessNode=d};a.prototype.clear=function(){for(var a in this.map){var b=this.map[a];b&&b.map==this&&b.clear()}this.map={}};Xflow.Channel=function(a,b){this.entries=[];this.map=a;this.id=++d;this.listeners=[];this.creatorProcessNode=null;b&&this.addDataSlot(b)};a=Xflow.Channel;a.prototype.addDataSlot=
function(a){a.addChannel(this);for(var b=0;b<this.entries.length;++b){var d=this.entries[b];if(d.key>=a.key-Xflow.EPSILON){Math.abs(d.key-a.key)<=Xflow.EPSILON?(d.removeChannel(this),this.entries.splice(b,1,a)):this.entries.splice(b,0,a);break}}this.entries.push(a)};a.prototype.getSequenceLength=function(){return this.entries.length};a.prototype.getSequenceMinKey=function(){return this.entries[0].key};a.prototype.getSequenceMaxKey=function(){return this.entries[this.entries.length-1].key};a.prototype.getType=
function(){return 0==this.entries.length?Xflow.DATA_TYPE.UNKNOWN:this.entries[0].dataEntry._type};a.prototype.addChannelEntries=function(a){for(var b=0;b<a.entries.length;++b)this.addDataSlot(a.entries[b]);a.creatorProcessNode&&(this.creatorProcessNode=a.creatorProcessNode)};a.prototype.getDataEntry=function(a,b){if(0==this.entries.length)return null;if(!a)return this.entries[0].dataEntry;for(var d=0,c=this.entries.length;d<c&&this.entries[d].key<b;)++d;if(a==Xflow.SEQUENCE.PREV_BUFFER)return this.entries[d?
d-1:0].dataEntry;if(a==Xflow.SEQUENCE.NEXT_BUFFER)return this.entries[d<c?d:c-1].dataEntry;if(a==Xflow.SEQUENCE.LINEAR_WEIGHT){var e=this.entries[d?d-1:0].key,d=this.entries[d<c?d:c-1].key,c=new Float32Array(1);c[0]=d==e?0:(b-e)/(d-e);return new Xflow.BufferEntry(Xflow.DATA_TYPE.FLOAT,c)}return null};a.prototype.willMergeWithChannel=function(a){if(this.entries.length!=a.entries.length)return!0;if(this.getType()!=a.getType())return!1;for(var b=0;b<this.entries.length;b++)if(Math.abs(this.entries[b].key-
a.entries[b].key)>Xflow.EPSILON)return!0;return!1};a.prototype.willMergeWithDataSlot=function(a){return 1<this.entries.length?!0:this.getType()!=a.dataEntry._type?!1:Math.abs(this.entries[0].key-a.key)>Xflow.EPSILON?!0:!1};a.prototype.notifyOnChange=function(a){for(var b=0;b<this.listeners.length;b++)this.listeners[b].onXflowChannelChange(this,a)};a.prototype.addListener=function(a){this.listeners.push(a)};a.prototype.removeListener=function(a){a=this.listeners.indexOf(a);-1!=a&&this.listeners.splice(a,
1)};a.prototype.clear=function(){for(var a=0;a<this.entries.length;++a)this.entries[a].removeChannel(this)};var d=0})();
(function(){function e(a,b,c,f){var e,i;f&&(e=[],i=[]);for(var j=0;j<a.params.length;++j){var k=a.params[j],l=k.source,m=b?b.getScriptInputName(j,l):l,o;f&&(o="For "+(j+1)+". argument '"+l+"': ",e.push(Xflow.getTypeName(k.type)+" "+l+(k.optional?" [optional]":"")));if(m){l=c.getChannel(m);if(!l&&!k.optional)if(f)i.push(o+"DataEntry '"+m+"' does not exist");else return!1;if(l&&l.getType()!=k.type)if(f)i.push(o+"DataEntry '"+m+"' has wrong type '"+Xflow.getTypeName(l.getType())+"'");else return!1}}f&&
f.push(a.name+"("+e.join(", ")+")\n\t * "+i.join("\n\t * "));return!0}function c(a,b,c,f){var e=c.getChannel(f);a.addChannel(b,e,c.getChildDataIndex(f))}Xflow.ChannelNode=function(a,b){this.owner=a;this.platform=Xflow.PLATFORM.JAVASCRIPT;this.substitution=b;this.loading=!1;this.inputSlots={};this.inputChannels=new Xflow.ChannelMap;this.computedChannels=new Xflow.ChannelMap;this.outputChannels=new Xflow.ChannelMap;this.processNode=this.dataflowChannelNode=this.operator=null;this.requestNodes={};this.useCount=
1;this.outOfSync=!0};Xflow.ChannelNode.prototype.synchronize=function(){if(this.outOfSync){var a=this.owner._graph;this.owner._computeOperator&&(this.platform=a.platform);a=this.owner;this.loading=a._subTreeLoading;this.substitution&&a._channelNode.synchronize();if(a._sourceNode)a._sourceNode._getChannelNode(this.substitution).synchronize();else for(var d=0;d<a._children.length;++d)a._children[d]._getChannelNode&&a._children[d]._getChannelNode(this.substitution).synchronize();a=this.owner;if(a._sourceNode)this.inputChannels.merge(a._sourceNode._getChannelNode(this.substitution).outputChannels,
0);else{for(var d=a._children,g=0;g<d.length;++g)d[g]._getChannelNode&&this.inputChannels.merge(d[g]._getChannelNode(this.substitution).outputChannels,g);for(g=0;g<d.length;++g)if(!d[g]._getChannelNode){var f=d[g],h=f._name+";"+f._key;if(this.substitution)f._paramName&&this.substitution.hasChannel(f._paramName)?this.inputChannels.addChannel(f._name,this.substitution.getChannel(f._paramName)):this.inputChannels.addDataEntry(f._name,a._channelNode.inputSlots[h]);else{var i=new Xflow.DataSlot(f._data,
f._key);this.inputSlots[h]=i;this.inputChannels.addDataEntry(f._name,i)}}}d=this.owner;this.computedChannels.merge(this.inputChannels);a=this.dataflowChannelNode;if(d._computeUsesDataflow&&d._dataflowNode){this.operator=null;var j=this.owner,d=new Xflow.Substitution(j._dataflowNode,this);this.dataflowChannelNode=j._dataflowNode._getChannelNode(d);j=this.owner;if(this.dataflowChannelNode){d=this.dataflowChannelNode;d.synchronize();g=d.outputChannels.getNames();for(f=0;f<g.length;++f)i=h=g[f],j._computeOutputMapping&&
(i=j._computeOutputMapping.getScriptOutputName(f,h)),i&&this.computedChannels.addChannel(i,d.outputChannels.getChannel(h))}}else if(!d._computeUsesDataflow&&d._computeOperator){this.dataflowChannelNode=null;g=this.owner;if(this.loading)this.operator=null;else if("string"==typeof g._computeOperator){d=g._computeOperator;f=null;if(d){a:{d=g._computeOperator;g=g._computeInputMapping;f=this.inputChannels;(h=Xflow.getOperators(d,this.platform)||Xflow.getOperators(d,Xflow.PLATFORM.JAVASCRIPT))||Xflow.notifyError("No operator with name '"+
d+"' found",this.owner);for(i=h.length;i--;)if(e(h[i],g,f)){f=h[i];break a}b.length=0;for(i=h.length;i--;)e(h[i],g,f,b);d="No operator '"+d+"' with matching type signature found:\n\n"+b.join("\n");Xflow.notifyError(d,this.owner);f=null}f&&(this.platform=f.platform)}this.operator=f}else this.operator=g._computeOperator;d=this.owner;if(this.operator)for(j in g=this.processNode=new Xflow.ProcessNode(this),f=0,g.outputDataSlots)h=j,d._computeOutputMapping&&(h=d._computeOutputMapping.getScriptOutputName(f,
j)),h&&this.computedChannels.addOutputDataSlot(h,g.outputDataSlots[j],g),f++}a&&a!=this.dataflowChannelNode&&a.owner._removeSubstitutionNode(a);j=this.owner;j._filterMapping?j._filterMapping.applyFilterOnChannelMap(this.outputChannels,this.computedChannels,j._filterType,c):this.outputChannels.merge(this.computedChannels);this.outOfSync=!1}};Xflow.ChannelNode.prototype.clear=function(){this.useCount=0;this.inputChannels.clear();this.outputChannels.clear();return!0};Xflow.ChannelNode.prototype.increaseRef=
function(){this.useCount++};Xflow.ChannelNode.prototype.decreaseRef=function(){this.useCount--;0==this.useCount&&this.clear();return!1};Xflow.ChannelNode.prototype.getOutputNames=function(){this.synchronize();return this.outputChannels.getNames()};Xflow.ChannelNode.prototype.getChildDataIndex=function(a){this.synchronize();return this.outputChannels.getChildDataIndexForFilter(a)};Xflow.ChannelNode.prototype.setStructureOutOfSync=function(){if(!this.outOfSync){this.outOfSync=!0;this.inputChannels.clear();
this.computedChannels.clear();this.outputChannels.clear();this.processNode&&this.processNode.clear();for(var a in this.requestNodes)this.requestNodes[a].setStructureOutOfSync()}};Xflow.ChannelNode.prototype.notifyDataChange=function(a,b){var c=a._name+";"+a._key;this.inputSlots[c]&&this.inputSlots[c].setDataEntry(a._data,b)};Xflow.ChannelNode.prototype.getResult=function(a,b){this.synchronize();var c=b?b.join(";"):"[null]";this.requestNodes[c]||(this.requestNodes[c]=new Xflow.RequestNode(this,b));
return this.requestNodes[c].getResult(a)};Xflow.ChannelNode.prototype.getOutputChannelInfo=function(a){this.synchronize();var b=this.outputChannels.getChannel(a);if(!b)return null;var c={type:b.getType(),seqLength:b.getSequenceLength(),seqMinKey:b.getSequenceMinKey(),seqMaxKey:b.getSequenceMaxKey(),origin:0,originalName:""},a=this.owner._filterMapping?this.owner._filterMapping.getRenameSrcName(a):a,b=b.getDataEntry();if(this.dataflowChannelNode){var f=this.inputChannels.getChannel(a);if(!f||b!=f.getDataEntry())return c.origin=
Xflow.ORIGIN.PROTO,c.originalName=a,c}if(this.operator&&(f=this.inputChannels.getChannel(a),!f||b!=f.getDataEntry()))return c.origin=Xflow.ORIGIN.COMPUTE,c.originalName=this.owner._computeOutputMapping.getScriptOutputNameInv(a,this.operator.outputs),c;c.origin=Xflow.ORIGIN.CHILD;c.originalName=a;return c};var b=[];Xflow.Substitution=function(a,b){this.map={};for(var c=b.owner,f=a._getGlobalParamNames(),e=0;e<f.length;++e)this.map[f[e]]=b.inputChannels.getChannel(f[e]);f=a._getParamNames();for(e=0;e<
f.length;++e){var i=f[e],j=i;c._computeInputMapping&&(j=c._computeInputMapping.getScriptInputName(e,i));this.map[i]=b.inputChannels.getChannel(j)}};Xflow.Substitution.prototype.hasChannel=function(a){return!!this.map[a]};Xflow.Substitution.prototype.getChannel=function(a){return this.map[a]};Xflow.Substitution.prototype.getKey=function(a){for(var b="",c=a._getGlobalParamNames(),f=0;f<c.length;++f)var e=this.map[c[f]],b=b+((e&&e.id||"-")+"!");a=a._getParamNames();for(f=0;f<a.length;++f)e=this.map[a[f]],
b+=(e&&e.id||"-")+".";return b}})();
(function(){function e(a,b,c){var f,e;for(e in c)if((f=c[e])&&f.creatorProcessNode)Xflow.utils.setAdd(a,f.creatorProcessNode),Xflow.utils.setAdd(b,f.creatorProcessNode.descendants);Xflow.utils.setRemove(a,b);Xflow.utils.setAdd(b,a)}function c(a,b){a.executers[b]||(a.executers[b]=new Xflow.Executer(a,b));return a.executers[b]}Xflow.ProcessNode=function(a){this.owner=a;this.operator=a.operator;this.inputChannels={};this.outputDataSlots={};this.status=Xflow.PROCESS_STATE.MODIFIED;this.children=[];this.descendants=
[];this.executers=[];this.asyncProcessState=3;for(var b=this.operator,c=a.owner._computeInputMapping,f=0;f<b.params.length;++f){var h=b.params[f].source,i=c?c.getScriptInputName(f,h):h;i&&((i=a.inputChannels.getChannel(i))&&i.addListener(this),this.inputChannels[h]=i)}e(this.children,this.descendants,this.inputChannels);var a=this.operator,b=this.outputDataSlots,c=Xflow.isOperatorAsync(a),j;for(j in a.outputs){var f=a.outputs[j],k,i=f.type;i!=Xflow.DATA_TYPE.TEXTURE?(h=new Xflow.BufferEntry(i,null),
c&&(k=new Xflow.BufferEntry(i,null))):(h=window.document?new Xflow.TextureEntry(null):new Xflow.ImageDataTextureEntry(null),c&&(k=window.document?new Xflow.TextureEntry(null):new Xflow.ImageDataTextureEntry(null)));b[f.name]=new Xflow.DataSlot(h,0);c&&(b[f.name].asyncDataEntry=k)}Xflow.isOperatorAsync(this.operator)&&(this._bindedAsyncCallback=this.receiveAsyncProcessing.bind(this))};var b=Xflow.ProcessNode;b.prototype.onXflowChannelChange=function(a,b){Xflow.isOperatorAsync(this.operator)?3!=this.asyncProcessState&&
(this.status=Xflow.PROCESS_STATE.MODIFIED,this.updateState()):(this.status=b==Xflow.DATA_ENTRY_STATE.CHANGED_VALUE&&this.status>Xflow.PROCESS_STATE.UNPROCESSED?Xflow.PROCESS_STATE.UNPROCESSED:Xflow.PROCESS_STATE.MODIFIED,this.notifyOutputChanged(b))};b.prototype.startAsyncProcessing=function(){0==this.asyncProcessState||3==this.asyncProcessState?(this.asyncProcessState=1,c(this,Xflow.PLATFORM.ASYNC).run(this._bindedAsyncCallback)):this.asyncProcessState=2};b.prototype.receiveAsyncProcessing=function(){this.status=
Xflow.PROCESS_STATE.PROCESSED;this.notifyOutputChanged(Xflow.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE);2==this.asyncProcessState?(this.asyncProcessState=0,this.status=Xflow.PROCESS_STATE.MODIFIED,this.updateState()):this.asyncProcessState=0;Xflow._callListedCallback()};b.prototype.notifyOutputChanged=function(a){for(var b in this.outputDataSlots)this.outputDataSlots[b].notifyOnChange(a)};b.prototype.clear=function(){for(var a in this.inputChannels)this.inputChannels[a]&&this.inputChannels[a].removeListener(this)};
b.prototype.updateState=function(){if(this.status==Xflow.PROCESS_STATE.MODIFIED)if(this.status=Xflow.PROCESS_STATE.UNPROCESSED,this.owner.loading)this.status=Xflow.PROCESS_STATE.LOADING;else{for(var a=0;a<this.children.length;++a)this.status=Math.min(this.status,this.children[a].updateState());if(a=this.status>Xflow.PROCESS_STATE.LOADING)a:{var a=this.operator,b=this.inputChannels,c;for(c in a.params){var f=b[a.params[c].source];if(f&&(f=f.getDataEntry())&&f.isLoading&&f.isLoading()){a=!0;break a}}a=
!1}a&&(this.status=Xflow.PROCESS_STATE.LOADING);if(c=this.status>Xflow.PROCESS_STATE.INVALID){var e;a:{c=this.operator;a=this.owner.owner._computeInputMapping;b=this.inputChannels;f=this.owner.owner;for(e in c.params){var i=c.params[e],j=a?a.getScriptInputName(e,i.source):i.source;if(!i.optional&&!j){Xflow.notifyError("Xflow: operator "+c.name+": Missing input argument for "+i.source,f);e=!1;break a}if(j){var k=b[i.source];if(!k){Xflow.notifyError("Xflow: operator "+c.name+": Input of name '"+j+"' not found. Used for parameter "+
i.source,f);e=!1;break a}j=k.getDataEntry();if(!k.creatorProcessNode&&!i.optional&&(!j||j.isEmpty())){Xflow.notifyError("Xflow: operator "+c.name+": Input for "+i.source+" contains no data.",f);e=!1;break a}if(j&&j.type!=i.type){Xflow.notifyError("Xflow: operator "+c.name+": Input for "+i.source+" has wrong type. Expected: "+Xflow.getTypeName(i.type)+", but got: "+Xflow.getTypeName(j.type),f);e=!1;break a}}}e=!0}c=!e}c&&(this.status=Xflow.PROCESS_STATE.INVALID);this.status==Xflow.PROCESS_STATE.UNPROCESSED&&
Xflow.isOperatorAsync(this.operator)&&(this.status=3==this.asyncProcessState?Xflow.PROCESS_STATE.LOADING:Xflow.PROCESS_STATE.PROCESSED,this.startAsyncProcessing())}return this.status};b.prototype.process=function(){var a;this.status==Xflow.PROCESS_STATE.UNPROCESSED&&(a=c(this,this.owner.platform),a.run(),this.status=Xflow.PROCESS_STATE.PROCESSED)};Xflow.RequestNode=function(a,b){this.owner=a;this.filter=b;this.results={};this.status=Xflow.PROCESS_STATE.MODIFIED;this.channels={};this.children=[];this.executers=
[];this.outOfSync=!0};b=Xflow.RequestNode;b.prototype.synchronize=function(){if(this.outOfSync){this.outOfSync=!1;var a=this.owner,b=this.filter;b||(b=a.outputChannels.getNames());for(var c=0;c<b.length;++c){var f=b[c],h=a.outputChannels.getChannel(f);h&&(this.channels[f]=h,h.addListener(this))}e(this.children,[],this.channels)}};b.prototype.updateState=function(){this.synchronize();if(this.status==Xflow.PROCESS_STATE.MODIFIED)if(this.status=Xflow.PROCESS_STATE.UNPROCESSED,this.owner.loading)this.status=
Xflow.PROCESS_STATE.LOADING;else for(var a=0;a<this.children.length;++a)this.status=Math.min(this.status,this.children[a].updateState());return this.status};b.prototype.isReady=function(){this.updateState();return this.status>=Xflow.PROCESS_STATE.UNPROCESSED};b.prototype.getResult=function(a){this.updateState();if(this.status==Xflow.PROCESS_STATE.UNPROCESSED){if(a==Xflow.RESULT_TYPE.COMPUTE){var b=c(this,this.owner.platform);b.isProcessed()||b.run()}this.status=Xflow.PROCESS_STATE.PROCESSED}b=null;
if(a==Xflow.RESULT_TYPE.COMPUTE){this.results[Xflow.RESULT_TYPE.COMPUTE]||(this.results[Xflow.RESULT_TYPE.COMPUTE]=new Xflow.ComputeResult);a=this.results[Xflow.RESULT_TYPE.COMPUTE];a._dataEntries={};a._outputNames=[];for(var e in this.channels)b=this.channels[e].getDataEntry(),a._dataEntries[e]=b&&!b.isEmpty()?b:null,a._outputNames.push(e);b=a}else a==Xflow.RESULT_TYPE.VS&&(e=c(this,Xflow.PLATFORM.GLSL),this.results[Xflow.RESULT_TYPE.VS]||(this.results[Xflow.RESULT_TYPE.VS]=new Xflow.VSDataResult),
a=this.results[Xflow.RESULT_TYPE.VS],b=e.getVertexShader(),a._program=b,a._programData=e.programData,b=a);b.loading=this.status==Xflow.PROCESS_STATE.LOADING;return b};b.prototype.setStructureOutOfSync=function(){this.outOfSync=!0;this.status=Xflow.PROCESS_STATE.MODIFIED;for(var a in this.results)this.results[a]._notifyChanged(Xflow.RESULT_STATE.CHANGED_STRUCTURE);for(var b in this.channels)this.channels[b].removeListener(this);this.channels=[];this.children=[];this.executers=[]};b.prototype.onXflowChannelChange=
function(a,b){a.creatorProcessNode&&(this.status=Xflow.PROCESS_STATE.MODIFIED);var c=b==Xflow.DATA_ENTRY_STATE.CHANGED_VALUE?Xflow.RESULT_STATE.CHANGED_DATA_VALUE:Xflow.RESULT_STATE.CHANGED_DATA_SIZE,f;for(f in this.results)this.results[f]._notifyChanged(c)}})();
(function(){function e(a,d,g,j){if(-1==a.blockedNodes.indexOf(d)){if(d.operator){if(j||g!=Xflow.PLATFORM.ASYNC&&Xflow.isOperatorAsync(d.operator)||a.firstOperator&&!(g==Xflow.PLATFORM.GLSL&&a.firstOperator.evaluate_glsl&&d.operator.evaluate_glsl)){c(a,d);return}a.firstOperator||(a.firstOperator=d.operator);for(var k=d.operator.mapping,l=0;l<k.length;++l)k[l].sequence?(b(a,d,k[l].source),b(a,d,k[l].keySource)):k[l].array&&b(a,d,k[l].source)}for(l=0;l<d.children.length;++l)e(a,d.children[l],g,j)}}function c(a,
b){if(-1==a.blockedNodes.indexOf(b)){a.blockedNodes.push(b);for(var d=0;d<b.children.length;++d)c(a,b.children[d])}}function b(a,b,d){(b=b.inputChannels[d])&&b.creatorProcessNode&&c(a,b.creatorProcessNode)}function a(b,d,c){if(-1==b.doneNodes.indexOf(c))if(b.doneNodes.push(c),-1!=b.blockedNodes.indexOf(c))d.subNodes.push(c);else{for(var e=0;e<c.children.length;++e)a(b,d,c.children[e]);c.operator&&b.constructionOrder.push(c)}}function d(a){for(var b=a.programData.inputs,d=0;d<a.programData.inputs.length;++d){var c=
a.programData.getDataEntry(d);(c=c?c.getIterateCount?c.getIterateCount():1:0)?!b[d].arrayAccess&&1<c?a.operatorList.setInputIterateType(d,Xflow.ITERATION_TYPE.MANY):a.operatorList.setInputIterateType(d,Xflow.ITERATION_TYPE.ONE):a.operatorList.setInputIterateType(d,Xflow.ITERATION_TYPE.NULL);b[d].arrayAccess&&a.platform==Xflow.PLATFORM.GLSL&&a.operatorList.setInputSize(d,c)}}function g(a){for(var b=0;b<a.subNodes.length;++b)a.subNodes[b].process()}Xflow.Executer=function(b,d){this.platform=d;this.mergedNodes=
[];this.mergedOutputNodes=[];this.subNodes=[];this.unprocessedDataNames=[];this.operatorList=new Xflow.OperatorList(d,b.owner.owner._graph);this.programData=new Xflow.ProgramData;this.program=null;var c={blockedNodes:[],doneNodes:[],constructionOrder:[],inputSlots:{},finalOutput:null,firstOperator:null};if(b instanceof Xflow.RequestNode){c.finalOutput={};for(var g=b.filter||b.owner.outputChannels.getNames(),k=0;k<g.length;++k){var l=g[k],m=b.owner.outputChannels.getChannel(l);m&&m.creatorProcessNode&&
(c.finalOutput[l]=m.getDataEntry())}Xflow.nameset.add(this.unprocessedDataNames,g)}e(c,b,this.platform,!1);a(c,this,b);for(g=0;g<c.constructionOrder.length;++g){for(var k=c.constructionOrder[g],m=l=new Xflow.OperatorEntry(k.operator),o=c,n=k,p=n.operator.mapping,q=0;q<p.length;++q){var r=n.inputChannels[p[q].source],v;if(r&&r.creatorProcessNode&&-1!=(v=this.mergedNodes.indexOf(r.creatorProcessNode))){a:{for(var t=r.creatorProcessNode,y=t.operator.outputs,w=0;w<y.length;++w)if(r.getDataEntry()==t.outputDataSlots[y[w].name].dataEntry){r=
w;break a}r=null}m.setTransferInput(q,v,r);this.operatorList.entries[v].isFinalOutput(r)||this.operatorList.entries[v].setTransferOutput(r)}else{t=p[q].source;n.owner.owner._computeInputMapping&&(t=n.owner.owner._computeInputMapping.getScriptInputName(p[q].paramIdx,p[q].source));y=new Xflow.ProgramInputConnection;y.channel=r;y.arrayAccess=p[q].array||!1;y.sequenceAccessType=p[q].sequence||0;y.sequenceAccessType&&(y.sequenceKeySourceChannel=n.inputChannels[p[q].keySource]);var w=y.getKey(),s=o.inputSlots[w];
r&&void 0!=s||(s=this.programData.inputs.length,o.inputSlots[w]=s,this.programData.inputs.push(y));m.setDirectInput(q,s,t)}}m=l;o=c;n=k;p=n.operator.outputs;q=!0;for(r=0;r<p.length;++r){t=n.outputDataSlots[p[r].name];a:if(o.finalOutput){y=void 0;for(y in o.finalOutput)if(o.finalOutput[y]==t.dataEntry)break a;y=!1}else y=!0;y?(w=this.programData.outputs.length,this.programData.outputs.push(t),m.setFinalOutput(r,w),!0!==y&&Xflow.nameset.remove(this.unprocessedDataNames,y)):q=!1}m=q;this.programData.operatorData.push({});
this.operatorList.addEntry(l);this.mergedNodes.push(k);(m||g==c.constructionOrder.length-1)&&this.mergedOutputNodes.push(k)}for(v=0;v<c.constructionOrder.length;++v){g=c.constructionOrder[v];k=this.operatorList.entries[v];l=g.operator.outputs;for(m=0;m<l.length;++m)!k.isFinalOutput(m)&&!k.isTransferOutput(m)&&(o=this.programData.outputs.length,this.programData.outputs.push(g.outputDataSlots[l[m].name]),k.setLostOutput(m,o))}};Xflow.Executer.prototype.isProcessed=function(){for(var a=this.mergedOutputNodes.length;a--;)if(this.mergedOutputNodes[a].status!=
Xflow.PROCESS_STATE.PROCESSED)return!1;return!0};Xflow.Executer.prototype.run=function(a){g(this);d(this);if(this.program=Xflow.createProgram(this.operatorList))this.operatorList.allocateOutput(this.programData,!!a),this.program.run(this.programData,a);if(this.platform!=Xflow.PLATFORM.ASYNC)for(a=this.mergedOutputNodes.length;a--;)this.mergedOutputNodes[a].status=Xflow.PROCESS_STATE.PROCESSED};Xflow.Executer.prototype.getVertexShader=function(){g(this);d(this);return this.program=Xflow.createProgram(this.operatorList)}})();
(function(){Xflow.utils={};Xflow.utils.setAdd=function(e,c){if(void 0!==c.length)for(var b=0;b<c.length;++b)-1==e.indexOf(c[b])&&e.push(c[b]);else-1==e.indexOf(c)&&e.push(c)};Xflow.utils.setRemove=function(e,c){var b;if(void 0!==c.length)for(var a=0;a<c.length;++a)-1!=(b=e.indexOf(c[a]))&&e.splice(b,1);else-1!=(b=e.indexOf(c))&&e.splice(b,1)};Xflow.nameset={};Xflow.nameset.add=function(e,c){if(c)if("string"==typeof c)-1==e.indexOf(c)&&e.push(c);else for(var b=0;b<c.length;++b)-1==e.indexOf(c[b])&&
e.push(c[b])};Xflow.nameset.remove=function(e,c){if(c)if("string"==typeof c){var b=e.indexOf(c);-1!=b&&e.splice(b,1)}else for(var a=0;a<c.length;++a)b=e.indexOf(c[a]),-1!=b&&e.splice(b,1)};Xflow.nameset.intersection=function(e,c){for(var b=e.length;b--;)-1==c.indexOf(e[b])&&e.splice(b,1)};Xflow.utils.binarySearch=function(e,c,b){for(var a=0,b=b-1;a<=b;){var d=Math.floor((a+b)/2);if(e[d]==c)return d;e[d]<c?a=d+1:b=d-1}return b}})();
(function(){function e(b){for(var a={},d=0;d<b.outputs.length;++d)b.outputs[d].type=Xflow.DATA_TYPE_MAP[b.outputs[d].type];for(d=0;d<b.params.length;++d)b.params[d].type=Xflow.DATA_TYPE_MAP[b.params[d].type],a[b.params[d].source]=d;b.mapping||(b.mapping=b.params);for(d=0;d<b.mapping.length;++d){var c=b.mapping[d],e=a[c.source];c.paramIdx=e;e=b.params[e].type;c.sequence&&(c.keyParamIdx=a[c.keySource]);c.sequence==Xflow.SEQUENCE.LINEAR_WEIGHT&&(e=Xflow.DATA_TYPE.FLOAT);c.internalType=e;c.name=c.name||
c.source}b.platform=b.platform||Xflow.PLATFORM.JAVASCRIPT}var c={};Xflow.registerOperator=function(b,a){var d,g;e(a);c[b]||(c[b]={});g=a.platform||Xflow.PLATFORM.JAVASCRIPT;d=c[b];b?a?(a.name=b,d[g]||(d[g]=[]),d[g].push(a)):XML3D.logWarning("Xflow.registerOperator: Operator data undefined."):XML3D.logWarning("Xflow.registerOperator: Operator name undefined.")};Xflow.initAnonymousOperator=function(b,a){e(a);a.name=b;return a};Xflow.isOperatorAsync=function(b){return!!b.evaluate_async};Xflow.getOperators=
function(b,a){a=a||Xflow.PLATFORM.JAVASCRIPT;return b&&!c[b]||!c[b][a]||0==c[b][a].length?null:c[b][a]}})();
(function(){function e(a,b,c,e){var f=d(a,b,!0);f.push(c);f.push(function(){g(a,b,f,!0);e()});a.operator.evaluate_async.apply(c,f)}function c(d,c){var e="function (",f=b(d.evaluate_core),e=e+(f.args.join(",")+",__xflowMax) {\n"),e=e+"    var __xflowI = __xflowMax\n    while(__xflowI--){\n",g=f.body,g=a(g,f.args,d,c);return eval("("+(e+(g+"\n  }\n}"))+")")}function b(a){var b={},d=a.toString().match(j);if(!d)return Xflow.notifyError("Xflow Internal: Could not parse function: "+a),null;b.args=d[2].split(",");
for(var c in b.args)b.args[c]=b.args[c].trim();b.body=d[3];return b}function a(a,b,d,c){for(var e="",f=0,g=a.indexOf("[",f);-1!=g;){var h=a.substr(f).match(k)[1],i=b.indexOf(h),h=!1,j=0;-1!=i&&(i<d.outputs.length?(h=!0,j=Xflow.DATA_TYPE_TUPLE_SIZE[[d.outputs[i].type]]):(i-=d.outputs.length,h=c.iterFlag[i],j=Xflow.DATA_TYPE_TUPLE_SIZE[d.mapping[i].internalType]));e+=a.substring(f,g)+"[";h&&(e+=j+"*__xflowI + ");f=g+1;g=a.indexOf("[",f)}return e+=a.substring(f)}function d(a,b,d){for(var c=[],e=a.operator.outputs,
g=0;g<e.length;++g)if(e[g].noAlloc)c.push({assign:null});else{var h=b.outputs[a.getOutputIndex(g)],h=d?h.asyncDataEntry:h.dataEntry;c.push(h?h.getValue():null)}f(c,a,b);return c}function g(a,b,d,c){for(var e=a.operator.outputs,f=0;f<e.length;++f){var g=b.outputs[a.getOutputIndex(f)];if(e[f].noAlloc){var h=c?g.asyncDataEntry:g.dataEntry;h.type==Xflow.DATA_TYPE.TEXTURE?h._setImage(d[f].assign):h._setValue(d[f].assign)}c&&g.swapAsync()}}function f(a,b,d){for(var c=b.operator.mapping,e=0;e<c.length;++e){var f=
d.getDataEntry(b.getDirectInputIndex(e));a.push(f?f.getValue():null)}}Xflow.OperatorEntry=function(a){this.index=0;this.operator=a;this.inputInfo=[];this.outputInfo=[]};Xflow.OperatorEntry.prototype.isTransferInput=function(a){return void 0!==this.inputInfo[a].operatorIndex};Xflow.OperatorEntry.prototype.getTransferInputOperatorIndex=function(a){return this.inputInfo[a].operatorIndex};Xflow.OperatorEntry.prototype.getTransferInputOutputIndex=function(a){return this.inputInfo[a].outputIndex};Xflow.OperatorEntry.prototype.getTransferInputId=
function(a){a=this.inputInfo[a];return a.operatorIndex+"_"+a.outputIndex};Xflow.OperatorEntry.prototype.getTransferOutputId=function(a){return this.index+"_"+a};Xflow.OperatorEntry.prototype.getInputMappingName=function(a){return this.inputInfo[a].mappedName};Xflow.OperatorEntry.prototype.getDirectInputIndex=function(a){return this.inputInfo[a].inputIndex};Xflow.OperatorEntry.prototype.getOutputIndex=function(a){return this.outputInfo[a].finalOut||this.outputInfo[a].lost||0};Xflow.OperatorEntry.prototype.isFinalOutput=
function(a){return this.outputInfo[a]&&void 0!==this.outputInfo[a].finalOut};Xflow.OperatorEntry.prototype.isTransferOutput=function(a){return this.outputInfo[a]&&this.outputInfo[a].transfer};Xflow.OperatorEntry.prototype.isLostOutput=function(a){return this.outputInfo[a]&&void 0!==this.outputInfo[a].lost};Xflow.OperatorEntry.prototype.setTransferInput=function(a,b,d){this.inputInfo[a]={operatorIndex:b,outputIndex:d}};Xflow.OperatorEntry.prototype.setDirectInput=function(a,b,d){this.inputInfo[a]=
{inputIndex:b,mappedName:d}};Xflow.OperatorEntry.prototype.setFinalOutput=function(a,b){this.outputInfo[a]={finalOut:b}};Xflow.OperatorEntry.prototype.setTransferOutput=function(a){this.outputInfo[a]={transfer:!0}};Xflow.OperatorEntry.prototype.setLostOutput=function(a,b){this.outputInfo[a]={lost:b}};Xflow.OperatorEntry.prototype.getKey=function(){for(var a=this.operator.name+"*O",b=0;b<this.outputInfo.length;++b)var d=this.outputInfo[b],a=a+("*"+(d.transfer?"_":d.finalOut||d.lost+"?"));a+=NaN;for(b=
0;b<this.inputInfo.length;++b)d=this.inputInfo[b],a+="*"+(d.inputIndex?d.inputInfo:d.operatorIndex+">"+d.outputIndex);return a};Xflow.OperatorList=function(a,b){this.graph=b;this.platform=a;this.entries=[];this.inputInfo={}};Xflow.OperatorList.prototype.addEntry=function(a){a.index=this.entries.length;this.entries.push(a)};Xflow.OperatorList.prototype.getKey=function(){for(var a=[],b=0;b<this.entries.length;++b)a.push(this.entries[b].getKey());a=this.platform+">"+a.join("!")+"|";for(b in this.inputInfo)a+=
b+">"+(this.inputInfo[b].iterate||0)+"x"+(this.inputInfo[b].size||0);return a};Xflow.OperatorList.prototype.setInputIterateType=function(a,b){this.inputInfo[a]||(this.inputInfo[a]={});this.inputInfo[a].iterate=b};Xflow.OperatorList.prototype.setInputSize=function(a,b){this.inputInfo[a]||(this.inputInfo[a]={});this.inputInfo[a].size=b};Xflow.OperatorList.prototype.isInputIterate=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==Xflow.ITERATION_TYPE.MANY};Xflow.OperatorList.prototype.isInputUniform=
function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==Xflow.ITERATION_TYPE.ONE};Xflow.OperatorList.prototype.isInputNull=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==Xflow.ITERATION_TYPE.NULL};Xflow.OperatorList.prototype.getInputIterateType=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate};Xflow.OperatorList.prototype.getInputSize=function(a){return this.inputInfo[a]&&this.inputInfo[a].size||0};Xflow.OperatorList.prototype.getIterateCount=function(a){for(var b=
-1,d=0;d<a.inputs.length;++d)if(this.isInputIterate(d)){var c=a.getDataEntry(d);c&&c.getIterateCount&&(c=c.getIterateCount(),b=0>b?c:Math.min(c,b))}return 0>b?1:b};var h={};Xflow.OperatorList.prototype.allocateOutput=function(a,b){for(var d=0;d<this.entries.length;++d){var c=this.entries[d],e=c.operator,g=a.operatorData[d],i=this.getIterateCount(a);if(e.alloc){var j=[h];f(j,c,a);j.push(i);e.alloc.apply(g,j)}for(g=0;g<e.outputs.length;++g){var k=e.outputs[g],j=a.outputs[c.getOutputIndex(g)],j=b?j.asyncDataEntry:
j.dataEntry;if(!k.noAlloc)if(j.type==Xflow.DATA_TYPE.TEXTURE)if(k.customAlloc){var k=h[k.name],y=k.imageFormat.width,w=k.imageFormat.height,s=k.imageFormat.texelType,D=k.imageFormat.texelFormat,k=k.samplerConfig;j._createImage(y,w,D,s,k)}else if(k.sizeof){for(var u=null,y=0;y<e.mapping.length;++y)if(e.mapping[y].source==k.sizeof){u=a.getDataEntry(c.getDirectInputIndex(y));break}if(u)y=Math.max(u.width,1),w=Math.max(u.height,1),D=k.texelFormat||u.texelFormat,s=k.texelType||u.texelType,k=k.samplerConfig||
u.getSamplerConfig(),j._createImage(y,w,D,s,k);else throw Error("Unknown texture input parameter '"+k.sizeof+"' in operator '"+e.name+"'");}else throw Error("Cannot create texture. Use customAlloc or sizeof parameter attribute");else if(k=(k.customAlloc?h[k.name]:i)*j.getTupleSize(),!j._value||j._value.length!=k)switch(j.type){case Xflow.DATA_TYPE.FLOAT:case Xflow.DATA_TYPE.FLOAT2:case Xflow.DATA_TYPE.FLOAT3:case Xflow.DATA_TYPE.FLOAT4:case Xflow.DATA_TYPE.FLOAT4X4:j._setValue(new Float32Array(k));
break;case Xflow.DATA_TYPE.INT:case Xflow.DATA_TYPE.INT4:case Xflow.DATA_TYPE.BOOL:j._setValue(new Int32Array(k));break;default:XML3D.debug.logWarning("Could not allocate output buffer of TYPE: "+j.type)}else j._notifyChanged()}}};Xflow.ProgramData=function(){this.inputs=[];this.outputs=[];this.operatorData=[]};Xflow.ProgramData.prototype.getChannel=function(a){return this.inputs[a].channel};Xflow.ProgramData.prototype.getDataEntry=function(a){var a=this.inputs[a],b=a.channel;if(!b)return null;var d=
0;a.sequenceKeySourceChannel&&(d=(d=a.sequenceKeySourceChannel.getDataEntry())&&d._value?d._value[0]:0);return b.getDataEntry(a.sequenceAccessType,d)};Xflow.ProgramInputConnection=function(){this.channel=null;this.arrayAccess=!1;this.sequenceAccessType=Xflow.SEQUENCE.NO_ACCESS;this.sequenceKeySourceChannel=null};Xflow.ProgramInputConnection.prototype.getKey=function(){return(this.channel?this.channel.id:"NULL")+";"+this.arrayAccess+";"+this.sequenceAccessType+";"+(this.sequenceKeySourceChannel?this.sequenceKeySourceChannel.id:
"")};var i={};Xflow.createProgram=function(a){var b;if(0===a.entries.length)return null;b=a.entries[0].operator;var d=a.getKey();i[d]||(a.platform===Xflow.PLATFORM.GLSL?i[d]=new Xflow.VSProgram(a):b.platform===Xflow.PLATFORM.CL?i[d]=new Xflow.CLProgram(a):b.platform===Xflow.PLATFORM.JAVASCRIPT&&1===a.entries.length?i[d]=new Xflow.SingleProgram(a):Xflow.notifyError("Could not create program from operatorList"));return i[d]};Xflow.SingleProgram=function(a){this.list=a;this.entry=a.entries[0];this.operator=
this.entry.operator;this._inlineLoop=null};Xflow.SingleProgram.prototype.run=function(a,b){var f=this.list,h=a.operatorData[0],i=f.entries[0],j=i.operator.mapping;h.iterFlag={};for(var k=0;k<j.length;++k){var v=i.isTransferInput(k)||f.isInputIterate(i.getDirectInputIndex(k));h.iterFlag[k]=v}h.iterateCount=f.getIterateCount(a);h.customData||(h.customData={});b?e(this.entry,a,h,b):this.operator.evaluate_core?(f=d(this.entry,a),f.push(h.iterateCount),this._inlineLoop||(this._inlineLoop=c(this.operator,
h)),this._inlineLoop.apply(h,f)):(f=this.entry,i=d(f,a),i.push(h),f.operator.evaluate.apply(h,i),g(f,a,i,!1))};var j=/function\s+([^(]*)\(([^)]*)\)\s*\{([\s\S]*)\}/,k=/([a-zA-Z_$][\w$]*)(\[)/})();
(function(){function e(a,b,e,f,h){for(var i,j=b.operator;-1!=(i=a.indexOf("#I{"));){var k=a.indexOf("}",i),l;a:{l=a.substring(i+3,k);for(var m=0;m<j.mapping.length;++m)if(j.mapping[m].name==l){l=m;break a}throw Error("Invalid input name '"+l+"' inside of code fragment");}l=b.isTransferInput(l)?e[b.getTransferInputId(l)]:f[b.getDirectInputIndex(l)];a=a.substring(0,i)+l+a.substring(k+1)}for(;-1!=(i=a.indexOf("#O{"));){k=a.indexOf("}",i);a:{f=a.substring(i+3,k);for(l=0;l<j.outputs.length;++l)if(j.outputs[l].name==
f){f=l;break a}f=void 0}l=e[b.getTransferOutputId(f)];a=a.substring(0,i)+l+a.substring(k+1)}for(b=[];-1!=(i=a.indexOf("#L{"));)k=a.indexOf("}",i),e=a.substring(i+3,k),b[e]||(b[e]=c(e,h)),l=b[e],a=a.substring(0,i)+l+a.substring(k+1);for(;-1!=(i=a.indexOf("#G{"));)k=a.indexOf("}",i),l=a.substring(i+3,k),a=a.substring(0,i)+l+a.substring(k+1);return a}function c(a,b){for(var c=a,e=1;-1!=b.indexOf(c);)c=a+"_"+ ++e;Xflow.nameset.add(b,c);return c}function b(a){switch(a){case Xflow.DATA_TYPE.BOOL:return"bool";
case Xflow.DATA_TYPE.BYTE:return"uint";case Xflow.DATA_TYPE.FLOAT:return"float";case Xflow.DATA_TYPE.FLOAT2:return"vec2";case Xflow.DATA_TYPE.FLOAT3:return"vec3";case Xflow.DATA_TYPE.FLOAT4:return"vec4";case Xflow.DATA_TYPE.FLOAT3X3:return"mat3";case Xflow.DATA_TYPE.FLOAT4X4:return"mat4";case Xflow.DATA_TYPE.INT:return"int";case Xflow.DATA_TYPE.INT4:return"ivec4"}throw Error("Type not supported for GLSL "+Xflow.getTypeName(a));}Xflow.VSProgram=function(a){this.list=a;this._outputInfo={};for(var a=
this.list,b=a.entries,b=b[b.length-1],c=b.operator,e=0;e<c.params.length;++e){var h=c.params[e],i=h.source,j=e,k=b.getDirectInputIndex(j);this._outputInfo[i]={type:h.type};this._outputInfo[i].iteration=b.isTransferInput(j)||a.isInputIterate(k)?Xflow.ITERATION_TYPE.MANY:a.isInputUniform(k)?Xflow.ITERATION_TYPE.ONE:Xflow.ITERATION_TYPE.NULL}};Xflow.VSProgram.prototype.getOutputNames=function(){return Object.keys(this._outputInfo)};Xflow.VSProgram.prototype.getOutputType=function(a){return this._outputInfo[a].type};
Xflow.VSProgram.prototype.isOutputUniform=function(a){return this._outputInfo[a].iteration==Xflow.ITERATION_TYPE.ONE};Xflow.VSProgram.prototype.isOutputNull=function(a){return this._outputInfo[a].iteration==Xflow.ITERATION_TYPE.NULL};Xflow.VSProgram.prototype.createVertexShader=function(a,d){var g=new Xflow.VertexShader(a),f=this.list,h=f.entries,i=[],j={},k={},l=h[h.length-1],m=[],o=l.operator;if(!d)throw Error("Could not find vsConfig! Attempt to create vertex shader programm without VS operator?");
Xflow.nameset.add(i,d.getBlockedNames());var n;n="// OUTPUT\n";for(var p in d._addOutput){var q=d._addOutput[p];n+="varying "+b(q.type)+" "+p+";\n";Xflow.nameset.add(i,p)}var r=0;for(p in d._attributes){for(var q=d._attributes[p],v=l.getDirectInputIndex(r),t=0;t<q.channeling.length;++t){var y=q.channeling[t],w={type:q.type,iteration:0,index:0,sourceName:p},s=y.outputName;y.code||l.isTransferInput(r)||f.isInputIterate(v)?(m[r]=!0,w.iteration=Xflow.ITERATION_TYPE.MANY,n+="varying "+b(o.outputs[r].type)+
" "+s+";\n",Xflow.nameset.add(i,s),k[l.getTransferOutputId(t)]=s):f.isInputUniform(v)?(w.iteration=Xflow.ITERATION_TYPE.ONE,w.index=v):w.iteration=Xflow.ITERATION_TYPE.NULL;Xflow.nameset.add(g._outputNames,s);g._outputInfo[s]=w}r++}n+="\n// INPUT\n";for(p in d._addInput)q=d._addInput[p],n+=(q.uniform?"uniform ":"attribute ")+b(q.type)+" "+p+";\n",Xflow.nameset.add(i,p);for(t=0;t<h.length;++t){q=h[t];y=q.operator;for(s=0;s<y.mapping.length;++s)if((t<h.length-1||m[s])&&!q.isTransferInput(s)&&!j[q.getDirectInputIndex(s)])o=
y.mapping[s],p=c(o.name,i),r=q.getDirectInputIndex(s),v=!f.isInputIterate(r),g._inputInfo[p]={index:r,uniform:v},Xflow.nameset.add(g._inputNames,p),j[r]=p,n+=(v?"uniform ":"attribute ")+b(o.internalType)+" "+p,o.array&&(n+="["+f.getInputSize(r)+"]"),n+=";\n"}n+="\n// CODE\nvoid main(void){\n";for(t=0;t<h.length;++t){q=h[t];y=q.operator;for(s=0;s<y.outputs.length;++s)q.isFinalOutput(s)||(p=c(y.outputs[s].name,i),k[q.getTransferOutputId(s)]=p,n+="\t"+b(y.outputs[s].type)+" "+p+";\n");f=e(y.evaluate_glsl,
q,k,j,i);n+=f+"\n"}h=0;f="";for(p in d._attributes){q=d._attributes[p];for(t=0;t<q.channeling.length;++t)y=q.channeling[t],s=y.outputName,g._outputInfo[s].iteration==Xflow.ITERATION_TYPE.MANY&&(f=y.code?f+("\t"+y.code+"\n"):f+("\t"+s+" = #I{"+p+"};\n"));h++}for(t=0;t<d._codeFragments.length;++t)f+="\t"+d._codeFragments[t]+"\n";n+=e(f,l,k,j,i)+"\n";g._glslCode=n+"}\n";return g}})();
(function(){function e(a,b,d,c,e,f){this.program=a;this.cl=a.cl;this.name=b;this.type=c||null;this.isInput=!!f;this.hasMemObject=this.needsMemObject=!1;this.clFunctionParam=this.arg=this.memObjectSize=this.byteSize=null;this.xflowType=d;this.helperMap=null;this.helpers=[];this.entryValue=e||null;this.val=null;this.prepareParam();this.initHelperParams();this.initKernelArg();this.updateValue(this.entryValue)}function c(a,b,d,c,f,g){var o=f?f.getValue():null,f=b?d.kernelParamMap.inputs:d.kernelParamMap.outputs;
f[g]?f[g].updateValue(o):(f[g]=new e(d,a.name,a.type,null,o,b),c.push(f[g].clFunctionParam),f[g].helpers.forEach(function(a){c.push(a.clFunctionParam)}))}function b(b){var d=b.cl,c=d.kernelManager,e=d.cmdQueue,f={inputs:[],outputs:[]},m=a(b.kernelParamMap,f),o=g(b.kernelParamMap.inputs[0]),n=b.kernelProgram;return function(){var a,b,d,g,h=f.inputs,i=f.outputs;if(!n)return!1;g=m.map(function(a){return a.arg});c.setArgs.apply(null,[n].concat(g));try{b=h.length;for(a=0;a<b;a++)d=h[a],e.enqueueWriteBuffer(d.arg,
!1,0,d.arg.getInfo(WebCL.MEM_SIZE),d.val,[]);e.enqueueNDRangeKernel(n,o[1].length,[],o[1],o[0],[]);b=i.length;for(a=0;a<b;a++)d=i[a],e.enqueueReadBuffer(d.arg,!1,0,d.arg.getInfo(WebCL.MEM_SIZE),d.val,[]);e.finish()}catch(w){return!1}return!0}}function a(a,b){var c=a.inputs,e=[];a.outputs.forEach(function(a){d(a,e,b.outputs)});c.forEach(function(a){d(a,e,b.inputs)});return e}function d(a,b,d){b.push(a);a.hasMemObject&&(d.push(a),a.helpers.forEach(function(a){b.push(a)}))}function g(a){var b;b=a.entryValue;
a.xflowType===Xflow.DATA_TYPE.TEXTURE?(a=[16,4],b=[Math.ceil(b.width/a[0])*a[0],Math.ceil(b.height/a[1])*a[1]]):(a=[16],b=[Math.ceil(b.length/a[0])*a[0]]);return[a,b]}Xflow.CLProgram=function(a){if(this.cl=a.graph.cl)this.list=a,this.entry=a.entries[0],this.operator=this.entry.operator,this.kernelParamMap={inputs:[],outputs:[]},this.kernelFunctionParams=[],this.mainProgram=this.kernelProgram=this.kernelCode=null};var f={type:"uint",params:["width","height"]};e.prototype={prepareParam:function(){var a,
b=Xflow.DATA_TYPE,d=[],c="",e="";if(!this.type){switch(this.xflowType){case b.TEXTURE:a=f;this.type="uchar4*";c="__global";this.needsMemObject=!0;break;case b.INT:this.type="int";break;case b.FLOAT:this.type="float";break;default:return}this.helperMap=a}c&&d.push(c);this.isInput&&(e="const");e&&d.push(e);d.push(this.type);d.push(this.name);this.clFunctionParam=d.join(" ")},initHelperParams:function(){var a,b=this,d=this.helperMap;d&&this.isInput&&d.params.forEach(function(c){var f=b.name+"_"+c;"width"===
c?a=b.entryValue.width:"height"===c?a=b.entryValue.height:"length"===c&&(a=b.entryValue.length);b.helpers.push(new e(b.program,f,null,d.type,new Uint32Array([a])))})},initKernelArg:function(){this.needsMemObject?this.allocateMemObject():this.arg=this.entryValue},allocateMemObject:function(){var a=this.cl.API,b=this.cl.ctx,d=this.type,c=parseInt(d.substring(d.length-2,d.length-1),10),d=this.isInput?"r":"w",e=this.entryValue;this.hasMemObject&&this.arg.release();this.byteSize=c;c=this.xflowType===Xflow.DATA_TYPE.TEXTURE?
e.width*e.height*c:e.length*c;a=a.createBuffer(c,d,b);this.memObjectSize=c;this.arg=a;this.hasMemObject=!0;this.needsMemObject=!1},updateValue:function(a){this.hasMemObject?(this.val=a.data,this.entryValue=a,this.checkEntrySize()):this.arg=this.entryValue=a},updateHelpers:function(){var a=this;this.helpers.forEach(function(b){var d=b.name;-1!==d.indexOf("width")?b.updateValue(new Uint32Array([a.entryValue.width])):-1!==d.indexOf("height")?b.updateValue(new Uint32Array([a.entryValue.height])):-1!==
d.indexOf("length")&&b.updateValue(new Uint32Array([a.entryValue.length]))})},checkEntrySize:function(){var a=this.entryValue;if(this.memObjectSize!==(this.xflowType===Xflow.DATA_TYPE.TEXTURE?a.width*a.height*this.byteSize:a.length*this.byteSize))this.allocateMemObject(),this.updateHelpers(),this.program.mainProgram=null}};Xflow.CLProgram.prototype.run=function(a){var d=this.list,e,f,g=a.operatorData[0],m=d.entries[0],o=m.operator.mapping;g.iterFlag={};for(f=0;f<o.length;++f)e=m.isTransferInput(f)||
d.isInputIterate(m.getDirectInputIndex(f)),g.iterFlag[f]=e;g.iterateCount=d.getIterateCount(a);if(this.operator.evaluate&&this.operator.evaluate instanceof Array){d=this.entry;e=this.kernelFunctionParams;o=this.operator.outputs;for(m=e.length=0;m<o.length;++m)f=o[m],g=a.outputs[d.getOutputIndex(m)].dataEntry,c(f,!!f.source,this,e,g,m);o=d.operator.mapping;for(m=0;m<o.length;++m)f=o[m],g=a.getDataEntry(d.getDirectInputIndex(m)),c(f,!!f.source,this,e,g,m);if(null===this.kernelCode)a:if(a=this.cl.kernelManager,
e=this.operator.evaluate,d=this.kernelName=this.operator.name.split("xflow.")[1],e){f=[];f.push("__kernel void");f.push(d+"(");f.push(this.kernelFunctionParams.join(", "));f.push(")");(f=f.join(" "))?(f+="{\n",g=[],m=this.kernelParamMap.inputs[0],"uchar4*"===m.type?(g.push("int x = get_global_id(0);"),g.push("int y = get_global_id(1);"),g.push("if (x >= "+m.name+"_width || y >= "+m.name+"_height) return;"),g.push("int "+m.name+"_i = y * "+m.name+"_width + x;")):(g.push("int "+m.name+"_i = get_global_id(0);"),
g.push("if (int "+m.name+"_i >= "+m.name+"_length) return;")),g=g.join("\n"))?(f=f+g+e.join("\n"),e=f+"\n}"):e=!1:e=!1;e=this.kernelCode=e;try{a.register(d,e)}catch(n){break a}this.kernelProgram=a.getKernel(this.kernelName)}null===this.mainProgram&&(this.mainProgram=b(this));this.mainProgram()}}})();
Xflow.registerOperator("xflow.morph",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"},{type:"float3",source:"valueAdd"},{type:"float",source:"weight"}],evaluate:function(e,c,b,a,d){for(var g=0;g<d.iterateCount;g++){var f=a[d.iterFlag[2]?g:0];e[3*g]=c[d.iterFlag[0]?3*g:0]+f*b[d.iterFlag[1]?3*g:0];e[3*g+1]=c[d.iterFlag[0]?3*g+1:1]+f*b[d.iterFlag[1]?3*g+1:1];e[3*g+2]=c[d.iterFlag[0]?3*g+2:2]+f*b[d.iterFlag[1]?3*g+2:2]}return!0},evaluate_core:function(e,c,b,a){e[0]=c[0]+
a[0]*b[0];e[1]=c[1]+a[0]*b[1];e[2]=c[2]+a[0]*b[2]},evaluate_glsl:"\t// xflow.morph \n\t#O{result} = #I{value} + vec3(#I{weight}) * #I{valueAdd};\n"});Xflow.registerOperator("xflow.sub",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value1"},{type:"float3",source:"value2"}],evaluate:function(){throw"Not used!";},evaluate_core:function(e,c,b){e[0]=c[0]-b[0];e[1]=c[1]-b[1];e[2]=c[2]-b[2]}});
Xflow.registerOperator("xflow.bufferSelect",{outputs:[{type:"float3",name:"result",noAlloc:!0}],params:[{type:"float3",source:"trueOption",array:!0},{type:"float3",source:"falseOption",array:!0},{type:"bool",source:"value",array:!0}],evaluate:function(e,c,b,a){e.assign=a[0]?b:c;return!0}});
Xflow.registerOperator("xflow.normalize",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"}],evaluate:function(e,c,b){for(var a=0;a<b.iterateCount;a++){var d=3*a,g=c[d],f=c[d+1],h=c[d+2],i=1/Math.sqrt(g*g+f*f+h*h);e[d]=g*i;e[d+1]=f*i;e[d+2]=h*i}}});
Xflow.registerOperator("xflow.lerpSeq",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:Xflow.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:Xflow.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:Xflow.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate_core:function(e,c,b,a){var d=1-a[0];e[0]=d*c[0]+a[0]*b[0];e[1]=d*c[1]+a[0]*
b[1];e[2]=d*c[2]+a[0]*b[2]},evaluate_parallel:function(){return!0}});
Xflow.registerOperator("xflow.lerpSeqAsync",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:Xflow.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:Xflow.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:Xflow.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate_async:function(e,c,b,a,d,g){for(var f=d.iterateCount,h,i,j;f--;){h=
3*(d.iterFlag[0]?f:0);i=3*(d.iterFlag[1]?f:0);j=d.iterFlag[2]?f:0;var k=1-a[j];e[3*f]=k*c[h]+a[j]*b[i];e[3*f+1]=k*c[h+1]+a[j]*b[i+1];e[3*f+2]=k*c[h+2]+a[j]*b[i+2]}window.setTimeout(g,200)}});
Xflow.registerOperator("xflow.lerpKeys",{outputs:[{type:"float3",name:"result"}],params:[{type:"float",source:"keys",array:!0},{type:"float3",source:"values",array:!0},{type:"float",source:"key"}],alloc:function(e){e.result=3},evaluate:function(e,c,b,a){var d=Math.min(c.length,Math.floor(b.length/3)),g=Xflow.utils.binarySearch(c,a[0],d);0>g||g==d-1?(g=Math.max(0,g),e[0]=b[3*g],e[1]=b[3*g+1],e[2]=b[3*g+2]):(c=(a[0]-c[g])/(c[g+1]-c[g]),a=1-c,e[0]=a*b[3*g]+c*b[3*g+3],e[1]=a*b[3*g+1]+c*b[3*g+4],e[2]=
a*b[3*g+2]+c*b[3*g+5])}});
Xflow.registerOperator("xflow.slerpSeq",{outputs:[{type:"float4",name:"result"}],params:[{type:"float4",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:Xflow.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:Xflow.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:Xflow.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate:function(e,c,b,a,d){for(var g=0;g<d.iterateCount;++g)XML3D.math.quat.slerpOffset(c,d.iterFlag[0]?
4*g:0,b,d.iterFlag[1]?4*g:0,a[0],e,4*g,!0)},evaluate_parallel:function(){return!0}});
Xflow.registerOperator("xflow.slerpKeys",{outputs:[{type:"float4",name:"result"}],params:[{type:"float",source:"keys",array:!0},{type:"float4",source:"values",array:!0},{type:"float",source:"key"}],alloc:function(e){e.result=4},evaluate:function(e,c,b,a){var d=Math.min(c.length,Math.floor(b.length/4)),g=Xflow.utils.binarySearch(c,a[0],d);0>g||g==d-1?(g=Math.max(0,g),e[0]=b[4*g],e[1]=b[4*g+1],e[2]=b[4*g+2],e[3]=b[4*g+3]):XML3D.math.quat.slerpOffset(b,4*g,b,4*(g+1),(a[0]-c[g])/(c[g+1]-c[g]),e,0,!0)}});
Xflow.registerOperator("xflow.createTransform",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float3",source:"translation",optional:!0},{type:"float4",source:"rotation",optional:!0},{type:"float3",source:"scale",optional:!0},{type:"float3",source:"center",optional:!0},{type:"float4",source:"scaleOrientation",optional:!0}],evaluate:function(e,c,b,a,d,g,f){for(var h=0;h<f.iterateCount;h++)XML3D.math.mat4.makeTransformXflow(c?c.subarray(f.iterFlag[0]?3*h:0):null,b?b.subarray(f.iterFlag[1]?
4*h:0):null,a?a.subarray(f.iterFlag[2]?3*h:0):null,d?d.subarray(f.iterFlag[3]?3*h:0):null,g?g.subarray(f.iterFlag[4]?4*h:0):null,e.subarray(16*h));return!0}});
Xflow.registerOperator("xflow.createTransformInv",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float3",source:"translation",optional:!0},{type:"float4",source:"rotation",optional:!0},{type:"float3",source:"scale",optional:!0},{type:"float3",source:"center",optional:!0},{type:"float4",source:"scaleOrientation",optional:!0}],evaluate:function(e,c,b,a,d,g,f){for(var h=0;h<f.iterateCount;h++)XML3D.math.mat4.makeTransformInvXflow(c?c.subarray(f.iterFlag[0]?3*h:0):null,b?b.subarray(f.iterFlag[1]?
4*h:0):null,a?a.subarray(f.iterFlag[2]?3*h:0):null,d?d.subarray(f.iterFlag[3]?3*h:0):null,g?g.subarray(f.iterFlag[4]?4*h:0):null,e.subarray(16*h))},evaluate_parallel:function(){return!0}});Xflow.registerOperator("xflow.mul",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float4x4",source:"value1"},{type:"float4x4",source:"value2"}],evaluate:function(e,c,b,a){for(var d=0;d<a.iterateCount;d++)XML3D.math.mat4.multiplyOffset(e,16*d,c,a.iterFlag[0]?16*d:0,b,a.iterFlag[0]?16*d:0)},evaluate_parallel:function(){return!0}});
Xflow.registerOperator("xflow.skinDirection",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"dir"},{type:"int4",source:"boneIdx"},{type:"float4",source:"boneWeight"},{type:"float4x4",source:"boneXform",array:!0}],evaluate:function(e,c,b,a,d,g){for(var f=XML3D.math.vec3,h=XML3D.math.mat4,i=f.create(),j=f.create(),k=0;k<g.iterateCount;++k){for(var l=3*k,m=i[0]=i[1]=i[2]=0;4>m;m++){var o=a[g.iterFlag[2]?4*k+m:m];o&&(h.multiplyOffsetDirection(d,16*b[g.iterFlag[1]?4*k+m:m],c,l,
j),f.scale(j,j,o),f.add(i,i,j))}f.normalize(i,i);e[l]=i[0];e[l+1]=i[1];e[l+2]=i[2]}},evaluate_parallel:function(){return!0}});
Xflow.registerOperator("xflow.skinPosition",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"pos"},{type:"int4",source:"boneIdx"},{type:"float4",source:"boneWeight"},{type:"float4x4",source:"boneXform",array:!0}],evaluate:function(e,c,b,a,d,g){for(var f=XML3D.math.vec3,h=XML3D.math.mat4,i=f.create(),j=f.create(),k=0;k<g.iterateCount;++k){for(var l=3*k,m=i[0]=i[1]=i[2]=0;4>m;m++){var o=a[g.iterFlag[2]?4*k+m:m];o&&(h.multiplyOffsetVec3(d,16*b[g.iterFlag[1]?4*k+m:m],c,l,j),f.scale(j,
j,o),f.add(i,i,j))}e[l]=i[0];e[l+1]=i[1];e[l+2]=i[2]}},evaluate_parallel:function(){return!0}});
Xflow.registerOperator("xflow.forwardKinematics",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"parent",array:!0},{type:"float4x4",source:"xform",array:!0}],alloc:function(e,c,b){c=Math.min(c.length,b.length/16);e.result=c},evaluate:function(e,c,b){for(var a=e.length/16,d=[],g=0;g<a;){if(!d[g]){var f=c[g];if(0<=f)if(d[f])XML3D.math.mat4.multiplyOffset(e,16*g,b,16*g,e,16*f);else{for(;0<=c[f]&&!d[c[f]];)f=c[f];if(0<=c[f])XML3D.math.mat4.multiplyOffset(e,16*f,b,
16*f,e,16*c[f]);else for(var h=0;16>h;h++)e[16*f+h]=b[16*f+h];d[f]=!0;continue}else for(h=0;16>h;h++)e[16*g+h]=b[16*g+h];d[g]=!0}g++}},evaluate_parallel:function(){return!0}});
Xflow.registerOperator("xflow.forwardKinematicsInv",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"parent",array:!0},{type:"float4x4",source:"xform",array:!0}],alloc:function(e,c,b){c=Math.min(c.length,b.length/16);e.result=c},evaluate:function(e,c,b){for(var a=b.length/16,d=[],g=0;g<a;){if(!d[g]){var f=c[g];if(0<=f)if(d[f])XML3D.math.mat4.multiplyOffset(e,16*g,e,16*f,b,16*g);else{for(;0<=c[f]&&!d[c[f]];)f=c[f];if(0<=c[f])XML3D.math.mat4.multiplyOffset(e,16*
f,e,16*c[f],b,16*f);else for(var h=0;16>h;h++)e[16*f+h]=b[16*f+h];d[f]=!0;continue}else for(h=0;16>h;h++)e[16*g+h]=b[16*g+h];d[g]=!0}g++}}});Xflow.registerOperator("xflow.flipNormal",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"}],evaluate:function(e,c,b){for(var a=0;a<3*b.iterateCount;a++)e[a]=-c[a]}});
Xflow.registerOperator("xflow.createIGIndex",{outputs:[{type:"float2",name:"texcoord",customAlloc:!0}],params:[{type:"int",source:"vertexCount",optional:!1},{type:"texture",source:"positionTex",optional:!1}],alloc:function(e,c,b){e.texcoord=b.width*b.height},evaluate:function(e,c,b){for(var c=0.5/b.width,a=0.5/b.height,d=0,g=0,f=b.height;g<f;g++)for(var h=0,i=b.width;h<i;h++)e[d++]=h/i+c,e[d++]=1-(g/f+a);return!0}});
XML3D.math.vec3.reciprocal=function(e,c){c||(c=e);c[0]=1/e[0];c[1]=1/e[1];c[2]=1/e[2];return c};XML3D.math.mat4.multiplyOffsetVec3=function(e,c,b,a,d){d||(d=b);a||(a=0);var g=b[a+0],f=b[a+1],b=b[a+2];d[0]=e[c+0]*g+e[c+4]*f+e[c+8]*b+e[c+12];d[1]=e[c+1]*g+e[c+5]*f+e[c+9]*b+e[c+13];d[2]=e[c+2]*g+e[c+6]*f+e[c+10]*b+e[c+14];return d};
XML3D.math.mat4.multiplyOffsetDirection=function(e,c,b,a,d){d||(d=b);a||(a=0);var g=b[a+0],f=b[a+1],b=b[a+2];d[0]=e[c+0]*g+e[c+4]*f+e[c+8]*b;d[1]=e[c+1]*g+e[c+5]*f+e[c+9]*b;d[2]=e[c+2]*g+e[c+6]*f+e[c+10]*b;return d};var IDENT_MAT=XML3D.math.mat4.identity(XML3D.math.mat4.create()),TMP_MATRIX=XML3D.math.mat4.create(),TMP_VEC=XML3D.math.vec3.create();
XML3D.math.mat4.makeTransformXflow=function(e,c,b,a,d,g){XML3D.math.mat4.identity(g);e&&XML3D.math.mat4.translate(g,g,e);a&&XML3D.math.mat4.translate(g,g,a);c&&(XML3D.math.mat4.fromRotationTranslation(TMP_MATRIX,[c[0],c[1],c[2],c[3]],[0,0,0]),XML3D.math.mat4.multiply(g,g,TMP_MATRIX));d&&(XML3D.math.mat4.fromRotationTranslation(TMP_MATRIX,[d[0],d[1],d[2],d[3]],[0,0,0]),XML3D.math.mat4.multiply(g,g,TMP_MATRIX));b&&XML3D.math.mat4.scale(g,g,b);d&&(XML3D.math.mat4.fromRotationTranslation(TMP_MATRIX,[d[0],
d[1],d[2],-d[3]],[0,0,0]),XML3D.math.mat4.multiply(g,g,TMP_MATRIX));a&&XML3D.math.mat4.translate(g,g,XML3D.math.vec3.negate(TMP_VEC,a))};
XML3D.math.mat4.makeTransformInvXflow=function(e,c,b,a,d,g){XML3D.math.mat4.identity(g);a&&XML3D.math.mat4.translate(g,g,a);d&&(XML3D.math.mat4.fromRotationTranslation(TMP_MATRIX,[d[0],d[1],d[2],d[3]],[0,0,0]),XML3D.math.mat4.multiply(g,g,TMP_MATRIX));b&&XML3D.math.mat4.scale(g,g,XML3D.math.vec3.reciprocal(b,TMP_VEC));d&&(XML3D.math.mat4.fromRotationTranslation(TMP_MATRIX,[d[0],d[1],d[2],-d[3]],[0,0,0]),XML3D.math.mat4.multiply(g,g,TMP_MATRIX));c&&(XML3D.math.mat4.fromRotationTranslation(TMP_MATRIX,
[c[0],c[1],c[2],-c[3]],[0,0,0]),XML3D.math.mat4.multiply(g,g,TMP_MATRIX));a&&XML3D.math.mat4.translate(g,g,XML3D.math.vec3.negate(TMP_VEC,a));e&&XML3D.math.mat4.translate(g,g,XML3D.math.vec3.negate(TMP_VEC,e))};
XML3D.math.mat4.multiplyOffset=function(e,c,b,a,d,g){var f=d[g+0],h=d[g+1],i=d[g+2],j=d[g+3],k=d[g+4],l=d[g+5],m=d[g+6],o=d[g+7],n=d[g+8],p=d[g+9],q=d[g+10],r=d[g+11],v=d[g+12],t=d[g+13],y=d[g+14],d=d[g+15],g=b[a+0],w=b[a+1],s=b[a+2],D=b[a+3],u=b[a+4],x=b[a+5],z=b[a+6],A=b[a+7],B=b[a+8],C=b[a+9],E=b[a+10],H=b[a+11],F=b[a+12],G=b[a+13],I=b[a+14],b=b[a+15];e[c+0]=g*f+w*k+s*n+D*v;e[c+1]=g*h+w*l+s*p+D*t;e[c+2]=g*i+w*m+s*q+D*y;e[c+3]=g*j+w*o+s*r+D*d;e[c+4]=u*f+x*k+z*n+A*v;e[c+5]=u*h+x*l+z*p+A*t;e[c+6]=
u*i+x*m+z*q+A*y;e[c+7]=u*j+x*o+z*r+A*d;e[c+8]=B*f+C*k+E*n+H*v;e[c+9]=B*h+C*l+E*p+H*t;e[c+10]=B*i+C*m+E*q+H*y;e[c+11]=B*j+C*o+E*r+H*d;e[c+12]=F*f+G*k+I*n+b*v;e[c+13]=F*h+G*l+I*p+b*t;e[c+14]=F*i+G*m+I*q+b*y;e[c+15]=F*j+G*o+I*r+b*d};
XML3D.math.quat.slerpOffset=function(e,c,b,a,d,g,f,h){g||(g=e);var i=c+1,j=c+2,k=c+3,l=a+1,m=a+2,o=a+3,n=f+1,p=f+2,q=f+3,r=e[c]*b[a]+e[i]*b[l]+e[j]*b[m]+e[k]*b[o],v;if(0.01>1-Math.abs(r))v=1-d;else{var t=Math.acos(Math.abs(r)),y=Math.sin(t);v=Math.sin(t*(1-d))/y;d=Math.sin(t*d)/y}h&&0>r&&(v=-v);g[f]=v*e[c]+d*b[a];g[n]=v*e[i]+d*b[l];g[p]=v*e[j]+d*b[m];g[q]=v*e[k]+d*b[o]};
Xflow.registerOperator("xflow.noiseImage",{outputs:[{type:"texture",name:"image",customAlloc:!0}],params:[{type:"int",source:"width"},{type:"int",source:"height"},{type:"float2",source:"scale"},{type:"float",source:"minFreq"},{type:"float",source:"maxFreq"}],alloc:function(e,c,b){var a=new Xflow.SamplerConfig;a.setDefaults();e.image={imageFormat:{width:c[0],height:b[0]},samplerConfig:a}},evaluate:function(e,c,b,a,d,g){for(var c=c[0],b=b[0],d=d[0],g=g[0],e=e.data,f=this.noise=this.noise||new SimplexNoise,
h=0!=d&&0!=g&&d<g,i=0;i<b;++i)for(var j=i/b*a[1],k=1/c,l=0;l<c;++l){var m=l*k*a[0],o;if(h){o=g;for(var n=j,p=0,q=d;q<o;q*=2)p+=Math.abs(f.noise(m*q,n*q))/q;o=p}else o=f.noise(m,j);m=4*(l*c+i);e[m]=Math.floor(255*o);e[m+1]=Math.floor(255*o);e[m+2]=Math.floor(255*o);e[m+3]=255}return!0}});
(function(){Xflow.Filters={};var e=null,c=null;Xflow.Filters.createImageData=function(b,a){e||(e=document.createElement("canvas"));c||(c=e.getContext("2d"));return c.createImageData(b,a)};Xflow.Filters.createImageDataFloat32=function(b,a){return{width:b,height:a,data:new Float32Array(4*b*a)}};Xflow.Filters.grayscale=function(b,a){for(var d=b.data,c=a.data,e=0;e<d.length;e+=4){var h=d[e+3];c[e]=c[e+1]=c[e+2]=0.2126*d[e]+0.7152*d[e+1]+0.0722*d[e+2];c[e+3]=h}return b};Xflow.Filters.convolute=function(b,
a,d,c){for(var e=Math.round(Math.sqrt(d.length)),h=Math.floor(e/2),i=b.data,j=b.width,b=b.height,k=a.data,c=c?1:0,l=0;l<b;l++)for(var m=0;m<j;m++){for(var o=l,n=m,p=4*(l*j+m),q=0,r=0,v=0,t=0,y=0;y<e;y++)for(var w=0;w<e;w++){var s=o+y-h,D=n+w-h;0<=s&&s<b&&0<=D&&D<j&&(s=4*(s*j+D),D=d[y*e+w],q+=i[s]*D,r+=i[s+1]*D,v+=i[s+2]*D,t+=i[s+3]*D)}k[p]=q;k[p+1]=r;k[p+2]=v;k[p+3]=t+c*(255-t)}return a}})();
function float4(e,c,b,a){var d=new Float32Array(4);switch(arguments.length){case 0:d[0]=0;d[1]=0;d[2]=0;d[3]=0;break;case 1:d[0]=e;d[1]=e;d[2]=e;d[3]=e;break;case 2:d[0]=e;d[1]=c;d[2]=0;d[3]=0;break;case 3:d[0]=e;d[1]=c;d[2]=b;d[3]=0;break;default:d[0]=e,d[1]=c,d[2]=b,d[3]=a}return d}function hypot(e,c){return Math.sqrt(e*e+c*c)}function hypot4(e,c){return float4(hypot(e[0],c[0]),hypot(e[1],c[1]),hypot(e[2],c[2]),hypot(e[3],c[3]))}
function hypot4To(e,c,b){e[0]=hypot(c[0],b[0]);e[1]=hypot(c[1],b[1]);e[2]=hypot(c[2],b[2]);e[3]=hypot(c[3],b[3])}function getTexel2D(e,c,b){c=4*(b*e.width+c);e=e.data;b=new Float32Array(4);b[0]=e[c]/255;b[1]=e[c+1]/255;b[2]=e[c+2]/255;b[3]=e[c+3]/255;return b}function getTexel2DTo(e,c,b,a){b=4*(a*c.width+b);c=c.data;e[0]=c[b]/255;e[1]=c[b+1]/255;e[2]=c[b+2]/255;e[3]=c[b+3]/255;return e}
function setTexel2D(e,c,b,a){c=4*(b*e.width+c);e=e.data;e[c]=255*a[0];e[c+1]=255*a[1];e[c+2]=255*a[2];e[c+3]=255*a[3]}
Xflow.registerOperator("xflow.sobelImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(e,c){for(var b=c.width,a=c.height,d=float4(0),g=float4(0),f=float4(),f=float4(),h=float4(),i=float4(),j=float4(),k=float4(),l=float4(),m=float4(),o=float4(),n=float4(),p=float4(),q=0;q<a;++q)for(var r=0;r<b;++r)1<=r&&r<b-1&&1<=q&&q<a-1&&(getTexel2DTo(f,c,r-1,q-1),getTexel2DTo(h,c,r,q-1),getTexel2DTo(i,c,r+1,q-1),getTexel2DTo(j,c,r-1,q),getTexel2DTo(k,
c,r,q),getTexel2DTo(l,c,r+1,q),getTexel2DTo(m,c,r-1,q+1),getTexel2DTo(o,c,r,q+1),getTexel2DTo(n,c,r+1,q+1),d[0]=f[0]+2*h[0]+i[0]-m[0]-2*o[0]-n[0],d[1]=f[1]+2*h[1]+i[1]-m[1]-2*o[1]-n[1],d[2]=f[2]+2*h[2]+i[2]-m[2]-2*o[2]-n[2],g[0]=f[0]-i[0]+2*j[0]-2*l[0]+m[0]-n[0],g[1]=f[1]-i[1]+2*j[1]-2*l[1]+m[1]-n[1],g[2]=f[2]-i[2]+2*j[2]-2*l[2]+m[2]-n[2],hypot4To(p,d,g),p[0]/=2,p[1]/=2,p[2]/=2,p[3]=1,setTexel2D(e,r,q,p));return!0}});
Xflow.registerOperator("xflow.grayscaleImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(e,c){for(var b=c.data,a=e.data,d=0;d<b.length;d+=4){var g=b[d+3];a[d]=a[d+1]=a[d+2]=0.2126*b[d]+0.7152*b[d+1]+0.0722*b[d+2];a[d+3]=g}return!0}});
Xflow.registerOperator("xflow.sepiaImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(e,c){for(var b=c.data,a=e.data,d=0,g=0,f=0,h=0;h<b.length;h+=4)d=0.393*b[h]+0.769*b[h+1]+0.189*b[h+2],g=0.349*b[h]+0.686*b[h+1]+0.168*b[h+2],f=0.272*b[h]+0.534*b[h+1]+0.131*b[h+2],255<d&&(d=255),255<g&&(g=255),255<f&&(f=255),0>d&&(d=0),0>g&&(g=0),0>f&&(f=0),a[h]=d,a[h+1]=g,a[h+2]=f,a[h+3]=255;return!0},evaluate_parallel:function(e,c){var b=e[0],
a=e[1],d=0.393*c[b][a][0]+0.769*c[b][a][1]+0.189*c[b][a][2],g=0.349*c[b][a][0]+0.686*c[b][a][1]+0.168*c[b][a][2],b=0.272*c[b][a][0]+0.534*c[b][a][1]+0.131*c[b][a][2];255<d&&(d=255);255<g&&(g=255);255<b&&(b=255);0>d&&(d=0);0>g&&(g=0);0>b&&(b=0);return[d,g,b,255]}});
Xflow.registerOperator("xflow.clampImage",{outputs:[{type:"texture",name:"result",sizeof:"image",formatType:"ImageData"}],params:[{type:"texture",source:"image"},{type:"float",source:"min"},{type:"float",source:"max"}],evaluate:function(e,c,b,a){for(var d=c.data,e=e.data,b=b[0],a=a[0],c=c.data.length,g=0;g<c;g++){var f=d[g];f<b&&(f=b);f>a&&(f=a);e[g]=f}return!0}});
(function(){function e(c,b,a,d){for(var e=Math.round(Math.sqrt(a.length)),f=Math.floor(e/2),h=c.data,i=c.width,c=c.height,j=b.data,d=d?1:0,k=0;k<c;k++)for(var l=0;l<i;l++){for(var m=k,o=l,n=4*(k*i+l),p=0,q=0,r=0,v=0,t=0;t<e;t++)for(var y=0;y<e;y++){var w=m+t-f,s=o+y-f;0<=w&&w<c&&0<=s&&s<i&&(w=4*(w*i+s),s=a[t*e+y],p+=h[w]*s,q+=h[w+1]*s,r+=h[w+2]*s,v+=h[w+3]*s)}j[n]=p;j[n+1]=q;j[n+2]=r;j[n+3]=v+d*(255-v)}return b}Xflow.registerOperator("xflow.convoluteImage",{outputs:[{type:"texture",name:"result",
sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"kernel"}],evaluate:function(c,b,a){e(b,c,a,!0);return!0}});Xflow.registerOperator("xflow.convoluteImageToFloat",{outputs:[{type:"texture",name:"result",sizeof:"image",formatType:"float32"}],params:[{type:"texture",source:"image"},{type:"float",source:"kernel"}],evaluate:function(c,b,a){e(b,c,a,!0);return!0}})})();
Xflow.registerOperator("xflow.funMirrorImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"time"}],evaluate:function(e,c,b){for(var a=e.width,d=e.height,b=b[0],c=c.data,e=e.data,g=0;g<d;++g)for(var f=0;f<a;++f){var h=f/a,i=g/d,h=2*h-1,j=2*i-1,i=Math.sqrt(h*h+j*j),j=Math.atan2(j,h),i=Math.pow(i,1/1.8)*b,h=i*Math.cos(j),j=i*Math.sin(j),h=h/2+0.5,i=j/2+0.5,h=Math.round(h*a),h=4*(Math.round(i*d)*a+h),i=c[h],j=c[h+1],k=c[h+2],l=
c[h+3],h=4*(g*a+f);e[h]=i;e[h+1]=j;e[h+2]=k;e[h+3]=l}return!0}});Xflow.registerOperator("xflow.popartImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"time"}],evaluate:function(e,c){for(var b=c.data,a=e.data,d=0;d<b.length;d+=4){var g=0.3*(b[d]/255)+0.59*(b[d+1]/255)+0.11*(b[d+2]/255),g=0.3>g?0:0.6>g?0.5:1;0.5==g?(a[d]=204,a[d+1]=0):1==g?(a[d]=229.5,a[d+1]=229.5):(a[d]=0,a[d+1]=0);a[d+2]=0;a[d+3]=b[d+3]}return!0}});
Xflow.registerOperator("xflow.magnitudeImage",{outputs:[{type:"texture",name:"result",sizeof:"image1"}],params:[{type:"texture",source:"image1"},{type:"texture",source:"image2"}],evaluate:function(e,c,b){for(var c=c.data,b=b.data,e=e.data,a=c.length,d=0;d<a;d+=1){var g=c[d],f=b[d];e[d]=Math.sqrt(g*g+f*f)}return!0}});
Xflow.registerOperator("xflow.flipVerticalImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(e,c){for(var b=c.width,a=c.height,d=e.data,g=c.data,f=0;f<a;++f)for(var h=0;h<b;++h){var i=f*b,j=4*(i+h),i=4*(i+(b-1-h));d[i]=g[j];d[i+1]=g[j+1];d[i+2]=g[j+2];d[i+3]=g[j+3]}return!0}});
Xflow.registerOperator("xflow.selectTransform",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"index"},{type:"float4x4",source:"transform"}],alloc:function(e){e.result=1},evaluate:function(e,c,b){c=16*c[0];c<b.length&&c+15<b.length?(e[0]=b[c+0],e[1]=b[c+1],e[2]=b[c+2],e[3]=b[c+3],e[4]=b[c+4],e[5]=b[c+5],e[6]=b[c+6],e[7]=b[c+7],e[8]=b[c+8],e[9]=b[c+9],e[10]=b[c+10],e[11]=b[c+11],e[12]=b[c+12],e[13]=b[c+13],e[14]=b[c+14],e[15]=b[c+15]):(e[0]=1,e[1]=0,e[2]=0,e[3]=
0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1)}});Xflow.registerOperator("xflow.selectBool",{outputs:[{type:"bool",name:"result",customAlloc:!0}],params:[{type:"int",source:"index"},{type:"bool",source:"value"}],alloc:function(e){e.result=1},evaluate:function(e,c,b){c=c[0];e[0]=c<b.length?b[c]:!1}});
(function(){var e=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[-1,-1,-1],[1,-1,-1],[-1,-1,1],[1,-1,1],[1,-1,-1],[1,1,-1],[1,-1,1],[1,1,1],[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],c=[[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],b=[[0,1,2,1,2,3],[4,5,6,5,6,7],[8,9,10,9,10,11],
[12,13,14,13,14,15],[16,17,18,17,18,19],[20,21,22,21,22,23]];Xflow.registerOperator("xflow.debug.createSkinCubes",{outputs:[{type:"int",name:"index",customAlloc:!0},{type:"float3",name:"position",customAlloc:!0},{type:"float3",name:"normal",customAlloc:!0},{type:"int4",name:"boneIndices",customAlloc:!0},{type:"float4",name:"boneWeights",customAlloc:!0}],params:[{type:"float4x4",source:"bindTransforms",array:!0},{type:"float",source:"size",array:!0,optional:!0}],alloc:function(a,b){var c=b.length/
16;a.position=24*c;a.normal=24*c;a.boneIndices=24*c;a.boneWeights=24*c;a.index=36*c},evaluate:function(a,d,g,f,h,i,j){for(var k=i.length/16,j=(j&&j[0]||1)/2,l=XML3D.math.vec3.create(),m=XML3D.math.vec3.create(),o=0;o<k;++o)for(var n=0;6>n;++n){for(var p=0;4>p;p++){var q=4*n+p,r=24*o+q;XML3D.math.vec3.copy(l,e[q]);XML3D.math.vec3.scale(l,l,j);XML3D.math.mat4.multiplyOffsetVec3(i,16*o,l,0);XML3D.math.vec3.copy(m,c[q]);XML3D.math.mat4.multiplyOffsetDirection(i,16*o,m,0);d[3*r+0]=l[0];d[3*r+1]=l[1];d[3*
r+2]=l[2];g[3*r+0]=m[0];g[3*r+1]=m[1];g[3*r+2]=m[2];f[4*r+0]=o;f[4*r+1]=f[4*r+2]=f[4*r+3]=0;h[4*r+0]=1;h[4*r+1]=h[4*r+2]=h[4*r+3]=0}q=36*o+6*n;for(p=0;6>p;++p)a[q+p]=24*o+b[n][p]}}})})();
Xflow.registerOperator("xflow.rgbePNGtoFloat",{outputs:[{type:"texture",name:"result",customAlloc:!0}],params:[{type:"texture",source:"image"}],alloc:function(e,c){var b=new Xflow.SamplerConfig;b.setDefaults();b.minFilter=Xflow.TEX_FILTER_TYPE.NEAREST;b.magFilter=Xflow.TEX_FILTER_TYPE.NEAREST;e.result={imageFormat:{width:c.width,height:c.height,texelType:Xflow.TEXTURE_TYPE.FLOAT,texelFormat:Xflow.TEXTURE_FORMAT.RGB},samplerConfig:b}},evaluate:function(e,c){for(var b=0;b<c.data.length;b+=4){var a=
c.data.subarray(b,b+4),d=0,g=a[3];0<g&&(d=Math.pow(2,g-136));g=new Float32Array(3);g[0]=a[0]*d;g[1]=a[1]*d;g[2]=a[2]*d;e.data.set(g,3*(b/4))}return!0}});(function(){function e(a,b){this.message=a;this.node=b}function c(a){var b;a.srcAsset&&(b=c(a.srcAsset));for(var d=[],g=0;g<a.children.length;++g){var k=a.children[g],l=k.name;if(l&&-1!=d.indexOf(l))throw new e("Two subdata elements with the same name: '"+l+"'",k.refNode);l&&d.push(l)}d=d.slice();b&&Xflow.utils.setAdd(d,b);for(g=0;g<a.children.length;++g)if(b=a.children[g],k=d,b.includes)for(l=0;l<b.includes.length;++l){var m=b.includes[l];if(-1==k.indexOf(m))throw new e("Subdata '"+b.name+"' includes non existing subdata of name '"+
m+"'",b.refNode);}return d}function b(a){a.assetResult&&(a.assetResult=null);for(var b=0;b<a.listener.length;++b)a.listener[b].onAssetChange(this)}function a(a){a.assetParent&&b(a.assetParent)}function d(a,b){if(b.outOfSync){b.accumulatedXflowNode?(b.accumulatedXflowNode.clearChildren(),b.accumulatedXflowNode.setCompute(""),b.accumulatedXflowNode.setFilter(""),b.accumulatedXflowNode.dataflowNode=null,b.accumulatedXflowNode.setLoading(!1)):b.accumulatedXflowNode=XML3D.data.xflowGraph.createDataNode(!1);
for(var c=1==b.postQueue.length?b.accumulatedXflowNode:XML3D.data.xflowGraph.createDataNode(!1),e=0;e<b.includes.length;++e){var g=a.namedEntries[b.includes[e]];d(a,g);c.appendChild(g.accumulatedXflowNode)}for(e=0;e<b.postQueue.length;++e)b.postQueue[e].xflowNode&&c.appendChild(b.postQueue[e].xflowNode);g=null;for(e=0;e<b.postQueue.length;++e){var l=b.postQueue[e];c||(c=e==b.postQueue.length-1?b.accumulatedXflowNode:XML3D.data.xflowGraph.createDataNode(!1));c.setCompute(l.compute);c.setFilter(l.filter);
c.dataflowNode=l.dataflow;c.setLoading(l.dataflowLoading);g&&c.appendChild(g);g=c;c=null}b.outOfSync=!1}}function g(a){this.name=a&&a.name;this.meshType=a&&a.meshType||null;this.includes=a&&a.includes.slice(0)||[];this.postQueue=a&&a.postQueue.slice(0)||[];this.shader=a&&a.shader||null;this.transform=a&&a.transform||null;this.accumulatedXflowNode=null;this.outOfSync=!0;this.refNode=null}XML3D.base.Asset=function(a){this.srcAsset=null;this.children=[];this.assetResult=this.pickFilter=null;this.listener=
[];this.loading=!1;this.refNode=a||null};XML3D.base.Asset.prototype.checkValidity=function(){this.isSubtreeLoading()||c(this)};XML3D.base.Asset.prototype.setLoading=function(a){a!=this.loading&&(this.loading=a,b(this))};XML3D.base.Asset.prototype.isSubtreeLoading=function(){if(this.loading||this.srcAsset&&this.srcAsset.isSubtreeLoading())return!0;for(var a=this.children.length;a--;)if(this.children[a].loading)return!0;return!1};XML3D.base.Asset.prototype.appendChild=function(a){this.children.push(a);
a.assetParent=this;b(this)};XML3D.base.Asset.prototype.setPickFilter=function(a){this.pickFilter=a;b(this)};XML3D.base.Asset.prototype.setSrcAsset=function(a){this.srcAsset&&this.srcAsset.removeChangeListener(this);(this.srcAsset=a)&&this.srcAsset.addChangeListener(this);b(this)};XML3D.base.Asset.prototype.clearChildren=function(){for(var a=this.children.length;a--;)this.children[a].assetParent=null;this.children=[];b(this)};XML3D.base.Asset.prototype.addChangeListener=function(a){Xflow.utils.setAdd(this.listener,
a)};XML3D.base.Asset.prototype.removeChangeListener=function(a){Xflow.utils.setRemove(this.listener,a)};XML3D.base.Asset.prototype.onAssetChange=function(){b(this)};XML3D.base.Asset.prototype.getResult=function(){this.assetResult||(this.assetResult=new XML3D.base.AssetResult(this));return this.assetResult};XML3D.base.SubData=function(a,b,d){this.xflowNodeOut=a;this.xflowNodeIn=b;this.refNode=d||null;this.postFilter=this.postCompute=this.postDataflow=this.name=null;this.includes=[];this.assetParent=
this.meshType=this.transform=this.shader=null;this.loading=!1};XML3D.base.SubData.prototype.setLoading=function(b){b!=this.loading&&(this.loading=b,a(this))};XML3D.base.SubData.prototype.setName=function(b){this.name=b;a(this)};XML3D.base.SubData.prototype.setPostDataflow=function(b){this.postDataflow=b;a(this)};XML3D.base.SubData.prototype.setPostCompute=function(b){this.postCompute=b;a(this)};XML3D.base.SubData.prototype.setPostFilter=function(b){this.postFilter=b;a(this)};XML3D.base.SubData.prototype.setIncludes=
function(b){this.includes=b;a(this)};XML3D.base.SubData.prototype.setShader=function(b){this.shader=b;a(this)};XML3D.base.SubData.prototype.setTransform=function(b){this.transform=b;a(this)};XML3D.base.SubData.prototype.setMeshType=function(b){this.meshType=b;a(this)};XML3D.base.AssetResult=function(a){this.namedEntries={};this.allEntries=[];this.pickFilter=null;var b=a.srcAsset,d=a.children;if(b){for(var b=b.getResult(),a=a.pickFilter,c=b.allEntries.length;c--;){var e=new g(b.allEntries[c]);this.allEntries.push(e);
e.name&&(this.namedEntries[e.name]=e)}if(a&&b.pickFilter){this.pickFilter=[];for(c=a.length;c--;)-1!=b.pickFilter.indexOf(a[c])&&this.pickFilter.push(a[c])}else this.pickFilter=a||b.pickFilter}else this.pickFilter=a.pickFilter;for(b=0;b<d.length;++b)if(a=d[b],(c=a.name)?this.namedEntries[c]?e=this.namedEntries[c]:(e=new g,this.namedEntries[c]=e,this.allEntries.push(e)):(e=new g,this.allEntries.push(e)),e.pushPostEntry(a),e.meshType=a.meshType||e.meshType,a.shader&&(e.shader=a.shader),a.transform)e.transform=
a.transform};XML3D.base.AssetResult.prototype.getMeshDataSets=function(){for(var a=[],b=0;b<this.allEntries.length;++b){var c=this.allEntries[b];if(c.meshType&&(!c.name||!this.pickFilter||-1!=this.pickFilter.indexOf(c.name)))d(this,c),a.push({xflowNode:c.accumulatedXflowNode,type:c.meshType,shader:c.shader,transform:c.transform,refNode:c.refNode})}return a};g.prototype.pushPostEntry=function(a){this.name=a.name;this.postQueue.push({dataflow:a.postDataflow,dataflowLoading:a.loading,compute:a.postCompute,
filter:a.postFilter,xflowNode:a.xflowNodeIn});this.refNode=a.refNode;this.accumulatedXflowNode=a.xflowNodeOut;Xflow.utils.setAdd(this.includes,a.includes)}})();XML3D.data={toString:function(){return"data"}};XML3D.data=XML3D.data||{};
(function(){function e(a){var b=a._children,d;if(b&&0<b.length)for(d=b.length;d--;)b[d]instanceof Xflow.DataNode&&(b[d].setPlatform(a._platform),e(b[d]))}function c(d){var c=d.xflowDataNode;c.setCompute(d.node.getAttribute("compute"));c.computeDataflowUrl?a(d,"dataflow",c.computeDataflowUrl):(d.disconnectAdapterHandle("dataflow"),b(d))}function b(a){var b=!1,d;(d=a.getConnectedAdapterHandle("src"))&&d.status===XML3D.base.AdapterHandle.STATUS.LOADING&&(b=!0);(d=a.getConnectedAdapterHandle("dataflow"))&&
d.status===XML3D.base.AdapterHandle.STATUS.LOADING&&(b=!0);a.xflowDataNode.setLoading(b)}function a(a,b,d){var c=(d=a.getAdapterHandle(d))&&d.status;c===XML3D.base.AdapterHandle.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+d.url+"' for "+b,a.node);a.connectAdapterHandle(b,d);a.connectedAdapterChanged(b,d?d.getAdapter():null,c)}function d(a){var b=a.node.getAttribute("out");b?a.xflowDataNode.setFilter("keep("+b+")"):a.xflowDataNode.setFilter("")}function g(b,c){var e=c.getAttribute("platform");
b.xflowDataNode.clearChildren();b.xflowDataNode.setCompute("");b.clearAdapterHandles();b.dataflowRefs=[];d(b);var g=c.lastElementChild,k=!0,l=null,m=b.xflowDataNode,o,n;do if(o=b.factory.getAdapter(g))if(o.getXflowNode)n=o.getXflowNode(),l?m.insertBefore(n,l):m.appendChild(n),l=n;else if(o.getComputeCode){o=o.getComputeCode().split(";");for(var p=o.length;p--;)if(o[p].trim()&&(k?k=!1:(n=XML3D.data.xflowGraph.createDataNode(),l?m.insertBefore(n,l):m.appendChild(n),m=n,l=null),m.userData=g,m.setPlatform(e),
m.setCompute(o[p].trim()),m.computeDataflowUrl))n=b.dataflowRefs.length,b.dataflowRefs.push(m),a(b,n,m.computeDataflowUrl)}while(g=g.previousElementSibling)}XML3D.data.xflowGraph=new Xflow.Graph;Xflow.setShaderConstant(Xflow.SHADER_CONSTANT_KEY.OBJECT_ID,"objectID");Xflow.setShaderConstant(Xflow.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM,"modelViewProjectionMatrix");Xflow.setShaderConstant(Xflow.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM_NORMAL,"modelViewProjectionNormalMatrix");Xflow.setShaderConstant(Xflow.SHADER_CONSTANT_KEY.VIEW_TRANSFORM,
"modelViewMatrix");Xflow.setShaderConstant(Xflow.SHADER_CONSTANT_KEY.VIEW_TRANSFORM_NORMAL,"modelViewMatrixN");Xflow.setShaderConstant(Xflow.SHADER_CONSTANT_KEY.WORLD_TRANSFORM,"modelMatrix");Xflow.registerErrorCallback(function(a,b){var a="Xflow: "+a,d=b.userData;if(d&&d.ownerDocument)if(d.ownerDocument===document)XML3D.debug.logError(a,d);else if(d.id){var c=new XML3D.URI("#"+d.id),c=c.getAbsoluteURI(d.ownerDocument.documentURI);XML3D.debug.logError(a,"External Node: "+c)}else XML3D.debug.logError(a,
"External Document: "+d.ownerDocument.documentURI);else"string"==typeof d?XML3D.debug.logError(a,d):XML3D.debug.logError(a)});XML3D.data.BaseDataAdapter=function(a,b){XML3D.base.NodeAdapter.call(this,a,b);this.xflowDataNode=null};XML3D.createClass(XML3D.data.BaseDataAdapter,XML3D.base.NodeAdapter);XML3D.data.BaseDataAdapter.prototype.getXflowNode=function(){return this.xflowDataNode};XML3D.data.BaseDataAdapter.prototype.getComputeRequest=function(a,b){return new Xflow.ComputeRequest(this.xflowDataNode,
a,b)};XML3D.data.BaseDataAdapter.prototype.getComputeResult=function(a){return this.xflowDataNode._getResult(Xflow.RESULT_TYPE.COMPUTE,a)};XML3D.data.BaseDataAdapter.prototype.getOutputNames=function(){return this.xflowDataNode.getOutputNames()};XML3D.data.BaseDataAdapter.prototype.getOutputChannelInfo=function(a){return this.xflowDataNode.getOutputChannelInfo(a)};XML3D.data.DataAdapter=function(a,b){XML3D.data.BaseDataAdapter.call(this,a,b);this.xflowDataNode=null};XML3D.createClass(XML3D.data.DataAdapter,
XML3D.data.BaseDataAdapter);XML3D.data.DataAdapter.prototype.init=function(){this.xflowDataNode=XML3D.data.xflowGraph.createDataNode();this.xflowDataNode.userData=this.node;this.xflowDataNode.setPlatform(this.node.getAttribute("platform"));a(this,"src",this.node.getAttribute("src"));this.assetData||(this.xflowDataNode.setFilter(this.node.getAttribute("filter")),c(this));for(var b=this.node.firstElementChild;null!==b;b=b.nextElementSibling){var d=this.factory.getAdapter(b);d&&(this.xflowDataNode.appendChild(d.getXflowNode()),
null!==this.xflowDataNode._platform&&e(this.xflowDataNode))}};XML3D.data.DataAdapter.prototype.notifyChanged=function(b){if(b.type===XML3D.events.ADAPTER_HANDLE_CHANGED)this.connectedAdapterChanged(b.key,b.adapter,b.handleStatus),b.handleStatus===XML3D.base.AdapterHandle.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find <data> element of url '"+b.url+"' for "+b.key,this.node);else if(b.type===XML3D.events.NODE_INSERTED){var d=b.wrapped.target;if(b=this.factory.getAdapter(d)){var b=b.getXflowNode(),
g=null;do d=d.nextSibling;while(d&&!(g=this.factory.getAdapter(d)));g?this.xflowDataNode.insertBefore(b,g.getXflowNode()):this.xflowDataNode.appendChild(b)}}else b.type===XML3D.events.NODE_REMOVED?(b=this.factory.getAdapter(b.wrapped.target))&&this.xflowDataNode.removeChild(b.getXflowNode()):b.type===XML3D.events.VALUE_MODIFIED?(b=b.wrapped.attrName,"filter"===b&&!this.assetData?this.xflowDataNode.setFilter(this.node.getAttribute(b)):"compute"===b&&!this.assetData?c(this):"src"===b?a(this,b,this.node.getAttribute(b)):
"platform"===b&&(b=this.xflowDataNode,b.setPlatform(this.node.getAttribute("platform")),e(b))):b.type===XML3D.events.THIS_REMOVED&&this.clearAdapterHandles()};XML3D.data.DataAdapter.prototype.connectedAdapterChanged=function(a,d){"src"===a&&(this.xflowDataNode.sourceNode=d?d.getXflowNode():null);"dataflow"===a&&(this.xflowDataNode.dataflowNode=d?d.getXflowNode():null);b(this)};XML3D.data.DataAdapter.prototype.toString=function(){return"XML3D.data.DataAdapter"};XML3D.data.DataflowDataAdapter=function(a,
b){XML3D.data.BaseDataAdapter.call(this,a,b);this.xflowDataNode=null};XML3D.createClass(XML3D.data.DataflowDataAdapter,XML3D.data.BaseDataAdapter);XML3D.data.DataflowDataAdapter.prototype.init=function(){this.xflowDataNode=XML3D.data.xflowGraph.createDataNode();this.dataflowRefs=[];g(this,this.node)};XML3D.data.DataflowDataAdapter.prototype.notifyChanged=function(a){switch(a.type){case XML3D.events.ADAPTER_HANDLE_CHANGED:this.connectedAdapterChanged(a.key,a.adapter,a.handleStatus);a.handleStatus===
XML3D.base.AdapterHandle.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find dataflow of url '"+a.url,this.node);break;case XML3D.events.NODE_INSERTED:case XML3D.events.NODE_REMOVED:g(this);break;case XML3D.events.VALUE_MODIFIED:a=a.wrapped.attrName,"out"===a?d(this):"platform"===a&&g(this,this.node)}};XML3D.data.DataflowDataAdapter.prototype.updateXflowNode=function(){g(this,this.node)};XML3D.data.DataflowDataAdapter.prototype.connectedAdapterChanged=function(a,b,d){if(a=this.dataflowRefs[a])a.dataflowNode=
b?b.getXflowNode():null,a.setLoading(d===XML3D.base.AdapterHandle.STATUS.LOADING)};XML3D.data.ComputeDataAdapter=function(a,b){XML3D.base.NodeAdapter.call(this,a,b)};XML3D.createClass(XML3D.data.ComputeDataAdapter,XML3D.base.NodeAdapter);XML3D.data.ComputeDataAdapter.prototype.getComputeCode=function(){return this.node.value};XML3D.data.ComputeDataAdapter.prototype.notifyChanged=function(a){switch(a.type){case XML3D.events.VALUE_MODIFIED:case XML3D.events.NODE_INSERTED:case XML3D.events.NODE_REMOVED:if(a=
this.node.parentNode)(a=this.factory.getAdapter(a))&&a.updateXflowNode()}}})();
(function(){function e(a){a.asset.clearChildren();for(var b=a.node.firstElementChild;null!==b;b=b.nextElementSibling){var d=a.factory.getAdapter(b);d&&d.assetEntry&&a.asset.appendChild(d.assetEntry)}}function c(a,b,d){var c=(d=a.getAdapterHandle(d))&&d.status;c===XML3D.base.AdapterHandle.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+d.url+"' for "+b,a.node);a.connectAdapterHandle(b,d);a.connectedAdapterChanged(b,d?d.getAdapter():null,c)}function b(a){if(a.node.hasAttribute("pick")){var b=
a.node.getAttribute("pick");a.asset.setPickFilter(b.split(/\s+/))}else a.asset.setPickFilter(null)}function a(a){var b=a.node.getAttribute("compute"),e=Xflow.getComputeDataflowUrl(b);e?c(a,"postDataflow",e):(a.disconnectAdapterHandle("postDataflow"),d(a));a.assetEntry.setPostCompute(b)}function d(a){var b=!1,d;(d=a.getConnectedAdapterHandle("postDataflow"))&&d.status===XML3D.base.AdapterHandle.STATUS.LOADING&&(b=!0);a.assetEntry.setLoading(b)}function g(a){var b=a.node,d=b.getAttribute("shader");
d?(b=XML3D.base.resourceManager.getAbsoluteURI(b.ownerDocument,d),a.assetEntry.setShader(b.toString())):a.assetEntry.setShader(null)}XML3D.data.AssetAdapter=function(a,b){XML3D.base.NodeAdapter.call(this,a,b);this.asset=null};XML3D.createClass(XML3D.data.AssetAdapter,XML3D.base.NodeAdapter);XML3D.data.AssetAdapter.prototype.init=function(){this.asset=new XML3D.base.Asset(this.node);c(this,"src",this.node.getAttribute("src"));b(this);e(this)};XML3D.data.AssetAdapter.prototype.getAsset=function(){return this.asset};
XML3D.data.AssetAdapter.prototype.connectedAdapterChanged=function(a,b){"src"==a&&this.asset.setSrcAsset(b&&b.getAsset()||null);var d=!1,c;(c=this.getConnectedAdapterHandle("src"))&&c.status===XML3D.base.AdapterHandle.STATUS.LOADING&&(d=!0);this.asset.setLoading(d)};XML3D.data.AssetAdapter.prototype.notifyChanged=function(a){a.type==XML3D.events.ADAPTER_HANDLE_CHANGED?(this.connectedAdapterChanged(a.key,a.adapter),a.handleStatus==XML3D.base.AdapterHandle.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find <asset> element of url '"+
a.url+"' for "+a.key)):a.type==XML3D.events.NODE_INSERTED?e(this):a.type==XML3D.events.NODE_REMOVED?e(this):a.type==XML3D.events.VALUE_MODIFIED?(a=a.wrapped.attrName,"src"==a&&c(this,"src",this.node.getAttribute("src")),"pick"==a&&b(this)):a.type==XML3D.events.THIS_REMOVED&&this.clearAdapterHandles()};XML3D.data.AssetDataAdapter=function(a,b){this.assetData=!0;XML3D.data.DataAdapter.call(this,a,b);this.outputXflowNode=this.assetEntry=null};XML3D.createClass(XML3D.data.AssetDataAdapter,XML3D.data.DataAdapter);
XML3D.data.AssetDataAdapter.prototype.init=function(){XML3D.data.DataAdapter.prototype.init.call(this);this.outputXflowNode=XML3D.data.xflowGraph.createDataNode(!1);this.assetEntry=new XML3D.base.SubData(this.outputXflowNode,this.getXflowNode(),this.node);this.assetEntry.setName(this.node.getAttribute("name"));a(this);this.assetEntry.setPostFilter(this.node.getAttribute("filter"));var b=this.assetEntry,d=this.node.getAttribute("includes");d?b.setIncludes(d.split(/\s+/)):b.setIncludes([])};XML3D.data.AssetDataAdapter.prototype.connectedAdapterChanged=
function(a,b){"postDataflow"==a?(this.assetEntry.setPostDataflow(b&&b.getXflowNode()||null),d(this)):XML3D.data.DataAdapter.prototype.connectedAdapterChanged.call(this,a,b)};XML3D.data.AssetDataAdapter.prototype.notifyChanged=function(b){XML3D.data.DataAdapter.prototype.notifyChanged.call(this,b);if(b.type==XML3D.events.VALUE_MODIFIED)switch(b.wrapped.attrName){case "name":this.assetEntry.setName(this.node.getAttribute("name"));break;case "compute":a(this);break;case "filter":this.assetEntry.setPostFilter(this.node.getAttribute("filter"));
break;case "includes":this.node.getAttribute("includes").setIncludes([])}};XML3D.data.AssetDataAdapter.prototype.onTransformChange=function(a,b){this.assetEntry.setTransform(b)};XML3D.data.AssetMeshAdapter=function(a,b){XML3D.data.AssetDataAdapter.call(this,a,b);this.transformFetcher=new XML3D.data.DOMTransformFetcher(this,"transform","transform")};XML3D.createClass(XML3D.data.AssetMeshAdapter,XML3D.data.AssetDataAdapter);XML3D.data.AssetMeshAdapter.prototype.init=function(){XML3D.data.AssetDataAdapter.prototype.init.call(this);
g(this);this.assetEntry.setMeshType(this.node.getAttribute("type")||"triangles");this.transformFetcher.update()};XML3D.data.AssetMeshAdapter.prototype.notifyChanged=function(a){XML3D.data.AssetDataAdapter.prototype.notifyChanged.call(this,a);if(a.type==XML3D.events.VALUE_MODIFIED)switch(a.wrapped.attrName){case "shader":g(this);break;case "style":case "transform":this.transformFetcher.update();break;case "type":this.assetEntry.setMeshType(this.node.getAttribute("type")||"triangles")}}})();
(function(){var e={};e["float"]=Xflow.DATA_TYPE.FLOAT;e["int"]=Xflow.DATA_TYPE.INT;e["byte"]=Xflow.DATA_TYPE.BYTE;e.ubyte=Xflow.DATA_TYPE.UBYTE;e.bool=Xflow.DATA_TYPE.BOOL;e.float2=Xflow.DATA_TYPE.FLOAT2;e.float3=Xflow.DATA_TYPE.FLOAT3;e.float4=Xflow.DATA_TYPE.FLOAT4;e.int4=Xflow.DATA_TYPE.INT4;e.float4x4=Xflow.DATA_TYPE.FLOAT4X4;XML3D.data.BUFFER_TYPE_TABLE=e;var c=function(b,a){XML3D.data.DataAdapter.call(this,b,a);this.xflowInputNode=null};XML3D.createClass(c,XML3D.base.NodeAdapter);c.prototype.init=
function(){var b=this.node._configured;this.node.textContent==XML3D.scriptValueLabel?b=b.scriptValue:(delete b.scriptValue,b=this.node.value);b=new Xflow.BufferEntry(e[this.node.localName],b);this.xflowInputNode=XML3D.data.xflowGraph.createInputNode();this.xflowInputNode.name=this.node.name;this.xflowInputNode.data=b;this.xflowInputNode.key=this.node.key;this.xflowInputNode.paramName=this.node.param?this.node.name:null};c.prototype.getXflowNode=function(){return this.xflowInputNode};c.prototype.notifyChanged=
function(b){b.type==XML3D.events.VALUE_MODIFIED&&((b=b.wrapped.attrName)?"name"==b?this.xflowInputNode.name=this.node.name:"key"==b?this.xflowInputNode.key=this.node.key:"param"==b&&(this.xflowInputNode.paramName=this.node.param?this.node.name:null):(delete this.node._configured.scriptValue,this.xflowInputNode.data.setValue(this.node.value)))};c.prototype.setScriptValue=function(b){this.xflowInputNode.data.setValue(b)};c.prototype.toString=function(){return"XML3D.data.ValueDataAdapter"};XML3D.data.ValueDataAdapter=
c})();
(function(){var e=function(a){if("clamp"==a)return WebGLRenderingContext.CLAMP_TO_EDGE;if("repeat"==a)return WebGLRenderingContext.REPEAT},c=function(a){if("nearest"==a)return WebGLRenderingContext.NEAREST;if("linear"==a)return WebGLRenderingContext.LINEAR;if("nearest-mipmap-nearest"==a)return WebGLRenderingContext.NEAREST_MIPMAP_NEAREST;if("linear-mipmap-nearest"==a)return WebGLRenderingContext.LINEAR_MIPMAP_NEAREST;if("nearest-mipmap-linear"==a)return WebGLRenderingContext.NEAREST_MIPMAP_LINEAR;if("linear-mipmap-linear"==
a)return WebGLRenderingContext.LINEAR_MIPMAP_LINEAR},b=function(a,b){XML3D.data.DataAdapter.call(this,a,b)};XML3D.createClass(b,XML3D.base.NodeAdapter);b.prototype.init=function(){this.xflowInputNode=this.createXflowNode();this.xflowInputNode.data=this.createTextureEntry()};b.prototype.createTextureEntry=function(){var a=this.node,b=new Xflow.TextureEntry(null),g=b.getSamplerConfig();g.wrapS=e(a.wrapS);g.wrapT=e(a.wrapT);g.minFilter=c(a.filterMin);g.magFilter=c(a.filterMag);g.textureType=Xflow.TEX_TYPE.TEXTURE_2D;
g.generateMipMap=this.shouldGenerateMipMaps(g.minFilter,g.magFilter);(a=this.factory.getAdapter(this.node.firstElementChild,XML3D.data.XML3DDataAdapterFactory.prototype))&&a.setTextureEntry(b);return b};b.prototype.shouldGenerateMipMaps=function(a,b){return a!=WebGLRenderingContext.NEAREST&&a!=WebGLRenderingContext.LINEAR||b!=WebGLRenderingContext.NEAREST&&b!=WebGLRenderingContext.LINEAR};b.prototype.createXflowNode=function(){var a=XML3D.data.xflowGraph.createInputNode();a.name=this.node.name;a.paramName=
this.node.param?this.node.name:null;a.key=this.node.key;return a};b.prototype.setScriptValue=function(){XML3D.debug.logError("Texture currently does not support setScriptValue()")};b.prototype.getOutputs=function(){var a={};a[this.node.name]=this;return a};b.prototype.getValue=function(){return this.value};b.prototype.notifyChanged=function(a){a.type==XML3D.events.VALUE_MODIFIED&&(a=a.wrapped.attrName,"name"==a?this.xflowInputNode.name=this.node.name:"key"==a?this.xflowInputNode.key=this.node.key:
"param"==a&&(this.xflowInputNode.paramName=this.node.param?this.node.name:null))};b.prototype.getXflowNode=function(){return this.xflowInputNode};b.prototype.toString=function(){return"XML3D.data.TextureDataAdapter"};XML3D.data.TextureDataAdapter=b})();
(function(){var e=function(a,b){XML3D.base.NodeAdapter.call(this,a,b);this.needsUpdate=this.isValid=!0};XML3D.createClass(e,XML3D.base.NodeAdapter);var c=e.prototype,b=XML3D.math.mat4.identity(XML3D.math.mat4.create());c.init=function(){this.matrix=XML3D.math.mat4.create();this.transform={translate:XML3D.math.mat4.create(),scale:XML3D.math.mat4.create(),scaleOrientationInv:XML3D.math.mat4.create(),center:XML3D.math.mat4.create(),centerInverse:XML3D.math.mat4.create()};this.needsUpdate=!0};c.updateMatrix=
function(){var a=this.node,d=this.transform,c=a.translation._data,e=a.center._data,h=a.scale._data,i=a.scaleOrientation.toMatrix()._data,a=a.rotation.toMatrix()._data;XML3D.math.mat4.translate(d.translate,b,c);XML3D.math.mat4.translate(d.center,b,e);XML3D.math.mat4.translate(d.centerInverse,b,XML3D.math.vec3.negate(e,e));XML3D.math.mat4.scale(d.scale,b,h);XML3D.math.mat4.invert(d.scaleOrientationInv,i);XML3D.math.mat4.multiply(this.matrix,d.translate,d.center);XML3D.math.mat4.multiply(this.matrix,
this.matrix,a);XML3D.math.mat4.multiply(this.matrix,this.matrix,i);XML3D.math.mat4.multiply(this.matrix,this.matrix,d.scale);XML3D.math.mat4.multiply(this.matrix,this.matrix,d.scaleOrientationInv);XML3D.math.mat4.multiply(this.matrix,this.matrix,d.centerInverse);this.needsUpdate=!1};c.getMatrix=function(){this.needsUpdate&&this.updateMatrix();return this.matrix};c.notifyChanged=function(a){1==a.type?this.needsUpdate=!0:2==a.type&&this.dispose();this.notifyOppositeAdapters()};c.dispose=function(){this.isValid=
!1};XML3D.data.TransformDataAdapter=e;XML3D.data.DOMTransformFetcher=function(a,b,c,e){this.owner=a;this.node=a.node;this.attrName=b;this.dataName=c;this.xflowRequest=this.adapterHandle=null;this.onlyDataTransform=e||!1;this._bindedCallback=this._onChange.bind(this)};XML3D.data.DOMTransformFetcher.prototype.clear=function(){this.xflowRequest&&this.xflowRequest.clear();this.xflowRequest=null;this.adapterHandle&&this.adapterHandle.removeListener(this._bindedCallback)};XML3D.data.DOMTransformFetcher.prototype.update=
function(){var a=this.owner.getAdapterHandle(this.node.getAttribute(this.attrName),XML3D.data,0);a!=this.adapterHandle&&(this.clear(),(this.adapterHandle=a)&&a.addListener(this._bindedCallback));this.updateMatrix()};XML3D.data.DOMTransformFetcher.prototype.updateMatrix=function(){this.owner.onTransformChange(this.attrName,this.getMatrix())};XML3D.data.DOMTransformFetcher.prototype.getMatrix=function(){var a=XML3D.math.mat4.create();return function(){if(!this.onlyDataTransform){var b=XML3D.css.getCSSMatrix(this.node);
if(b)return XML3D.css.convertCssToMat4(b)}var c;if(this.adapterHandle&&(c=this.adapterHandle.getAdapter())){if(c.getXflowNode&&(this.xflowRequest||(this.xflowRequest=new Xflow.ComputeRequest(c.getXflowNode(),[this.dataName],this._bindedCallback)),b=this.xflowRequest.getResult(),b=b.getOutputData(this.dataName)&&b.getOutputData(this.dataName).getValue()))return b;if(c.getMatrix)return c.getMatrix()}return this.onlyDataTransform?null:a}}();XML3D.data.DOMTransformFetcher.prototype._onChange=function(){this.updateMatrix()}})();
(function(){var e=function(a,b){XML3D.data.DataAdapter.call(this,a,b)};XML3D.createClass(e,XML3D.data.DataAdapter);e.prototype.isSinkAdapter=function(){return!0};e.prototype.toString=function(){return"XML3D.data.SinkDataAdapter"};XML3D.data.SinkDataAdapter=e;e=function(a,b){XML3D.base.NodeAdapter.call(this,a,b)};XML3D.createClass(e,XML3D.base.NodeAdapter);XML3D.data.ScriptDataAdapter=e;e.prototype.getScriptType=function(){return this.node.type};e.prototype.getScriptCode=function(){return this.node.value};
e.prototype.notifyChanged=function(a){switch(a.type){case XML3D.events.VALUE_MODIFIED:case XML3D.events.NODE_INSERTED:case XML3D.events.NODE_REMOVED:this.notifyOppositeAdapters()}};e=function(a,b){XML3D.base.NodeAdapter.call(this,a,b);this.image=this.textureEntry=null;b.src&&this.createImageFromURL(b.src)};XML3D.createClass(e,XML3D.base.NodeAdapter);e.prototype.createImageFromURL=function(a){var b=this,a=(new XML3D.URI(a)).getAbsoluteURI(this.node.ownerDocument.documentURI);this.image=XML3D.base.resourceManager.getImage(a,
function(a,c){b.textureEntry&&b.textureEntry.setImage(c)},function(a,b){XML3D.debug.logError("Could not load image URI="+b.src)})};e.prototype.setTextureEntry=function(a){this.textureEntry=a;this.image&&this.textureEntry.setImage(this.image)};e.prototype.notifyChanged=function(a){a.type==XML3D.events.VALUE_MODIFIED&&"src"==a.wrapped.attrName&&this.createImageFromURL(this.node.src)};e.prototype.getValue=function(){return this.image};e.prototype.getOutputs=function(){return{image:this}};e.prototype.resolveScript=
function(){return null};var c=function(a,b){XML3D.data.DataAdapter.call(this,a,b);this.video=this.textureEntry=null;this._ticking=!1;this._boundTick=this._tick.bind(this);b.src&&this.createVideoFromURL(b.src)};XML3D.createClass(c,XML3D.base.NodeAdapter);c.prototype.createVideoFromURL=function(a){var b=this,a=(new XML3D.URI(a)).getAbsoluteURI(this.node.ownerDocument.documentURI);this.video=XML3D.base.resourceManager.getVideo(a,this.node.autoplay,{canplay:function(){XML3D.util.dispatchCustomEvent(b.node,
"canplay",!0,!0,null);b._startVideoRefresh()},ended:function(){XML3D.util.dispatchCustomEvent(b.node,"ended",!0,!0,null)},load:function(){XML3D.util.dispatchEvent(b.node,"load")},error:function(a,c){XML3D.util.dispatchCustomEvent(b.node,"error",!0,!0,null);XML3D.debug.logError("Could not load video URI="+c.src)}});this.textureEntry&&this.textureEntry.setImage(this.video)};c.prototype.play=function(){this.video&&this.video.play()};c.prototype.pause=function(){this.video&&this.video.pause()};c.prototype._startVideoRefresh=
function(){this._ticking||this._tick()};c.prototype._tick=function(){this._ticking=!0;window.requestAnimFrame(this._boundTick,XML3D.webgl.MAXFPS);this.textureEntry&&this.textureEntry.setImage(this.video)};c.prototype.setTextureEntry=function(a){this.textureEntry=a;this.video&&this.textureEntry.setImage(this.video)};c.prototype.notifyChanged=function(a){a.type==XML3D.events.VALUE_MODIFIED&&"src"==a.wrapped.attrName&&this.createVideoFromURL(this.node.src)};c.prototype.getValue=function(){return this.video};
c.prototype.getOutputs=function(){return{video:this}};var b=function(a,b){XML3D.base.NodeAdapter.call(this,a,b);this.image=this.textureEntry=null;this.createImageFromIFrame(b)};XML3D.createClass(b,XML3D.base.NodeAdapter);b.prototype.createImageFromIFrame=function(a){var b=document.createElement("canvas");b.width=a.getAttribute("width");b.height=a.getAttribute("height");b.complete=!1;document.body.appendChild(b);var c=document.createElement("iframe");c.id="newIFrame";c.setAttribute("scrolling","no");
c.width=a.getAttribute("width");c.height=a.getAttribute("height");c.style.position="absolute";c.style.left=-c.width-8+"px";document.body.appendChild(c);c.addEventListener("load",function(){var a={_iframe:c,_canvas:b},i=document.createEvent("CustomEvent");i.initCustomEvent("XML3D_XML3DINIT",!0,!1,a);document.dispatchEvent(i);a._canvas.complete=!0;e.textureEntry&&e.textureEntry.setImage(b)},!0);c.src=a.src;var e=this;this.image=b};b.prototype.setTextureEntry=function(a){this.textureEntry=a;this.image&&
this.textureEntry.setImage(this.image)};XML3D.data.IFrameDataAdapter=b;XML3D.data.ImgDataAdapter=e;XML3D.data.VideoDataAdapter=c})();
(function(){var e=function(){XML3D.base.NodeAdapterFactory.call(this,XML3D.data)};XML3D.createClass(e,XML3D.base.NodeAdapterFactory);var c=e.prototype.aspect=XML3D.data,b={};b.mesh=c.SinkDataAdapter;b.shader=c.SinkDataAdapter;b.lightshader=c.SinkDataAdapter;b["float"]=c.ValueDataAdapter;b.float2=c.ValueDataAdapter;b.float3=c.ValueDataAdapter;b.float4=c.ValueDataAdapter;b.float4x4=c.ValueDataAdapter;b["int"]=c.ValueDataAdapter;b.int4=c.ValueDataAdapter;b.bool=c.ValueDataAdapter;b["byte"]=c.ValueDataAdapter;
b.ubyte=c.ValueDataAdapter;b.img=c.ImgDataAdapter;b.texture=c.TextureDataAdapter;b.data=c.DataAdapter;b.proto=c.DataAdapter;b.dataflow=c.DataflowDataAdapter;b.compute=c.ComputeDataAdapter;b.iframe=c.IFrameDataAdapter;b.video=c.VideoDataAdapter;b.script=c.ScriptDataAdapter;b.transform=c.TransformDataAdapter;b.asset=c.AssetAdapter;b.assetdata=c.AssetDataAdapter;b.assetmesh=c.AssetMeshAdapter;b.model=c.AssetAdapter;e.prototype.createAdapter=function(a){var d=b[a.localName];if(void 0!==d)return new d(this,
a);XML3D.debug.logWarning("Not supported as data element: "+a.localName);return null};XML3D.data.XML3DDataAdapterFactory=e;XML3D.base.xml3dFormatHandler.registerFactoryClass(e)})();
(function(){function e(b,d,c,e,g){g=new a[d](g);d=new Xflow.BufferEntry(XML3D.data.BUFFER_TYPE_TABLE[d],g);g=XML3D.data.xflowGraph.createInputNode();g.data=d;g.name=c;g.key=e;b.appendChild(g)}function c(b,c,g){if(a[g.type])for(var f=0;f<g.seq.length;++f){var l=g.seq[f],m=l.value,o=l.key;if("Object"===Object.prototype.toString.call(m).slice(8,-1)&&m.url){if(!d())throw Error("Big-endian binary data are not supported yet");XML3D.base.resourceManager.loadData(m.url,function(d){var e=g.type,f=o,k=a[e],
d=new k(d,m.byteOffset,m.byteLength/k.BYTES_PER_ELEMENT),e=new Xflow.BufferEntry(XML3D.data.BUFFER_TYPE_TABLE[e],d),d=XML3D.data.xflowGraph.createInputNode();d.data=e;d.name=c;d.key=f;b.appendChild(d)},null)}else e(b,g.type,c,o,m)}}var b=function(){XML3D.base.JSONFormatHandler.call(this)};XML3D.createClass(b,XML3D.base.JSONFormatHandler);b.prototype.isFormatSupported=function(a,b,d){return"application/json"===d&&"xml3d-json"==a.format&&"0.4.0"==a.version};b.prototype.getFormatData=function(a,b,d,
e){try{if("xml3d-json"!=a.format)throw Error("Unknown JSON format: "+a.format);if("0.4.0"!=a.version)throw Error("Unknown JSON version: "+a.version);var g=XML3D.data.xflowGraph.createDataNode();g.userData="External Json";var f=a.data,o;for(o in f)c(g,o,f[o]);e(!0,g)}catch(n){XML3D.debug.logException(n,"Failed to process XML3D json file"),e(!1)}};b=new b;XML3D.base.registerFormat(b);var a={"int":Int32Array,int4:Int32Array,"float":Float32Array,float2:Float32Array,float3:Float32Array,float4:Float32Array,
float4x4:Float32Array,bool:Uint8Array,"byte":Int8Array,ubyte:Uint8Array},d=function(){var a=new ArrayBuffer(4),b=new DataView(a);(new Int32Array(a))[0]=16909060;var d=16909060===b.getInt32(0,!0);return function(){return d}}(),g=function(a){this.xflowDataNode=a};g.prototype.getXflowNode=function(){return this.xflowDataNode};var f=function(){XML3D.base.AdapterFactory.call(this,XML3D.data)};XML3D.createClass(f,XML3D.base.AdapterFactory);f.prototype.aspect=XML3D.data;f.prototype.createAdapter=function(a){return new g(a)};
b.registerFactoryClass(f)})();
(function(){var e={"int":Int32Array,int4:Int32Array,"float":Float32Array,float2:Float32Array,float3:Float32Array,float4:Float32Array,float4x4:Float32Array,bool:Uint8Array,"byte":Int8Array,ubyte:Uint8Array},c=function(a){this.data=a;try{if(!a instanceof ArrayBuffer&&!a instanceof ArrayBufferView)throw Error("Unknown binary type: "+typeof a);var b=XML3D.data.xflowGraph.createDataNode(),c="ubyte",f=null;if(e[c]){var f=new e[c](a),c=XML3D.data.BUFFER_TYPE_TABLE[c],h=new Xflow.BufferEntry(c,f),i=XML3D.data.xflowGraph.createInputNode();
i.data=h;i.name="data";b.appendChild(i)}this.xflowDataNode=b}catch(j){XML3D.debug.logException(j,"Failed to process binary file")}};c.prototype.getXflowNode=function(){return this.xflowDataNode};var b=function(){XML3D.base.AdapterFactory.call(this,XML3D.data,["application/octet-stream","text/plain; charset=x-user-defined"])};XML3D.createClass(b,XML3D.base.AdapterFactory);b.prototype.createAdapter=function(a){return new c(a)};new b})();XML3D.webgl={toString:function(){return"webgl"},supported:function(){var e=document.createElement("canvas");return function(){try{return!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl"))}catch(c){return!1}}}(),MAX_PICK_BUFFER_DIMENSION:512};XML3D.webgl.DataChangeListener=function(e){this.requestRedraw=e.requestRedraw;Xflow.DataChangeNotifier.addListener(this.dataEntryChanged)};
XML3D.webgl.DataChangeListener.prototype.dataEntryChanged=function(e,c){if(e.userData.webglData)for(var b in e.userData.webglData)e.userData.webglData[b].changed=Math.max(e.userData.webglData[b].changed,c)};XML3D.webgl.getXflowEntryWebGlData=function(e,c){if(!e)return null;e.userData.webglData||(e.userData.webglData={});e.userData.webglData[c]||(e.userData.webglData[c]={changed:Xflow.DATA_ENTRY_STATE.CHANGED_NEW});return e.userData.webglData[c]};XML3D.webgl.MAXFPS=30;
(function(){function e(a,d){this.canvas=a;this.xml3dElem=d;this.renderInterface={};this.id=++b;XML3D.webgl.handlers[this.id]=this;this._pickingDisabled=!1;this.lastPickObj=null;this.timeNow=Date.now()/1E3;this.lastKnownDimensions={width:a.width,height:a.height};var c=this.getContextForCanvas(a);c&&this.initialize(c)}var c={alpha:!0,premultipliedAlpha:!1,antialias:!0,stencil:!0,preserveDrawingBuffer:!0};XML3D.webgl.configure=function(a){a instanceof Array||(a=[a]);for(var b in a){var c=XML3D.webgl.createCanvas(a[b],
b),c=new XML3D.webgl.CanvasHandler(c,a[b]);window.requestAnimFrame(c.tick,XML3D.webgl.MAXFPS)}};var b=0;XML3D.webgl.handlers=[];XML3D.webgl.events={available:[]};e.prototype.getContextForCanvas=function(a){try{return a.getContext("experimental-webgl",c)}catch(b){return null}};e.prototype.initialize=function(a){this.registerCanvasListeners();var b=this;this.tick=function(){XML3D.updateXflowObserver();if(b.canvasSizeChanged()||b.renderer.needsRedraw())b.dispatchUpdateEvent(),b.draw();window.requestAnimFrame(b.tick,
XML3D.webgl.MAXFPS)};var a=new XML3D.webgl.GLContext(a,this.id,this.canvas.clientWidth,this.canvas.clientHeight),c=new XML3D.webgl.GLScene(a),e=XML3D.base.xml3dFormatHandler.getFactory(XML3D.webgl,this.id);e.setScene(c);this.renderer=XML3D.webgl.rendererFactory.createRenderer(a,c,this.canvas);this.renderOptions=this.renderer.renderInterface.options;e.setRenderer(this.renderer);e.getAdapter(this.xml3dElem).traverse(function(){});c.rootNode.setVisible(!0)};e.prototype.getPickObjectByPoint=function(a,
b){return!this.renderOptions.pickingEnabled?null:this.renderer.getRenderObjectFromPickingBuffer(a,b)};e.prototype.getWorldSpaceNormalByPoint=function(a,b){return this.renderer.getWorldSpaceNormalByPoint(a,b)};e.prototype.getWorldSpacePositionByPoint=function(a,b){return this.renderer.getWorldSpacePositionByPoint(a,b)};e.prototype.canvasSizeChanged=function(){var a=this.canvas;return a.clientWidth!==this.lastKnownDimensions.width||a.clientHeight!==this.lastKnownDimensions.height?(this.lastKnownDimensions.width=
a.width=a.clientWidth,this.lastKnownDimensions.height=a.height=a.clientHeight,this.renderer.handleResizeEvent(a.width,a.height),this.dispatchResizeEvent(),!0):!1};e.prototype.dispatchUpdateEvent=function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("update",!0,!0,null);this.xml3dElem.dispatchEvent(a)};e.prototype.dispatchResizeEvent=function(){var a={width:this.canvas.width,height:this.canvas.height},b=document.createEvent("CustomEvent");b.initCustomEvent("resize",!0,!0,a);this.xml3dElem.dispatchEvent(b)};
e.prototype.draw=function(){try{var a=Date.now(),b=this.renderer.renderToCanvas(),c=Date.now();this.dispatchFrameDrawnEvent(a,c,b)}catch(e){XML3D.debug.logException(e)}};e.prototype.registerCanvasListeners=function(){var a=this;XML3D.webgl.events.available.forEach(function(b){a.canvas.addEventListener(b,function(d){a[b]&&a[b].call(a,d);d.stopPropagation()})});var b=this.xml3dElem.getAttribute("contextmenu");(!b||"false"==b)&&this.canvas.addEventListener("contextmenu",function(a){XML3D.webgl.stopEvent(a)},
!1)};e.prototype.dispatchFrameDrawnEvent=function(a,b,c){var c=c||{count:{primitives:0,objects:0}},e=document.createEvent("CustomEvent");e.initCustomEvent("framedrawn",!0,!0,{timeStart:a,timeEnd:b,renderTimeInMilliseconds:b-a,count:c.count});this.xml3dElem.dispatchEvent(e)};e.prototype.shutdown=function(){this.renderer&&this.renderer.dispose()};XML3D.webgl.CanvasHandler=e})();
XML3D.webgl.createCanvas=function(e){var c=e.parentNode,b=c.ownerDocument.createElement("div");b.style.display="none";c.insertBefore(b,e);b.appendChild(e);var a=e._configured.canvas;c.insertBefore(a,b);e=a.ownerDocument.defaultView.getComputedStyle(e);if(!a.style.backgroundColor&&(e=e.getPropertyValue("background-color"))&&"transparent"!=e)a.style.backgroundColor=e;a.width=a.clientWidth;a.height=a.clientHeight;return a};
XML3D.webgl.stopEvent=function(e){e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation()};
(function(){var e=XML3D.webgl;"ontouchstart"in window?(e.events.available.push("touchstart","touchmove","touchend","touchcancel"),XML3D.extend(e.CanvasHandler.prototype,{hasTouchEvents:function(){return!0},copyTouchEvent:function(c,b){return this.createTouchEvent(this.copyTouchEventData(c,b))},copyTouchEventData:function(c,b){return{type:b.type||c.type,timeStamp:Date.now(),bubbles:c.bubbles,cancelable:c.cancelable,detail:c.detail,screenX:c.screenX,screenY:c.screenY,pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,
clientY:c.clientY,ctrlKey:c.ctrlKey,altKey:c.altKey,shiftKey:c.shiftKey,metaKey:c.metaKey,scale:c.scale,rotation:c.rotation,view:c.view,touches:c.touches,changedTouches:c.changedTouches,targetTouches:c.targetTouches}},createTouchEvent:function(c){var b;try{b=document.createEvent("TouchEvent")}catch(a){XML3D.debug.logWarning("Create Touch Event failed, creating UI instead"),b=document.createEvent("UIEvent")}b&&b.initTouchEvent&&(0==b.initTouchEvent.length?b.initTouchEvent(c.touches,c.targetTouches,
c.changedTouches,c.type,c.view,c.screenX,c.screenY,c.clientX,c.clientY):12==b.initTouchEvent.length?b.initTouchEvent(c.type,c.bubbles,c.cancelable,c.view,c.detail,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.touches,c.targetTouches,c.changedTouches):b.initTouchEvent(c.type,c.bubbles,c.cancelable,c.view,c.detail,c.screenX,c.screenY,c.pageX,c.pageY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.touches,c.targetTouches,c.changedTouches,c.scale,c.rotation));return b},dispatchTouchEventOnPickedObject:function(c,
b){var b=b||{},a=this.copyTouchEvent(c,b);a.preventDefault=function(){c.preventDefault()};this.xml3dElem.dispatchEvent(a)},touchstart:function(c){this.dispatchTouchEventOnPickedObject(c)},touchend:function(c){this.dispatchTouchEventOnPickedObject(c)},touchmove:function(c){this.dispatchTouchEventOnPickedObject(c)},touchcancel:function(c){this.dispatchTouchEventOnPickedObject(c)}})):XML3D.extend(e.CanvasHandler.prototype,{hasTouchEvents:function(){return!1}})})();
(function(){var e=XML3D.webgl;XML3D.options.register("renderer-mousemove-picking",!0);XML3D.options.register("renderer-movement-aware-click-handler",!1);e.events.available.push("click","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","mousewheel");XML3D.extend(e.CanvasHandler.prototype,{lastMousePosition:{x:0,y:0},dispatchMouseEvent:function(c,b,a){var a=a||{},b=b||this.xml3dElem,d=void 0!==a.x?a.x:c.clientX,e=void 0!==a.y?a.y:c.clientY,c=a.noCopy?c:this.copyMouseEvent(c);this.initExtendedMouseEvent(c,
d,e);b.dispatchEvent(c)},copyMouseEvent:function(c){var b=document.createEvent("MouseEvents");b.initMouseEvent(c.type,c.bubbles,c.cancelable,c.view,c.detail,c.screenX,c.screenY,c.clientX,c.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.button,c.relatedTarget);c.dataTransfer&&(b.data={url:c.dataTransfer.getData("URL"),text:c.dataTransfer.getData("Text")});b.preventDefault=function(){c.preventDefault()};return b},createMouseEvent:function(c,b){var b=b||{},a=document.createEvent("MouseEvents");a.initMouseEvent(c,
void 0!==b.canBubble?b.canBubble:!0,void 0!==b.cancelable?b.cancelable:!0,b.view||window,void 0!=b.detail?b.detail:0,void 0!=b.screenX?b.screenX:0,void 0!=b.screenY?b.screenY:0,void 0!=b.clientX?b.clientX:0,void 0!=b.clientY?b.clientY:0,void 0!=b.ctrl?b.ctrl:!1,void 0!=b.alt?b.alt:!1,void 0!=b.shift?b.shift:!1,void 0!=b.meta?b.meta:!1,void 0!=b.button?b.button:0,b.relatedTarget);return a},initExtendedMouseEvent:function(c,b,a){var d=this;(function(){var e=void 0,f=void 0;c.__defineGetter__("normal",
function(){if(void 0!==f)return f;var c=d.getWorldSpaceNormalByPoint(b,a);return f=c?new window.XML3DVec3(c[0],c[1],c[2]):null});c.__defineGetter__("position",function(){if(!e){var c=d.getWorldSpacePositionByPoint(b,a);e=c?new window.XML3DVec3(c[0],c[1],c[2]):null}return e})})()},setMouseMovePicking:function(){},dispatchMouseEventOnPickedObject:function(c,b){var b=b||{},a=this.getMousePosition(c),d=null;b.omitUpdate||(d=this.getPickObjectByPoint(a.x,a.y));this.dispatchMouseEvent(c,d&&d.node,a)},getMousePosition:function(c){var b=
this.canvas.getBoundingClientRect();return{x:c.clientX-b.left,y:c.clientY-b.top}},mouseup:function(c){this.dispatchMouseEventOnPickedObject(c,{omitUpdate:!this.renderOptions.pickingEnabled})},mousedown:function(c){this.lastMousePosition=this.getMousePosition(c);this.dispatchMouseEventOnPickedObject(c,{omitUpdate:!this.renderOptions.pickingEnabled})},click:function(c){if(!0===XML3D.options.getValue("renderer-movement-aware-click-handler")){var b=this.getMousePosition(c);if(4<Math.abs(b.x-this.lastMousePosition.x)||
4<Math.abs(b.y-this.lastMousePosition.y))return}this.dispatchMouseEventOnPickedObject(c)},dblclick:function(c){this.dispatchMouseEventOnPickedObject(c)},mousemove:function(c){var b=this.getMousePosition(c),a=XML3D.options.getValue("renderer-mousemove-picking");this.dispatchMouseEventOnPickedObject(c,{omitUpdate:!a});if(a&&(a=this.renderer.pickedObject?this.renderer.pickedObject.node:null,a!==this.lastPickObj))this.lastPickObj&&(this.dispatchMouseEvent(this.createMouseEvent("mouseout",{clientX:b.x,
clientY:b.y,button:c.button}),this.lastPickObj),a||this.dispatchMouseEvent(this.createMouseEvent("mouseover",{clientX:b.x,clientY:b.y,button:c.button}),this.xml3dElem)),a&&(this.dispatchMouseEvent(this.createMouseEvent("mouseover",{clientX:b.x,clientY:b.y,button:c.button}),a),this.lastPickObj||this.dispatchMouseEvent(this.createMouseEvent("mouseout",{clientX:b.x,clientY:b.y,button:c.button}),this.xml3dElem)),this.lastPickObj=a},mouseout:function(c){var b=this.getMousePosition(c);this.dispatchMouseEvent(c,
this.lastPickObj,b)},mouseover:function(c){var b=XML3D.options.getValue("renderer-mousemove-picking");this.getMousePosition(c);this.dispatchMouseEventOnPickedObject(c,{omitUpdate:!b})},mousewheel:function(c){this.getMousePosition(c);this.dispatchMouseEventOnPickedObject(c)}})})();
(function(e){function c(b,a,d){var c=XML3D.math.vec3.create();c[0]=d(b[0],a[0]);c[1]=d(b[1],a[1]);c[2]=d(b[2],a[2]);return c}e.calculateBoundingBox=function(b,a){var d=new XML3D.math.bbox.create;if(!b||3>b.length)return d;if(a){var c=3*a[0];d[0]=b[c];d[1]=b[c+1];d[2]=b[c+2];d[3]=b[c];d[4]=b[c+1];d[5]=b[c+2];for(c=1;c<a.length;c++){var e=3*a[c],h=b[e],i=b[e+1],e=b[e+2];h<d[0]&&(d[0]=h);i<d[1]&&(d[1]=i);e<d[2]&&(d[2]=e);h>d[3]&&(d[3]=h);i>d[4]&&(d[4]=i);e>d[5]&&(d[5]=e)}}else{d[0]=b[0];d[1]=b[1];d[2]=
b[2];d[3]=b[0];d[4]=b[1];d[5]=b[2];for(c=3;c<b.length;c+=3)b[c]<d[0]&&(d[0]=b[c]),b[c+1]<d[1]&&(d[1]=b[c+1]),b[c+2]<d[2]&&(d[2]=b[c+2]),b[c]>d[3]&&(d[3]=b[c]),b[c+1]>d[4]&&(d[4]=b[c+1]),b[c+2]>d[5]&&(d[5]=b[c+2])}return d};XML3D.math.mat4.create();XML3D.webgl.splitMesh=function(b,a){var a=3*Math.floor(a/3),d=b.position.data,c=b.index?b.index.data:void 0,e=b.normal?b.normal.data:void 0,h=b.texcoord?b.texcoord.data:void 0,i=b.color?b.color.data:void 0,j=b.position.tupleSize,k=b.texcoord?b.texcoord.tupleSize:
void 0,l=c.length;if(c){for(var m=[],o=Math.ceil(l/a),l=[],n=0;n<o;n++)if(l[n]={},l[n].index=new Uint16Array(a),l[n].index.nextFreeSlot=0,l[n].position=new Float32Array(a*j),e&&(l[n].normal=new Float32Array(a*j)),h&&(l[n].texcoord=new Float32Array(a*k)),i)l[n].color=new Float32Array(3*a);for(n=0;n<c.length;n+=3){var p=!0,o=Math.floor(c[n]/a);l[o].index.nextFreeSlot+3>a&&(p=!1);for(q=1;3>q;q++)if(Math.floor(c[n+q]/a)!=o){p=!1;break}if(p)for(var p=a*o,q=0;3>q;q++){var r=c[n+q],v=r-p,t=l[o];t.index[t.index.nextFreeSlot]=
v;t.index.nextFreeSlot++;for(var y=r*j,w=[],s=0;s<j;s++)w[s]=d[y+s];t.position.set(w,v*j);if(e){w=[];for(s=0;s<j;s++)w[s]=e[y+s];t.normal.set(w,v*j)}r*=k;if(h){w=[];for(s=0;s<k;s++)w[s]=h[r+s];t.texcoord.set(w,v*k)}if(i){w=[];for(s=0;3>s;s++)w[s]=i[y+s];t.color.set(w,3*v)}}else m.push(n)}for(n=o=0;n<m.length;n++){for(;l[o].index.nextFreeSlot+3>a;)if(o++,o>=l.length){l[o]={};l[o].index=new Uint16Array(a);l[o].index.nextFreeSlot=0;l[o].position=new Float32Array(a*j);e&&(l[o].normal=new Float32Array(a*
j));h&&(l[o].texcoord=new Float32Array(a*k));i&&(l[o].color=new Float32Array(3*a));break}for(q=0;3>q;q++){t=l[o];r=c[m[n]+q];v=t.index.nextFreeSlot;t.index[v]=v;t.index.nextFreeSlot++;w=[];for(s=0;s<j;s++)w[s]=d[r*j+s];t.position.set(w,v*j);if(e){w=[];for(s=0;s<j;s++)w[s]=e[r*j+s];t.normal.set(w,v*j)}if(h){w=[];for(s=0;s<k;s++)w[s]=h[r*k+s];t.texcoord.set(w,v*k)}if(i){w=[];for(s=0;s<j;s++)w[s]=i[3*r+s];t.color.set(w,3*v)}}}b.index=[];b.position=[];e&&(b.normal=[]);h&&(b.texcoord=[]);i&&(b.color=[]);
for(n=0;n<l.length;n++)0<l[n].index.nextFreeSlot&&(b.index[n]={data:l[n].index,tupleSize:j},b.position[n]={data:l[n].position,tupleSize:j},e&&(b.normal[n]={data:l[n].normal,tupleSize:j}),h&&(b.texcoord[n]={data:l[n].texcoord,tupleSize:k}),i&&(b.color[n]={data:l[n].color,tupleSize:3}))}};XML3D.webgl.adjustMinMax=function(b,a,d,e){var f=XML3D.math.vec3.create(),h=XML3D.math.vec3.create();XML3D.math.vec3.transformMat4(f,b.min,e);XML3D.math.vec3.transformMat4(h,b.max,e);b=c(f,h,Math.min);f=c(f,h,Math.max);
b[0]<a[0]&&(a[0]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[2]<a[2]&&(a[2]=b[2]);f[0]>d[0]&&(d[0]=f[0]);f[1]>d[1]&&(d[1]=f[1]);f[2]>d[2]&&(d[2]=f[2])};e.convertPageCoords=function(b,a,d){var c;c=b.getBoundingClientRect();var e=document.body,h=document.documentElement,b=c.left+(window.pageXOffset||h.scrollLeft||e.scrollLeft)-(h.clientLeft||e.clientLeft||0);c=Math.round(c.top+(window.pageYOffset||h.scrollTop||e.scrollTop)-(h.clientTop||e.clientTop||0));b=Math.round(b);return{x:a-b,y:d-c}}})(XML3D.webgl);
(function(e){var c=window.WebGLRenderingContext,b=function(a,b){this.context=a;this.scene=b;this.options={pickingEnabled:!0,mouseMovePickingEnabled:!0,glBlendFuncSeparate:[c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA]};this.renderPipeline=null};XML3D.extend(b.prototype,{getRenderPipeline:function(){return this.renderPipeline=this.renderPipeline||new XML3D.webgl.RenderPipeline(this.context)},setRenderPipeline:function(a){this.renderPipeline=a;this.context.requestRedraw("Pipeline changed")},
getRenderOptions:function(){return this.options}});e.RenderInterface=b})(XML3D.webgl);
(function(e){var c=function(){this.pages=[];this.nextOffset=0;this.freeEntries=[];this.addPage()};XML3D.createClass(c,XML3D.util.EventDispatcher,{addPage:function(){this.pages.push(new Float32Array(c.PAGE_SIZE));this.nextOffset=0;XML3D.debug.logInfo("Adding page",this.pages.length,"(",c.PAGE_SIZE*Float32Array.BYTES_PER_ELEMENT*this.pages.length/1024,"kB)")},getPageEntry:function(b){if(!b)throw Error("No size given for page entry");return this.reusePageEntry(b)||this.createPageEntry(b)},reusePageEntry:function(b){return(b=
this.freeEntries[b])&&b.length?b.pop():null},createPageEntry:function(b){if(this.nextOffset+b>c.PAGE_SIZE)return this.addPage(),this.getPageEntry(b);var a=this.pages[this.pages.length-1],d=this.nextOffset;this.nextOffset+=b;return{page:a,offset:d,size:b}},freePageEntry:function(b){var a=this.freeEntries[b.size];a||(a=this.freeEntries[b.size]=[]);a.push(b)}});c.PAGE_SIZE=4096;e.Pager=c})(XML3D.webgl);
(function(){var e=function(c,b,a,d){var d=d||{},e=!1===d.visible?!1:!0;this.scene=b;this.type=c;this.name=d.name||"";this.page=a.page;this.offset=a.offset;this.entrySize=a.size;this.visible=this.localVisible=e;this.transformDirty=!0;this.children=[];this.setParent(d.parent||b.rootNode)};XML3D.extend(e.prototype,{getChildren:function(){return this.children},getParent:function(){return this.parent},setParent:function(c){this.parent=c;this.setLocalVisible(this.localVisible);c&&c.addChild&&c.addChild(this)},
traverse:function(c){c(this);this.children.forEach(function(b){b.traverse(c)})},getWorldMatrix:function(c){this.transformDirty&&(this.parent.getWorldMatrix(c),this.updateWorldMatrix(c));for(var b=this.offset+0,a=0;16>a;a++,b++)c[a]=this.page[b]},setWorldMatrix:function(c){for(var b=this.offset+0,a=0;16>a;a++,b++)this.page[b]=c[a];this.transformDirty=!1;this.setBoundingBoxDirty&&this.setBoundingBoxDirty()},isVisible:function(){return this.visible},setTransformDirty:function(){this.transformDirty=!0},
setLocalVisible:function(c){this.localVisible=c;this.setVisible(this.parent&&this.parent.isVisible()&&c)},setVisible:function(c){var b=c;!1===this.localVisible&&(b=!1);this.visible!=b&&(this.visible=b,this.children.forEach(function(a){a.setVisible(b)}))},remove:function(){this.parent.removeChild(this);this.scene.freePageEntry({page:this.page,offset:this.offset,size:this.entrySize})},findRayIntersections:function(){}});XML3D.webgl.RenderNode=e})();
(function(e){var c=function(b,a,d){XML3D.webgl.RenderNode.call(this,e.Scene.NODE_TYPE.OBJECT,b,a,d);d=d||{};this.node=d.node;this.object=d.object||{data:null,type:"triangles"};this.boundingBoxDirty=this.transformDirty=!0;this.transformDataRequest=this.createTransformRequest();this.drawable=this.createDrawable();this.localShaderHandle=d.shaderHandle||null;this.override=this.shaderHandle=null};c.ENTRY_SIZE=108;c.IDENTITY_MATRIX=XML3D.math.mat4.create();XML3D.createClass(c,XML3D.webgl.RenderNode,{createTransformRequest:function(){return!this.object.data?
null:new Xflow.ComputeRequest(this.object.data,["meshTransform"],this.onTransformDataChange.bind(this))},createDrawable:function(){var b=this.scene.createDrawable(this);if(b){var a=this;b.addEventListener(e.Scene.EVENT_TYPE.DRAWABLE_STATE_CHANGED,function(b){b.newState===e.DrawableClosure.READY_STATE.COMPLETE?a.scene.moveFromQueueToReady(a):b.newState===e.DrawableClosure.READY_STATE.INCOMPLETE&&b.oldState===e.DrawableClosure.READY_STATE.COMPLETE&&a.scene.moveFromReadyToQueue(a)});b.updateTypeRequest();
b.calculateBoundingBox();b.addEventListener(e.Scene.EVENT_TYPE.SCENE_SHAPE_CHANGED,function(){a.scene.dispatchEvent({type:e.Scene.EVENT_TYPE.SCENE_SHAPE_CHANGED})})}return b},setType:function(b){this.object.type=b},getType:function(){return this.object.type},getDataNode:function(){return this.object?this.object.data:null},getLocalMatrix:function(b){for(var a=this.offset+16,d=0;16>d;d++,a++)b[d]=this.page[a]},setLocalMatrix:function(b){for(var a=this.offset+16,d=0;16>d;d++,a++)this.page[a]=b[d];this.setTransformDirty();
this.setBoundingBoxDirty()},dispose:function(){this.transformDataRequest&&this.transformDataRequest.clear();this.scene.remove(this)},onTransformDataChange:function(){this.setTransformDirty()},getModelViewMatrix:function(b){for(var a=this.offset+44,d=0;16>d;d++,a++)b[d]=this.page[a]},getModelMatrixN:function(b){var a=this.offset+76;b[0]=this.page[a];b[1]=this.page[a+1];b[2]=this.page[a+2];b[3]=this.page[a+4];b[4]=this.page[a+5];b[5]=this.page[a+6];b[6]=this.page[a+8];b[7]=this.page[a+9];b[8]=this.page[a+
10]},getModelViewMatrixN:function(b){var a=this.offset+92;b[0]=this.page[a];b[1]=this.page[a+1];b[2]=this.page[a+2];b[3]=this.page[a+4];b[4]=this.page[a+5];b[5]=this.page[a+6];b[6]=this.page[a+8];b[7]=this.page[a+9];b[8]=this.page[a+10]},getModelViewProjectionMatrix:function(b){for(var a=this.offset+60,d=0;16>d;d++,a++)b[d]=this.page[a]},updateWorldSpaceMatrices:function(b,a){this.transformDirty&&this.updateWorldMatrix();this.updateModelViewMatrix(b);this.updateModelMatrixN();this.updateModelViewMatrixN();
this.updateModelViewProjectionMatrix(a)},updateWorldMatrix:function(){var b=XML3D.math.mat4.create();return function(){this.parent.getWorldMatrix(b);XML3D.math.mat4.multiplyOffset(b,0,this.page,this.offset+16,b,0);if(this.transformDataRequest){var a=this.transformDataRequest.getResult().getOutputData("meshTransform");a&&a.getValue()&&XML3D.math.mat4.multiply(b,b,a.getValue())}this.setWorldMatrix(b);this.boundingBoxDirty=!0;this.transformDirty=!1}}(),updateModelViewMatrix:function(b){this.transformDirty&&
this.updateWorldMatrix();var a=this.page,d=this.offset;XML3D.math.mat4.multiplyOffset(a,d+44,a,d+0,b,0)},updateModelMatrixN:function(){var b=XML3D.math.mat4.create();return function(){this.getWorldMatrix(b);for(var a=XML3D.math.mat4.invert(b,b),a=a?XML3D.math.mat4.transpose(a,a):c.IDENTITY_MATRIX,d=this.offset+76,e=0;16>e;e++,d++)this.page[d]=a[e]}}(),updateModelViewMatrixN:function(){var b=XML3D.math.mat4.create();return function(){this.getModelViewMatrix(b);for(var a=XML3D.math.mat4.invert(b,b),
a=a?XML3D.math.mat4.transpose(a,a):c.IDENTITY_MATRIX,d=this.offset+92,e=0;16>e;e++,d++)this.page[d]=a[e]}}(),updateModelViewProjectionMatrix:function(b){var a=this.page,d=this.offset;XML3D.math.mat4.multiplyOffset(a,d+60,a,d+44,b,0)},setTransformDirty:function(){this.transformDirty=!0;this.setBoundingBoxDirty();this.scene.dispatchEvent({type:e.Scene.EVENT_TYPE.SCENE_SHAPE_CHANGED});this.scene.requestRedraw("Transformation changed")},shaderHandleCallback:function(b){XML3D.debug.assert(b.type==XML3D.events.ADAPTER_HANDLE_CHANGED);
this.updateShaderFromHandle(b.adapterHandle)},setLocalShaderHandle:function(b){this.localShaderHandle=b;void 0===b?this.setShader(this.parent.getShaderHandle()):this.setShader(b)},setShader:function(b){if(this.drawable){this.localShaderHandle&&(b=this.localShaderHandle);var a=this.shaderHandle;a!=b&&(this.bindedShaderHandleCallback||(this.bindedShaderHandleCallback=this.shaderHandleCallback.bind(this)),a&&a.removeListener(this.bindedShaderHandleCallback),b&&b.addListener(this.bindedShaderHandleCallback),
this.shaderHandle=b,this.updateShaderFromHandle(b))}},updateShaderFromHandle:function(b){var a=null;if(b)switch(b.status){case XML3D.base.AdapterHandle.STATUS.NOT_FOUND:XML3D.debug.logWarning("Shader not found.",b.url,this.name);break;case XML3D.base.AdapterHandle.STATUS.READY:a=b.getAdapter().getShaderInfo()}this.drawable.setShaderComposer(this.scene.shaderFactory.createComposerForShaderInfo(a))},setObjectSpaceBoundingBox:function(b){var a=this.offset+32;this.page[a]=b[0];this.page[a+1]=b[1];this.page[a+
2]=b[2];this.page[a+3]=b[3];this.page[a+4]=b[4];this.page[a+5]=b[5];this.setBoundingBoxDirty()},getObjectSpaceBoundingBox:function(b){var a=this.offset+32;b[0]=this.page[a];b[1]=this.page[a+1];b[2]=this.page[a+2];b[3]=this.page[a+3];b[4]=this.page[a+4];b[5]=this.page[a+5]},setBoundingBoxDirty:function(){this.boundingBoxDirty=!0;this.parent.setBoundingBoxDirty()},setWorldSpaceBoundingBox:function(b){var a=this.offset+38;this.page[a]=b[0];this.page[a+1]=b[1];this.page[a+2]=b[2];this.page[a+3]=b[3];
this.page[a+4]=b[4];this.page[a+5]=b[5]},getWorldSpaceBoundingBox:function(b){this.boundingBoxDirty&&this.updateWorldSpaceBoundingBox();var a=this.offset+38;b[0]=this.page[a];b[1]=this.page[a+1];b[2]=this.page[a+2];b[3]=this.page[a+3];b[4]=this.page[a+4];b[5]=this.page[a+5]},updateWorldSpaceBoundingBox:function(){var b=new XML3D.math.bbox.create,a=new XML3D.math.mat4.create;return function(){this.getObjectSpaceBoundingBox(b);this.getWorldMatrix(a);XML3D.math.bbox.transform(b,a,b);this.setWorldSpaceBoundingBox(b);
this.boundingBoxDirty=!1}}(),setLocalVisible:function(b){this.localVisible=b;this.setVisible(this.parent&&this.parent.isVisible()&&b);this.setBoundingBoxDirty()},getProgram:function(){return this.drawable.getProgram()},hasTransparency:function(){var b=this.getProgram();return b?b.hasTransparency():!1},updateForRendering:function(){e.SystemNotifier.setNode(this.node);this.setShader(this.parent.getShaderHandle());try{this.drawable&&this.drawable.update(this.scene)}catch(b){XML3D.debug.logError("Mesh Error: "+
b.message,this.node)}e.SystemNotifier.setNode(null)},findRayIntersections:function(){var b=XML3D.math.bbox.create(),a={dist:0};return function(d,c){this.getWorldSpaceBoundingBox(b);XML3D.math.bbox.intersects(b,d,a)&&c.push(this)}}()});e.RenderObject=c})(XML3D.webgl);
(function(e){var c=function(b,a,d){e.RenderNode.call(this,e.Scene.NODE_TYPE.GROUP,b,a,d);d=d||{};this.shaderHandle=d.shaderHandle||null;this.boundingBoxDirty=!1;this.setWorldSpaceBoundingBox(XML3D.math.EMPTY_BOX)};c.ENTRY_SIZE=38;XML3D.createClass(c,e.RenderNode);XML3D.extend(c.prototype,{getLocalMatrix:function(b){for(var a=this.offset+16,d=0;16>d;d++,a++)b[d]=this.page[a]},setLocalMatrix:function(b){for(var a=this.offset+16,d=0;16>d;d++,a++)this.page[a]=b[d];this.setTransformDirty();this.setBoundingBoxDirty()},
getWorldSpaceBoundingBox:function(b){this.boundingBoxDirty&&this.updateWorldSpaceBoundingBox();var a=this.offset+32;b[0]=this.page[a];b[1]=this.page[a+1];b[2]=this.page[a+2];b[3]=this.page[a+3];b[4]=this.page[a+4];b[5]=this.page[a+5]},setWorldSpaceBoundingBox:function(b){var a=this.offset+32;this.page[a]=b[0];this.page[a+1]=b[1];this.page[a+2]=b[2];this.page[a+3]=b[3];this.page[a+4]=b[4];this.page[a+5]=b[5]},updateWorldSpaceBoundingBox:function(){var b=XML3D.math.bbox.create();return function(){for(var a=
XML3D.math.bbox.create(),d=0,c=this.children.length;d<c;d++){var e=this.children[d];e.isVisible()&&(e.getWorldSpaceBoundingBox(b),XML3D.math.bbox.extendWithBox(a,b))}this.setWorldSpaceBoundingBox(a);this.boundingBoxDirty=!1}}(),addChild:function(b){this.children.push(b);this.setBoundingBoxDirty();this.scene.dispatchEvent({type:e.Scene.EVENT_TYPE.SCENE_STRUCTURE_CHANGED,newChild:b})},removeChild:function(b){var a=this.children.indexOf(b);-1!=a&&this.children.splice(a,1);this.scene.dispatchEvent({type:e.Scene.EVENT_TYPE.SCENE_STRUCTURE_CHANGED,
removedChild:b})},getChildren:function(){return this.children},updateWorldMatrix:function(b){var a=this.page,d=this.offset;XML3D.math.mat4.multiplyOffset(a,d+0,a,d+16,b,0);this.transformDirty=!1},setTransformDirty:function(){this.transformDirty=!0;this.children.forEach(function(b){b.setTransformDirty()})},setLocalShaderHandle:function(b){this.shaderHandle=void 0;void 0===b?this.setShader(this.parent.getShaderHandle()):this.setShader(b);this.shaderHandle=b},setShader:function(b){void 0===this.shaderHandle&&
this.children.forEach(function(a){a.setShader&&a.setShader(b)})},getShaderHandle:function(){return!this.shaderHandle?this.parent.getShaderHandle():this.shaderHandle},setBoundingBoxDirty:function(){this.boundingBoxDirty=!0;this.parent&&this.parent.setBoundingBoxDirty()},setLocalVisible:function(b){this.localVisible=b;this.setVisible(this.parent&&this.parent.isVisible()&&b);this.setBoundingBoxDirty()},findRayIntersections:function(){var b=XML3D.math.bbox.create();return function(a,d){this.getWorldSpaceBoundingBox(b);
if(XML3D.math.bbox.intersects(b,a))for(var c=0;c<this.children.length;c++)this.children[c].findRayIntersections(a,d)}}()});e.RenderGroup=c})(XML3D.webgl);
(function(e){var c=XML3D.math.vec3.fromValues(0,0,-1);XML3D.math.vec3.fromValues(0,0,1);var b=XML3D.math.vec3.fromValues(1,1,1),a=XML3D.math.vec3.fromValues(0,0,1),d=Math.PI/4,g="intensity,attenuation,softness,falloffAngle,direction,position,castShadow,shadowBias".split(",");new Float32Array([0.5,0,0,0,0,0.5,0,0,0,0,0.5,0,0.5,0.5,0.5,1]);var f=function(f,i,j){XML3D.webgl.RenderNode.call(this,e.Scene.NODE_TYPE.LIGHT,f,i,j);j=j||{};f=j.light||{};this.light={type:f.type||"directional",data:f.data};this.intensity=
XML3D.math.vec3.clone(b);this.srcPosition=XML3D.math.vec3.fromValues(0,0,0);this.srcDirection=XML3D.math.vec3.clone(c);this.position=XML3D.math.vec3.fromValues(0,0,0);this.direction=XML3D.math.vec3.clone(c);this.attenuation=XML3D.math.vec3.clone(a);this.castShadow=!1;this.fallOffAngle=d;this.userData=null;this.light.data?(this.lightParameterRequest=new Xflow.ComputeRequest(this.light.data,g,this.lightParametersChanged.bind(this)),this.lightParametersChanged(this.lightParameterRequest,null)):XML3D.debug.logWarning("External light shaders not supported yet");
this.localIntensity=void 0!==j.localIntensity?j.localIntensity:1;this.addLightToScene()};f.ENTRY_SIZE=16;XML3D.createClass(f,e.RenderNode);XML3D.extend(f.prototype,{getFrustum:function(a){var b="directional"==this.light.type,d=XML3D.math.mat4.create(),c=new XML3D.math.bbox.create;this.scene.getBoundingBox(c);if(XML3D.math.bbox.isEmpty(c))return new XML3D.webgl.Frustum(1,110,0,2*this.fallOffAngle,a,b);this.getWorldToLightMatrix(d);XML3D.math.bbox.transform(c,d,c);var e=1,d=2;"point"==this.light.type?
(e=1,d=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2]),Math.abs(c[3]),Math.abs(c[4]),Math.abs(c[5]))):(e=-c[5],d=-c[2]);c=Math.max(0.3*(d-e),0.05);return new XML3D.webgl.Frustum(1,d+c,0,2*this.fallOffAngle,a,b)},addLightToScene:function(){var a=this.scene.lights[this.light.type];Array.isArray(a)?(a.push(this),this.lightStructureChanged(!1)):XML3D.debug.logError("Unsupported light shader script: urn:xml3d:lightshader:"+this.light.type)},removeLightFromScene:function(){var a=this.scene.lights[this.light.type];
Array.isArray(a)&&(-1<a.indexOf(this)&&a.splice(a.indexOf(this),1),this.lightStructureChanged(!0))},lightParametersChanged:function(a,b){var d=a.getResult();if(d){var c=d.getOutputData("intensity");c&&XML3D.math.vec3.copy(this.intensity,c.getValue());(c=d.getOutputData("attenuation"))&&XML3D.math.vec3.copy(this.attenuation,c.getValue());(c=d.getOutputData("position"))&&XML3D.math.vec3.copy(this.srcPosition,c.getValue());(c=d.getOutputData("direction"))&&XML3D.math.vec3.copy(this.srcDirection,c.getValue());
this.updateWorldMatrix();if(c=d.getOutputData("castShadow"))this.castShadow=c.getValue()[0];b&&this.lightValueChanged()}},lightValueChanged:function(){this.scene.dispatchEvent({type:e.Scene.EVENT_TYPE.LIGHT_VALUE_CHANGED,light:this})},lightStructureChanged:function(a){this.scene.dispatchEvent({type:e.Scene.EVENT_TYPE.LIGHT_STRUCTURE_CHANGED,light:this,removed:a})},getLightData:function(a,b){var c=3*b;["position","direction","attenuation"].forEach(function(b){a[b]&&(a[b][c+0]=this[b][0],a[b][c+1]=
this[b][1],a[b][c+2]=this[b][2])},this);a.intensity&&(a.intensity[c+0]=this.intensity[0]*this.localIntensity,a.intensity[c+1]=this.intensity[1]*this.localIntensity,a.intensity[c+2]=this.intensity[2]*this.localIntensity);a.on&&(a.on[b]=this.visible);var e=this.light.data?this.lightParameterRequest.getResult():null,g;a.softness&&(g=e?e.getOutputData("softness"):null,a.softness[b]=g?g.getValue()[0]:0);a.falloffAngle&&(g=(g=e?e.getOutputData("falloffAngle"):null)?g.getValue()[0]:d,this.fallOffAngle=a.falloffAngle[b]=
g);if(a.castShadow)if(a.castShadow[b]=this.castShadow){a.shadowBias&&(g=e.getOutputData("shadowBias"),"point"==this.light.type?a.shadowBias[b]=g?g.getValue()[0]:1.0E-4:"spot"==this.light.type?a.shadowBias[b]=g?g.getValue()[0]:0.001:"directional"==this.light.type&&(a.shadowBias[b]=g?g.getValue()[0]:0.0045));if(a.lightMatrix){e=XML3D.math.mat4.create();this.getShadowMapLightMatrix(e);var f=16*b;for(g=0;16>g;g++)a.lightMatrix[f+g]=e[g]}if(a.lightNearFar){e=this.getFrustum(1);e=XML3D.math.vec2.fromValues(e.nearPlane,
e.farPlane);f=2*b;for(g=0;2>g;g++)a.lightNearFar[f+g]=e[g]}}else{a.shadowBias[b]=0;f=16*b;for(g=0;16>g;g++)a.lightMatrix[f+g]=0}},setTransformDirty:function(){this.updateWorldMatrix()},getShadowMapLightMatrix:function(a){var b=XML3D.math.mat4.create();this.getWorldToLightMatrix(b);var d=XML3D.math.mat4.create();this.getFrustum(1).getProjectionMatrix(d);XML3D.math.mat4.multiply(a,d,b)},updateWorldMatrix:function(){var a=XML3D.math.mat4.create();return function(){this.parent&&(this.parent.getWorldMatrix(a),
this.setWorldMatrix(a),this.updateLightTransformData(a))}}(),getWorldToLightMatrix:function(a){this.getWorldMatrix(a);if("directional"==this.light.type){var b=new XML3D.math.bbox.create;this.scene.getBoundingBox(b);var d=XML3D.math.vec3.create(),c=XML3D.math.vec3.create(),e=XML3D.math.vec3.create();XML3D.math.bbox.center(c,b);XML3D.math.bbox.size(d,b);b=XML3D.math.vec3.len(d);XML3D.math.vec3.scale(e,this.direction,-0.55*b);this.position=XML3D.math.vec3.add(this.position,c,e);this.fallOffAngle=1.568}else"spot"!=
this.light.type&&"point"!=this.light.type&&XML3D.debug.logWarning("Light transformation not yet implemented for light type: "+this.light.type);XML3D.math.mat4.identity(a);c=XML3D.math.mat4.create();e=XML3D.math.vec3.fromValues(0,1,0);0==this.direction[0]&&0==this.direction[2]&&(e=XML3D.math.vec3.fromValues(0,0,1));b=XML3D.math.vec3.create();d=XML3D.math.vec3.len(this.direction);XML3D.math.vec3.scale(b,this.direction,-XML3D.math.vec3.dot(e,this.direction)/(d*d));XML3D.math.vec3.add(b,b,e);XML3D.math.vec3.normalize(b,
b);XML3D.math.mat4.lookAt(c,XML3D.math.vec3.fromValues(0,0,0),this.direction,b);XML3D.math.mat4.invert(c,c);XML3D.math.mat4.translate(a,a,this.position);XML3D.math.mat4.multiply(a,a,c);"directional"==this.light.type&&(b=new XML3D.math.bbox.create,this.scene.getBoundingBox(b),XML3D.math.bbox.transform(b,a,b),d=XML3D.math.vec3.create(),XML3D.math.bbox.size(d,b),c=d[0]>d[1]?d[0]:d[1],this.fallOffAngle=Math.atan(0.55*c));XML3D.math.mat4.invert(a,a)},updateLightTransformData:function(a){switch(this.light.type){case "directional":XML3D.math.vec3.copy(this.direction,
this.applyTransformDir(this.srcDirection,a));XML3D.math.vec3.copy(this.position,this.applyTransform(this.srcPosition,a));break;case "spot":XML3D.math.vec3.copy(this.direction,this.applyTransformDir(this.srcDirection,a));XML3D.math.vec3.copy(this.position,this.applyTransform(this.srcPosition,a));break;case "point":XML3D.math.vec3.copy(this.position,this.applyTransform(this.srcPosition,a))}this.lightValueChanged()},applyTransform:function(a,b){var d=XML3D.math.vec4.transformMat4(XML3D.math.vec4.create(),
[a[0],a[1],a[2],1],b);return[d[0]/d[3],d[1]/d[3],d[2]/d[3]]},applyTransformDir:function(a,b){var d=XML3D.math.vec4.transformMat4(XML3D.math.vec4.create(),[a[0],a[1],a[2],0],b);return[d[0],d[1],d[2]]},setVisible:function(a){a=this.localVisible&&a;this.visible!=a&&(this.visible=a,this.lightValueChanged())},setLocalIntensity:function(a){this.localIntensity=a;this.lightValueChanged()},setLightType:function(a){a=a||"directional";a!=this.light.type&&(this.removeLightFromScene(),this.light.type=a,this.addLightToScene())},
remove:function(){this.parent.removeChild(this);this.removeLightFromScene()},getWorldSpaceBoundingBox:function(a){XML3D.math.bbox.empty(a)}});e.RenderLight=f})(XML3D.webgl);
(function(e){var c=0.25*Math.PI,b=function(a,b,g){XML3D.webgl.RenderNode.call(this,e.Scene.NODE_TYPE.VIEW,a,b,g);g=g||{};this.position=g.position||XML3D.math.vec3.create();this.orientation=g.orientation||XML3D.math.mat4.create();this.fieldOfView=void 0!==g.fieldOfView?g.fieldOfView:c;this.worldSpacePosition=XML3D.math.vec3.create();this.projectionOverride=g.projectionOverride;this.projectionDirty=this.viewDirty=!0;this.frustum=new XML3D.webgl.Frustum(1,1E5,0,this.fieldOfView,1);this.lastAspectRatio=
1};b.ENTRY_SIZE=48;XML3D.createClass(b,XML3D.webgl.RenderNode);XML3D.extend(b.prototype,{getFrustum:function(){return this.frustum},updateViewMatrix:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(){XML3D.math.mat4.identity(a);a[12]=this.position[0];a[13]=this.position[1];a[14]=this.position[2];XML3D.math.mat4.multiply(a,a,this.orientation);this.parent.getWorldMatrix(b);XML3D.math.mat4.multiply(a,b,a);XML3D.math.vec3.set(this.worldSpacePosition,a[12],a[13],a[14]);
this.setViewToWorldMatrix(a);XML3D.math.mat4.invert(a,a);this.setWorldToViewMatrix(a);this.viewDirty=!1}}(),updateProjectionMatrix:function(){var a=XML3D.math.mat4.create();return function(b){if(this.projectionOverride)this.setProjectionMatrix(this.projectionOverride),this.frustum.setFrustum(1,1E5,0,this.fieldOfView,1);else{var c=this.getClippingPlanes(),e=c.near,c=c.far,h=this.fieldOfView;XML3D.math.mat4.perspective(a,h,b,e,c);this.setProjectionMatrix(a);this.frustum.setFrustum(e,c,0,h,b);this.lastAspectRatio=
b}}}(),getClippingPlanes:function(){var a=XML3D.math.mat4.create(),b=new XML3D.math.bbox.create;return function(){this.scene.getBoundingBox(b);if(XML3D.math.bbox.isEmpty(b))return{near:1,far:10};this.getWorldToViewMatrix(a);XML3D.math.bbox.transform(b,a,b);var c=-b[5],e=-b[2],h=Math.max(0.005*(e-c),0.05),e=e+h;return{near:Math.max(c-h,h,0.01),far:e}}}(),setMatrix:function(a,b){for(var c=this.offset+b,e=0;16>e;e++,c++)this.page[c]=a[e]},setWorldToViewMatrix:function(a){this.setMatrix(a,16)},setViewToWorldMatrix:function(a){this.setMatrix(a,
0)},setProjectionMatrix:function(a){for(var b=this.offset+32,c=0;16>c;c++,b++)this.page[b]=a[c];this.projectionDirty=!1},setProjectionOverride:function(a){this.projectionOverride=a;this.setProjectionDirty()},setTransformDirty:function(){this.viewDirty=!0;this.setProjectionDirty();this.scene.requestRedraw("Transformation changed")},setProjectionDirty:function(){this.projectionDirty=!0},updatePosition:function(a){this.setTransformDirty();this.position=a},updateOrientation:function(a){this.setTransformDirty();
this.orientation=a},updateFieldOfView:function(a){this.setTransformDirty();this.fieldOfView=a},getViewToWorldMatrix:function(a){this.viewDirty&&this.updateViewMatrix();for(var b=this.offset+0,c=0;16>c;c++,b++)a[c]=this.page[b]},getWorldToViewMatrix:function(a){this.viewDirty&&this.updateViewMatrix();for(var b=this.offset+16,c=0;16>c;c++,b++)a[c]=this.page[b]},getProjectionMatrix:function(a,b){(this.projectionDirty||b!=this.lastAspectRatio)&&this.updateProjectionMatrix(b);for(var c=this.offset+32,
e=0;16>e;e++,c++)a[e]=this.page[c]},getWorldSpacePosition:function(){return this.worldSpacePosition},getWorldSpaceBoundingBox:function(a){XML3D.math.bbox.empty(a)}});e.RenderView=b})(XML3D.webgl);
(function(e){var c=function(){e.Pager.call(this);this.boundingBox=new XML3D.math.bbox.create;this.lights={queue:[],point:[],directional:[],spot:[],length:function(){return this.point.length+this.directional.length+this.spot.length}};this.shaderInfos=[];this.activeView=null;this.rootNode=this.createRootNode();this.systemDomNode=null};XML3D.createClass(c,e.Pager);c.NODE_TYPE={GROUP:"group",OBJECT:"object",LIGHT:"light",VIEW:"view"};c.EVENT_TYPE={VIEW_CHANGED:"view_changed",LIGHT_STRUCTURE_CHANGED:"light_structure_changed",
LIGHT_VALUE_CHANGED:"light_value_changed",SCENE_SHAPE_CHANGED:"scene_shape_changed",SCENE_STRUCTURE_CHANGED:"scene_structure_changed",DRAWABLE_STATE_CHANGED:"drawable_state_changed"};XML3D.extend(c.prototype,{getActiveView:function(){return this.activeView},setActiveView:function(b){if(b!=this.activeView){if(!b)throw Error("Active view must not be null");this.activeView=b;this.dispatchEvent({type:c.EVENT_TYPE.VIEW_CHANGED,newView:this.activeView})}},createRenderObject:function(b){var a=this.getPageEntry(e.RenderObject.ENTRY_SIZE);
return new e.RenderObject(this,a,b)},createRenderGroup:function(b){var a=this.getPageEntry(e.RenderGroup.ENTRY_SIZE);return new e.RenderGroup(this,a,b)},createRenderView:function(b){var a=this.getPageEntry(e.RenderView.ENTRY_SIZE);return new e.RenderView(this,a,b)},createRenderLight:function(b){var a=this.getPageEntry(e.RenderLight.ENTRY_SIZE);return new e.RenderLight(this,a,b)},createShaderInfo:function(b){return new e.ShaderInfo(this,b)},createRootNode:function(){var b=this.getPageEntry(e.RenderGroup.ENTRY_SIZE),
b=new e.RenderGroup(this,b,{});b.setWorldMatrix(XML3D.math.mat4.create());b.setLocalMatrix(XML3D.math.mat4.create());b.transformDirty=!1;b.shaderDirty=!1;b.visible=!0;b.shaderHandle=new XML3D.base.AdapterHandle("not_found");b.shaderHandle.status=XML3D.base.AdapterHandle.STATUS.NOT_FOUND;return b},updateBoundingBox:function(){this.rootNode.boundingBoxDirty&&this.activeView&&this.activeView.setProjectionDirty();this.rootNode.getWorldSpaceBoundingBox(this.boundingBox)},getBoundingBox:function(b){this.updateBoundingBox();
XML3D.math.bbox.copy(b,this.boundingBox)},createDrawable:function(){throw Error("Scene::createDrawable not implemented");},requestRedraw:function(){throw Error("Scene::requestRedraw not implemented");},traverse:function(b){this.rootNode.traverse(b)},findRayIntersections:function(b){var a=[];this.rootNode.findRayIntersections(b,a);return a}});e.Scene=c;e.SystemNotifier={node:null,setNode:function(b){this.node=b},sendEvent:function(b,a){if(this.node){var d=document.createEvent("CustomEvent");a.systemtype=
b;d.initCustomEvent("xml3dsystem",!0,!0,a);this.node.dispatchEvent(d)}}}})(XML3D.webgl);
(function(e){var c=function(){var a=0;return function(){return a++}}(),b=function(a,b){b=b||{};this.id=c();this.scene=a;this.data=b.data;this.scriptCode=this.scriptType=this.scriptUri=null;this.scene.shaderInfos.push(this);this.changeListener=[]};XML3D.extend(b.prototype,{setScript:function(a,b,c){this.scriptUri=a;this.scriptType=b;this.scriptCode=c;this.scriptChangedEvent()},getScriptUri:function(){return this.scriptUri},getScriptType:function(){return this.scriptType},getScriptCode:function(){return this.scriptCode},
getData:function(){return this.data},addChangeListener:function(a){this.changeListener.push(a)},scriptChangedEvent:function(){for(var a=0;a<this.changeListener.length;++a)this.changeListener[a](this)}});e.ShaderInfo=b})(XML3D.webgl);
(function(e){var c=function(a,d,c,e){this.gl=a;this.id=d;this.canvasTarget=new XML3D.webgl.GLCanvasTarget(this,c,e);this.programFactory=new XML3D.webgl.ProgramFactory(this);this.stats={materials:0,meshes:0};var d={},h;for(h in b)c=b[h],(e=a.getExtension(c))?d[c]=e:XML3D.debug.logInfo(c,"is not supported on your graphics card");this.extensions=d},b=c.EXTENSIONS={};b.STANDARD_DERIVATES="OES_standard_derivatives";b.MULTIPLE_RENDER_TARGETS="WEBGL_draw_buffers";b.DEPTH_TEXTURE="WEBGL_depth_texture";b.FLOAT_COLOR_BUFFER=
"WEBGL_color_buffer_float";b.FLOAT_TEXTURES="OES_texture_float";b.UINT32_INDICES="OES_element_index_uint";XML3D.extend(c.prototype,{getXflowEntryWebGlData:function(a){return XML3D.webgl.getXflowEntryWebGlData(a,this.id)},requestRedraw:function(){},handleResizeEvent:function(a,b){this.canvasTarget=new XML3D.webgl.GLCanvasTarget(this,a,b)},getStatistics:function(){return this.stats},getExtensionByName:function(a){return this.extensions[a]}});e.GLContext=c})(XML3D.webgl);
(function(e){var c=function(a){Xflow.SamplerConfig.call(this);this.setDefaults();this.height=this.width=0;this.gl=a;this.handle=null};XML3D.createClass(c,Xflow.SamplerConfig);c.State={NONE:"none",LOADING:"loading",READY:"ready",ERROR:"error"};var b=function(){var a=null;return function(b){if(!a){a=new c(b);for(var d=new Uint8Array(768),e=0;e<d.length;e++)d[e]=128;a.createTex2DFromData(b.RGB,16,16,b.RGB,b.UNSIGNED_BYTE,{texels:d,wrapS:b.REPEAT,wrapT:b.REPEAT,minFilter:b.LINEAR,magFilter:b.LINEAR})}return a}}(),
a=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1},d=function(a,b){switch(a){case Xflow.TEXTURE_FORMAT.ALPHA:return b.ALPHA;case Xflow.TEXTURE_FORMAT.RGB:return b.RGB;case Xflow.TEXTURE_FORMAT.RGBA:return b.RGBA;case Xflow.TEXTURE_FORMAT.LUMINANCE:return b.LUMINANCE;case Xflow.TEXTURE_FORMAT.LUMINANCE_ALPHA:return b.LUMINANCE_ALPHA;default:throw Error("Unsupported Texture Format!");}},g=function(a,b){switch(a){case Xflow.TEXTURE_TYPE.FLOAT:return b.FLOAT;case Xflow.TEXTURE_TYPE.UBYTE:return b.UNSIGNED_BYTE;
case Xflow.TEXTURE_TYPE.USHORT_4_4_4_4:return b.UNSIGNED_SHORT_4_4_4_4;case Xflow.TEXTURE_TYPE.USHORT_5_5_5_1:return b.UNSIGNED_SHORT_5_5_5_1;case Xflow.TEXTURE_TYPE.USHORT_5_6_5:return b.GL_UNSIGNED_SHORT_5_6_5;default:throw Error("Unsupported Texture Type!");}};XML3D.extend(c.prototype,{updateFromTextureEntry:function(a){if(a.isLoading())this.loads();else{this.set(a.getSamplerConfig());a=a.asGLTextureValue();if(!a)return this.failed();this.createOrUpdateTexture(a)}},needsScale:function(a,b){return(this.generateMipMap||
this.wrapS!=this.gl.CLAMP_TO_EDGE||this.wrapT!=this.gl.CLAMP_TO_EDGE)&&(0!=(a&a-1)||0!=(b&b-1))},bind:function(a){this.canBind()?(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.textureType,this.handle)):b(this.gl).bind(a)},unbind:function(a){this.gl.activeTexture(this.gl.TEXTURE0+a);this.gl.bindTexture(this.textureType,null)},destroy:function(){this.gl.deleteTexture(this.handle)},canBind:function(){return this.current==c.State.READY},createOrUpdateTexture:function(a){var b=this.gl;
this.handle||(this.handle=b.createTexture());this.updateTextureFromData(a)},updateTextureFromData:function(b){var c=this.gl;this.textureType=c.TEXTURE_2D;c.bindTexture(c.TEXTURE_2D,this.handle);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,this.wrapS);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,this.wrapT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.minFilter);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,this.magFilter);var e=g(b.texelType,c),j=d(b.texelFormat,c),k=b.width;this.width=
k;var l=b.height;this.height=l;if(this.generateMipMap&&this.needsScale(k,l)){if(e===c.FLOAT)throw Error("Should generate MipMaps but texture data is float and not power of two in size!");var m=document.createElement("canvas");m.width=a(k);m.height=a(l);var o=m.getContext("2d");if(b instanceof HTMLElement)o.drawImage(b,0,0,m.width,m.height);else{var n=document.createElement("canvas");n.width=k;n.height=l;var p=n.getContext("2d"),q=p.createImageData(k,l);q.data.set(b.data);p.putImageData(q,0,0);o.drawImage(n,
0,0,m.width,m.height)}b=m}b instanceof HTMLElement?c.texImage2D(c.TEXTURE_2D,0,j,j,e,b):c.texImage2D(c.TEXTURE_2D,0,j,k,l,0,j,e,b.data);this.generateMipMap&&c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null);this.created()},createTex2DFromData:function(a,b,c,d,e,g){var m=this.gl,g=g||{},o=g.texels;o||(o=e==m.FLOAT?new Float32Array(4*b*c):new Uint8Array(4*b*c));this.width=b;this.height=c;this.handle=m.createTexture();this.textureType=m.TEXTURE_2D;m.bindTexture(m.TEXTURE_2D,this.handle);
m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,g.wrapS);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,g.wrapT);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,g.minFilter);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,g.magFilter);g.isDepth?m.texImage2D(m.TEXTURE_2D,0,a,b,c,0,d,e,null):m.texImage2D(m.TEXTURE_2D,0,a,b,c,0,d,e,o);g.generateMipmap&&m.generateMipmap(m.TEXTURE_2D);m.bindTexture(m.TEXTURE_2D,null);this.created()}});window.StateMachine.create({target:c.prototype,initial:c.State.NONE,
events:[{name:"created",from:"*",to:c.State.READY},{name:"failed",from:"*",to:c.State.ERROR},{name:"loads",from:"*",to:c.State.LOADING}]});e.GLTexture=c})(XML3D.webgl);
(function(e){var c=function(a){Xflow.SamplerConfig.call(this);this.setDefaults();this.height=this.width=0;this.gl=a;this.handle=null;this.glSides=[a.TEXTURE_CUBE_MAP_POSITIVE_X,a.TEXTURE_CUBE_MAP_NEGATIVE_X,a.TEXTURE_CUBE_MAP_POSITIVE_Y,a.TEXTURE_CUBE_MAP_NEGATIVE_Y,a.TEXTURE_CUBE_MAP_POSITIVE_Z,a.TEXTURE_CUBE_MAP_NEGATIVE_Z]};XML3D.createClass(c,Xflow.SamplerConfig);c.State={NONE:"none",LOADING:"loading",READY:"ready",ERROR:"error"};var b=function(){var a=null;return function(b){if(!a){a=new c(b);
for(var e=new Uint8Array(768),h=0;h<e.length;h++)e[h]=128;a.createTex2DFromData(b.RGB,16,16,b.RGB,b.UNSIGNED_BYTE,{texels:e,wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,minFilter:b.LINEAR,magFilter:b.LINEAR})}return a}}(),a=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};XML3D.extend(c.prototype,{updateFromTextureEntry:function(a){var b=a.getImage();b?(this.handle||(this.handle=this.gl.createTexture()),this.set(a.getSamplerConfig()),a.isLoading()?this.loads():this.updateTex2DFromImage(b)):
this.failed()},needsScale:function(a,b){return(this.generateMipMap||this.wrapS!=this.gl.CLAMP_TO_EDGE||this.wrapT!=this.gl.CLAMP_TO_EDGE)&&(0!=(a&a-1)||0!=(b&b-1))},updateTex2DFromImage:function(b,c){var e=this.gl,h=this.width=b.videoWidth||b.width,i=this.height=b.videoHeight||b.height;e.bindTexture(e.TEXTURE_CUBE_MAP,this.handle);if(this.needsScale(h,i)){var j=b,k=document.createElement("canvas");k.width=a(h);k.height=a(i);k.getContext("2d").drawImage(j,0,0,k.width,k.height);b=k}if("undefined"===
c||null==c)for(h=0;h<this.glSides.length;++h)e.texImage2D(this.glSides[h],0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,b);else e.texImage2D(this.glSides[c],0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,b);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,this.wrapS);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,this.wrapT);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,this.minFilter);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,this.magFilter);this.generateMipMap&&e.generateMipmap(e.TEXTURE_CUBE_MAP);
e.bindTexture(e.TEXTURE_CUBE_MAP,null);this.created()},bind:function(a){this.canBind()?(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.textureType,this.handle)):b(this.gl).bind(a)},unbind:function(a){this.gl.activeTexture(this.gl.TEXTURE0+a);this.gl.bindTexture(this.textureType,null)},destroy:function(){this.gl.deleteTexture(this.handle)},canBind:function(){return this.current==c.State.READY},createTex2DFromData:function(a,b,c,e,i,j){var k=this.gl,j=j||{},l=j.texels;l||(l=i==k.FLOAT?
new Float32Array(4*b*c):new Uint8Array(4*b*c));this.width=b;this.height=c;this.handle=k.createTexture();this.textureType=k.TEXTURE_CUBE_MAP;k.bindTexture(k.TEXTURE_CUBE_MAP,this.handle);k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_S,j.wrapS);k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_T,j.wrapT);k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MIN_FILTER,j.minFilter);k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MAG_FILTER,j.magFilter);j.isDepth&&(l=null);for(var m=0;m<this.glSides.length;m++)k.texImage2D(this.glSides[m],
0,a,b,c,0,e,i,l);j.generateMipmap&&k.generateMipmap(k.TEXTURE_CUBE_MAP);k.bindTexture(k.TEXTURE_CUBE_MAP,null);this.created()}});window.StateMachine.create({target:c.prototype,initial:c.State.NONE,events:[{name:"created",from:"*",to:c.State.READY},{name:"failed",from:"*",to:c.State.ERROR},{name:"loads",from:"*",to:c.State.LOADING}]});e.GLCubeMap=c})(XML3D.webgl);
(function(e){var c=function(a,b,c){var h=a.createShader(b);a.shaderSource(h,c);a.compileShader(h);if(0==a.getShaderParameter(h,a.COMPILE_STATUS)){var h=a.getShaderInfoLog(h),i="",i=b==a.VERTEX_SHADER?"Vertex shader failed to compile: \n":"Fragment shader failed to compile: \n",i=i+(h+"\n--------\n")+"Shader Source:\n--------\n"+XML3D.debug.formatSourceCode(c);a.getError();e.SystemNotifier.sendEvent("glsl",{glslType:"compile_error",shaderType:b==a.VERTEX_SHADER?"vertex":"fragment",code:c,message:h});
throw Error(i);}return h},b=function(){var a=0;return function(){return a++}}(),a=function(a,c){this.gl=a;this.sources=c;this.id=b();this.attributes={};this.uniforms={};this.samplers={};this.needsLights=!0;this.handle=null;this.texturesBinded=!1;var e=0;this.nextTextureUnit=function(){return e++};this.create()};XML3D.extend(a.prototype,{create:function(){XML3D.debug.logDebug("Create shader program: ",this.id);var a=this.gl,b=[this.sources.vertex],f=[this.sources.fragment],h=null,i=[],j;for(j in b)h=
b[j],h=c(a,a.VERTEX_SHADER,h),i.push(h);for(j in f)h=f[j],h=c(a,a.FRAGMENT_SHADER,h),i.push(h);var b=a.createProgram(),k;for(k in i)a.attachShader(b,i[k]);a.linkProgram(b);if(0==a.getProgramParameter(b,a.LINK_STATUS))throw i=a.getProgramInfoLog(b),k="Shader linking failed: \n"+i+"\n--------\n",a.getError(),e.SystemNotifier.sendEvent("glsl",{glslType:"link_error",message:i}),Error(k);if(this.handle=b){e.SystemNotifier.sendEvent("glsl",{glslType:"success"});this.bind();a=this.gl;i=this.handle;b=a.getProgramParameter(i,
a.ACTIVE_ATTRIBUTES);for(k=0;k<b;k++)if(f=a.getActiveAttrib(i,k))j={},j.name=f.name,j.size=f.size,j.glType=f.type,j.location=a.getAttribLocation(i,f.name),this.attributes[f.name]=j;b=a.getProgramParameter(i,a.ACTIVE_UNIFORMS);for(k=0;k<b;k++)if(h=a.getActiveUniform(i,k))if(f={},f.name=h.name,f.size=h.size,f.glType=h.type,f.location=a.getUniformLocation(i,h.name),j=f.name,"[0]"==j.substring(j.length-3)&&(j=j.substring(0,j.length-3)),h.type==a.SAMPLER_2D||h.type==a.SAMPLER_CUBE){f.unit=[];f.texture=
[];for(h=0;h<f.size;h++)f.unit[h]=this.nextTextureUnit(),f.texture[h]=new XML3D.webgl.GLTexture(a);e.setUniform(a,f,f.unit);this.samplers[j]=f}else this.uniforms[j]=f}},bind:function(){this.handle||XML3D.debug.logError("Trying to bind invalid GLProgram.");this.gl.useProgram(this.handle);for(var a in this.samplers){var b=this.samplers[a];if(b.texture)for(var c=0;c<b.texture.length;c++)b.texture[c]&&b.texture[c].bind(b.unit[c])}this.texturesBinded=!0},unbind:function(){this.texturesBinded=!1},isValid:function(){return!!this.handle},
setUniformVariables:function(a,b,c){var e,i,j;if(a&&c.envBase){e=a.length;i=c.envBase;for(j=c.envOverride;e--;){var k=a[e];this.setUniformVariable(k,j&&void 0!==j[k]?j[k]:i[k])}}if(b&&c.sysBase){e=b.length;for(i=c.sysBase;e--;)k=b[e],this.setUniformVariable(k,i[k])}},setUniformVariable:function(a,b){if(void 0!==b)if(this.uniforms[a])e.setUniform(this.gl,this.uniforms[a],b);else if(this.samplers[a]){var c=this.samplers[a];if(b&&c.texture!==b&&b instanceof Array){c.texture=b;for(var h=0;h<c.texture.length;h++)c.texture[h]&&
c.texture[h].bind(c.unit[h])}}}});e.GLProgramObject=a})(XML3D.webgl);
(function(e){var c=function(a,b,c){this.context=a;this.width=b;this.height=c},b=function(){};XML3D.extend(c.prototype,{getWidth:function(){return this.width},getHeight:function(){return this.height},getScale:function(){return 1},bind:b,unbind:b,resize:b});var a=function(a,b){this.context=a;this.width=b.width||800;this.height=b.height||600;this.scale=b.scale||1;this.opt=this.fillOptions(b);this.handle=null;this.colorTarget={handle:null,isTexture:!1};this.depthTarget={handle:null,isTexture:!1};this.stencilTarget=
{handle:null,isTexture:!1};this.valid=!1};XML3D.extend(a.prototype,{getWidth:function(){return this.width},getHeight:function(){return this.height},getScale:function(){return this.scale},bind:function(){var a=!1;this.handle||(this.createFrameBuffer(this.opt.colorFormat,this.opt.depthFormat,this.opt.stencilFormat),a=!0);if(this.valid){var b=this.context.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.handle);a&&b.viewport(0,0,this.width,this.height)}},unbind:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,
null)},resize:function(a,b){this.dispose();this.width=a;this.height=b;this.bind()},createFrameBuffer:function(a,b,c){var e=this.context.gl;this.handle=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,this.handle);a&&this.createColorTarget(a);b&&this.createDepthTarget(b);c&&this.createStencilTarget(c);this.checkStatus()},createColorTarget:function(a){var b=this.context.gl;if(this.opt.colorAsRenderbuffer){var c=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,c);b.renderbufferStorage(b.RENDERBUFFER,
a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,c);this.colorTarget={handle:c,isTexture:!1}}else c=new XML3D.webgl.GLTexture(b),c.createTex2DFromData(a,this.width,this.height,b.RGBA,this.opt.colorType||b.UNSIGNED_BYTE,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,c.handle,0),this.colorTarget={handle:c,isTexture:!0}},createDepthTarget:function(a){var b=this.context.gl;this.opt.isDepth=
!0;if(this.opt.depthAsRenderbuffer){var c=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,c);b.renderbufferStorage(b.RENDERBUFFER,a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,c);this.depthTarget={handle:c,isTexture:!1}}else c=new XML3D.webgl.GLTexture(b),c.createTex2DFromData(a,this.width,this.height,b.DEPTH_COMPONENT,b.FLOAT,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,
c.handle,0),this.depthTarget={handle:c,isTexture:!0}},createStencilTarget:function(a){var b=this.context.gl;if(this.opt.stencilAsRenderbuffer){var c=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,c);b.renderbufferStorage(b.RENDERBUFFER,a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,c);this.stencilTarget={handle:c,isTexture:!1}}else c=new XML3D.webgl.GLTexture(b),c.createTex2DFromData(a,this.width,
this.height,b.STENCIL_COMPONENT,b.UNSIGNED_BYTE,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.TEXTURE_2D,c.handle,0),this.stencilTarget={handle:c,isTexture:!0}},checkStatus:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.handle);var b=a.checkFramebufferStatus(a.FRAMEBUFFER);switch(b){case a.FRAMEBUFFER_COMPLETE:break;case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
break;case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case a.FRAMEBUFFER_UNSUPPORTED:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:XML3D.debug.logError("Incomplete framebuffer: "+b)}a.bindFramebuffer(a.FRAMEBUFFER,null);return this.valid=b==a.FRAMEBUFFER_COMPLETE},fillOptions:function(a){var b=this.context.gl,b={wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,minFilter:b.NEAREST,magFilter:b.NEAREST,
depthMode:b.LUMINANCE,depthCompareMode:b.COMPARE_R_TO_TEXTURE,depthCompareFunc:b.LEQUAL,colorsAsRenderbuffer:!1,depthAsRenderbuffer:!1,stencilAsRenderbuffer:!1,isDepth:!1},c;for(c in a)b[c]=a[c];return b},dispose:function(){if(this.handle){var a=this.context.gl;a.deleteFramebuffer(this.handle);null!==this.colorTarget&&(this.colorTarget.isTexture?this.colorTarget.handle.dispose():a.deleteRenderBuffer(this.colorTarget.handle));null!==this.depthTarget&&(this.depthTarget.isTexture?this.depthTarget.handle.dispose():
a.deleteRenderBuffer(this.depthTarget.handle));null!==this.stencilTarget&&(this.stencilTarget.isTexture?this.stencilTarget.handle.dispose():a.deleteRenderBuffer(this.stencilTarget.handle))}}});b=function(b,c,e){a.call(this,b,e);this.scaleToMaxDimension(c)};XML3D.createClass(b,a);XML3D.extend(b.prototype,{scaleToMaxDimension:function(a){var b=this.height-a,c=this.width-a;if(0<b||0<c)a=b>c?a/this.height:a/this.width,this.width=Math.floor(this.width*a),this.height=Math.floor(this.height*a),this.scale=
a}});e.GLCanvasTarget=c;e.GLRenderTarget=a;e.GLScaledRenderTarget=b})(XML3D.webgl);
(function(e){var c=function(b,a){var c=b.gl;this.context=b;this.height=this.width=a.width||800;this.scale=a.scale||1;this.opt=this.fillOptions(a);this.stencilTarget=this.depthTarget=this.colorTarget=this.stex=this.dtex=this.ctex=this.handle=null;this.valid=!1;this.glSides=[c.TEXTURE_CUBE_MAP_POSITIVE_X,c.TEXTURE_CUBE_MAP_NEGATIVE_X,c.TEXTURE_CUBE_MAP_POSITIVE_Y,c.TEXTURE_CUBE_MAP_NEGATIVE_Y,c.TEXTURE_CUBE_MAP_POSITIVE_Z,c.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.framebuffers=[]};XML3D.extend(c.prototype,
{getWidth:function(){return this.width},getHeight:function(){return this.height},getScale:function(){return this.scale},bind:function(b){var a=!1;0>=this.framebuffers.length&&(this.createFrameBuffers(this.opt.colorFormat,this.opt.depthFormat,this.opt.stencilFormat),a=!0);if(this.valid){var c=this.context.gl;c.bindFramebuffer(c.FRAMEBUFFER,this.framebuffers[b]);a&&c.viewport(0,0,this.width,this.height)}},unbind:function(){var b=this.context.gl;b.bindFramebuffer(b.FRAMEBUFFER,null)},resize:function(b,
a){this.dispose();this.width=b;this.height=a;this.bind()},createFrameBuffers:function(b,a,c){var e=this.context.gl;b&&(this.ctex=new XML3D.webgl.GLCubeMap(e),this.ctex.createTex2DFromData(b,this.width,this.height,e.RGBA,this.opt.colorType||e.UNSIGNED_BYTE,this.opt),this.colorTarget={handle:this.ctex,isTexture:!0});a&&(this.opt.isDepth=!0,this.opt.depthAsRenderbuffer||(this.dtex=new XML3D.webgl.GLCubeMap(e),this.dtex.createTex2DFromData(a,this.width,this.height,e.DEPTH_COMPONENT,e.FLOAT,this.opt),
this.depthTarget={handle:this.dtex,isTexture:!0}));c&&(this.stex=new XML3D.webgl.GLCubeMap(e),this.stex.createTex2DFromData(c,this.width,this.height,e.STENCIL_COMPONENT,e.UNSIGNED_BYTE,this.opt),this.stencilTarget={handle:this.stex,isTexture:!0});for(var f=0;f<this.glSides.length;++f)this.framebuffers[f]=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffers[f]),b&&this.createColorTarget(b,f),a&&this.createDepthTarget(a,f),c&&this.createStencilTarget(c,f),this.checkStatus()},createColorTarget:function(b,
a){var c=this.context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,this.glSides[a],this.ctex.handle,0)},createDepthTarget:function(b,a){var c=this.context.gl;this.opt.depthAsRenderbuffer&&(this.dtex||(this.dtex=[]),this.dtex[a]=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,this.dtex[a]),c.renderbufferStorage(c.RENDERBUFFER,b,this.width,this.height),c.bindRenderbuffer(c.RENDERBUFFER,null),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,this.dtex[a]),
this.depthTarget||(this.depthTarget=[]),this.depthTarget[a]={handle:this.dtex[a],isTexture:!1})},createStencilTarget:function(b,a){var c=this.context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,this.glSides[a],this.stex.handle,0)},checkStatus:function(b){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffers[b]);b=a.checkFramebufferStatus(a.FRAMEBUFFER);switch(b){case a.FRAMEBUFFER_COMPLETE:break;case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");
break;case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case a.FRAMEBUFFER_UNSUPPORTED:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:XML3D.debug.logError("Incomplete framebuffer: "+b)}a.bindFramebuffer(a.FRAMEBUFFER,null);return this.valid=
b==a.FRAMEBUFFER_COMPLETE},fillOptions:function(b){var a=this.context.gl,a={wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,minFilter:a.NEAREST,magFilter:a.NEAREST,depthMode:a.LUMINANCE,depthCompareMode:a.COMPARE_R_TO_TEXTURE,depthCompareFunc:a.LEQUAL,colorsAsRenderbuffer:!1,depthAsRenderbuffer:!1,stencilAsRenderbuffer:!1,isDepth:!1},c;for(c in b)a[c]=b[c];return a},dispose:function(){if(!(0>=this.framebuffers.length)){var b=this.context.gl,a;for(a in this.framebuffers)b.deleteFramebuffer(this.framebuffers[a]);
null!==this.colorTarget.handle&&this.colorTarget.handle.dispose();null!==this.depthTarget&&this.depthTarget.handle.dispose();null!==this.stencilTarget&&this.stencilTarget.handle.dispose();this.framebuffers=[]}}});e.GLCubeMapRenderTarget=c})(XML3D.webgl);
(function(e){var c=XML3D.math.vec3,b=c.create(),a=c.create(),d=function(a,b,c,d,e,g){this.orthographic="undefined"===typeof g?!1:g;this.setFrustum(a,b,c,d,e,this.orthographic)};XML3D.extend(d.prototype,{setFrustum:function(a,b,c,d,e,g){if(c&&d)throw Error("fovx and fovy cannot both be non-zero.");c?(this.right=a*Math.tan(c/2),this.left=-this.right,this.top=(this.right-this.left)/e/2,this.bottom=-this.top):(this.top=a*Math.tan(0.5*d),this.bottom=-this.top,this.right=(this.top-this.bottom)*e/2,this.left=
-this.right);this.nearPlane=a;this.farPlane=b;this.orthographic="undefined"===typeof g?!1:g},getProjectionMatrix:function(a){var b=Number.MAX_VALUE,c=this.right+this.left,d=this.right-this.left,e=this.top+this.bottom,g=this.top-this.bottom,f=this.farPlane+this.nearPlane,n=this.farPlane-this.nearPlane;if(1>Math.abs(d)&&Math.abs(c)>b*Math.abs(d)||1>Math.abs(g)&&Math.abs(e)>b*Math.abs(g)||1>Math.abs(n)&&Math.abs(f)>b*Math.abs(n))throw Error("Bad viewing frustum: projection matrix cannot be computed.");
if(this.orthographic){var p=-c/d,q=-e/g,r=-f/n;if(1>Math.abs(d)&&2>b*Math.abs(d)||1>Math.abs(g)&&2>b*Math.abs(g)||1>Math.abs(n)&&2>b*Math.abs(n))throw Error("Bad viewing frustum:  projection matrix cannot be computed.");c=2/d;e=2/g;f=-2/n;XML3D.math.mat4.identity(a);a[0]=c;a[5]=e;a[10]=f;a[12]=p;a[13]=q;a[14]=r;a[15]=1}else{c/=d;e/=g;f=-f/n;p=-2*this.farPlane*this.nearPlane;if(1>Math.abs(n)&&Math.abs(p)>b*Math.abs(n))throw Error("Bad viewing frustum: projection matrix cannot be computed.");n=p/n;
p=2*this.nearPlane;if(1>Math.abs(d)&&Math.abs(p)>b*Math.abs(d)||1>Math.abs(g)&&Math.abs(p)>b*Math.abs(g))throw Error("Bad viewing frustum: projection matrix cannot be computed.");b=p/d;g=p/g;XML3D.math.mat4.identity(a);a[0]=b;a[5]=g;a[8]=c;a[9]=e;a[10]=f;a[11]=-1;a[14]=n;a[15]=0}},getPlanes:function(){var a=c.create(),b=c.create(),d=c.create(),e=c.create(),g=c.create(),f=c.create(),o=c.create(),n=c.create();return function(p,q){var r=c.transformMat4(a,[this.left,this.bottom,-this.nearPlane],q),v=
c.transformMat4(b,[this.left,this.top,-this.nearPlane],q),t=c.transformMat4(d,[this.right,this.top,-this.nearPlane],q),y=c.transformMat4(e,[this.right,this.bottom,-this.nearPlane],q),w,s,D,u;this.orthographic?(w=c.transformMat4(g,[this.left,this.bottom,-this.farPlane],q),s=c.transformMat4(f,[this.left,this.top,-this.farPlane],q),D=c.transformMat4(o,[this.right,this.top,-this.farPlane],q),u=c.transformMat4(n,[this.right,this.bottom,-this.farPlane],q),p[0].setFromPoints(t,D,s),p[1].setFromPoints(y,
u,D),p[2].setFromPoints(r,w,u),p[3].setFromPoints(v,s,w)):(w=this.farPlane/this.nearPlane,s=w*this.left,D=w*this.right,u=w*this.top,w=c.transformMat4(g,[s,w*this.bottom,-this.farPlane],q),s=c.transformMat4(f,[s,u,-this.farPlane],q),D=c.transformMat4(o,[D,u,-this.farPlane],q),u=c.transformMat4(n,[0,0,0],q),p[0].setFromPoints(u,t,v),p[1].setFromPoints(u,y,t),p[2].setFromPoints(u,r,y),p[3].setFromPoints(u,v,r));p[4].setFromPoints(r,y,t);p[5].setFromPoints(w,s,D)}}()});var g=function(){this.distance=
0;this.normal=c.create()};XML3D.extend(g.prototype,{setFromPoints:function(d,e,g){c.cross(this.normal,c.sub(a,g,d),c.sub(b,e,d));c.normalize(this.normal,this.normal);this.distance=-c.dot(this.normal,d)},set:function(a,b,d,e){c.set(this.normal,a,b,d);c.normalize(this.normal,this.normal);this.distance=e}});var f=function(a,b){this.frustumPlanes=[new g,new g,new g,new g,new g,new g];a&&b&&this.set(a,b)};XML3D.extend(f.prototype,{set:function(a,b){a.getPlanes(this.frustumPlanes,b)},isBoxVisible:function(){return function(a){if(XML3D.math.bbox.isEmpty(a))return!1;
for(var b=0;b<this.frustumPlanes.length;b++){var c=this.frustumPlanes[b],d=c.normal;if(0>(0<=d[0]?a[3]:a[0])*d[0]+(0<=d[1]?a[4]:a[1])*d[1]+(0<=d[2]?a[5]:a[2])*d[2]+c.distance)return!1}return!0}}()});e.Plane=g;e.Frustum=d;e.FrustumTest=f})(XML3D.webgl);
(function(e){var c=function(a){var b=window.WebGLRenderingContext;a&&a.toLoweGLase&&(a=a.toLowerCase());switch(a){case "triangles":return b.TRIANGLES;case "tristrips":return b.TRIANGLE_STRIP;case "points":return b.POINTS;case "lines":return b.LINES;case "linestrips":return b.LINE_STRIP;default:throw Error("Unknown primitive type: "+a);}},b=function(a,b){this.context=a;this.glType=c(b);this.buffers={};this.uniformOverride={};this.maxIndex=this.minIndex=0;this.isIndexed=!1;this.vertexCount=null;this.minAttributeCount=
-1;this.context.getStatistics().meshes++};XML3D.extend(b.prototype,{setIndexRange:function(a,b){this.minIndex=a;this.maxIndex=b},checkBufferCompatible:function(a,b){var c=b.getIterateCount();this.minAttributeCount=-1==this.minAttributeCount?c:Math.min(this.minAttributeCount,c);if(this.isIndexed){if(c<=this.maxIndex)throw Error("Index range of ["+this.minIndex+", "+this.maxIndex+"]  goes beyond element count "+c+" of attribute '"+a+"'");}else if(null!==this.vertexCount&&c<this.vertexCount)throw Error("VertexCount "+
this.vertexCount+" is larger than element count "+c+" of attribute '"+a+"'");},removeBuffer:function(a){delete this.buffers[a]},setBuffer:function(a,b){this.buffers[a]=b;this.isIndexed=this.isIndexed||"index"==a},clear:function(){this.buffers={};this.uniformOverride={};this.minIndex=this.maxIndex=0;this.isIndexed=!1;this.minAttributeCount=-1},setUniformOverride:function(a,b){void 0===b&&delete this.uniformOverride[a];this.uniformOverride[a]=b},setVertexCount:function(a){this.vertexCount=a},isReadyToRender:function(){return 0<
this.minAttributeCount},getElementCount:function(){try{return this.buffers.index.length}catch(a){return 0}},getVertexCount:function(){try{return null!=this.vertexCount?this.vertexCount:this.minAttributeCount}catch(a){return 0}},draw:function(a){var b=this.context.gl,c=a.attributes,e=this.buffers,h=0,i;for(i in c){var j=c[i];if(h=e[i])b.enableVertexAttribArray(j.location),b.bindBuffer(b.ARRAY_BUFFER,h),b.vertexAttribPointer(j.location,h.tupleSize,h.glType,!1,0,0)}if(this.isIndexed){b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
e.index);if(this.segments){e=0;j=this.segments.value;for(h=0;h<j.length;h++)b.drawElements(this.glType,j[h],b.UNSIGNED_SHORT,e),e+=2*j[h]}else b.drawElements(this.glType,this.getElementCount(),e.index.glType,0);h=this.getElementCount()/3}else{if(this.size){e=0;j=this.size.data;for(h=0;h<j.length;h++)b.drawArrays(this.glType,e,j[h]),e+=2*j[h]}else b.drawArrays(this.glType,0,this.getVertexCount());h=this.getVertexCount()}for(i in c)j=c[i],b.disableVertexAttribArray(j.location);b.bindBuffer(b.ARRAY_BUFFER,
null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null);a.undoUniformVariableOverride&&a.undoUniformVariableOverride(this.uniformOverride);return h}});e.GLMesh=b})(XML3D.webgl);
(function(e){e.checkError=function(c,b){var a=c.getError();if(a!==c.NO_ERROR){var d=""+a;switch(a){case 1280:d="1280 ( GL_INVALID_ENUM )";break;case 1281:d="1281 ( GL_INVALID_VALUE )";break;case 1282:d="1282 ( GL_INVALID_OPERATION )";break;case 1283:d="1283 ( GL_STACK_OVERFLOW )";break;case 1284:d="1284 ( GL_STACK_UNDERFLOW )";break;case 1285:d="1285 ( GL_OUT_OF_MEMORY )"}a="GL error "+d+" occured.";void 0!==b&&(a+=" "+b);XML3D.debug.trace(a)}};e.getGLBufferFromXflowDataEntry=function(c,b,a){var d=
b.getXflowEntryWebGlData(c),g=d.buffer,f=b.gl;if(d.changed&&a){for(var h=c.getValue(),i=1E8,j=0,k=h.length;k--;)i=Math.min(i,h[k]),j=Math.max(j,h[k]);d.maxIndex=j;d.minIndex=i}switch(d.changed){case Xflow.DATA_ENTRY_STATE.CHANGED_VALUE:if(a){c=c.getValue();switch(g.glType){case f.UNSIGNED_BYTE:c=new Uint8Array(c);break;case f.UNSIGNED_SHORT:c=new Uint16Array(c);break;case f.UNSIGNED_INT:break;default:return XML3D.debug.logError("Uknown GL type for element buffer: ",g.glType),null}f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,
g);f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c)}else f.bindBuffer(f.ARRAY_BUFFER,g),f.bufferSubData(f.ARRAY_BUFFER,0,c.getValue());break;case Xflow.DATA_ENTRY_STATE.CHANGED_NEW:case Xflow.DATA_ENTRY_STATE.CHANGED_SIZE:case Xflow.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:a?(g=c.getValue(),i=d.maxIndex,f=b.gl,a=g,h=f.UNSIGNED_INT,256>i?(h=f.UNSIGNED_BYTE,a=new Uint8Array(g)):65536>i?(h=f.UNSIGNED_SHORT,a=new Uint16Array(g)):b.extensions[e.GLContext.EXTENSIONS.UINT32_INDICES]||(XML3D.debug.logError("Trying to use index data with indices larger than 65535, but this is not supported on your platform. Indexing errors will occur."),
h=f.UNSIGNED_SHORT,a=new Uint16Array(g)),b=f.createBuffer(),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a,f.STATIC_DRAW),b.length=g.length,b.glType=h):(g=c.getValue(),f=b.gl,b=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,b),f.bufferData(f.ARRAY_BUFFER,g,f.STATIC_DRAW),b.length=g.length,f=window.WebGLRenderingContext,b.glType=g instanceof Int8Array?f.BYTE:g instanceof Uint8Array?f.UNSIGNED_BYTE:g instanceof Int16Array?f.SHORT:g instanceof Uint16Array?f.UNSIGNED_SHORT:
g instanceof Int32Array?f.INT:g instanceof Uint32Array?f.UNSIGNED_INT:f.FLOAT),g=b,g.tupleSize=c.getTupleSize(),d.buffer=g}d.changed=0;return g};e.getGLUniformValueFromXflowDataEntry=function(c,b){var a;if(!c)return null;if(c.type==Xflow.DATA_TYPE.TEXTURE){var d=b.gl;a=b.getXflowEntryWebGlData(c);d=a.texture||new XML3D.webgl.GLTexture(d);a.changed&&d.updateFromTextureEntry(c);a.texture=d;a.changed=0;a=[d]}else if(c.type==Xflow.DATA_TYPE.BOOL){a=c.getValue();for(var d=[a.length],e=0;e<a.length;e++)d[e]=
a[e];a=d}else a=c.getValue();return a};e.canvasToGlY=function(c,b){return c.height-b-1};e.FRAGMENT_HEADER="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif // GL_FRAGMENT_PRECISION_HIGH\n\n";e.addFragmentShaderHeader=function(c){return e.FRAGMENT_HEADER+c};e.setUniform=function(c,b,a,d){switch(b.glType){case 35670:case 5124:case 35678:case 35680:a&&void 0!==a.length?c.uniform1iv(b.location,a):c.uniform1i(b.location,a||0);break;case 35671:case 35667:c.uniform2iv(b.location,
a);break;case 35672:case 35668:c.uniform3iv(b.location,a);break;case 35673:case 35669:c.uniform4iv(b.location,a);break;case 5126:null!=a.length?c.uniform1fv(b.location,a):c.uniform1f(b.location,a);break;case 35664:c.uniform2fv(b.location,a);break;case 35665:c.uniform3fv(b.location,a);break;case 35666:c.uniform4fv(b.location,a);break;case 35674:c.uniformMatrix2fv(b.location,d||!1,a);break;case 35675:c.uniformMatrix3fv(b.location,d||!1,a);break;case 35676:c.uniformMatrix4fv(b.location,d||!1,a);break;
default:XML3D.debug.logError("Unknown uniform type "+b.glType)}}})(XML3D.webgl);
(function(e){var c=function(b){this.gl=b.gl;this.createGLAssets(this.gl)};XML3D.extend(c.prototype,{createGLAssets:function(b){this.posBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.posBuffer);b.bufferData(b.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]),b.STATIC_DRAW)},draw:function(b){var a=this.gl,b=b.attributes.position;a.enableVertexAttribArray(b.location);a.bindBuffer(a.ARRAY_BUFFER,this.posBuffer);a.vertexAttribPointer(b.location,3,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLE_STRIP,
0,4);a.disableVertexAttribArray(b.location)}});e.FullscreenQuad=c})(XML3D.webgl);(function(e){var c=function(b){this.mainRenderPass=null;this.renderInterface=b};XML3D.extend(c.prototype,{render:function(b){this.mainRenderPass.renderTree(b)}});e.BaseRenderTree=c})(XML3D.webgl);
(function(e){var c=function(b,a){e.BaseRenderTree.call(this,b);var c=b.scene;c.addEventListener(e.Scene.EVENT_TYPE.LIGHT_STRUCTURE_CHANGED,this.onLightStructureChange.bind(this));c.addEventListener(e.Scene.EVENT_TYPE.LIGHT_VALUE_CHANGED,this.onLightValueChange.bind(this));c.addEventListener(e.Scene.EVENT_TYPE.SCENE_SHAPE_CHANGED,this.onSceneShapeChange.bind(this));c.addEventListener(e.ShaderComposerFactory.EVENT_TYPE.MATERIAL_INITIALIZED,this.onShaderChange.bind(this));this._enableSSAO=a;this.mainPass=
null;this.createMainPass()};XML3D.createClass(c,e.BaseRenderTree);XML3D.extend(c.prototype,{onLightStructureChange:function(b){var a=b.light;b.removed?a.userData=null:"spot"==a.light.type?a.userData=this.createLightPass(a):"directional"==a.light.type?a.userData=this.createLightPass(a):"point"==a.light.type&&(a.userData=this.createPointLightPass(a));this.reassignLightPasses(b.target)},onLightValueChange:function(b){b.light.castShadow&&b.light.visible&&b.light.userData&&b.light.userData.setProcessed(!1)},
onSceneShapeChange:function(b){for(var b=b.target,a=0;a<b.lights.spot.length;a++){var c=b.lights.spot[a];c.castShadow&&c.visible&&c.userData&&c.userData.setProcessed(!1)}for(a=0;a<b.lights.directional.length;a++)c=b.lights.directional[a],c.castShadow&&c.visible&&c.userData&&c.userData.setProcessed(!1);for(a=0;a<b.lights.point.length;a++)c=b.lights.point[a],c.castShadow&&c.visible&&c.userData&&c.userData.setProcessed(!1)},onShaderChange:function(b){this.reassignLightPasses(b.target)},createLightPass:function(b){var a=
this.renderInterface.context,c=2*Math.max(a.canvasTarget.width,a.canvasTarget.height),c=new e.GLRenderTarget(a,{width:c,height:c,colorFormat:a.gl.RGBA,depthFormat:a.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0}),b=new e.LightPass(this.renderInterface,c,b);b.init(a);return b},createPointLightPass:function(b){var a=this.renderInterface.context,c=2*Math.max(a.canvasTarget.width,a.canvasTarget.height),c=new e.GLCubeMapRenderTarget(a,{width:c,height:c,colorFormat:a.gl.RGBA,depthFormat:a.gl.DEPTH_COMPONENT16,
stencilFormat:null,depthAsRenderbuffer:!0}),b=new e.PointLightPass(this.renderInterface,c,b);b.init(a);return b},reassignLightPasses:function(b){this.mainPass.clearLightPasses();for(var a=0;a<b.lights.spot.length;a++){var c=b.lights.spot[a];this.mainPass.addLightPass("spotLightShadowMap",c.userData);(!c.castShadow||!c.visible)&&c.userData.setProcessed(!0)}for(a=0;a<b.lights.directional.length;a++)c=b.lights.directional[a],this.mainPass.addLightPass("directionalLightShadowMap",c.userData),(!c.castShadow||
!c.visible)&&c.userData.setProcessed(!0);for(a=0;a<b.lights.point.length;a++)c=b.lights.point[a],this.mainPass.addLightPass("pointLightShadowMap",c.userData),(!c.castShadow||!c.visible)&&c.userData.setProcessed(!0)},createMainPass:function(){var b=this.renderInterface.context.canvasTarget;if(this._enableSSAO){var a=this.createVertexAttributePass("render-position"),c=this.createVertexAttributePass("render-normal"),g=this.createSSAOPass(a.output,c.output);g.addPrePass(a);g.addPrePass(c);var f=this.createBlurPass(g.output);
f.addPrePass(g);this._blurPass=f;this._ssaoPass=g;this._positionPass=a;this._normalPass=c;this.mainPass=new e.ForwardRenderPass(this.renderInterface,b,{inputs:{ssaoMap:f.output}});this.mainPass.addPrePass(f)}else this.mainPass=new e.ForwardRenderPass(this.renderInterface,b);this.mainRenderPass=this.mainPass},createVertexAttributePass:function(b){var a=this.renderInterface.context,a=new e.GLRenderTarget(a,{width:a.canvasTarget.width,height:a.canvasTarget.height,colorFormat:a.gl.RGBA,colorType:a.gl.FLOAT,
depthFormat:a.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new e.VertexAttributePass(this.renderInterface,a,{programName:b})},createSSAOPass:function(b,a){var c=this.renderInterface.context,c=new e.GLRenderTarget(c,{width:c.canvasTarget.width,height:c.canvasTarget.height,colorFormat:c.gl.RGBA,depthFormat:c.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new e.SSAOPass(this.renderInterface,c,{inputs:{positionBuffer:b,normalBuffer:a}})},createBlurPass:function(b){var a=
this.renderInterface.context,a=new e.GLRenderTarget(a,{width:b.width,height:b.height,colorFormat:a.gl.RGBA,depthFormat:a.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new e.BoxBlurPass(this.renderInterface,a,{inputs:{buffer:b}})},render:function(b){this._enableSSAO&&(this._positionPass.setProcessed(!1),this._normalPass.setProcessed(!1),this._ssaoPass.setProcessed(!1),this._blurPass.setProcessed(!1));this.mainRenderPass.setProcessed(!1);e.BaseRenderTree.prototype.render.call(this,
b)},getRenderStats:function(){return this.mainPass.getRenderStats()}});e.ForwardRenderTree=c})(XML3D.webgl);
(function(e){var c={"renderer-ssao":{defaultValue:!1,recompileOnChange:!0}},b;for(b in c)XML3D.options.register(b,c[b].defaultValue);c=function(a,b,c){this.context=a;this.scene=b;this.canvas=c;this.width=c.clientWidth;this.height=c.clientHeight;this.pickedObject=null;this.needsPickingDraw=this.needsDraw=!0;this.context.requestRedraw=this.requestRedraw.bind(this);this.rayCamera=this.scene.createRenderView();this.initGL();this.changeListener=new XML3D.webgl.DataChangeListener(this);this.renderInterface=
this.createRenderInterface();this.createDefaultPipelines();XML3D.options.addObserver(this.onFlagsChange.bind(this))};c.prototype.generateRay=function(){};XML3D.extend(c.prototype,{initGL:function(){var a=this.context.gl;a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(0);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.frontFace(a.CCW);a.cullFace(a.BACK);a.disable(a.CULL_FACE);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.disable(a.BLEND);a.viewport(0,0,this.width,
this.height);a.pixelStorei(a.PACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL)},handleResizeEvent:function(a,b){this.width=a;this.height=b;this.context.handleResizeEvent(a,b);this.createDefaultPipelines();this.scene.handleResizeEvent(a,b);this.needsDraw=this.needsPickingDraw=!0},createDefaultPipelines:function(){this.renderInterface.setRenderPipeline(new XML3D.webgl.ForwardRenderTree(this.renderInterface,
XML3D.options.getValue("renderer-ssao")));var a=new e.GLScaledRenderTarget(this.context,e.MAX_PICK_BUFFER_DIMENSION,{width:this.context.canvasTarget.width,height:this.context.canvasTarget.height,colorFormat:this.context.gl.RGBA,depthFormat:this.context.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});this.pickObjectPass=new e.PickObjectRenderPass(this.renderInterface,a);this.pickPositionPass=new e.PickPositionRenderPass(this.renderInterface,a);this.pickNormalPass=new e.PickNormalRenderPass(this.renderInterface,
a)},createRenderInterface:function(){return new XML3D.webgl.RenderInterface(this.context,this.scene)},requestRedraw:function(a){XML3D.debug.logDebug("Request redraw because:",a);this.needsPickingDraw=this.needsDraw=!0},getWorldSpaceNormalByPoint:function(a,b,c){c=c||this.pickedObject;if(!c)return null;b=e.canvasToGlY(this.canvas,b);this.pickNormalPass.render(c);this.needsPickingDraw=!0;return this.pickNormalPass.readNormalFromPickingBuffer(a,b)},getWorldSpacePositionByPoint:function(a,b,c){c=c||this.pickedObject;
if(!c)return null;b=e.canvasToGlY(this.canvas,b);this.pickPositionPass.render(c);this.needsPickingDraw=!0;return this.pickPositionPass.readPositionFromPickingBuffer(a,b)},getRenderObjectByRay:function(a,b,c){a=this.scene.findRayIntersections(a);this.pickObjectPass.render(a,b,c);b=Math.floor(this.pickObjectPass.output.getWidth()/2/this.pickObjectPass.output.getScale());c=Math.floor(this.pickObjectPass.output.getHeight()/2/this.pickObjectPass.output.getScale());return this.pickObjectPass.getRenderObjectFromPickingBuffer(b,
c,a)},getWorldSpaceNormalByRay:function(a,b,c,e){if(!b)return null;this.pickNormalPass.render(b,c,e);a=Math.floor(this.pickNormalPass.output.getWidth()/2/this.pickNormalPass.output.getScale());b=Math.floor(this.pickNormalPass.output.getHeight()/2/this.pickNormalPass.output.getScale());return this.pickNormalPass.readNormalFromPickingBuffer(a,b)},getWorldSpacePositionByRay:function(a,b,c,e){if(!b)return null;this.pickPositionPass.render(b,c,e);a=Math.floor(this.pickPositionPass.output.getWidth()/2/
this.pickPositionPass.output.getScale());b=Math.floor(this.pickPositionPass.output.getHeight()/2/this.pickPositionPass.output.getScale());return this.pickPositionPass.readPositionFromPickingBuffer(a,b)},calculateMatricesForRay:function(a,b,c){this.rayCamera.updatePosition(a.origin._data);this.rayCamera.updateOrientation(this.calculateOrientationForRayDirection(a));this.rayCamera.getWorldToViewMatrix(b);a=this.pickObjectPass.output.getWidth()/this.pickObjectPass.output.getHeight();this.rayCamera.getProjectionMatrix(c,
a)},calculateOrientationForRayDirection:function(){var a=XML3D.math.vec3.create(),b=XML3D.math.vec3.create(),c=XML3D.math.vec3.create(),e=XML3D.math.vec3.create(),h=XML3D.math.quat.create(),i=XML3D.math.mat4.create();return function(j){XML3D.math.vec3.set(e,0,1,0);XML3D.math.vec3.cross(a,j.direction._data,e);XML3D.math.vec3.length(a)||XML3D.math.vec3.set(a,1,0,0);XML3D.math.vec3.cross(b,a,j.direction._data);XML3D.math.vec3.negate(c,j.direction._data);XML3D.math.quat.setFromBasis(a,b,c,h);XML3D.math.mat4.fromRotationTranslation(i,
h,[0,0,0]);return i}}(),needsRedraw:function(){return this.needsDraw},renderToCanvas:function(){this.prepareRendering();this.renderInterface.getRenderPipeline().render(this.scene);var a=this.renderInterface.getRenderPipeline().getRenderStats();XML3D.debug.logDebug("Rendered to Canvas");this.needsDraw=!1;return a},getRenderObjectFromPickingBuffer:function(a,b){b=e.canvasToGlY(this.canvas,b);this.needsPickingDraw&&(this.prepareRendering(),this.scene.updateReadyObjectsFromActiveView(this.pickObjectPass.output.getWidth()/
this.pickObjectPass.output.getHeight()),this.pickObjectPass.render(this.scene.ready),this.needsPickingDraw=!1,XML3D.debug.logDebug("Rendered Picking Buffer"));return this.pickedObject=this.pickObjectPass.getRenderObjectFromPickingBuffer(a,b,this.scene.ready)},prepareRendering:function(){this.scene.update()},generateRay:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(c,e){var h=XML3D.webgl.canvasToGlY(this.canvas,e),i=[0,0];i[2]=this.width;i[3]=this.height;var j=
this.scene.getActiveView();j.getWorldToViewMatrix(a);j.getProjectionMatrix(b,i[2]/i[3]);var j=new window.XML3DRay,k=[],l=[];if(!1===GLU.unProject(c,h,0,a,b,i,k)||!1===GLU.unProject(c,h,1,a,b,i,l))return j;XML3D.math.mat4.invert(a,a);h=new window.XML3DVec3(a[12],a[13],a[14]);j.origin.set(h);j.direction.set(l[0]-k[0],l[1]-k[1],l[2]-k[2]);j.direction.set(j.direction.normalize());return j}}(),dispose:function(){this.scene.clear()},getRenderInterface:function(){return this.renderInterface},onFlagsChange:function(a){"renderer-ssao"==
a&&(this.scene.shaderFactory.setShaderRecompile(),this.createDefaultPipelines())}});e.GLRenderer=c})(XML3D.webgl);
(function(e){var c={"shadejs-extractUniformExpressions":{defaultValue:!1,recompileOnChange:!0},"shadejs-transformSpaces":{defaultValue:!0,recompileOnChange:!0},"renderer-frustumCulling":{defaultValue:!0,recompileOnChange:!1},"shadejs-cache":{defaultValue:!0,recompileOnChange:!1}},b;for(b in c)XML3D.options.register(b,c[b].defaultValue);b=function(a){e.Scene.call(this);this.context=a;this.shaderFactory=new e.ShaderComposerFactory(a);this.drawableFactory=new e.DrawableFactory(a);this.firstOpaqueIndex=
0;this.ready=[];this.queue=[];this.lightsNeedUpdate=!0;this.systemUniforms={};this.deferred=window.XML3D_DEFERRED||!1;this.colorClosureSignatures=[];this.doFrustumCulling=!!XML3D.options.getValue("renderer-frustumCulling");this.addListeners()};var a=e.Scene.EVENT_TYPE;XML3D.createClass(b,e.Scene);b.LIGHT_PARAMETERS="pointLightPosition,pointLightAttenuation,pointLightIntensity,pointLightOn,pointLightCastShadow,pointLightMatrix,pointLightShadowBias,pointLightNearFar,directionalLightDirection,directionalLightIntensity,directionalLightOn,directionalLightCastShadow,directionalLightMatrix,directionalLightShadowBias,spotLightAttenuation,spotLightPosition,spotLightIntensity,spotLightDirection,spotLightOn,spotLightSoftness,spotLightCosFalloffAngle,spotLightCosSoftFalloffAngle,spotLightCastShadow,spotLightMatrix,spotLightShadowBias".split(",");
XML3D.extend(b.prototype,{remove:function(a){var b=this.queue.indexOf(a);-1!=b&&this.queue.splice(b,1);b=this.ready.indexOf(a);-1!=b&&(this.ready.splice(b,1),b<this.firstOpaqueIndex&&this.firstOpaqueIndex--)},clear:function(){this.ready=[];this.queue=[]},moveFromQueueToReady:function(a){var b=this.queue.indexOf(a);-1!=b&&(this.queue.splice(b,1),a.hasTransparency()?(this.ready.unshift(a),this.firstOpaqueIndex++):this.ready.push(a))},moveFromReadyToQueue:function(a){var b=this.ready.indexOf(a);-1!=
b&&(this.ready.splice(b,1),b<this.firstOpaqueIndex&&this.firstOpaqueIndex--,this.queue.push(a))},update:function(){this.lightsNeedUpdate&&(this.lightsNeedUpdate=!1,this.updateLightParameters());this.updateObjectsForRendering();this.updateShaders()},updateLightParameters:function(){var a=this.systemUniforms,b=this.lights,c={position:[],attenuation:[],intensity:[],on:[],castShadow:[],lightMatrix:[],shadowBias:[],lightNearFar:[]};b.point.forEach(function(a,b){a.getLightData(c,b)});a.pointLightPosition=
c.position;a.pointLightAttenuation=c.attenuation;a.pointLightIntensity=c.intensity;a.pointLightOn=c.on;a.pointLightCastShadow=c.castShadow;a.pointLightMatrix=c.lightMatrix;a.pointLightShadowBias=c.shadowBias;a.pointLightNearFar=c.lightNearFar;var e={direction:[],intensity:[],on:[],castShadow:[],lightMatrix:[],shadowBias:[]};b.directional.forEach(function(a,b){a.getLightData(e,b)});a.directionalLightDirection=e.direction;a.directionalLightIntensity=e.intensity;a.directionalLightOn=e.on;a.directionalLightCastShadow=
e.castShadow;a.directionalLightMatrix=e.lightMatrix;a.directionalLightShadowBias=e.shadowBias;var i={position:[],attenuation:[],direction:[],intensity:[],on:[],softness:[],falloffAngle:[],castShadow:[],lightMatrix:[],shadowBias:[]};b.spot.forEach(function(a,b){a.getLightData(i,b)});a.spotLightAttenuation=i.attenuation;a.spotLightPosition=i.position;a.spotLightIntensity=i.intensity;a.spotLightDirection=i.direction;a.spotLightOn=i.on;a.spotLightSoftness=i.softness;a.spotLightCastShadow=i.castShadow;
a.spotLightMatrix=i.lightMatrix;a.spotLightShadowBias=i.shadowBias;for(var j=[],k=0;k<b.spot.length;k++)j[k]=i.falloffAngle[k]*(1-i.softness[k]);a.spotLightCosFalloffAngle=i.falloffAngle.map(Math.cos);a.spotLightCosSoftFalloffAngle=j.map(Math.cos)},updateSystemUniforms:function(a){this.shaderFactory.updateSystemUniforms(a,this)},updateShaders:function(){this.shaderFactory.update(this)},updateObjectsForRendering:function(){this.forEach(function(a){a.updateForRendering()})},forEach:function(a,b){this.queue.slice().forEach(a,
b);this.ready.slice().forEach(a,b)},updateReadyObjectsFromActiveView:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create(),c=XML3D.math.mat4.create(),e=XML3D.math.bbox.create(),i=new XML3D.webgl.FrustumTest;return function(j){var k=this.getActiveView(),l=this.ready;k.getWorldToViewMatrix(a);l.forEach(function(b){b.updateModelViewMatrix(a);b.updateModelMatrixN();b.updateModelViewMatrixN()});this.updateBoundingBox();k.getProjectionMatrix(c,j);k.getViewToWorldMatrix(b);j=k.getFrustum();
i.set(j,b);j=0;for(k=l.length;j<k;j++){var m=l[j];m.updateModelViewProjectionMatrix(c);m.getWorldSpaceBoundingBox(e);m.inFrustum=this.doFrustumCulling?i.isBoxVisible(e):!0}}}(),updateReadyObjectsFromMatrices:function(a,b){for(var c=this.ready,e=0,i=c.length;e<i;e++){var j=c[e];j.updateModelViewMatrix(a);j.updateModelMatrixN();j.updateModelViewProjectionMatrix(b)}},addListeners:function(){this.addEventListener(a.SCENE_STRUCTURE_CHANGED,function(a){void 0!==a.newChild?this.addChildEvent(a.newChild):
void 0!==a.removedChild&&this.removeChildEvent(a.removedChild)});this.addEventListener(a.VIEW_CHANGED,function(){this.context.requestRedraw("Active view changed.")});this.addEventListener(a.LIGHT_STRUCTURE_CHANGED,function(){this.lightsNeedUpdate=!0;this.shaderFactory.setLightStructureDirty();this.context.requestRedraw("Light structure changed.")});this.addEventListener(a.LIGHT_VALUE_CHANGED,function(){this.lightsNeedUpdate=!0;this.shaderFactory.setLightValueChanged();this.context.requestRedraw("Light value changed.")});
XML3D.options.addObserver(this.onFlagsChange.bind(this))},addChildEvent:function(a){a.type==e.Scene.NODE_TYPE.OBJECT&&(this.queue.push(a),this.context.requestRedraw("Object was added to scene."))},removeChildEvent:function(a){a.type==e.Scene.NODE_TYPE.OBJECT&&(this.remove(a),a.dispose(),this.context.requestRedraw("Object was removed from scene."))},handleResizeEvent:function(){this.getActiveView().setProjectionDirty()},createDrawable:function(a){return this.drawableFactory.createDrawable(a)},requestRedraw:function(a){return this.context.requestRedraw(a)},
onFlagsChange:function(a,b){c[a]&&c[a].recompileOnChange&&this.shaderFactory.setShaderRecompile();"renderer-frustumCulling"==a&&(this.doFrustumCulling=!!b)}});e.GLScene=b})(XML3D.webgl);
(function(e){var c=function(){},b=XML3D.math.bbox.create(),a=XML3D.math.vec3.create();XML3D.extend(c.prototype,{sortScene:function(c,e){for(var f=c.ready,h=c.firstOpaqueIndex,i=[],j=[],k=[],l,m=0,o=f.length;m<o;m++)if(l=f[m],!1!==l.inFrustum)if(m<h)k.push(l);else{var n=l.getProgram();i[n.id]=i[n.id]||[];i[n.id].push(l)}f=k.length;if(1<f){for(m=0;m<f;m++)l=k[m],l.getWorldSpaceBoundingBox(b),XML3D.math.bbox.center(a,b),e&&XML3D.math.vec3.transformMat4(a,a,e),k[m]=[l,a[2]];k.sort(function(a,b){return a[1]-
b[1]});for(m=0;m<f;m++)j[m]=k[m][0]}else 1==f&&(j[0]=k[0]);return{opaque:i,transparent:j}}});e.ObjectSorter=c})(XML3D.webgl);
(function(e){var c=function(b,a,c){this.renderInterface=b;this.output=a;c=c||{};this.inputs=c.inputs||{};this.id=c.id||"";this.prePasses=[];this.postPasses=[];this.processed=!1};XML3D.extend(c.prototype,{addPrePass:function(b){-1===this.prePasses.indexOf(b)&&(this.prePasses.push(b),b.postPasses.push(this))},removePrePass:function(b){var a=this.prePasses.indexOf(b);-1!==a&&(this.prePasses.splice(a,1),b.postPasses.splice(b.postPasses.indexOf(this),1))},clearPrePasses:function(){for(var b=this.prePasses.length;b--;)this.removePrePass(this.prePasses[b])},
setProcessed:function(b){if(this.processed&&!b)for(var a=this.postPasses.length;a--;)this.postPasses[a].setProcessed(!1);this.processed=b},renderTree:function(b){if(!this.processed){this.processed=!0;for(var a=this.prePasses.length;a--;)this.prePasses[a].renderTree(b);this.render(b)}},readPixelDataFromBuffer:function(){var b=new Uint8Array(8);return function(a,c,e){var f=this.renderInterface.context.gl,h=e.getScale(),a=a*h,c=c*h;e.bind();try{return f.readPixels(a,c,1,1,f.RGBA,f.UNSIGNED_BYTE,b),e.unbind(),
b}catch(i){return XML3D.debug.logException(i),e.unbind(),null}}}()});e.BaseRenderPass=c})(XML3D.webgl);
(function(e){function c(a){return"cw"==a.toLowerCase()?function(a){a.frontFace(a.CW)}:function(a){a.frontFace(a.CCW)}}function b(a){switch(a.toLowerCase()){case "back":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.BACK)};case "front":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.FRONT)};case "both":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.FRONT_AND_BACK)};default:return function(a){a.disable(a.CULL_FACE)}}}XML3D.options.register("renderer-faceculling","none");XML3D.options.register("renderer-frontface",
"ccw");var a=function(a,g,f){e.BaseRenderPass.call(this,a,g,f);this.setFaceCulling=b(XML3D.options.getValue("renderer-faceculling"));this.setFrontFace=c(XML3D.options.getValue("renderer-frontface"));var h=this;XML3D.options.addObserver("renderer-faceculling",function(a,c){h.setFaceCulling=b(c)});XML3D.options.addObserver("renderer-frontface",function(a,b){h.setFrontFace=c(b)})};XML3D.createClass(a,e.BaseRenderPass,{setGLStates:function(){var a=this.renderInterface.context.gl;a.clear(a.COLOR_BUFFER_BIT|
a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);this.setFaceCulling(a);this.setFrontFace(a);a.enable(a.DEPTH_TEST)},renderObjectsToActiveBuffer:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat3.create(),c=XML3D.math.mat4.create(),e=XML3D.math.mat4.create(),i=XML3D.math.mat3.create(),j=["modelMatrix","modelMatrixN","modelViewMatrix","modelViewProjectionMatrix","modelViewMatrixN"];return function(k,l,m,o,n,p){var m=l=0,q=p.stats||{},r=!0===p.transparent||!1,v=this.renderInterface.context.gl,p=p.program||
k[0].getProgram();if(0==k.length)return q;r&&(v.enable(v.BLEND),v.blendFuncSeparate(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE,v.ONE_MINUS_SRC_ALPHA));p.bind();p.setSystemUniformVariables(n,o);for(var n=null,t=0,y=k.length;t<y;t++){var w=k[t];if(w.isVisible()){var s=w.mesh;XML3D.debug.assert(s,"We need a mesh at this point.");w.getWorldMatrix(a);o.modelMatrix=a;w.getModelMatrixN(b);o.modelMatrixN=b;w.getModelViewMatrix(c);o.modelViewMatrix=c;w.getModelViewProjectionMatrix(e);o.modelViewProjectionMatrix=
e;w.getModelViewMatrixN(i);o.modelViewMatrixN=i;p.setSystemUniformVariables(j,o);p.changeUniformVariableOverride(n,s.uniformOverride);n=s.uniformOverride;m+=s.draw(p);l++;r&&v.disable(v.BLEND)}}p.changeUniformVariableOverride(n,null);p.unbind();q.objects+=l;q.primitives+=m;return q}}()});e.SceneRenderPass=a})(XML3D.webgl);
(function(e){var c=function(b,a,c,g){e.SceneRenderPass.call(this,b,a,g);this.light=c;this.program=null};XML3D.createClass(c,e.SceneRenderPass,{init:function(b){this.sorter=new e.ObjectSorter;this.program=b.programFactory.getProgramByName("light-depth")},render:function(){var b=XML3D.math.mat4.create(),a=XML3D.math.mat4.create(),c=["viewMatrix","projectionMatrix"];return function(e){var f=this.renderInterface.context.gl,h=this.output,i=h.getWidth(),j=h.getHeight(),k=i/j,l=this.light.getFrustum(k),
m=this.program;h.bind();f.clear(f.DEPTH_BUFFER_BIT|f.COLOR_BUFFER_BIT);f.viewport(0,0,i,j);f.enable(f.DEPTH_TEST);f={objects:0,primitives:0};this.light.getWorldToLightMatrix(b);l.getProjectionMatrix(a,k);e.updateReadyObjectsFromMatrices(b,a);k=this.sorter.sortScene(e);l={};l.viewMatrix=b;l.projectionMatrix=a;for(var o in k.opaque)this.renderObjectsToActiveBuffer(k.opaque[o],e,h,l,c,{transparent:!1,stats:f,program:m});h.unbind();return{count:f}}}()});e.LightPass=c})(XML3D.webgl);
(function(e){var c=function(b,a,c,g){e.SceneRenderPass.call(this,b,a,g);this.light=c;this.program=null};XML3D.createClass(c,e.SceneRenderPass,{init:function(b){this.sorter=new e.ObjectSorter;this.program=b.programFactory.getProgramByName("light-depth")},render:function(){var b=XML3D.math.mat4.create(),a=XML3D.math.mat4.create(),c=["viewMatrix","projectionMatrix"];return function(e){for(var f=this.renderInterface.context.gl,h=this.output,i=h.getWidth(),j=h.getHeight(),k=i/j,l=this.light.getFrustum(k),
m=this.program,o=0;o<h.glSides.length;o++){var n=XML3D.math.mat4.create();XML3D.math.mat4.identity(n);0==o?(n[0]=0,n[1]=0,n[2]=-1,n[4]=0,n[5]=-1,n[6]=0,n[8]=-1,n[9]=0,n[10]=0):1==o?(n[0]=0,n[1]=0,n[2]=1,n[4]=0,n[5]=-1,n[6]=0,n[8]=1,n[9]=0,n[10]=0):2==o?(n[0]=1,n[1]=0,n[2]=0,n[4]=0,n[5]=0,n[6]=-1,n[8]=0,n[9]=1,n[10]=0):3==o?(n[0]=1,n[1]=0,n[2]=0,n[4]=0,n[5]=0,n[6]=1,n[8]=0,n[9]=-1,n[10]=0):4==o?(n[0]=1,n[1]=0,n[2]=0,n[4]=0,n[5]=-1,n[6]=0,n[8]=0,n[9]=0,n[10]=-1):5==o&&(n[0]=-1,n[1]=0,n[2]=0,n[4]=0,
n[5]=-1,n[6]=0,n[8]=0,n[9]=0,n[10]=1);h.bind(o);f.clear(f.DEPTH_BUFFER_BIT|f.COLOR_BUFFER_BIT);f.viewport(0,0,i,j);f.enable(f.DEPTH_TEST);var p={objects:0,primitives:0};this.light.getWorldToLightMatrix(b);XML3D.math.mat4.mul(b,n,b);l.getProjectionMatrix(a,k);e.updateReadyObjectsFromMatrices(b,a);var n=this.sorter.sortScene(e),q={};q.viewMatrix=b;q.projectionMatrix=a;for(var r in n.opaque)this.renderObjectsToActiveBuffer(n.opaque[r],e,h,q,c,{transparent:!1,stats:p,program:m});h.unbind()}return{count:p}}}()});
e.PointLightPass=c})(XML3D.webgl);
(function(e){var c=function(b,a,c){e.SceneRenderPass.call(this,b,a,c);this.sorter=new e.ObjectSorter;this.reassignShadowMaps={};this.lightPasses={};this.lastRenderStats={}};XML3D.createClass(c,e.SceneRenderPass);XML3D.extend(c.prototype,{clearLightPasses:function(){var b=this;Object.keys(this.lightPasses).forEach(function(a){b.removePrePass(b.lightPasses[a])});this.lightPasses={};for(var a in this.reassignShadowMaps)this.reassignShadowMaps[a]=!0},addLightPass:function(b,a){this.lightPasses[b]||(this.lightPasses[b]=
[]);this.lightPasses[b].push(a);a&&this.addPrePass(a);this.reassignShadowMaps[b]=!0},setShadowMapReassign:function(b){this.reassignShadowMaps[b]=!0},updateShadowMapUniforms:function(b){var a=[],c;for(c in this.reassignShadowMaps)if(this.reassignShadowMaps[c]){this.reassignShadowMaps[c]=!1;a.push(c);var e=this.lightPasses[c];b.systemUniforms[c]=[];if("undefined"!=typeof e)for(var f=0;f<e.length;++f){var h=e[f].output;b.systemUniforms[c].push(h&&h.colorTarget&&h.colorTarget.handle)}}0<a.length&&b.updateSystemUniforms(a)},
render:function(){var b=XML3D.math.mat4.create(),a=XML3D.math.mat4.create(),c=XML3D.math.mat4.create(),e="viewMatrix,viewInverseMatrix,projectionMatrix,cameraPosition,coords,ssaoMap,width".split(",");return function(f){var h=this.renderInterface.context.gl,i={objects:0,primitives:0},j=this.output,k=f.systemUniforms,l=j.getWidth(),m=j.getHeight(),o=l/m;this.updateShadowMapUniforms(f);j.bind();this.setGLStates();h.viewport(0,0,l,m);f.updateReadyObjectsFromActiveView(o);f.getActiveView().getWorldToViewMatrix(b);
f.getActiveView().getViewToWorldMatrix(a);f.getActiveView().getProjectionMatrix(c,o);h=this.sorter.sortScene(f,b);k.viewMatrix=b;k.viewInverseMatrix=a;k.projectionMatrix=c;k.cameraPosition=f.getActiveView().getWorldSpacePosition();k.coords=[j.width,j.height,1];this.inputs.ssaoMap&&(k.ssaoMap=[this.inputs.ssaoMap.colorTarget.handle]);for(var n in h.opaque)this.renderObjectsToActiveBuffer(h.opaque[n],f,j,k,e,{transparent:!1,stats:i});for(n=0;n<h.transparent.length;n++)this.renderObjectsToActiveBuffer([h.transparent[n]],
f,j,k,e,{transparent:!0,stats:i});f.lights.changed=!1;j.unbind();this.lastRenderStats.count=i}}(),getRenderStats:function(){return this.lastRenderStats}});e.ForwardRenderPass=c})(XML3D.webgl);
(function(e){var c=function(b,a,c){e.BaseRenderPass.call(this,b,a,c)};XML3D.createClass(c,e.BaseRenderPass);XML3D.extend(c.prototype,{render:function(){var b=XML3D.math.mat4.create(),a={envBase:{},envOverride:null,sysBase:{}},c=["id","modelViewProjectionMatrix"];return function(e,f,h){var i=this.renderInterface.context.gl,j=this.output;j.bind();i.enable(i.DEPTH_TEST);i.disable(i.CULL_FACE);i.disable(i.BLEND);i.viewport(0,0,j.getWidth(),j.getHeight());i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);
i=this.renderInterface.context.programFactory.getPickingObjectIdProgram();i.bind();for(var k=0,l=e.length;k<l;k++){var m=e[k],o=m.mesh;if(m.isVisible()){f&&h&&(m.updateModelViewMatrix(f),m.updateModelViewProjectionMatrix(h));m.getModelViewProjectionMatrix(b);var m=k+1,n=m&255,m=m>>8,p=m&255,m=m>>8;a.sysBase.id=[(m&255)/255,p/255,n/255];a.sysBase.modelViewProjectionMatrix=b;i.setUniformVariables(null,c,a);o.draw(i)}}i.unbind();j.unbind()}}(),getRenderObjectFromPickingBuffer:function(b,a,c){a=this.readPixelDataFromBuffer(b,
a,this.output);if(!a)return null;b=null;a=65536*a[0]+256*a[1]+a[2];0<a&&(b=c[a-1]);return b}});e.PickObjectRenderPass=c})(XML3D.webgl);
(function(e){var c=function(b,a,c){e.BaseRenderPass.call(this,b,a,c);this.objectBoundingBox=XML3D.math.bbox.create()};XML3D.createClass(c,e.BaseRenderPass,{render:function(){var b=XML3D.math.mat4.create(),a=XML3D.math.mat4.create(),c={envBase:{},envOverride:null,sysBase:{}},e=["bbox","modelMatrix","modelViewProjectionMatrix"];return function(f,h,i){var j=this.renderInterface.context.gl,k=this.output;k.bind();j.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT|j.STENCIL_BUFFER_BIT);j.enable(j.DEPTH_TEST);
j.disable(j.CULL_FACE);j.disable(j.BLEND);h&&i&&(f.updateModelViewMatrix(h),f.updateModelViewProjectionMatrix(i));f.getWorldMatrix(b);f.getObjectSpaceBoundingBox(this.objectBoundingBox);XML3D.math.bbox.transform(this.objectBoundingBox,b,this.objectBoundingBox);h=this.renderInterface.context.programFactory.getPickingPositionProgram();h.bind();f.getModelViewProjectionMatrix(a);c.sysBase.bbox=this.objectBoundingBox;c.sysBase.modelMatrix=b;c.sysBase.modelViewProjectionMatrix=a;h.setUniformVariables(null,
e,c);f.mesh.draw(h);h.unbind();k.unbind()}}(),readPositionFromPickingBuffer:function(){var b=XML3D.math.vec3.create();return function(a,c){var e=this.readPixelDataFromBuffer(a,c,this.output);return e?(b[0]=e[0]/255,b[1]=e[1]/255,b[2]=e[2]/255,e=XML3D.math.bbox.size(XML3D.math.vec3.create(),this.objectBoundingBox),e=XML3D.math.vec3.mul(e,b,e),XML3D.math.vec3.add(e,this.objectBoundingBox,e),e):null}}()});e.PickPositionRenderPass=c})(XML3D.webgl);
(function(e){var c=function(b,a,c){e.BaseRenderPass.call(this,b,a,c)};XML3D.createClass(c,e.BaseRenderPass,{render:function(){var b=XML3D.math.mat4.create(),a=XML3D.math.mat4.create(),c=XML3D.math.mat3.create(),e={envBase:{},envOverride:null,sysBase:{}},f=["modelViewProjectionMatrix","modelViewMatrixN"];return function(h,i,j){var k=this.renderInterface.context.gl,l=this.output;l.bind();k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT|k.STENCIL_BUFFER_BIT);k.enable(k.DEPTH_TEST);k.disable(k.CULL_FACE);
k.disable(k.BLEND);i&&j&&(h.updateModelViewMatrix(i),h.updateModelViewProjectionMatrix(j));h.getModelViewProjectionMatrix(b);h.getWorldMatrix(a);XML3D.math.mat4.invert(a,a)?(XML3D.math.mat3.fromMat4(c,a),XML3D.math.mat3.transpose(c,c)):XML3D.math.mat3.identity(c);i=this.renderInterface.context.programFactory.getPickingNormalProgram();i.bind();e.sysBase.modelViewProjectionMatrix=b;e.sysBase.modelViewMatrixN=c;i.setUniformVariables(null,f,e);h.mesh.draw(i);i.unbind();l.unbind()}}(),readNormalFromPickingBuffer:function(){var b=
XML3D.math.vec3.create(),a=XML3D.math.vec3.fromValues(1,1,1);return function(c,e){var f=this.readPixelDataFromBuffer(c,e,this.output);if(!f)return null;b[0]=f[0]/254;b[1]=f[1]/254;b[2]=f[2]/254;return XML3D.math.vec3.subtract(XML3D.math.vec3.create(),XML3D.math.vec3.scale(XML3D.math.vec3.create(),b,2),a)}}()});e.PickNormalRenderPass=c})(XML3D.webgl);
(function(e){var c=function(b,a,c){e.BaseRenderPass.call(this,b,a,c);this._program=this.renderInterface.context.programFactory.getProgramByName(c.programName)};XML3D.createClass(c,e.SceneRenderPass);XML3D.extend(c.prototype,{render:function(b){var a=this.renderInterface.context.gl,c=this.output,e=c.getWidth(),f=c.getHeight(),e=e/f;c.bind();a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.viewport(0,0,c.getWidth(),c.getHeight());a.enable(a.DEPTH_TEST);b.updateReadyObjectsFromActiveView(e);this.renderObjectsToActiveBuffer(b.ready,
b,c,b.systemUniforms,[],{transparent:!1,program:this._program});c.unbind()}});e.VertexAttributePass=c})(XML3D.webgl);
(function(e){var c={"renderer-ssao-scale":{defaultValue:1},"renderer-ssao-intensity":{defaultValue:5},"renderer-ssao-bias":{defaultValue:0.2},"renderer-ssao-radius":{defaultValue:1}},b;for(b in c)XML3D.options.register(b,c[b].defaultValue);c=function(a,b,c){e.BaseRenderPass.call(this,a,b,c);a=this.renderInterface.context;this._program=a.programFactory.getProgramByName("ssao");this.randomVectorTexture=this.createRandomVectorTexture(a);this.loadRandomVectorImage();this._screenQuad=new XML3D.webgl.FullscreenQuad(a);
this._uniformsDirty=!0};XML3D.createClass(c,e.BaseRenderPass);XML3D.extend(c.prototype,{createRandomVectorTexture:function(a){var a=a.gl,b=new XML3D.webgl.GLTexture(a);b.createTex2DFromData(a.RGBA,64,64,a.RGBA,a.UNSIGNED_BYTE,{wrapS:a.REPEAT,wrapT:a.REPEAT,minFilter:a.LINEAR,magFilter:a.LINEAR});b.isTexture=!0;return b},loadRandomVectorImage:function(){var a=new Image;a.src="data:image/png;base64,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";
var b=this.renderInterface.context.gl,c=this.randomVectorTexture.handle;a.onload=function(){b.bindTexture(b.TEXTURE_2D,c);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a)}},createVertexAttributePass:function(a){var b=this.renderInterface.context,b=new e.GLRenderTarget(b,{width:b.canvasTarget.width,height:b.canvasTarget.height,colorFormat:b.gl.RGBA,colorType:b.gl.FLOAT,depthFormat:b.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new e.VertexAttributePass(this.renderInterface,
b,{programName:a})},render:function(){var a=XML3D.math.mat4.create(),b=["viewMatrix"];return function(c){var e=this.renderInterface.context.gl,h=this.output;h.bind();e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.viewport(0,0,h.getWidth(),h.getHeight());e.disable(e.DEPTH_TEST);this._program.bind();this._setNonVolatileShaderUniforms();e={};c.getActiveView().getWorldToViewMatrix(a);e.viewMatrix=a;this._program.setSystemUniformVariables(b,e);this._screenQuad.draw(this._program);this._program.unbind();
h.unbind()}}(),_setNonVolatileShaderUniforms:function(){var a="canvasSize,sPositionTex,sNormalTex,sRandomNormals,uRandomTexSize,uScale,uBias,uIntensity,uSampleRadius,uConstVectors".split(",");return function(){if(this._uniformsDirty){var b={},c=this._program;c.bind();var e=this.output;b.canvasSize=[e.width,e.height];b.sPositionTex=[this.inputs.positionBuffer.colorTarget.handle];b.sNormalTex=[this.inputs.normalBuffer.colorTarget.handle];b.sRandomNormals=[this.randomVectorTexture];b.uRandomTexSize=
[64,64];b.uScale=XML3D.options.getValue("renderer-ssao-scale");b.uBias=XML3D.options.getValue("renderer-ssao-bias");b.uIntensity=XML3D.options.getValue("renderer-ssao-intensity");b.uSampleRadius=XML3D.options.getValue("renderer-ssao-radius");b.uConstVectors=[1,0,-1,0,0,1,0,-1];c.setSystemUniformVariables(a,b);c.unbind()}}}()});e.SSAOPass=c})(XML3D.webgl);
(function(e){var c=function(b,a,c){e.BaseRenderPass.call(this,b,a,c);this._program=this.renderInterface.context.programFactory.getProgramByName("boxblur");this._screenQuad=new XML3D.webgl.FullscreenQuad(this.renderInterface.context);this._uniformsDirty=!0};XML3D.createClass(c,e.BaseRenderPass);XML3D.extend(c.prototype,{render:function(){return function(){var b=this.renderInterface.context.gl,a=this.output;a.bind();b.clear(b.COLOR_BUFFER_BIT);b.disable(b.DEPTH_TEST);this._program.bind();this._setNonVolatileShaderUniforms();
this._screenQuad.draw(this._program);this._program.unbind();a.unbind()}}(),_setNonVolatileShaderUniforms:function(){var b={},a=["canvasSize","sInTexture","blurOffset"];return function(){if(this._uniformsDirty){var c=this._program,e=this.output;b.canvasSize=[e.width,e.height];b.sInTexture=[this.inputs.buffer.colorTarget.handle];b.blurOffset=[1,1];c.setSystemUniformVariables(a,b)}}}()});e.BoxBlurPass=c})(XML3D.webgl);
(function(e){var c=function(b){this.context=b;this.programs={fallback:null,picking:{id:null,normal:null,position:null}}};XML3D.extend(c.prototype,{getProgramByName:function(b){var a=XML3D.shaders.getScript(b);if(!a||!a.vertex)return XML3D.debug.logError("Unknown shader: ",b),null;b=new e.ShaderDescriptor;XML3D.extend(b,a);b.fragment=XML3D.webgl.addFragmentShaderHeader(b.fragment);a=new e.ShaderClosure(this.context,b);a.createSources({},null,null);a.compile();return a},getFallbackProgram:function(){if(!this.programs.fallback){var b=
new e.ShaderDescriptor;XML3D.extend(b,XML3D.shaders.getScript("matte"));b.fragment=XML3D.webgl.addFragmentShaderHeader(b.fragment);b=new e.ShaderClosure(this.context,b);b.uniformCollection.envBase.diffuseColor=[1,0,0];b.createSources({},null,null);b.compile();this.programs.fallback=b;this.programs.fallback.bind();this.programs.fallback.setUniformVariables(["diffuseColor"],null,{envBase:{diffuseColor:[1,0,0]}});this.programs.fallback.unbind()}return this.programs.fallback},getPickingObjectIdProgram:function(){var b=
this.programs.picking;b.id||(b.id=this.getProgramByName("pickobjectid"));return b.id},getPickingPositionProgram:function(){var b=this.programs.picking;b.position||(b.position=this.getProgramByName("pickedposition"));return b.position},getPickingNormalProgram:function(){var b=this.programs.picking;b.normal||(b.normal=this.getProgramByName("pickedNormals"));return b.normal}});e.ProgramFactory=c})(XML3D.webgl);
(function(e){var c=function(b){this.context=b};XML3D.extend(c.prototype,{createDrawable:function(b){XML3D.debug.logDebug("DrawableFactory::createDrawable",b);try{var a=new e.MeshClosure(this.context,b.getType(),b.getDataNode(),{boundingBoxChanged:b.setObjectSpaceBoundingBox.bind(b)});b.mesh=a.getMesh();return a}catch(c){return XML3D.debug.logError(c,b.node),null}}});e.DrawableFactory=c})(XML3D.webgl);
(function(e){var c=function(a,b){this.context=a;this.shaderClosures=[];this.updateLightValues=this.dataChanged=!1;this.request=null;b.addChangeListener(this.onShaderInfoChanged.bind(this))};XML3D.createClass(c,XML3D.util.EventDispatcher,{setShaderInfo:null,updateRequest:function(a){this.request&&this.request.clear();this.request=new Xflow.ComputeRequest(a,this.getRequestFields(),this.onShaderRequestChange.bind(this));this.setShaderRecompile()},onShaderInfoChanged:function(a){this.setShaderInfo(a);
this.setShaderRecompile();this.context.requestRedraw("Shader script changed")},onShaderRequestChange:function(a,b){this.dataChanged=!0;b==Xflow.RESULT_STATE.CHANGED_STRUCTURE&&this.setShaderRecompile();this.context.requestRedraw("Shader data changed")},update:function(a){for(var b=this,c=this.shaderClosures.length;c--;)this.shaderClosures[c].obsolete&&this.shaderClosures.splice(c,1);if(this.shaderClosures.length){if(this.dataChanged){var e=this.getShaderDataResult();this.shaderClosures.forEach(function(a){b.updateClosureFromComputeResult(a,
e)});this.dataChanged=!1}this.updateLightValues&&this.shaderClosures.forEach(function(c){b.updateClosureFromLightParameters(c,a)})}},updateClosureFromComputeResult:function(a,b){b&&b.getOutputMap&&(a.bind(),a.updateUniformsFromComputeResult(b))},updateClosureFromLightParameters:function(a,b){a.bind();a.setSystemUniformVariables(e.GLScene.LIGHT_PARAMETERS,b.systemUniforms)},updateSystemUniforms:function(a,b){this.shaderClosures.forEach(function(c){c.bind();c.setSystemUniformVariables(a,b.systemUniforms)})},
createShaderClosure:function(){throw Error("AbstractComposer::createShaderClosure needs to be overridden");},createObjectDataRequest:function(){throw Error("AbstractComposer::createObjectDataRequest needs to be overridden");},distributeObjectShaderData:function(){throw Error("AbstractComposer::distributeObjectShaderData needs to be overridden");},getShaderClosure:function(a,b){var c=this.createShaderClosure();try{c.createSources(a,this.getShaderDataResult(),b)}catch(e){throw Error("Shader: "+e.message);
}for(var h=0;h<this.shaderClosures.length;h++)if(this.shaderClosures[h].equals(c))return this.shaderClosures[h].obsolete=!1,this.shaderClosures[h];this.initializeShaderClosure(c,a);return c},initializeShaderClosure:function(a,b){a.compile();b.dispatchEvent({type:e.ShaderComposerFactory.EVENT_TYPE.MATERIAL_INITIALIZED});this.updateClosureFromComputeResult(a,this.getShaderDataResult());this.updateClosureFromLightParameters(a,b);this.shaderClosures.push(a)},setShaderRecompile:function(){for(var a=0;a<
this.shaderClosures.length;++a)this.shaderClosures[a].obsolete=!0;this.dispatchEvent({type:e.ShaderComposerFactory.EVENT_TYPE.MATERIAL_STRUCTURE_CHANGED});this.updateLightValues=this.dataChanged=!0},getShaderDataResult:function(){return this.request?this.request.getResult():null}});var b=function(a){this.context=a};XML3D.createClass(b,c,{update:function(){},getShaderClosure:function(){return this.context.programFactory.getFallbackProgram()},getShaderAttributes:function(){return{color:null,normal:null}},
getRequestFields:function(){return["diffuseColor","useVertexColor"]},createObjectDataRequest:function(a,b){return new Xflow.ComputeRequest(a,["position","color","normal","diffuseColor","useVertexColor"],b)},distributeObjectShaderData:function(a,b,c){var a=a.getResult().getOutputMap(),e=this.getRequestFields(),h;for(h in a)-1!=e.indexOf(h)?c(h,a[h]):b(h,a[h])}});e.AbstractShaderComposer=c;e.DefaultComposer=b})(XML3D.webgl);
(function(e){var c=function(){this.uniforms={};this.samplers={};this.attributes={};this.vertex=this.fragment=this.name=""};c.prototype.addDirectives=function(){};c.prototype.hasTransparency=function(){return!1};e.ShaderDescriptor=c;var b=function(a,b){e.AbstractShaderComposer.call(this,a,b);this.descriptor=null;this.setShaderInfo(b)};XML3D.createClass(b,e.AbstractShaderComposer,{setShaderInfo:function(a){this.setShaderScript(a.getScriptUri());this.descriptor&&(this.updateRequest(a.getData()),this.descriptor.fragment=
XML3D.webgl.addFragmentShaderHeader(this.descriptor.fragment))},setShaderScript:function(a){if(a)if("urn"!=a.scheme)XML3D.debug.logError("Shader script reference should start with an URN: ",this.adapter.node);else{var b;b=a.path;b=b.substring(b.lastIndexOf(":")+1);(b=XML3D.shaders.getScript(b))?(this.descriptor=new c,XML3D.extend(this.descriptor,b)):XML3D.debug.logError("No Shader registered for urn:",a)}else XML3D.debug.logError("Shader has no script attached: ",this.adapter.node)},getRequestFields:function(){return Object.keys(this.descriptor.uniforms).concat(Object.keys(this.descriptor.samplers))},
getShaderAttributes:function(){return this.descriptor.attributes},createShaderClosure:function(){return new e.ShaderClosure(this.context,this.descriptor)},createObjectDataRequest:function(a,b){var c=["position"];c.push.apply(c,Object.keys(this.descriptor.attributes));c.push.apply(c,Object.keys(this.descriptor.uniforms));c.push.apply(c,Object.keys(this.descriptor.samplers));return new Xflow.ComputeRequest(a,c,b)},distributeObjectShaderData:function(a,b,c){var a=a.getResult().getOutputMap(),e;for(e in a)"position"==
e||void 0!==this.descriptor.attributes[e]?b(e,a[e]):(void 0!==this.descriptor.uniforms[e]||void 0!==this.descriptor.samplers[e])&&c(e,a[e])}});e.URNShaderComposer=b})(XML3D.webgl);
(function(e){var c=function(b,a){e.AbstractShaderComposer.call(this,b,a);if(!window.Shade)throw Error("shade.js library not found");this.context=b;this.sourceTemplate=this.shaderURL=null;this.extractedParams=[];this.request=null;this.setShaderInfo(a)};c.convertEnvName=function(b){return("_env_"+b).replace(/_+/g,"_")};c.convertSysName=function(b){return b};XML3D.createClass(c,e.AbstractShaderComposer,{setShaderInfo:function(b){this.sourceTemplate=b.getScriptCode();try{this.extractedParams=Shade.extractParameters(this.sourceTemplate,
{implementation:"xml3d-glsl-forward"}).shaderParameters}catch(a){this.extractedParams=[]}-1==this.extractedParams.indexOf("position")&&this.extractedParams.push("position");this.extractedParams.length&&this.updateRequest(b.getData())},getRequestFields:function(){return this.extractedParams},getShaderAttributes:function(){return{color:null,normal:null,texcoord:null}},createShaderClosure:function(){return new e.JSShaderClosure(this.context,this.sourceTemplate,this.extractedParams)},createObjectDataRequest:function(b,
a){var c=new Xflow.VSConfig,e=this.extractedParams.slice();c.addAttribute(Xflow.DATA_TYPE.FLOAT3,"position",!0);for(var f=0;f<e.length;++f){var h=e[f];if("position"!=h){var i=b.getOutputChannelInfo(h);i&&c.addAttribute(i.type,h,!0)}}return new Xflow.VertexShaderRequest(b,c,a)},distributeObjectShaderData:function(b,a,c){for(var b=b.getVertexShader(),e=b.inputNames,f=0;f<e.length;++f){var h=e[f],i=b.getInputData(h);b.isInputUniform(h)?c(h,i):a(h,i)}a=b.outputNames;for(f=0;f<a.length;++f)h=a[f],b.isOutputFragmentUniform(h)&&
c(b.getOutputSourceName(h),b.getUniformOutputData(h))}});e.JSShaderComposer=c})(XML3D.webgl);
(function(e){var c={"text/shade-javascript":e.JSShaderComposer},b=function(a){this.context=a;this.composers={};this.defaultComposer=new e.DefaultComposer(a)};b.EVENT_TYPE={MATERIAL_STRUCTURE_CHANGED:"material_structure_changed",MATERIAL_INITIALIZED:"material_initialized"};XML3D.extend(b.prototype,{createComposerForShaderInfo:function(a){if(!a)return this.defaultComposer;var b=this.composers[a.id];if(!b){var g=a.getScriptUri();if("urn"==g.scheme)b=new e.URNShaderComposer(this.context,a);else{if(!a.getScriptType())return this.defaultComposer;
try{b=new (c[a.getScriptType()])(this.context,a)}catch(f){return XML3D.debug.logError("No shader could be created for "+g+":",f.message),this.defaultComposer}}b&&(this.composers[a.id]=b,this.context.getStatistics().materials++);return b||this.defaultComposer}return b},getDefaultComposer:function(){return this.defaultComposer},getTemplateById:function(a){return this.composers[a]},update:function(a){for(var b in this.composers)this.composers[b].update(a,{updateLightValues:this.lightValuesDirty});this.lightValuesDirty=
!1},setLightStructureDirty:function(){this.setShaderRecompile()},setShaderRecompile:function(){for(var a in this.composers)this.composers[a].setShaderRecompile()},updateSystemUniforms:function(a,b){for(var c in this.composers)this.composers[c].updateSystemUniforms(a,b)},setLightValueChanged:function(){for(var a in this.composers)this.composers[a].updateLightValues=!0}});e.ShaderComposerFactory=b})(XML3D.webgl);
(function(e){var c=null,b={type:"object",kind:"any",info:{coords:{type:"object",kind:"float3",source:"uniform"},cameraPosition:{type:"object",kind:"float3",source:"uniform"},viewMatrix:{type:"object",kind:"matrix4",source:"uniform"},viewInverseMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelViewMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelViewProjectionMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelMatrixN:{type:"object",
kind:"matrix3",source:"uniform"},modelViewMatrixN:{type:"object",kind:"matrix3",source:"uniform"},MAX_POINTLIGHTS:{type:"int",source:"constant",staticValue:5},pointLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},pointLightAttenuation:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightPosition:{type:"array",elements:{type:"object",
kind:"float3"},staticSize:5,source:"uniform"},pointLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},pointLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},pointLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},pointLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},pointLightProjection:{type:"array",elements:{type:"object",kind:"matrix4"},
staticSize:5,source:"uniform"},pointLightNearFar:{type:"array",elements:{type:"object",kind:"float2"},staticSize:5,source:"uniform"},MAX_DIRECTIONALLIGHTS:{type:"int",source:"constant",staticValue:5},directionalLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},directionalLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},directionalLightDirection:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},
directionalLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},directionalLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},directionalLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},directionalLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},MAX_SPOTLIGHTS:{type:"int",source:"constant",staticValue:5},spotLightOn:{type:"array",elements:{type:"boolean"},
staticSize:5,source:"uniform"},spotLightAttenuation:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightPosition:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightDirection:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightCosFalloffAngle:{type:"array",elements:{type:"number"},
staticSize:5,source:"uniform"},spotLightCosSoftFalloffAngle:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},spotLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},spotLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},
ssaoMap:{type:"object",kind:"texture",source:"uniform"},environment:{type:"object",kind:"texture",source:"uniform"}}};e.getJSSystemConfiguration=function(a){c||(a.getExtensionByName(e.GLContext.EXTENSIONS.STANDARD_DERIVATES)&&(b.info.fwidth={type:Shade.TYPES.FUNCTION},b.info.dx={type:Shade.TYPES.FUNCTION},b.info.dy={type:Shade.TYPES.FUNCTION}),c=b);return c}})(XML3D.webgl);
(function(e){var c=function(b){this.program=null;this.context=b;this.obsolete=!1;this.id="";this.uniformCollection={envBase:{},envOverride:null,sysBase:null};this.isTransparent=!1;this.source={vertex:"",fragment:""}};Object.defineProperties(c.prototype,{attributes:{writeable:!1,get:function(){return this.program?this.program.attributes:{}}},uniforms:{writeable:!1,get:function(){return this.program?this.program.uniforms:{}}},samplers:{writeable:!1,get:function(){return this.program?this.program.samplers:
{}}}});XML3D.createClass(c,null,{equals:function(b){return this.source.vertex===b.source.vertex&&this.source.fragment===b.source.fragment},hasTransparency:function(){return this.isTransparent},compile:function(){if(!this.source.fragment||!this.source.vertex)XML3D.debug.logError("No source found for shader",this);else{var b=new XML3D.webgl.GLProgramObject(this.context.gl,this.source);this.program=b;this.id=b.id}},bind:function(){this.program.bind()},unbind:function(){this.program.unbind()},isValid:function(){return this.program.isValid()},
updateUniformsFromComputeResult:function(b){var b=b.getOutputMap(),a=this.uniformCollection.envBase={};this.setDefaultUniforms(this.uniformCollection.envBase);for(var c in b){var g=e.getGLUniformValueFromXflowDataEntry(b[c],this.context);a[c]=g}this.setUniformVariables(Object.keys(a),null,this.uniformCollection);this.isTransparent=this.getTransparencyFromInputData(b)},setUniformVariables:function(b,a,c){this.program.setUniformVariables(b,a,c)},setSystemUniformVariables:function(b,a){this.uniformCollection.sysBase=
a;this.setUniformVariables(null,b,this.uniformCollection)},changeUniformVariableOverride:function(b,a){var c=b?Object.keys(b):[];a&&c.push.apply(c,Object.keys(a));this.uniformCollection.envOverride=a;this.setUniformVariables(c,null,this.uniformCollection)}});e.AbstractShaderClosure=c})(XML3D.webgl);
(function(e){var c=function(b,a){e.AbstractShaderClosure.call(this,b);this.descriptor=a};XML3D.createClass(c,e.AbstractShaderClosure);XML3D.extend(c.prototype,{setDefaultUniforms:function(b){XML3D.extend(b,this.descriptor.uniforms)},createSources:function(b,a,c){var g=c&&c.getResult(),c=[],f={};a&&XML3D.extend(f,a.getOutputMap());g&&XML3D.extend(f,g.getOutputMap());for(var h in this.descriptor.attributes)if((a=this.descriptor.attributes[h])&&a.required&&!f[h])throw Error("Mesh is missing '"+h+"' attribute.");
this.descriptor.addDirectives(c,b.lights||{},f);this.source={fragment:this.addDirectivesToSource(c,this.descriptor.fragment),vertex:this.addDirectivesToSource(c,this.descriptor.vertex)};e.SystemNotifier.sendEvent("urnshader",{urnshaderType:"code",vertexShader:this.source.vertex,fragmentShader:this.source.fragment});return!0},addDirectivesToSource:function(b,a){var c="";b.forEach(function(a){c+="#define "+a+"\n"});return c+"\n"+a},getTransparencyFromInputData:function(b){return this.descriptor.hasTransparency(b)}});
e.ShaderClosure=c})(XML3D.webgl);
(function(e){var c={pointLightOn:{staticValue:"MAX_POINTLIGHTS",staticSize:"pointLightOn,pointLightAttenuation,pointLightIntensity,pointLightPosition,pointLightCastShadow,pointLightShadowBias,pointLightShadowMap,pointLightMatrix,pointLightNearFar".split(",")},directionalLightOn:{staticValue:"MAX_DIRECTIONALLIGHTS",staticSize:"directionalLightOn,directionalLightIntensity,directionalLightDirection,directionalLightCastShadow,directionalLightShadowBias,directionalLightShadowMap,directionalLightMatrix".split(",")},spotLightOn:{staticValue:"MAX_SPOTLIGHTS",
staticSize:"spotLightOn,spotLightAttenuation,spotLightIntensity,spotLightPosition,spotLightDirection,spotLightCosFalloffAngle,spotLightCosSoftFalloffAngle,spotLightCastShadow,spotLightShadowBias,spotLightShadowMap,spotLightMatrix".split(",")}},b={},a=function(a,b){var c={};switch(a){case Xflow.DATA_TYPE.BOOL:c.type=Shade.TYPES.BOOLEAN;break;case Xflow.DATA_TYPE.INT:c.type=Shade.TYPES.INT;break;case Xflow.DATA_TYPE.FLOAT:c.type=Shade.TYPES.NUMBER;break;case Xflow.DATA_TYPE.FLOAT2:c.type=Shade.TYPES.OBJECT;
c.kind=Shade.OBJECT_KINDS.FLOAT2;break;case Xflow.DATA_TYPE.FLOAT3:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.FLOAT3;break;case Xflow.DATA_TYPE.FLOAT4:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.FLOAT4;break;case Xflow.DATA_TYPE.FLOAT3X3:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.MATRIX3;break;case Xflow.DATA_TYPE.FLOAT4X4:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.MATRIX4;break;case Xflow.DATA_TYPE.TEXTURE:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.TEXTURE;
break;default:throw Error("Unknown Xflow DataType: "+a);}c.source=b;return c},d=function(a,b,c){e.AbstractShaderClosure.call(this,a);this.sourceTemplate=b;this.extractedParams=c;this.uniformSetter=function(){};this.uniformConverter=[]};XML3D.createClass(d,e.AbstractShaderClosure,{createSources:function(d,f,h){var i=h.getResult(),j={"this":e.getJSSystemConfiguration(this.context),"global.shade":[{extra:{type:"object",kind:"any",global:!0,info:{}}}]},k=d.systemUniforms,l=j["this"].info,m;for(m in c){var o=
c[m],n=k[m]&&k[m].length;l[o.staticValue].staticValue=n;for(var p=0;p<o.staticSize.length;++p)l[o.staticSize[p]].staticSize=n}k=j["global.shade"][0].extra.info;f=f&&f.getOutputMap();l=i&&i.outputNames;for(p=0;p<this.extractedParams.length;++p)m=this.extractedParams[p],l&&-1!=l.indexOf(m)?k[m]=a(i.getOutputType(m),i.isOutputUniform(m)?Shade.SOURCES.UNIFORM:Shade.SOURCES.VERTEX):f&&f[m]&&(k[m]=a(f[m].type,Shade.SOURCES.UNIFORM));XML3D.debug.logDebug("CONTEXT:",j);p={propagateConstants:!0,validate:!0,
sanitize:!0,transformSpaces:XML3D.options.getValue("shadejs-transformSpaces"),extractUniformExpressions:XML3D.options.getValue("shadejs-extractUniformExpressions")};f={useStatic:!0,uniformExpressions:p.uniformExpressions};l=d.deferred?"xml3d-glsl-deferred":"xml3d-glsl-forward";k=l+";"+JSON.stringify(p)+";"+JSON.stringify(k)+";"+this.sourceTemplate;if(!(m=b[k]))try{var q=new Shade.WorkingSet;q.parse(this.sourceTemplate,{loc:!0});q.analyze(j,l,p);var r=q.getProcessingData("spaceInfo"),v=q.compileFragmentShader(f);
m={source:v.source,uniformSetter:v.uniformSetter,spaceInfo:r};this.uniformSetter=v.uniformSetter;this.source={fragment:v.source,vertex:this.createVertexShader(h,i,r)};d.deferred&&(m.signatures=q.getProcessingData("colorClosureSignatures"));XML3D.options.getValue("shadejs-cache")&&(b[k]=m)}catch(t){throw e.SystemNotifier.sendEvent("shadejs",{shadejsType:"error",event:t,code:this.sourceTemplate}),d="Shade.js Compile Error:\n"+t.message+"\n------------\nShader Source:\n------------\n"+XML3D.debug.formatSourceCode(this.sourceTemplate),
Error(d);}this.source={fragment:m.source,vertex:this.createVertexShader(h,i,m.spaceInfo)};this.uniformSetter=m.uniformSetter;d.deferred&&d.colorClosureSignatures.push.apply(d.colorClosureSignatures,m.signatures);XML3D.debug.logDebug(this.source.vertex);XML3D.debug.logDebug(this.source.fragment);e.SystemNotifier.sendEvent("shadejs",{shadejsType:"success",vertexShader:this.source.vertex,fragmentShader:this.source.fragment});return!0},createVertexShader:function(a,b,c){for(var d=a.getConfig(),b=b.outputNames,
e=0;e<b.length;++e){var k=d,l=b[e],m=c;if(!m||!m[l])m=XML3D.webgl.JSShaderComposer.convertEnvName(l),k.channelAttribute(l,m,null);else for(var o=m[l].length;o--;){var n=m[l][o],p=XML3D.webgl.JSShaderComposer.convertEnvName(n.name),q=null;switch(n.space){case Shade.SPACE_VECTOR_TYPES.OBJECT:break;case Shade.SPACE_VECTOR_TYPES.VIEW_POINT:k.addInputParameter(Xflow.DATA_TYPE.FLOAT4X4,"modelViewMatrix",!0);q=p+" = ( modelViewMatrix * vec4(#I{"+l+"}, 1.0) ).xyz;";break;case Shade.SPACE_VECTOR_TYPES.VIEW_NORMAL:k.addInputParameter(Xflow.DATA_TYPE.FLOAT3X3,
"modelViewMatrixN",!0);q=p+" = normalize( modelViewMatrixN * #I{"+l+"} );";break;case Shade.SPACE_VECTOR_TYPES.WORLD_POINT:k.addInputParameter(Xflow.DATA_TYPE.FLOAT4X4,"modelMatrix",!0);q=p+" = ( modelMatrix * vec4(#I{"+l+"}, 1.0) ).xyz;";break;case Shade.SPACE_VECTOR_TYPES.WORLD_NORMAL:k.addInputParameter(Xflow.DATA_TYPE.FLOAT3X3,"modelMatrixN",!0);q=p+" = normalize( modelMatrixN * #I{"+l+"} );";break;default:throw Error("Can't handle Space Type: "+n.space);}k.channelAttribute(l,p,q)}}d.addInputParameter(Xflow.DATA_TYPE.FLOAT4X4,
"modelViewProjectionMatrix",!0);d.addCodeFragment("gl_Position = modelViewProjectionMatrix * vec4(#I{position}, 1.0);");return a.getVertexShader().getGLSLCode()},setUniformVariables:function(a,b,c){this.uniformSetter(a,b,c,this.program.setUniformVariable.bind(this.program))},getTransparencyFromInputData:function(){return!1},setDefaultUniforms:function(){}});e.JSShaderClosure=d})(XML3D.webgl);
(function(e){var c=function(b,a){this.context=b;this._type=a;this._valid=!1};c.TYPES={MESH:"mesh",VOLUME:"volume"};c.READY_STATE={COMPLETE:"complete",INCOMPLETE:"incomplete"};XML3D.createClass(c,XML3D.util.EventDispatcher,{getType:function(){return this._type},isValid:function(){return this._valid},setShaderComposer:function(){},update:function(){}});e.DrawableClosure=c})(XML3D.webgl);
(function(e){var c=e.DrawableClosure.READY_STATE,b={};b[WebGLRenderingContext.TRIANGLES]={attributeData:{position:Xflow.DATA_TYPE.FLOAT3},typeData:{index:Xflow.DATA_TYPE.INT,solid:Xflow.DATA_TYPE.BOOL,vertexCount:Xflow.DATA_TYPE.INT},bboxFix:{boundingBox:Xflow.DATA_TYPE.FLOAT3},bboxCompute:{position:Xflow.DATA_TYPE.FLOAT3}};b[WebGLRenderingContext.LINE_STRIP]=b[WebGLRenderingContext.TRIANGLES];b[WebGLRenderingContext.LINES]=b[WebGLRenderingContext.TRIANGLES];b[WebGLRenderingContext.POINTS]=b[WebGLRenderingContext.TRIANGLES];
var a=function(a,b,c,h){e.DrawableClosure.call(this,a,e.DrawableClosure.TYPES.MESH);h=h||{};this.mesh=new e.GLMesh(a,b);this.dataNode=c;this.typeRequest=this.shaderClosure=this.shaderComposer=null;this.typeDataValid=!0;this.objectShaderRequest=null;this.changeState=void 0;this.boundingBoxChanged=h.boundingBoxChanged||function(){};this.initialize()};XML3D.createClass(a,e.DrawableClosure,{initialize:function(){this.typeDataChanged(this.typeRequest,Xflow.RESULT_STATE.CHANGED_STRUCTURE);this.shaderChanged()},
setShaderComposer:function(a){this.bindedShaderChanged||(this.bindedShaderChanged=this.shaderChanged.bind(this));this.shaderComposer&&this.shaderComposer.removeEventListener(e.ShaderComposerFactory.EVENT_TYPE.MATERIAL_STRUCTURE_CHANGED,this.bindedShaderChanged);(this.shaderComposer=a)&&this.shaderComposer.addEventListener(e.ShaderComposerFactory.EVENT_TYPE.MATERIAL_STRUCTURE_CHANGED,this.bindedShaderChanged);this.changeState|=32},update:function(a){if(0!==this.changeState){XML3D.debug.logDebug("Update mesh closure",
this.changeState);var b=!!this.shaderClosure&&this.typeDataValid,f=null,h=!1;try{if(this.changeState&33&&this.mesh.clear(),this.changeState&3&&this.updateTypeData(),h=!0,this.changeState&35&&this.updateIndexBuffer(),this.changeState&33?(this.updateObjectShaderRequest(),this.updateShaderClosure(a),this.updateObjectShaderData()):this.changeState&5&&this.updateObjectShaderData(),this.dataNode.isSubtreeLoading())this.shaderClosure=null,this.typeDataValid=!1}catch(i){f=i,h?this.shaderClosure=null:this.typeDataValid=
!1}a=!!this.shaderClosure&&this.typeDataValid;b!=a&&this.dispatchEvent({type:e.Scene.EVENT_TYPE.DRAWABLE_STATE_CHANGED,newState:a?c.COMPLETE:c.INCOMPLETE,oldState:b?c.COMPLETE:c.INCOMPLETE});this.changeState=0;if(f)throw f;}},calculateBoundingBox:function(){var a=XML3D.math.bbox.create();return function(){var b=this.typeRequest.getResult(),c=b.getOutputData("boundingBox");c?this.boundingBoxChanged(XML3D.webgl.calculateBoundingBox(c.getValue(),null)):(c=b.getOutputData("position"))?(b=b.getOutputData("index"),
this.boundingBoxChanged(XML3D.webgl.calculateBoundingBox(c.getValue(),b?b.getValue():null))):this.boundingBoxChanged(a)}}(),typeDataChanged:function(a,b){this.changeState|=b==Xflow.RESULT_STATE.CHANGED_STRUCTURE?1:2;this.dispatchEvent({type:e.Scene.EVENT_TYPE.SCENE_SHAPE_CHANGED});this.context.requestRedraw("Mesh Type Data Change");XML3D.debug.logDebug("MeshClosure: Type data changed",a,b,this.changeState)},getMesh:function(){return this.mesh},getMeshType:function(){return this.mesh.glType},updateObjectShaderRequest:function(){this.objectShaderRequest&&
this.objectShaderRequest.clear();this.objectShaderRequest=null;this.dataNode.isSubtreeLoading()||(this.objectShaderRequest=this.shaderComposer.createObjectDataRequest(this.dataNode,this.shaderInputDataChanged.bind(this)))},updateShaderClosure:function(a){this.shaderClosure=null;if(!this.dataNode.isSubtreeLoading()&&!this.dataNode.getOutputChannelInfo("position"))throw Error("Mesh does not have 'position' attribute.");!this.dataNode.isSubtreeLoading()&&!this.objectShaderRequest.getResult().loading&&
(this.shaderClosure=this.shaderComposer.getShaderClosure(a,this.objectShaderRequest))},updateIndexBuffer:function(){var a=this.typeRequest.getResult().getOutputData("index");a&&a.getValue()&&this.handleBuffer("index",a,!0)},updateObjectShaderData:function(){if(this.shaderClosure&&(this.bindedHandleBuffer||(this.bindedHandleBuffer=this.handleBuffer.bind(this)),this.bindedHandleUniform||(this.bindedHandleUniform=this.handleUniform.bind(this)),this.shaderComposer.distributeObjectShaderData(this.objectShaderRequest,
this.bindedHandleBuffer,this.bindedHandleUniform),!this.mesh.isReadyToRender()))throw Error("Mesh has empty vertex attributes.");},updateTypeData:function(){if(this.typeDataValid||this.changeState&1){this.updateTypeRequest();this.calculateBoundingBox();var a=this.typeRequest.getResult().getOutputData("vertexCount");this.mesh.setVertexCount(a&&a.getValue()?a.getValue()[0]:null);this.typeDataValid=!0}},handleBuffer:function(a,b,c){var c=c||!1,h=this.mesh;if("position"==a&&!b)throw Error("'position' attribute of mesh is empty.");
if(b)if(b.type==Xflow.DATA_TYPE.TEXTURE)XML3D.debug.logError("Texture as mesh parameter is not yet supported");else{var i=e.getGLBufferFromXflowDataEntry(b,this.context,"index"==a);c?this.updateIndexRange(b):this.mesh.checkBufferCompatible(a,b);h.setBuffer(a,i)}else this.mesh.removeBuffer(a)},updateIndexRange:function(a){a=XML3D.webgl.getXflowEntryWebGlData(a,this.context.id);this.mesh.setIndexRange(a.minIndex,a.maxIndex)},checkBufferSize:function(a,b){if(b.getIterateCount){var c=b.getIterateCount();
if(c>=this.mesh.maxIndex)throw Error("Index range of ["+this.mesh.minIndex+", "+this.mesh.maxIndex+"]  goes beyond element count "+c+" of attribute '"+a+"'");}},handleUniform:function(a,b){var c=e.getGLUniformValueFromXflowDataEntry(b,this.context);this.mesh.setUniformOverride(a,c)},updateTypeRequest:function(){var a=b[this.getMeshType()];if(a){if(a=this.getTypeRequestNames(a),!this.typeRequest||this.typeRequest.filter!=a)this.typeRequest&&this.typeRequest.clear(),this.typeRequest=new Xflow.ComputeRequest(this.dataNode,
a,this.typeDataChanged.bind(this))}else XML3D.debug.logError("Unsupported Mesh request: ",this.mesh,this.getMeshType()),this.typeDataValid=!1},getTypeRequestNames:function(a){var b=[];b.push.apply(b,Object.keys(a.typeData));b.push.apply(b,Object.keys(a.bboxFix));this.checkXflowTypes(this.dataNode,a.bboxFix)||(this.checkXflowTypes(this.dataNode,a.bboxCompute)||(this.typeDataValid=!1),b.push.apply(b,Object.keys(a.bboxCompute)));return b},checkXflowTypes:function(a,b){for(var c in b){var e=a.getOutputChannelInfo(c);
if(!e||e.type!=b[c])return!1}return!0},shaderInputDataChanged:function(a,b){this.changeState|=b!=Xflow.RESULT_STATE.CHANGED_DATA_VALUE?1:4;this.dispatchEvent({type:e.Scene.EVENT_TYPE.SCENE_SHAPE_CHANGED});this.context.requestRedraw("Mesh Attribute Data Changed");XML3D.debug.logDebug("MeshClosure: Attribute data changed",a,b,this.changeState)},shaderChanged:function(){this.changeState|=32},getProgram:function(){return this.shaderClosure}});e.MeshClosure=a})(XML3D.webgl);
(function(e){e.renderers=[];e.rendererFactory=new function(){this.createRenderer=function(c,b,a){return new e.GLRenderer(c,b,a)}}})(XML3D.webgl);
(function(){XML3D.webgl.RenderAdapter=function(e,c){XML3D.base.NodeAdapter.call(this,e,c)};XML3D.createClass(XML3D.webgl.RenderAdapter,XML3D.base.NodeAdapter);XML3D.webgl.RenderAdapter.prototype.getShader=function(){return null};XML3D.webgl.RenderAdapter.prototype.getParentRenderAdapter=function(){return this.factory.getAdapter(this.node.parentElement,XML3D.webgl.RenderAdapter)};XML3D.webgl.RenderAdapter.prototype.initElement=function(e){this.factory.getAdapter(e);this.initChildElements(e)};XML3D.webgl.RenderAdapter.prototype.initChildElements=
function(e){for(e=e.firstElementChild;e;)this.initElement(e),e=e.nextElementSibling};XML3D.webgl.RenderAdapter.prototype.applyTransformMatrix=function(e){return e};XML3D.webgl.RenderAdapter.prototype.getScene=function(){return this.factory.renderer.scene};XML3D.webgl.RenderAdapter.prototype.initializeEventAttributes=function(e){var c=this.node.attributes,e=e||[],b;for(b in c){var a=c[b];if(a.name){var d=a.name;"on"==d.substring(2,0)&&(d=d.substring(2),(-1!=XML3D.webgl.events.available.indexOf(d)||
-1!=e.indexOf(d))&&this.node.addEventListener(d,new Function("event",a.value),!1))}}}})();
(function(e){var c=function(b,a,c){e.RenderAdapter.call(this,b,a);this.renderNode=null;this.handleShader=c||!1;this.transformFetcher=new XML3D.data.DOMTransformFetcher(this,"transform","transform")};XML3D.createClass(c,e.RenderAdapter);XML3D.extend(c.prototype,{onDispose:function(){this.transformFetcher.clear()},onConfigured:function(){},getRenderNode:function(){this.renderNode||(this.renderNode=this.createRenderNode?this.createRenderNode():null,this.updateLocalMatrix());return this.renderNode},updateLocalMatrix:function(){this.transformFetcher.update()},
onTransformChange:function(b,a){"transform"==b&&this.renderNode.setLocalMatrix(a)},getShaderHandle:function(){var b=this.node.shader;if(""==b){var a=this.node.getAttribute("style");a&&(a=/shader\s*:\s*url\s*\(\s*(\S+)\s*\)/i.exec(a))&&(b=a[1])}if(b)return this.getAdapterHandle(b)},notifyChanged:function(b){if(b.type==XML3D.events.VALUE_MODIFIED){var a=b.attrName||b.wrapped.attrName;"transform"==a?this.transformFetcher.update():"style"==a?this.transformFetcher.updateMatrix():"visible"==a?(this.renderNode.setLocalVisible("true"===
b.wrapped.newValue),this.factory.renderer.requestRedraw("Transformable visibility changed.")):"shader"==a&&this.handleShader&&(this.renderNode.setLocalShaderHandle(this.getShaderHandle()),this.factory.renderer.requestRedraw("Transformable shader changed."))}}});e.TransformableAdapter=c})(XML3D.webgl);(function(){XML3D.webgl.DefsRenderAdapter=function(e,c){XML3D.webgl.RenderAdapter.call(this,e,c)};XML3D.createClass(XML3D.webgl.DefsRenderAdapter,XML3D.webgl.RenderAdapter)})();
(function(){var e=function(c,b){XML3D.webgl.RenderAdapter.call(this,c,b);this.initializeEventAttributes(["load"])};XML3D.createClass(e,XML3D.webgl.RenderAdapter);XML3D.extend(e.prototype,{updateActiveViewAdapter:function(){var c=this.node.getAttribute("activeView");c?this.connectAdapterHandle("activeView",this.getAdapterHandle(c)):this.disconnectAdapterHandle("activeView")},setViewAdapter:function(c){c=c||this.getConnectedAdapter("activeView");if(!c||!c.getRenderNode)c=this.factory.getAdapter(XML3D.util.getOrCreateActiveView(this.node));
this.factory.getScene().setActiveView(c.getRenderNode())},dispose:function(){this.clearAdapterHandles()}});e.prototype.notifyChanged=function(c){switch(c.type){case XML3D.events.ADAPTER_HANDLE_CHANGED:this.setViewAdapter(c.adapter);return;case XML3D.events.NODE_INSERTED:this.initElement(c.wrapped.target);return;case XML3D.events.NODE_REMOVED:return}if("activeView"==(c.internalType||c.attrName||c.wrapped.attrName))this.updateActiveViewAdapter(),this.setViewAdapter()};e.prototype.onConfigured=function(){this.updateActiveViewAdapter();
this.setViewAdapter();var c=function(b){var a=2;return function(){a--;0==a&&XML3D.util.dispatchEvent(b,"load")}}(this.node,this.factory.canvasId);XML3D.base.resourceManager.addLoadCompleteListener(0,c);XML3D.base.resourceManager.addLoadCompleteListener(this.factory.canvasId,c)};e.prototype.getBoundingBox=function(){var c=new window.XML3DBox;Array.prototype.forEach.call(this.node.childNodes,function(b){b.getBoundingBox&&c.extend(b.getBoundingBox())});return c};e.prototype.getElementByPoint=function(c,
b,a,d){var b=XML3D.webgl.convertPageCoords(this.node,c,b),c=b.x,b=b.y,e=this.factory.getRenderer(),f=e.getRenderObjectFromPickingBuffer(c,b);if(f){if(a){var h=e.getWorldSpacePositionByPoint(c,b,f);a.set(h[0],h[1],h[2])}d&&(h=e.getWorldSpaceNormalByPoint(c,b,f),d.set(h[0],h[1],h[2]))}else a&&a.set(NaN,NaN,NaN),d&&d.set(NaN,NaN,NaN);return f?f.node:null};e.prototype.getRenderInterface=function(){return this.factory.getRenderer().getRenderInterface()};e.prototype.generateRay=function(c,b){var a=XML3D.webgl.convertPageCoords(this.node,
c,b);return this.factory.getRenderer().generateRay(a.x,a.y)};e.prototype.getElementByRay=function(){var c=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(a,d,e){var f=this.factory.getRenderer();f.calculateMatricesForRay(a,c,b);var h=f.getRenderObjectByRay(a,c,b);if(null!==h&&(d||e)){if(d){var i=f.getWorldSpacePositionByRay(a,h,c,b);d.set(i[0],i[1],i[2])}e&&(i=f.getWorldSpaceNormalByRay(a,h,c,b),e.set(i[0],i[1],i[2]))}else d&&d.set(NaN,NaN,NaN),e&&e.set(NaN,NaN,NaN);return null!==
h?h.node:null}}();XML3D.webgl.XML3DRenderAdapter=e})();
(function(){var e=function(b,a){XML3D.webgl.TransformableAdapter.call(this,b,a);this.perspectiveFetcher=new XML3D.data.DOMTransformFetcher(this,"perspective","perspective",!0);this.createRenderNode()};XML3D.createClass(e,XML3D.webgl.TransformableAdapter);var c=e.prototype;c.createRenderNode=function(){var b=this.factory.getAdapter(this.node.parentElement,XML3D.webgl.RenderAdapter),b=b.getRenderNode?b.getRenderNode():this.factory.renderer.scene.createRootNode();this.renderNode=this.factory.renderer.scene.createRenderView({position:this.node.position._data,
orientation:this.node.orientation.toMatrix()._data,fieldOfView:this.node.fieldOfView,parent:b});this.perspectiveFetcher.update()};c.getViewMatrix=function(){var b=new window.XML3DMatrix;this.renderNode.getWorldToViewMatrix(b._data);return b};c.getWorldMatrix=function(){var b=new window.XML3DMatrix;this.renderNode.getViewToWorldMatrix(b._data);return b};c.notifyChanged=function(b){switch(b.type){case XML3D.events.THIS_REMOVED:this.dispose();break;case XML3D.events.VALUE_MODIFIED:switch(b=b.wrapped.attrName,
b){case "orientation":this.renderNode.updateOrientation(this.node.orientation.toMatrix()._data);break;case "position":this.renderNode.updatePosition(this.node.position._data);break;case "perspective":this.perspectiveFetcher.update();break;case "fieldOfView":this.renderNode.updateFieldOfView(this.node.fieldOfView);break;default:XML3D.debug.logWarning("Unhandled value changed event in view adapter for attribute:"+b)}}this.factory.getRenderer().requestRedraw("View changed")};c.onTransformChange=function(b,
a){XML3D.webgl.TransformableAdapter.prototype.onTransformChange.call(this,b,a);"perspective"==b&&this.renderNode.setProjectionOverride(a)};c.dispose=function(){this.perspectiveFetcher.clear();this.getRenderNode().remove();this.clearAdapterHandles()};XML3D.webgl.ViewRenderAdapter=e})();
(function(e){var c=function(b,a){XML3D.webgl.RenderAdapter.call(this,b,a);this.dataAdapter=XML3D.base.resourceManager.getAdapter(this.node,XML3D.data);this.shaderInfo=this.createShaderInfo();this.templateId=this.shaderInfo.id;this.updateScript()};XML3D.createClass(c,XML3D.webgl.RenderAdapter);XML3D.extend(c.prototype,{createShaderInfo:function(){return this.getScene().createShaderInfo({data:this.getDataAdapter().getXflowNode()})},updateScript:function(){var b=this.getShaderScriptURI();"urn"!=b.scheme?
this.connectAdapterHandle("script",this.getAdapterHandle(b,XML3D.data,0)):this.disconnectAdapterHandle("script");this.updateShaderInfoDetails()},updateShaderInfoDetails:function(){var b=null,a=null,c=this.getConnectedAdapter("script");c&&c.getScriptType&&(b=c.getScriptType(),a=c.getScriptCode());this.shaderInfo.setScript(this.getShaderScriptURI(),b,a)},getShaderInfo:function(){return this.shaderInfo},getShaderScriptURI:function(){return new XML3D.URI(this.node.getAttribute("script"))},getDataAdapter:function(){return this.dataAdapter},
notifyChanged:function(b){switch(b.type){case XML3D.events.VALUE_MODIFIED:b=b.internalType||b.attrName||b.wrapped.attrName;switch(b){case "script":this.updateScript();break;default:XML3D.debug.logWarning("Unhandled mutation event in shader adapter for parameter '"+b+"'")}break;case XML3D.events.ADAPTER_HANDLE_CHANGED:b.handleStatus==XML3D.base.AdapterHandle.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find script of url '"+b.url+"'"),this.updateShaderInfoDetails()}}});e.ShaderRenderAdapter=c})(XML3D.webgl);
(function(){XML3D.webgl.ImgRenderAdapter=function(e,c){XML3D.webgl.RenderAdapter.call(this,e,c);this.textureAdapter=e.getAdapter(c.parentNode)};XML3D.createClass(XML3D.webgl.ImgRenderAdapter,XML3D.webgl.RenderAdapter);XML3D.webgl.ImgRenderAdapter.prototype.notifyChanged=function(e){this.textureAdapter.notifyChanged(e)}})();XML3D.webgl.MAX_MESH_INDEX_COUNT=65535;
(function(e){XML3D.math.mat4.create();var c=function(b,a){e.TransformableAdapter.call(this,b,a,!0);this.initializeEventAttributes();this.createRenderNode()};XML3D.createClass(c,e.TransformableAdapter,{createRenderNode:function(){var b=XML3D.base.resourceManager.getAdapter(this.node,XML3D.data),a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderObject({parent:a,node:this.node,object:{data:b.getXflowNode(),type:this.getMeshType()},name:this.node.id,
shaderHandle:this.getShaderHandle(),visible:!this.node.visible?!1:void 0});this.updateLocalMatrix()},getMeshType:function(){return this.node.hasAttribute("type")?this.node.getAttribute("type"):"triangles"},notifyChanged:function(b){XML3D.webgl.TransformableAdapter.prototype.notifyChanged.call(this,b);switch(b.type){case XML3D.events.THIS_REMOVED:this.dispose();break;case XML3D.events.VALUE_MODIFIED:this.valueChanged(b.wrapped)}},valueChanged:function(b){switch(b.attrName){case "type":this.renderNode.setType(b.newValue)}},
dispose:function(){this.getRenderNode().remove();this.clearAdapterHandles()}});XML3D.extend(c.prototype,{getBoundingBox:function(){if(this.renderNode){var b=new XML3D.math.bbox.create;this.renderNode.getObjectSpaceBoundingBox(b);return XML3D.math.bbox.asXML3DBox(b)}return new window.XML3DBox},getWorldMatrix:function(){var b=new window.XML3DMatrix,a=this.renderNode;a&&a.getWorldMatrix(b._data);return b}});e.MeshRenderAdapter=c})(XML3D.webgl);XML3D.webgl.MAX_MESH_INDEX_COUNT=65535;
(function(e){var c=function(a,b){e.TransformableAdapter.call(this,a,b,!0);this.asset=null;this.renderObjects=[];this.initializeEventAttributes();this.createRenderNode()},b=XML3D.math.mat4.create();XML3D.createClass(c,e.TransformableAdapter,{createRenderNode:function(){this.asset=XML3D.base.resourceManager.getAdapter(this.node,XML3D.data).getAsset();this.asset.addChangeListener(this);var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderGroup({parent:a,
shaderHandle:null,visible:this.node.visible,name:this.node.id});this.updateLocalMatrix();this.createSubRenderObjects()},clearSubRenderObjects:function(){for(var a=this.renderObjects.length;a--;)this.renderObjects[a].remove();this.renderObjects.length=0},createSubRenderObjects:function(){this.clearSubRenderObjects();if(!this.asset.isSubtreeLoading())try{this.asset.checkValidity();for(var a=this.asset.getResult().getMeshDataSets(),c=0;c<a.length;++c){var e=this.getScene().createRenderObject({parent:this.renderNode,
node:a[c].refNode||this.node,object:{data:a[c].xflowNode,type:a[c].type},shaderHandle:this.getSubShaderHandle(a[c].shader,c),name:this.node.id,visible:!this.node.visible?!1:void 0});e.setLocalMatrix(a[c].transform||b);this.renderObjects.push(e)}}catch(f){XML3D.debug.logError("Asset Error: "+f.message,f.node||this.node),this.clearSubRenderObjects()}},getSubShaderHandle:function(a){return a?((a=this.getAdapterHandle(a))&&a.status==XML3D.base.AdapterHandle.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find <shader> of url '"+
a.url+"' ",this.node),a):null},notifyChanged:function(a){XML3D.webgl.TransformableAdapter.prototype.notifyChanged.call(this,a);switch(a.type){case XML3D.events.THIS_REMOVED:this.dispose()}},onAssetChange:function(){this.createSubRenderObjects()},dispose:function(){this.asset.removeChangeListener(this);this.clearSubRenderObjects();this.getRenderNode().remove();this.clearAdapterHandles()}});XML3D.extend(c.prototype,{getBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;this.renderNode.getWorldSpaceBoundingBox(a);
return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},getWorldMatrix:function(){var a=new window.XML3DMatrix,b=this.renderNode;b&&b.getWorldMatrix(a._data);return a}});e.ModelRenderAdapter=c})(XML3D.webgl);
(function(){var e=function(b,a){XML3D.webgl.TransformableAdapter.call(this,b,a,!0);this.initializeEventAttributes();this.factory=b;this.createRenderNode()};XML3D.createClass(e,XML3D.webgl.TransformableAdapter);var c=e.prototype;c.createRenderNode=function(){var b=this.getParentRenderAdapter(),b=b.getRenderNode&&b.getRenderNode();this.renderNode=this.getScene().createRenderGroup({parent:b,shaderHandle:this.getShaderHandle(),visible:this.node.visible,name:this.node.id});this.updateLocalMatrix();this.renderNode.setWorldSpaceBoundingBox(XML3D.math.bbox.create())};
c.notifyChanged=function(b){XML3D.webgl.TransformableAdapter.prototype.notifyChanged.call(this,b);if(b.type!==XML3D.events.VALUE_MODIFIED)return this.handleConnectedAdapterEvent(b)};c.handleConnectedAdapterEvent=function(b){switch(b.type){case XML3D.events.NODE_INSERTED:this.initElement(b.wrapped.target);break;case XML3D.events.THIS_REMOVED:this.dispose();break;case XML3D.events.ADAPTER_HANDLE_CHANGED:break;case XML3D.events.NODE_REMOVED:break;default:XML3D.debug.logWarning("Unhandled connected adapter event for "+
b.key+" in shader adapter")}};c.dispose=function(){this.traverse(function(b){b&&b.destroy&&b.dispose()});this.getRenderNode().remove();this.clearAdapterHandles()};c.getBoundingBox=function(){var b=XML3D.math.bbox.create();this.renderNode.getWorldSpaceBoundingBox(b);return XML3D.math.bbox.asXML3DBox(b)};c.getLocalMatrix=function(){var b=new window.XML3DMatrix;this.renderNode.getLocalMatrix(b._data);return b};XML3D.math.mat4.create();c.getWorldMatrix=function(){var b=new window.XML3DMatrix;this.renderNode.getWorldMatrix(b._data);
return b};XML3D.webgl.GroupRenderAdapter=e})();
(function(e){var c=function(b,a){XML3D.webgl.RenderAdapter.call(this,b,a);this.dataAdapter=XML3D.base.resourceManager.getAdapter(this.node,XML3D.data)};XML3D.createClass(c,e.RenderAdapter,{getDataNode:function(){return this.dataAdapter.getXflowNode()},getLightType:function(){var b=this.node.getAttribute("script");if(0===b.indexOf("urn:xml3d:lightshader:"))return b.substring(22,b.length);XML3D.debug.logError("Unsupported light type "+b);return null},notifyChanged:function(b){switch(b.type){case XML3D.events.THIS_REMOVED:this.notifyOppositeAdapters();break;
case XML3D.events.VALUE_MODIFIED:this.notifyOppositeAdapters(XML3D.events.ADAPTER_VALUE_CHANGED)}}});e.LightShaderRenderAdapter=c})(XML3D.webgl);
(function(e){var c=function(b,a){e.TransformableAdapter.call(this,b,a);this.updateLightShader();this.createRenderNode()};XML3D.createClass(c,e.TransformableAdapter);c.prototype.createRenderNode=function(){var b=this.getParentRenderAdapter(),b=b.getRenderNode&&b.getRenderNode(),a=this.getLightShader();this.renderNode=this.factory.getScene().createRenderLight({light:{type:a?a.getLightType():null,data:a?a.getDataNode():null},parent:b,shader:a,visible:!this.node.visible?!1:void 0,localIntensity:this.node.intensity})};
c.prototype.notifyChanged=function(b){switch(b.type){case XML3D.events.THIS_REMOVED:this.dispose();break;case XML3D.events.ADAPTER_HANDLE_CHANGED:if("shader"==b.key){this.renderNode.remove();break}break;case XML3D.events.VALUE_MODIFIED:this.valueModified(b.wrapped.attrName,b.wrapped.newValue);break;case XML3D.events.ADAPTER_VALUE_CHANGED:this.renderNode.setLightType(b.adapter.getLightType())}};c.prototype.valueModified=function(b,a){switch(b){case "visible":this.renderNode.setLocalVisible("true"===
a);break;case "intensity":this.renderNode.setLocalIntensity(a);break;case "shader":this.renderNode.remove(),this.updateLightShader(),this.createRenderNode()}};c.prototype.updateLightShader=function(){var b=this.node.shader;if(!b){var a=this.node.getAttribute("style");a&&(a=/shader\s*:\s*url\s*\(\s*(\S+)\s*\)/i.exec(a))&&(b=a[1])}this.connectAdapterHandle("shader",this.getAdapterHandle(b))};c.prototype.getLightShader=function(){return this.getConnectedAdapter("shader")};c.prototype.dispose=function(){this.getRenderNode().remove();
this.clearAdapterHandles()};c.prototype.getWorldMatrix=function(){var b=new window.XML3DMatrix;this.renderNode.getWorldMatrix(b._data);return b};e.LightRenderAdapter=c})(XML3D.webgl);
(function(){var e=function(a){XML3D.base.NodeAdapterFactory.call(this,XML3D.webgl,a);this.type="RenderAdapterFactory"};XML3D.createClass(e,XML3D.base.NodeAdapterFactory);e.prototype.aspect=XML3D.webgl;XML3D.base.xml3dFormatHandler.registerFactoryClass(e);var c=XML3D.webgl,b={xml3d:c.XML3DRenderAdapter,view:c.ViewRenderAdapter,defs:c.DefsRenderAdapter,mesh:c.MeshRenderAdapter,model:c.ModelRenderAdapter,shader:c.ShaderRenderAdapter,group:c.GroupRenderAdapter,img:c.ImgRenderAdapter,light:c.LightRenderAdapter,
lightshader:c.LightShaderRenderAdapter};e.prototype.createAdapter=function(a){var c=b[a.localName];return void 0!==c?new c(this,a):null};e.prototype.setScene=function(a){this.scene=a};e.prototype.getScene=function(){return this.scene};e.prototype.setRenderer=function(a){this.renderer=a};e.prototype.getRenderer=function(){return this.renderer};XML3D.webgl.RenderAdapterFactory=e})();
(function(){var e={},c={};e.register=function(b,a){c[b]=a;a.name=b};e.getScript=function(b){return c[b]};XML3D.shaders=e})();
XML3D.shaders.register("matte",{vertex:"attribute vec3 position;\nattribute vec3 color;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n   fragVertexColor = color;\n   gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"uniform vec3 diffuseColor;\nuniform bool useVertexColor;\nvarying vec3 fragVertexColor;\nvoid main(void) {\n    vec3 color = diffuseColor;\n    if (useVertexColor)\n       color *=  fragVertexColor;\n    gl_FragColor = vec4(color, 1.0);\n}",uniforms:{diffuseColor:[1,
1,1],useVertexColor:!1},attributes:{color:null}});XML3D.shaders.register("flat",XML3D.shaders.getScript("matte"));
XML3D.shaders.register("diffuse",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nvoid main(void) {\n    vec3 pos = position;\n    vec3 norm = normal;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragNormal = normalize(modelViewMatrixN * norm);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n}",fragment:"uniform float ambientIntensity;\nuniform vec3 diffuseColor;\nuniform vec3 emissiveColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\n#if HAS_EMISSIVETEXTURE\nuniform sampler2D emissiveTexture;\n#endif\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if MAX_POINTLIGHTS > 0\nuniform vec3 pointLightAttenuation[MAX_POINTLIGHTS];\nuniform vec3 pointLightPosition[MAX_POINTLIGHTS];\nuniform vec3 pointLightIntensity[MAX_POINTLIGHTS];\nuniform bool pointLightOn[MAX_POINTLIGHTS];\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\nuniform vec3 directionalLightDirection[MAX_DIRECTIONALLIGHTS];\nuniform vec3 directionalLightIntensity[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightOn[MAX_DIRECTIONALLIGHTS];\n#endif\n#if MAX_SPOTLIGHTS > 0\nuniform vec3 spotLightAttenuation[MAX_SPOTLIGHTS];\nuniform vec3 spotLightPosition[MAX_SPOTLIGHTS];\nuniform vec3 spotLightIntensity[MAX_SPOTLIGHTS];\nuniform bool spotLightOn[MAX_SPOTLIGHTS];\nuniform vec3 spotLightDirection[MAX_SPOTLIGHTS];\nuniform float spotLightCosFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightCosSoftFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightSoftness[MAX_SPOTLIGHTS];\n#endif\nvoid main(void) {\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec4 texDiffuse = texture2D(diffuseTexture, fragTexCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  #if HAS_EMISSIVETEXTURE\n    vec3 color = emissiveColor * texture2D(emissiveTexture, fragTexCoord).rgb + (ambientIntensity * objDiffuse);\n  #else\n    vec3 color = emissiveColor + (ambientIntensity * objDiffuse);\n  #endif\n  #if MAX_POINTLIGHTS > 0\n    for (int i=0; i<MAX_POINTLIGHTS; i++) {\n      if (!pointLightOn[i])\n         continue;\n      vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n      vec3 L = lPosition.xyz - fragVertexPosition;\n      float dist = length(L);\n      L = normalize(L);\n      float atten = 1.0 / (pointLightAttenuation[i].x + pointLightAttenuation[i].y * dist + pointLightAttenuation[i].z * dist * dist);\n      vec3 Idiff = pointLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n      color = color + atten*Idiff;\n    }\n  #endif\n#if MAX_DIRECTIONALLIGHTS > 0\n  for (int i=0; i<MAX_DIRECTIONALLIGHTS; i++) {\n      if (!directionalLightOn[i])\n         continue;\n    vec4 lDirection = viewMatrix * vec4(directionalLightDirection[i], 0.0);\n    vec3 L =  normalize(-lDirection.xyz);\n    vec3 Idiff = directionalLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n    color = color + Idiff;\n  }\n#endif\n#if MAX_SPOTLIGHTS > 0\n  for (int i=0; i<MAX_SPOTLIGHTS; i++) {\n      if (!spotLightOn[i])\n         continue;\n    vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n    vec3 L = lPosition.xyz - fragVertexPosition;\n    float dist = length(L);\n    L = normalize(L);\n    float atten = 1.0 / (spotLightAttenuation[i].x + spotLightAttenuation[i].y * dist + spotLightAttenuation[i].z * dist * dist);\n    vec3 Idiff = spotLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n    vec4 lDirection = viewMatrix * vec4(-spotLightDirection[i], 0.0);\n    vec3 D = normalize(lDirection.xyz);\n    float angle = dot(L, D);\n    if(angle > spotLightCosFalloffAngle[i]) {\n       float softness = 1.0;\n       if (angle < spotLightCosSoftFalloffAngle[i])\n           softness = (angle - spotLightCosFalloffAngle[i]) /  (spotLightCosSoftFalloffAngle[i] -  spotLightCosFalloffAngle[i]);\n       color += atten * softness * Idiff;\n    }\n  }\n#endif\n  gl_FragColor = vec4(color, alpha);\n}",
addDirectives:function(e,c,b){var a=c.directional?c.directional.length:0,d=c.spot?c.spot.length:0;e.push("MAX_POINTLIGHTS "+(c.point?c.point.length:0));e.push("MAX_DIRECTIONALLIGHTS "+a);e.push("MAX_SPOTLIGHTS "+d);e.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in b?"1":"0"));e.push("HAS_EMISSIVETEXTURE "+("emissiveTexture"in b?"1":"0"))},hasTransparency:function(e){return e.transparency&&0.001<e.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],emissiveColor:[0,0,0],transparency:0,ambientIntensity:0,
useVertexColor:!1},samplers:{diffuseTexture:null,emissiveTexture:null},attributes:{normal:{required:!0},texcoord:null,color:null}});
XML3D.shaders.register("phong",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\nvarying vec3 fragWorldPosition;\n#endif\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nvoid main(void) {\n    vec3 pos = position;\n    vec3 norm = normal;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragNormal = normalize(modelViewMatrixN * norm);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\n    fragWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n#endif\n}",fragment:"uniform float ambientIntensity;\nuniform vec3 diffuseColor;\nuniform vec3 emissiveColor;\nuniform float shininess;\nuniform vec3 specularColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\nuniform vec3 coords;\n#if HAS_EMISSIVETEXTURE\nuniform sampler2D emissiveTexture;\n#endif\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\n#if HAS_SPECULARTEXTURE\nuniform sampler2D specularTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\nvarying vec3 fragWorldPosition;\nfloat unpackDepth( const in vec4 rgba_depth ) {\n  const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n  float depth = dot( rgba_depth, bit_shift );\n  return depth;\n}\n#endif\n#if MAX_POINTLIGHTS > 0\nuniform vec3 pointLightAttenuation[MAX_POINTLIGHTS];\nuniform vec3 pointLightPosition[MAX_POINTLIGHTS];\nuniform vec3 pointLightIntensity[MAX_POINTLIGHTS];\nuniform bool pointLightOn[MAX_POINTLIGHTS];\nuniform bool pointLightCastShadow[MAX_POINTLIGHTS];\n#if HAS_POINTLIGHT_SHADOWMAPS\nuniform samplerCube pointLightShadowMap[MAX_POINTLIGHTS];\nuniform float pointLightShadowBias[MAX_POINTLIGHTS];\nuniform vec2 pointLightNearFar[MAX_POINTLIGHTS];\nfloat vecToDepth(vec3 vec, float n, float f){\nvec3 absVec = abs(vec);float maxComp = max(absVec.x, max(absVec.y, absVec.z));\nfloat res = (f+n)/(f-n)-(2.0*f*n)/(f-n)/maxComp;\nreturn res*0.5+0.5;\n}\n#endif\n#endif\n#if MAX_SPOTLIGHTS > 0\nuniform vec3 spotLightAttenuation[MAX_SPOTLIGHTS];\nuniform vec3 spotLightPosition[MAX_SPOTLIGHTS];\nuniform vec3 spotLightIntensity[MAX_SPOTLIGHTS];\nuniform bool spotLightOn[MAX_SPOTLIGHTS];\nuniform vec3 spotLightDirection[MAX_SPOTLIGHTS];\nuniform float spotLightCosFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightCosSoftFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightSoftness[MAX_SPOTLIGHTS];\nuniform bool spotLightCastShadow[MAX_SPOTLIGHTS];\n#if HAS_SPOTLIGHT_SHADOWMAPS\nuniform mat4 spotLightMatrix[ MAX_SPOTLIGHTS ];\nuniform sampler2D spotLightShadowMap[MAX_SPOTLIGHTS];\nuniform float spotLightShadowBias[MAX_SPOTLIGHTS];\n#endif\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\nuniform vec3 directionalLightDirection[MAX_DIRECTIONALLIGHTS];\nuniform vec3 directionalLightIntensity[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightOn[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightCastShadow[MAX_DIRECTIONALLIGHTS];\n#if HAS_DIRECTIONALLIGHT_SHADOWMAPS\nuniform mat4 directionalLightMatrix[MAX_DIRECTIONALLIGHTS];\nuniform sampler2D directionalLightShadowMap[MAX_DIRECTIONALLIGHTS];\nuniform float directionalLightShadowBias[MAX_DIRECTIONALLIGHTS];\n#endif\n#endif\nuniform sampler2D ssaoMap;\nvoid main(void) {\n#if MAX_POINTLIGHTS > 0 && HAS_POINTLIGHT_SHADOWMAPS\n    vec3 pointLightShadowMapDirection[MAX_POINTLIGHTS];\n    for(int i = 0; i < MAX_POINTLIGHTS; i++) {\n       pointLightShadowMapDirection[i] = fragWorldPosition - pointLightPosition[i];\n    }\n#endif\n#if MAX_SPOTLIGHTS > 0 && HAS_SPOTLIGHT_SHADOWMAPS\n    vec4 spotLightShadowMapCoord[MAX_SPOTLIGHTS];\n    for(int i = 0; i < MAX_SPOTLIGHTS; i++) {\n      spotLightShadowMapCoord[i] = spotLightMatrix[i] * vec4(fragWorldPosition, 1.0);\n    }\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0 && HAS_DIRECTIONALLIGHT_SHADOWMAPS\n    vec4 directionalLightShadowMapCoord[MAX_DIRECTIONALLIGHTS];\n    for(int i = 0; i < MAX_DIRECTIONALLIGHTS; i++) {\n      directionalLightShadowMapCoord[i] = directionalLightMatrix[i] * vec4(fragWorldPosition, 1.0);\n    }\n#endif\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec4 texDiffuse = texture2D(diffuseTexture, fragTexCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  #if HAS_EMISSIVETEXTURE\n    vec3 color = emissiveColor * texture2D(emissiveTexture, fragTexCoord).rgb + (ambientIntensity * objDiffuse);\n  #else\n    vec3 color = emissiveColor + (ambientIntensity * objDiffuse);\n  #endif\n  vec3 objSpecular = specularColor;\n  #if HAS_SPECULARTEXTURE\n    objSpecular = objSpecular * texture2D(specularTexture, fragTexCoord).rgb;\n  #endif\n  #if HAS_SSAOMAP\n\t float ssao = 1.0 - texture2D(ssaoMap, gl_FragCoord.xy / coords.xy).r;\n  #endif\n  float shadowInfluence = 0.0;\n#if MAX_POINTLIGHTS > 0\n  for (int i = 0; i < MAX_POINTLIGHTS; i++) {\n    shadowInfluence = 1.0;\n    if(pointLightOn[i]){\n   #if HAS_POINTLIGHT_SHADOWMAPS\n       if(pointLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           float lsDepth = vecToDepth(pointLightShadowMapDirection[i], pointLightNearFar[i].x, pointLightNearFar[i].y );\n\t\t    float depth = unpackDepth( textureCube(pointLightShadowMap[i], pointLightShadowMapDirection[i])) +  pointLightShadowBias[i];\n           if(lsDepth < depth)\n               shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n   #endif\n       vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n       vec3 L = lPosition.xyz - fragVertexPosition;\n       float dist = length(L);\n       L = normalize(L);\n       vec3 R = normalize(reflect(L,fragNormal));\n       float atten = 1.0 / (pointLightAttenuation[i].x + pointLightAttenuation[i].y * dist + pointLightAttenuation[i].z * dist * dist);\n       vec3 Idiff = pointLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n       Idiff *= ssao;\n   #endif\n       vec3 Ispec = pointLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       color = color + (atten*shadowInfluence*(Idiff + Ispec));\n   #if HAS_POINTLIGHT_SHADOWMAPS\n       }\n   #endif\n     }\n  }\n#endif\n#if MAX_SPOTLIGHTS > 0\n  for (int i=0; i<MAX_SPOTLIGHTS; i++) {\n    shadowInfluence = 1.0;\n    if(spotLightOn[i]) {\n  #if HAS_SPOTLIGHT_SHADOWMAPS\n       if(spotLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           vec4 lspos = spotLightShadowMapCoord[i];\n\t\t\tvec3 perspectiveDivPos = lspos.xyz / lspos.w * 0.5 + 0.5;\n\t\t\tfloat lsDepth = perspectiveDivPos.z;\n\t\t\tvec2 lightuv = perspectiveDivPos.xy;\n\t\t\tfloat depth = unpackDepth(texture2D(spotLightShadowMap[i], lightuv)) + spotLightShadowBias[i];\n           if(lsDepth < depth)\n               shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n  #endif\n       vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n       vec3 L = lPosition.xyz - fragVertexPosition;\n       float dist = length(L);\n       L = normalize(L);\n       vec3 R = normalize(reflect(L,fragNormal));\n       float atten = 1.0 / (spotLightAttenuation[i].x + spotLightAttenuation[i].y * dist + spotLightAttenuation[i].z * dist * dist);\n       vec3 Idiff = spotLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n\t    Idiff *= ssao;\n   #endif\n       vec3 Ispec = spotLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       vec4 lDirection = viewMatrix * vec4(-spotLightDirection[i], 0.0);\n       vec3 D = normalize(lDirection.xyz);\n       float angle = dot(L, D);\n       if(angle > spotLightCosFalloffAngle[i]) {\n           float softness = 1.0;\n           if (angle < spotLightCosSoftFalloffAngle[i])\n               softness = (angle - spotLightCosFalloffAngle[i]) /  (spotLightCosSoftFalloffAngle[i] -  spotLightCosFalloffAngle[i]);\n           color += atten*softness*shadowInfluence*(Idiff + Ispec);\n       }\n   #if HAS_SPOTLIGHT_SHADOWMAPS\n       }\n   #endif\n   } \n  }\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\n  for (int i=0; i<MAX_DIRECTIONALLIGHTS; i++) {\n   shadowInfluence = 1.0;\n   if(directionalLightOn[i]){\n   #if HAS_DIRECTIONALLIGHT_SHADOWMAPS\n       if(directionalLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           vec4 lspos = directionalLightShadowMapCoord[i];\n           vec3 orthogonalDivPos = lspos.xyz / lspos.w *0.5 + 0.5;\n           float lsDepth = orthogonalDivPos.z;\n           vec2 lightuv = orthogonalDivPos.xy;\n               float depth = unpackDepth(texture2D(directionalLightShadowMap[i], lightuv))+directionalLightShadowBias[i];\n               if(lsDepth < depth) shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n   #endif\n       vec4 lDirection = viewMatrix * vec4(directionalLightDirection[i], 0.0);\n       vec3 L =  normalize(-lDirection.xyz);\n       vec3 R = normalize(reflect(L,fragNormal));\n       vec3 Idiff = directionalLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n       Idiff *= ssao;\n   #endif\n       vec3 Ispec = directionalLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       color = color + shadowInfluence*((Idiff + Ispec));\n   #if HAS_DIRECTIONALLIGHT_SHADOWMAPS\n       }\n   #endif\n   }\n  }\n#endif\n  gl_FragColor = vec4(color, alpha);\n}",
addDirectives:function(e,c,b){["point","directional","spot"].forEach(function(a){var b=c[a]?c[a].length:0,g=c[a]&&c[a].some(function(a){return a.castShadow});e.push("MAX_"+a.toUpperCase()+"LIGHTS "+b);e.push("HAS_"+a.toUpperCase()+"LIGHT_SHADOWMAPS "+(g?1:0))});e.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in b?"1":"0"));e.push("HAS_SPECULARTEXTURE "+("specularTexture"in b?"1":"0"));e.push("HAS_EMISSIVETEXTURE "+("emissiveTexture"in b?"1":"0"));e.push("HAS_SSAOMAP "+(XML3D.options.getValue("renderer-ssao")?
"1":"0"))},hasTransparency:function(e){return e.transparency&&0.001<e.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],emissiveColor:[0,0,0],specularColor:[0,0,0],transparency:0,shininess:0.2,ambientIntensity:0,useVertexColor:!1},samplers:{diffuseTexture:null,emissiveTexture:null,specularTexture:null,directionalLightShadowMap:null,spotLightShadowMap:null,pointLightShadowMap:null,ssaoMap:null},attributes:{normal:{required:!0},texcoord:null,color:null}});
XML3D.shaders.register("point",{vertex:"attribute vec3 position;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nuniform vec3 coords;\nuniform float pointSize;\nvoid main(void) {\n    vec3 pos = position;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n    vec4 pos2 = vec4(fragVertexPosition, 1.0); pos2.x += pointSize;\n    gl_PointSize = distance( gl_Position.xy, (projectionMatrix * pos2).xy ) * coords.x / gl_Position.w;\n}",fragment:"uniform vec3 diffuseColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\nuniform vec2 texCoordOffset;\nuniform vec2 texCoordSize;\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nvoid main(void) {\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec2 texCoord = fragTexCoord + texCoordOffset + gl_PointCoord*texCoordSize;\n    texCoord.y = 1.0 - texCoord.y;\n    vec4 texDiffuse = texture2D(diffuseTexture, texCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  gl_FragColor = vec4(objDiffuse, alpha);\n}",
addDirectives:function(e,c,b){e.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in b?"1":"0"))},hasTransparency:function(e){return e.transparency&&0.001<e.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],texCoordOffset:[0,0],texCoordSize:[1,1],transparency:0,useVertexColor:!1,pointSize:1},samplers:{diffuseTexture:null},attributes:{texcoord:null,color:null}});
XML3D.shaders.register("pickobjectid",{vertex:"attribute vec3 position;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"uniform vec3 id;\nvoid main(void) {\n    gl_FragColor = vec4(id, 0.0);\n}",uniforms:{}});
XML3D.shaders.register("pickedposition",{vertex:"attribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform vec3 bbox[2];\nvarying vec3 worldCoord;\nvoid main(void) {\n    worldCoord = (modelMatrix * vec4(position, 1.0)).xyz;\n    vec3 diff = bbox[1] - bbox[0];\n    worldCoord = worldCoord - bbox[0];\n    worldCoord = worldCoord / diff;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 worldCoord;\nvoid main(void) {\n    gl_FragColor = vec4(worldCoord, 1.0);\n}",
uniforms:{}});XML3D.shaders.register("pickedNormals",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat3 modelViewMatrixN;\nvarying vec3 fragNormal;\nvoid main(void) {\n    fragNormal = normalize(modelViewMatrixN * normal);\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 fragNormal;\nvoid main(void) {\n    gl_FragColor = vec4((fragNormal+1.0)/2.0 * (254.0 / 255.0), 1.0);\n}",uniforms:{}});
XML3D.shaders.register("light-depth",{vertex:"attribute vec3 position;\nvarying vec4 worldPosition;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n   worldPosition = modelMatrix * vec4(position, 1.0);\n   gl_Position   = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec4 worldPosition;\nuniform mat4 viewMatrix;\nvec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main(void) {\n    gl_FragColor = pack_depth( gl_FragCoord.z );\n}",
uniforms:{}});XML3D.shaders.register("render-normal",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat3 modelMatrixN;\nvarying vec3 fragNormal;\nvoid main(void) {\n    fragNormal = modelMatrixN * normal;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 fragNormal;\nvoid main(void) {\n   gl_FragColor = vec4((normalize(fragNormal) + 1.0) / 2.0, 1.0);\n}",uniforms:{}});
XML3D.shaders.register("render-position",{vertex:"attribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvarying vec3 worldCoord;\nvoid main(void) {\n    worldCoord = (modelMatrix * vec4(position, 1.0)).xyz;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 worldCoord;\nvoid main(void) {\n    gl_FragColor = vec4(worldCoord, 1.0);\n}",uniforms:{}});
XML3D.shaders.register("boxblur",{vertex:"attribute vec3 position;\nvoid main(void) {\n   gl_Position = vec4(position, 1.0);\n}",fragment:"uniform sampler2D sInTexture;\nuniform vec2 canvasSize;\nuniform vec2 blurOffset;\nconst float blurSize = 1.0/512.0;\nvoid main(void) {\n   vec2 texcoord = (gl_FragCoord.xy / canvasSize.xy);\n   vec4 sum = vec4(0.0);\n   float blurSizeY = blurOffset.y / canvasSize.y;\n   float blurSizeX = blurOffset.x / canvasSize.x;\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - 1.5*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - 2.0*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + 2.0*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + 1.5*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x - 1.5*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x - 2.0*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x - blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + 2.0*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + 1.5*blurSizeX, texcoord.y));\n   gl_FragColor = sum / 12.0;\n}",
uniforms:{canvasSize:[512,512],blurOffset:[1,1]},samplers:{sInTexture:null}});
XML3D.shaders.register("ssao",{vertex:"attribute vec2 position;\nvoid main(void) {\n    gl_Position = vec4(position, 0.0, 1.0);\n}",fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 canvasSize;\nuniform sampler2D sPositionTex;\nuniform sampler2D sNormalTex;\nuniform sampler2D sRandomNormals;\nuniform vec2 uRandomTexSize;\nuniform float uSampleRadius;\nuniform float uScale;\nuniform float uBias;\nuniform float uIntensity;\nuniform vec2 uConstVectors[4];\nuniform mat4 viewMatrix;\nvec3 getPosition(vec2 uv) {\nreturn texture2D(sPositionTex, uv).xyz;\n}\nfloat calcAmbientOcclusion(vec2 screenUV, vec2 uvOffset, vec3 origin, vec3 cnorm) {\n   vec3 diff = getPosition(screenUV + uvOffset) - origin;\n   vec3 v = normalize(diff);\n   float dist = length(diff) * uScale;\n   return max(0.0, dot(cnorm, v) - uBias) * (1.0/(1.0 + dist)) * uIntensity;\n}\nvoid main(void) {\n   vec2 screenUV = gl_FragCoord.xy / canvasSize.xy;\n   vec2 rand = normalize(texture2D(sRandomNormals, gl_FragCoord.xy / uRandomTexSize).xy * 2.0 - 1.0 );\n   vec3 norm = normalize(texture2D(sNormalTex, screenUV).xyz * 2.0 - 1.0 );\n   vec3 origin = getPosition(screenUV);\n   float radius = uSampleRadius / (viewMatrix * vec4(origin, 1.0)).z;\n   float ao = 0.0;\n   const int iterations = 4;\n   for (int i = 0; i < iterations; ++i) {\n       vec2 coord1 = reflect(uConstVectors[i], rand) * radius;\n       vec2 coord2 = vec2(coord1.x*0.707 - coord1.y*0.707, coord1.x*0.707 + coord1.y*0.707);\n       ao += calcAmbientOcclusion(screenUV, coord1*0.25, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord2*0.5, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord1*0.75, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord2, origin, norm);\n   }\n   ao /= (float(iterations) * 4.0);\n   gl_FragColor = vec4(ao, ao, ao, 1.0);\n}",uniforms:{canvasSize:[512,
512],uConstVectors:[1,0,-1,0,0,1,0,-1],uRandomTexSize:[64,64],uSampleRadius:0.9,uScale:0.9,uBias:0.2,uIntensity:1},samplers:{sPositionTex:null,sNormalTex:null,sRandomNormals:null},attributes:{}});